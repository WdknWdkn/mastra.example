exports.id=396,exports.ids=[396],exports.modules={37347:()=>{throw Error('Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <p align="center">\n|   <a href="https://docs.turso.tech/sdk/ts/quickstart">\n|     <img alt="Turso + TypeScript" src="https://github.com/tursodatabase/libsql-client-ts/assets/950181/5d3a2693-75f9-4c56-9107-8ccaa96785fd" width="1000">')},74480:()=>{throw Error("Module parse failed: Unexpected token (1:4)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> MIT License\n| \n| Copyright 2023 the sqld authors")},76138:()=>{throw Error("Module parse failed: Unexpected character ' ' (1:1)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> # Hrana client for TypeScript\n| \n| **[API docs][docs] | [Github][github] | [npm][npm]**")},41126:()=>{throw Error("Module parse failed: Unexpected character ' ' (1:1)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> # `@libsql/isomorphic-fetch`\n| \n| This package provides `fetch()` on Node (using `node-fetch`) and in Deno and Cloudflare Workers (using the native `fetch()`). Supports both CommonJS and ES modules.")},99071:()=>{throw Error("Module parse failed: Unexpected character ' ' (1:1)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> # `@libsql/isomorphic-ws`\n| \n| This package provides `WebSocket` on Node (using `ws`) and in Deno and Cloudflare Workers (using the native `WebSocket`). Supports both CommonJS and ES modules.")},56373:()=>{throw Error("Module parse failed: Unexpected character ' ' (1:1)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> # `@libsql/linux-x64-gnu`\n| \n| Prebuilt binary package for `libsql` on `linux-x64-gnu`.")},41103:()=>{throw Error("Module parse failed: Unexpected character '\x7f' (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n(Source code omitted for this binary file)")},87736:()=>{throw Error("Module parse failed: Unexpected character ' ' (1:1)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> # `@libsql/linux-x64-musl`\n| \n| Prebuilt binary package for `libsql` on `linux-x64-musl`.")},4608:()=>{throw Error("Module parse failed: Unexpected character '\x7f' (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n(Source code omitted for this binary file)")},80439:()=>{throw Error("Module parse failed: Unexpected token (2:7)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-loader/index.js\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n| /** Configuration object for {@link createClient}. */\n> export interface Config {\n|     /** The database URL.\n|      *")},29249:()=>{throw Error('Module parse failed: Unexpected token (1:12)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-loader/index.js\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n> import type { Config, IntMode } from "./api.js";\n| import type { Authority } from "./uri.js";\n| export interface ExpandedConfig {')},15238:()=>{throw Error('Module parse failed: Unexpected token (2:7)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-loader/index.js\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n| /// <reference types="node" />\n> export interface Uri {\n|     scheme: string;\n|     authority: Authority | undefined;')},30675:()=>{throw Error('Module parse failed: Unexpected token (2:7)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-loader/index.js\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n| import { ResultSet, Row, TransactionMode } from "./api";\n> export declare const supportedUrlLink = "https://github.com/libsql/libsql-client-ts#supported-urls";\n| export declare function transactionModeToBegin(mode: TransactionMode): string;\n| export declare class ResultSetImpl implements ResultSet {')},14499:()=>{throw Error('Module parse failed: Unexpected token (1:12)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-loader/index.js\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n> import type { RowsResult, RowResult, ValueResult, StmtResult } from "./result.js";\n| import type * as proto from "./shared/proto.js";\n| import type { InStmt } from "./stmt.js";')},37369:()=>{throw Error("Module parse failed: Unexpected token (1:7)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-loader/index.js\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n> export declare class ByteQueue {\n|     #private;\n|     constructor(initialCap: number);")},66374:()=>{throw Error('Module parse failed: Unexpected token (1:12)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-loader/index.js\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n> import type { Stream } from "./stream.js";\n| import type { IntMode } from "./value.js";\n| export type ProtocolVersion = 1 | 2 | 3;')},16479:()=>{throw Error('Module parse failed: Unexpected token (1:12)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-loader/index.js\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n> import type * as proto from "./shared/proto.js";\n| export declare abstract class Cursor {\n|     /** Fetch the next entry from the cursor. */')},99287:()=>{throw Error('Module parse failed: Unexpected token (1:12)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-loader/index.js\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n> import type * as proto from "./shared/proto.js";\n| export interface DescribeResult {\n|     paramNames: Array<string | undefined>;')},75699:(e,t,r)=>{"use strict";r.r(t),r.d(t,{readJsonObject:()=>s.readJsonObject,readProtobufMessage:()=>i.readProtobufMessage,writeJsonObject:()=>o.writeJsonObject,writeProtobufMessage:()=>a.writeProtobufMessage});var s=r(7966),o=r(77705),i=r(94062),a=r(93874)},72762:()=>{throw Error("Module parse failed: Unexpected token (1:7)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-loader/index.js\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n> export type Value = Obj | Array<Value> | string | number | true | false | null;\n| export type Obj = {\n|     [key: string]: Value | undefined;")},64293:()=>{throw Error("Module parse failed: Unexpected token (1:7)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-loader/index.js\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n> export type ObjectFun<T> = (w: ObjectWriter, value: T) => void;\n| export declare class ObjectWriter {\n|     #private;")},416:()=>{throw Error("Module parse failed: Unexpected token (1:7)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-loader/index.js\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n> export interface MessageDef<T> {\n|     default(): T;\n|     [tag: number]: (r: FieldReader, msg: T) => T | void;")},13933:()=>{throw Error("Module parse failed: Unexpected token (1:7)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-loader/index.js\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n> export type MessageFun<T> = (w: MessageWriter, msg: T) => void;\n| export declare class MessageWriter {\n|     #private;")},15593:()=>{throw Error("Module parse failed: Unexpected token (1:7)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-loader/index.js\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n> export type WireType = 0 | 1 | 2 | 3 | 4 | 5;\n| export declare const VARINT: WireType;\n| export declare const FIXED_64: WireType;")},1496:()=>{throw Error('Module parse failed: Unexpected token (1:12)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-loader/index.js\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n> import type * as proto from "./shared/proto.js";\n| /** Generic error produced by the Hrana client. */\n| export declare class ClientError extends Error {')},29178:()=>{throw Error('Module parse failed: Unexpected token (2:12)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-loader/index.js\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n| /// <reference types="node" />\n> import type { ProtocolVersion, ProtocolEncoding } from "../client.js";\n| import { Client } from "../client.js";\n| import { HttpStream } from "./stream.js";')},50166:()=>{throw Error('Module parse failed: Unexpected token (1:12)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-loader/index.js\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n> import type { Response } from "@libsql/isomorphic-fetch";\n| import type { ProtocolEncoding } from "../client.js";\n| import { Cursor } from "../cursor.js";')},60012:()=>{throw Error('Module parse failed: Unexpected token (3:7)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-loader/index.js\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n| import * as d from "../encoding/json/decode.js";\n| import * as proto from "./proto.js";\n> export declare function PipelineRespBody(obj: d.Obj): proto.PipelineRespBody;\n| export declare function CursorRespBody(obj: d.Obj): proto.CursorRespBody;\n| ')},31207:()=>{throw Error('Module parse failed: Unexpected token (3:7)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-loader/index.js\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n| import * as e from "../encoding/json/encode.js";\n| import * as proto from "./proto.js";\n> export declare function PipelineReqBody(w: e.ObjectWriter, msg: proto.PipelineReqBody): void;\n| export declare function CursorReqBody(w: e.ObjectWriter, msg: proto.CursorReqBody): void;\n| ')},50885:()=>{throw Error('Module parse failed: Unexpected token (3:7)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-loader/index.js\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n| export * from "../shared/proto.js";\n| import { int32, Error, Stmt, StmtResult, Batch, BatchResult, DescribeResult } from "../shared/proto.js";\n> export type PipelineReqBody = {\n|     baton: string | undefined;\n|     requests: Array<StreamRequest>;')},91365:()=>{throw Error('Module parse failed: Unexpected token (3:7)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-loader/index.js\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n| import * as d from "../encoding/protobuf/decode.js";\n| import * as proto from "./proto.js";\n> export declare const PipelineRespBody: d.MessageDef<proto.PipelineRespBody>;\n| export declare const CursorRespBody: d.MessageDef<proto.CursorRespBody>;\n| ')},52198:()=>{throw Error('Module parse failed: Unexpected token (3:7)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-loader/index.js\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n| import * as e from "../encoding/protobuf/encode.js";\n| import * as proto from "./proto.js";\n> export declare function PipelineReqBody(w: e.MessageWriter, msg: proto.PipelineReqBody): void;\n| export declare function CursorReqBody(w: e.MessageWriter, msg: proto.CursorReqBody): void;\n| ')},41793:()=>{throw Error('Module parse failed: Unexpected token (2:12)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-loader/index.js\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n| /// <reference types="node" />\n> import type { fetch } from "@libsql/isomorphic-fetch";\n| import type { SqlOwner, ProtoSql } from "../sql.js";\n| import { Sql } from "../sql.js";')},36208:()=>{throw Error("Module parse failed: Unexpected token (1:7)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-loader/index.js\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n> export declare class IdAlloc {\n|     #private;\n|     constructor();")},78908:()=>{throw Error('Module parse failed: Unexpected token (6:7)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-loader/index.js\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n| import { ProtocolVersion } from "./client.js";\n| export { WebSocket } from "@libsql/isomorphic-ws";\n> export type { RequestInit, Response } from "@libsql/isomorphic-fetch";\n| export { fetch, Request, Headers } from "@libsql/isomorphic-fetch";\n| export type { ProtocolVersion, ProtocolEncoding } from "./client.js";')},42044:()=>{throw Error("Module parse failed: Unexpected token (2:7)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-loader/index.js\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n| /** Result of parsing a libsql URL using {@link parseLibsqlUrl}. */\n> export interface ParsedLibsqlUrl {\n|     /** A WebSocket URL that can be used with {@link openWs} to open a {@link WsClient}. It is `undefined`\n|      * if the parsed URL specified HTTP explicitly. */")},71298:()=>{throw Error("Module parse failed: Unexpected token (1:7)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-loader/index.js\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n> export declare class Queue<T> {\n|     #private;\n|     constructor();")},35536:()=>{throw Error("Module parse failed: Unexpected token (1:8)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-loader/index.js\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n> declare let _queueMicrotask: (callback: () => void) => void;\n| export { _queueMicrotask as queueMicrotask };\n| ")},92430:()=>{throw Error('Module parse failed: Unexpected token (2:12)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-loader/index.js\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n| import { ResponseError } from "./errors.js";\n> import type * as proto from "./shared/proto.js";\n| import type { Value, IntMode } from "./value.js";\n| /** Result of executing a database statement. */')},50888:()=>{throw Error('Module parse failed: Unexpected token (3:7)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-loader/index.js\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n| import * as d from "../encoding/json/decode.js";\n| import * as proto from "./proto.js";\n> export declare function Error(obj: d.Obj): proto.Error;\n| export declare function StmtResult(obj: d.Obj): proto.StmtResult;\n| export declare function BatchResult(obj: d.Obj): proto.BatchResult;')},24410:()=>{throw Error('Module parse failed: Unexpected token (3:7)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-loader/index.js\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n| import * as e from "../encoding/json/encode.js";\n| import * as proto from "./proto.js";\n> export declare function Stmt(w: e.ObjectWriter, msg: proto.Stmt): void;\n| export declare function Batch(w: e.ObjectWriter, msg: proto.Batch): void;\n| ')},4113:()=>{throw Error("Module parse failed: Unexpected token (1:7)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-loader/index.js\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n> export type int32 = number;\n| export type uint32 = number;\n| export type Error = {")},51588:()=>{throw Error('Module parse failed: Unexpected token (3:7)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-loader/index.js\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n| import * as d from "../encoding/protobuf/decode.js";\n| import * as proto from "./proto.js";\n> export declare const Error: d.MessageDef<proto.Error>;\n| export declare const StmtResult: d.MessageDef<proto.StmtResult>;\n| export declare const BatchResult: d.MessageDef<proto.BatchResult>;')},15788:()=>{throw Error('Module parse failed: Unexpected token (3:7)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-loader/index.js\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n| import * as e from "../encoding/protobuf/encode.js";\n| import * as proto from "./proto.js";\n> export declare function Stmt(w: e.MessageWriter, msg: proto.Stmt): void;\n| export declare function Batch(w: e.MessageWriter, msg: proto.Batch): void;\n| ')},8021:()=>{throw Error("Module parse failed: Unexpected token (3:7)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-loader/index.js\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n| /** A SQL text that you can send to the database. Either a string or a reference to SQL text that is cached on\n|  * the server. */\n> export type InSql = string | Sql;\n| export interface SqlOwner {\n|     /** Cache a SQL text on the server. This requires protocol version 2 or higher. */")},16607:()=>{throw Error('Module parse failed: Unexpected token (1:12)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-loader/index.js\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n> import type * as proto from "./shared/proto.js";\n| import type { InSql, SqlOwner } from "./sql.js";\n| import type { InValue } from "./value.js";')},77190:()=>{throw Error('Module parse failed: Unexpected token (2:12)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-loader/index.js\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n| import { Batch } from "./batch.js";\n> import type { Client } from "./client.js";\n| import type { Cursor } from "./cursor.js";\n| import type { DescribeResult } from "./describe.js";')},35450:()=>{throw Error("Module parse failed: Unexpected token (1:7)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-loader/index.js\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n> export declare function impossible(value: never, message: string): Error;\n| ")},54976:()=>{throw Error('Module parse failed: Unexpected token (1:12)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-loader/index.js\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n> import type * as proto from "./shared/proto.js";\n| /** JavaScript values that you can receive from the database in a statement result. */\n| export type Value = null | string | number | bigint | ArrayBuffer;')},34868:()=>{throw Error('Module parse failed: Unexpected token (3:12)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-loader/index.js\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n| /// <reference types="ws" />\n| import { WebSocket } from "@libsql/isomorphic-ws";\n> import type { ProtocolVersion, ProtocolEncoding } from "../client.js";\n| import { Client } from "../client.js";\n| import { IdAlloc } from "../id_alloc.js";')},71520:()=>{throw Error('Module parse failed: Unexpected token (2:12)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-loader/index.js\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n| import { Cursor } from "../cursor.js";\n> import type { WsClient } from "./client.js";\n| import type * as proto from "./proto.js";\n| import type { WsStream } from "./stream.js";')},49796:()=>{throw Error('Module parse failed: Unexpected token (3:7)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-loader/index.js\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n| import * as d from "../encoding/json/decode.js";\n| import * as proto from "./proto.js";\n> export declare function ServerMsg(obj: d.Obj): proto.ServerMsg;\n| ')},25753:()=>{throw Error('Module parse failed: Unexpected token (3:7)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-loader/index.js\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n| import * as e from "../encoding/json/encode.js";\n| import * as proto from "./proto.js";\n> export declare function ClientMsg(w: e.ObjectWriter, msg: proto.ClientMsg): void;\n| ')},67101:()=>{throw Error('Module parse failed: Unexpected token (3:7)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-loader/index.js\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n| export * from "../shared/proto.js";\n| import { int32, uint32, Error, Stmt, StmtResult, Batch, BatchResult, CursorEntry, DescribeResult } from "../shared/proto.js";\n> export type ClientMsg = HelloMsg | RequestMsg;\n| export type ServerMsg = {\n|     type: "none";')},99254:()=>{throw Error('Module parse failed: Unexpected token (3:7)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-loader/index.js\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n| import * as d from "../encoding/protobuf/decode.js";\n| import * as proto from "./proto.js";\n> export declare const ServerMsg: d.MessageDef<proto.ServerMsg>;\n| ')},90146:()=>{throw Error('Module parse failed: Unexpected token (3:7)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-loader/index.js\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n| import * as e from "../encoding/protobuf/encode.js";\n| import * as proto from "./proto.js";\n> export declare function ClientMsg(w: e.MessageWriter, msg: proto.ClientMsg): void;\n| ')},70495:()=>{throw Error('Module parse failed: Unexpected token (1:12)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-loader/index.js\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n> import type { SqlOwner, ProtoSql } from "../sql.js";\n| import { Stream } from "../stream.js";\n| import type { WsClient } from "./client.js";')},86664:()=>{throw Error('Module parse failed: Unexpected token (3:27)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-loader/index.js\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n| // these type declarations are extracted and heavily simplified from the TypeScript "dom" library\n| \n> export function fetch(input: Request): Promise<Response>;\n| \n| export class Request {')},45713:(e,t,r)=>{"use strict";r.r(t),r.d(t,{WebSocket:()=>s.ZP});var s=r(1559)},60452:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var o=Object.getOwnPropertyDescriptor(t,r);(!o||("get"in o?!t.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,o)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&s(t,e,r);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.load=t.currentTarget=void 0;let a=i(r(55315)),l=i(r(92048));t.currentTarget=function(){let e=null;switch(process.platform){case"android":switch(process.arch){case"arm":return"android-arm-eabi";case"arm64":return"android-arm64"}e="Android";break;case"win32":switch(process.arch){case"x64":return"win32-x64-msvc";case"arm64":return"win32-arm64-msvc";case"ia32":return"win32-ia32-msvc"}e="Windows";break;case"darwin":switch(process.arch){case"x64":return"darwin-x64";case"arm64":return"darwin-arm64"}e="macOS";break;case"linux":switch(process.arch){case"x64":case"arm64":return!function(){let e=process.report?.getReport();if("object"!=typeof e||!e||!("header"in e))return!1;let t=e.header;return"object"==typeof t&&!!t&&"glibcVersionRuntime"in t}()?`linux-${process.arch}-musl`:`linux-${process.arch}-gnu`;case"arm":return"linux-arm-gnueabihf"}e="Linux";break;case"freebsd":if("x64"===process.arch)return"freebsd-x64";e="FreeBSD"}if(e)throw Error(`Neon: unsupported ${e} architecture: ${process.arch}`);throw Error(`Neon: unsupported system: ${process.platform}`)},t.load=function(e){let t=a.join(e,"index.node");return l.existsSync(t)?r(37900)(t):null}},66263:e=>{"use strict";if("undefined"!=typeof SharedArrayBuffer&&"undefined"!=typeof Atomics){let t=new Int32Array(new SharedArrayBuffer(4));e.exports=function(e){if(!1==(e>0&&e<1/0)){if("number"!=typeof e&&"bigint"!=typeof e)throw TypeError("sleep: ms must be a number");throw RangeError("sleep: ms must be a number that is greater than 0 but less than Infinity")}Atomics.wait(t,0,0,Number(e))}}else e.exports=function(e){if(!1==(e>0&&e<1/0)){if("number"!=typeof e&&"bigint"!=typeof e)throw TypeError("sleep: ms must be a number");throw RangeError("sleep: ms must be a number that is greater than 0 but less than Infinity")}let t=Date.now()+Number(e);for(;t>Date.now(););}},71827:(e,t,r)=>{"use strict";var s;function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(i){var a,l,u,c=arguments,d=(a=/d{1,4}|D{3,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|W{1,2}|[LlopSZN]|"[^"]*"|'[^']*'/g,l=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,u=/[^-+\dA-Z]/g,function(e,t,r,s){if(1!==c.length||"string"!==g(e)||/\d/.test(e)||(t=e,e=void 0),(e=e||0===e?e:new Date)instanceof Date||(e=new Date(e)),isNaN(e))throw TypeError("Invalid date");var o=(t=String(d.masks[t]||t||d.masks.default)).slice(0,4);("UTC:"===o||"GMT:"===o)&&(t=t.slice(4),r=!0,"GMT:"===o&&(s=!0));var i=function(){return r?"getUTC":"get"},y=function(){return e[i()+"Date"]()},b=function(){return e[i()+"Day"]()},_=function(){return e[i()+"Month"]()},v=function(){return e[i()+"FullYear"]()},w=function(){return e[i()+"Hours"]()},S=function(){return e[i()+"Minutes"]()},E=function(){return e[i()+"Seconds"]()},k=function(){return e[i()+"Milliseconds"]()},I=function(){return r?0:e.getTimezoneOffset()},O=function(){return f(e)},T={d:function(){return y()},dd:function(){return p(y())},ddd:function(){return d.i18n.dayNames[b()]},DDD:function(){return h({y:v(),m:_(),d:y(),_:i(),dayName:d.i18n.dayNames[b()],short:!0})},dddd:function(){return d.i18n.dayNames[b()+7]},DDDD:function(){return h({y:v(),m:_(),d:y(),_:i(),dayName:d.i18n.dayNames[b()+7]})},m:function(){return _()+1},mm:function(){return p(_()+1)},mmm:function(){return d.i18n.monthNames[_()]},mmmm:function(){return d.i18n.monthNames[_()+12]},yy:function(){return String(v()).slice(2)},yyyy:function(){return p(v(),4)},h:function(){return w()%12||12},hh:function(){return p(w()%12||12)},H:function(){return w()},HH:function(){return p(w())},M:function(){return S()},MM:function(){return p(S())},s:function(){return E()},ss:function(){return p(E())},l:function(){return p(k(),3)},L:function(){return p(Math.floor(k()/10))},t:function(){return 12>w()?d.i18n.timeNames[0]:d.i18n.timeNames[1]},tt:function(){return 12>w()?d.i18n.timeNames[2]:d.i18n.timeNames[3]},T:function(){return 12>w()?d.i18n.timeNames[4]:d.i18n.timeNames[5]},TT:function(){return 12>w()?d.i18n.timeNames[6]:d.i18n.timeNames[7]},Z:function(){return s?"GMT":r?"UTC":(String(e).match(l)||[""]).pop().replace(u,"").replace(/GMT\+0000/g,"UTC")},o:function(){return(I()>0?"-":"+")+p(100*Math.floor(Math.abs(I())/60)+Math.abs(I())%60,4)},p:function(){return(I()>0?"-":"+")+p(Math.floor(Math.abs(I())/60),2)+":"+p(Math.floor(Math.abs(I())%60),2)},S:function(){return["th","st","nd","rd"][y()%10>3?0:(y()%100-y()%10!=10)*y()%10]},W:function(){return O()},WW:function(){return p(O())},N:function(){return m(e)}};return t.replace(a,function(e){return e in T?T[e]():e.slice(1,e.length-1)})});d.masks={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",paddedShortDate:"mm/dd/yyyy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:sso",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",expiresHeaderFormat:"ddd, dd mmm yyyy HH:MM:ss Z"},d.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"],timeNames:["a","p","am","pm","A","P","AM","PM"]};var p=function(e,t){for(e=String(e),t=t||2;e.length<t;)e="0"+e;return e},h=function(e){var t=e.y,r=e.m,s=e.d,o=e._,i=e.dayName,a=e.short,l=void 0!==a&&a,u=new Date,c=new Date;c.setDate(c[o+"Date"]()-1);var d=new Date;return(d.setDate(d[o+"Date"]()+1),u[o+"FullYear"]()===t&&u[o+"Month"]()===r&&u[o+"Date"]()===s)?l?"Tdy":"Today":c[o+"FullYear"]()===t&&c[o+"Month"]()===r&&c[o+"Date"]()===s?l?"Ysd":"Yesterday":d[o+"FullYear"]()===t&&d[o+"Month"]()===r&&d[o+"Date"]()===s?l?"Tmw":"Tomorrow":i},f=function(e){var t=new Date(e.getFullYear(),e.getMonth(),e.getDate());t.setDate(t.getDate()-(t.getDay()+6)%7+3);var r=new Date(t.getFullYear(),0,4);r.setDate(r.getDate()-(r.getDay()+6)%7+3);var s=t.getTimezoneOffset()-r.getTimezoneOffset();return t.setHours(t.getHours()-s),1+Math.floor((t-r)/(864e5*7))},m=function(e){var t=e.getDay();return 0===t&&(t=7),t},g=function(e){return null===e?"null":void 0===e?"undefined":"object"!==o(e)?o(e):Array.isArray(e)?"array":({}).toString.call(e).slice(8,-1).toLowerCase()};void 0!==(s=(function(){return d}).call(t,r,t,e))&&(e.exports=s)}(void 0)},96474:(e,t,r)=>{"use strict";let s,o;let i=r(61282),{isLinux:a,getReport:l}=r(60057),{LDD_PATH:u,readFile:c,readFileSync:d}=r(6825),p="getconf GNU_LIBC_VERSION 2>&1 || true; ldd --version 2>&1 || true",h="",f=()=>h||new Promise(e=>{i.exec(p,(t,r)=>{e(h=t?" ":r)})}),m=()=>{if(!h)try{h=i.execSync(p,{encoding:"utf8"})}catch(e){h=" "}return h},g="glibc",y=/GLIBC\s(\d+\.\d+)/,b="musl",_=g.toUpperCase(),v=b.toLowerCase(),w=e=>e.includes("libc.musl-")||e.includes("ld-musl-"),S=()=>{let e=l();return e.header&&e.header.glibcVersionRuntime?g:Array.isArray(e.sharedObjects)&&e.sharedObjects.some(w)?b:null},E=e=>{let[t,r]=e.split(/[\r\n]+/);return t&&t.includes(g)?g:r&&r.includes(b)?b:null},k=e=>e.includes(v)?b:e.includes(_)?g:null,I=async()=>{if(void 0!==s)return s;s=null;try{let e=await c(u);s=k(e)}catch(e){}return s},O=()=>{if(void 0!==s)return s;s=null;try{let e=d(u);s=k(e)}catch(e){}return s},T=async()=>{let e=null;return a()&&((e=await I())||(e=S()),e||(e=E(await f()))),e},j=()=>{let e=null;return a()&&((e=O())||(e=S()),e||(e=E(m()))),e},C=async()=>a()&&await T()!==g,R=async()=>{if(void 0!==o)return o;o=null;try{let e=(await c(u)).match(y);e&&(o=e[1])}catch(e){}return o},A=()=>{if(void 0!==o)return o;o=null;try{let e=d(u).match(y);e&&(o=e[1])}catch(e){}return o},P=()=>{let e=l();return e.header&&e.header.glibcVersionRuntime?e.header.glibcVersionRuntime:null},N=e=>e.trim().split(/\s+/)[1],q=e=>{let[t,r,s]=e.split(/[\r\n]+/);return t&&t.includes(g)?N(t):r&&s&&r.includes(b)?N(s):null},M=async()=>{let e=null;return a()&&((e=await R())||(e=P()),e||(e=q(await f()))),e};e.exports={GLIBC:g,MUSL:b,family:T,familySync:j,isNonGlibcLinux:C,isNonGlibcLinuxSync:()=>a()&&j()!==g,version:M,versionSync:()=>{let e=null;return a()&&((e=A())||(e=P()),e||(e=q(m()))),e}}},6825:(e,t,r)=>{"use strict";let s=r(92048);e.exports={LDD_PATH:"/usr/bin/ldd",readFileSync:e=>s.readFileSync(e,"utf-8"),readFile:e=>new Promise((t,r)=>{s.readFile(e,"utf-8",(e,s)=>{e?r(e):t(s)})})}},60057:e=>{"use strict";let t=()=>"linux"===process.platform,r=null;e.exports={isLinux:t,getReport:()=>(r||(r=t()&&process.report?process.report.getReport():{}),r)}},79500:(e,t,r)=>{let s=r(92048),o=r(55315),i=r(19801),a=r(84770),l=r(63229).version,u=/(?:^|^)\s*(?:export\s+)?([\w.-]+)(?:\s*=\s*?|:\s+?)(\s*'(?:\\'|[^'])*'|\s*"(?:\\"|[^"])*"|\s*`(?:\\`|[^`])*`|[^#\r\n]+)?\s*(?:#.*)?(?:$|$)/mg;function c(e){console.log(`[dotenv@${l}][DEBUG] ${e}`)}function d(e){return e&&e.DOTENV_KEY&&e.DOTENV_KEY.length>0?e.DOTENV_KEY:process.env.DOTENV_KEY&&process.env.DOTENV_KEY.length>0?process.env.DOTENV_KEY:""}function p(e){let t=null;if(e&&e.path&&e.path.length>0){if(Array.isArray(e.path))for(let r of e.path)s.existsSync(r)&&(t=r.endsWith(".vault")?r:`${r}.vault`);else t=e.path.endsWith(".vault")?e.path:`${e.path}.vault`}else t=o.resolve(process.cwd(),".env.vault");return s.existsSync(t)?t:null}function h(e){return"~"===e[0]?o.join(i.homedir(),e.slice(1)):e}let f={configDotenv:function(e){let t;let r=o.resolve(process.cwd(),".env"),i="utf8",a=!!(e&&e.debug);e&&e.encoding?i=e.encoding:a&&c("No encoding is specified. UTF-8 is used by default");let l=[r];if(e&&e.path){if(Array.isArray(e.path))for(let t of(l=[],e.path))l.push(h(t));else l=[h(e.path)]}let u={};for(let r of l)try{let t=f.parse(s.readFileSync(r,{encoding:i}));f.populate(u,t,e)}catch(e){a&&c(`Failed to load ${r} ${e.message}`),t=e}let d=process.env;return(e&&null!=e.processEnv&&(d=e.processEnv),f.populate(d,u,e),t)?{parsed:u,error:t}:{parsed:u}},_configVault:function(e){console.log(`[dotenv@${l}][INFO] Loading env from encrypted .env.vault`);let t=f._parseVault(e),r=process.env;return e&&null!=e.processEnv&&(r=e.processEnv),f.populate(r,t,e),{parsed:t}},_parseVault:function(e){let t;let r=p(e),s=f.configDotenv({path:r});if(!s.parsed){let e=Error(`MISSING_DATA: Cannot parse ${r} for an unknown reason`);throw e.code="MISSING_DATA",e}let o=d(e).split(","),i=o.length;for(let e=0;e<i;e++)try{let r=o[e].trim(),i=function(e,t){let r;try{r=new URL(t)}catch(e){if("ERR_INVALID_URL"===e.code){let e=Error("INVALID_DOTENV_KEY: Wrong format. Must be in valid uri format like dotenv://:key_1234@dotenvx.com/vault/.env.vault?environment=development");throw e.code="INVALID_DOTENV_KEY",e}throw e}let s=r.password;if(!s){let e=Error("INVALID_DOTENV_KEY: Missing key part");throw e.code="INVALID_DOTENV_KEY",e}let o=r.searchParams.get("environment");if(!o){let e=Error("INVALID_DOTENV_KEY: Missing environment part");throw e.code="INVALID_DOTENV_KEY",e}let i=`DOTENV_VAULT_${o.toUpperCase()}`,a=e.parsed[i];if(!a){let e=Error(`NOT_FOUND_DOTENV_ENVIRONMENT: Cannot locate environment ${i} in your .env.vault file.`);throw e.code="NOT_FOUND_DOTENV_ENVIRONMENT",e}return{ciphertext:a,key:s}}(s,r);t=f.decrypt(i.ciphertext,i.key);break}catch(t){if(e+1>=i)throw t}return f.parse(t)},config:function(e){if(0===d(e).length)return f.configDotenv(e);let t=p(e);if(!t){var r;return r=`You set DOTENV_KEY but you are missing a .env.vault file at ${t}. Did you forget to build it?`,console.log(`[dotenv@${l}][WARN] ${r}`),f.configDotenv(e)}return f._configVault(e)},decrypt:function(e,t){let r=Buffer.from(t.slice(-64),"hex"),s=Buffer.from(e,"base64"),o=s.subarray(0,12),i=s.subarray(-16);s=s.subarray(12,-16);try{let e=a.createDecipheriv("aes-256-gcm",r,o);return e.setAuthTag(i),`${e.update(s)}${e.final()}`}catch(s){let e=s instanceof RangeError,t="Invalid key length"===s.message,r="Unsupported state or unable to authenticate data"===s.message;if(e||t){let e=Error("INVALID_DOTENV_KEY: It must be 64 characters long (or more)");throw e.code="INVALID_DOTENV_KEY",e}if(r){let e=Error("DECRYPTION_FAILED: Please check your DOTENV_KEY");throw e.code="DECRYPTION_FAILED",e}throw s}},parse:function(e){let t;let r={},s=e.toString();for(s=s.replace(/\r\n?/mg,"\n");null!=(t=u.exec(s));){let e=t[1],s=t[2]||"",o=(s=s.trim())[0];s=s.replace(/^(['"`])([\s\S]*)\1$/mg,"$2"),'"'===o&&(s=(s=s.replace(/\\n/g,"\n")).replace(/\\r/g,"\r")),r[e]=s}return r},populate:function(e,t,r={}){let s=!!(r&&r.debug),o=!!(r&&r.override);if("object"!=typeof t){let e=Error("OBJECT_REQUIRED: Please check the processEnv argument being passed to populate");throw e.code="OBJECT_REQUIRED",e}for(let r of Object.keys(t))Object.prototype.hasOwnProperty.call(e,r)?(!0===o&&(e[r]=t[r]),s&&(!0===o?c(`"${r}" is already defined and WAS overwritten`):c(`"${r}" is already defined and was NOT overwritten`))):e[r]=t[r]}};e.exports.configDotenv=f.configDotenv,e.exports._configVault=f._configVault,e.exports._parseVault=f._parseVault,e.exports.config=f.config,e.exports.decrypt=f.decrypt,e.exports.parse=f.parse,e.exports.populate=f.populate,e.exports=f},27541:(e,t,r)=>{var s=r(57861),o=function(){},i=function(e,t,r){if("function"==typeof t)return i(e,null,t);t||(t={}),r=s(r||o);var a=e._writableState,l=e._readableState,u=t.readable||!1!==t.readable&&e.readable,c=t.writable||!1!==t.writable&&e.writable,d=!1,p=function(){e.writable||h()},h=function(){c=!1,u||r.call(e)},f=function(){u=!1,c||r.call(e)},m=function(t){r.call(e,t?Error("exited with error code: "+t):null)},g=function(t){r.call(e,t)},y=function(){process.nextTick(b)},b=function(){if(!d&&(u&&!(l&&l.ended&&!l.destroyed)||c&&!(a&&a.ended&&!a.destroyed)))return r.call(e,Error("premature close"))},_=function(){e.req.on("finish",h)};return e.setHeader&&"function"==typeof e.abort?(e.on("complete",h),e.on("abort",y),e.req?_():e.on("request",_)):c&&!a&&(e.on("end",p),e.on("close",p)),e.stdio&&Array.isArray(e.stdio)&&3===e.stdio.length&&e.on("exit",m),e.on("end",f),e.on("finish",h),!1!==t.error&&e.on("error",g),e.on("close",y),function(){d=!0,e.removeListener("complete",h),e.removeListener("abort",y),e.removeListener("request",_),e.req&&e.req.removeListener("finish",h),e.removeListener("end",p),e.removeListener("close",p),e.removeListener("finish",h),e.removeListener("exit",m),e.removeListener("end",f),e.removeListener("error",g),e.removeListener("close",y)}};e.exports=i},78598:(e,t,r)=>{"use strict";let s=r(75887),o=r(40461),i=r(92857),a=r(81975),{groupRedact:l,nestedRedact:u}=r(25489),c=r(30081),d=r(5464),p=s(),h=e=>e;function f(e={}){let t=Array.from(new Set(e.paths||[])),r="serialize"in e?!1===e.serialize?e.serialize:"function"==typeof e.serialize?e.serialize:JSON.stringify:JSON.stringify,s=e.remove;if(!0===s&&r!==JSON.stringify)throw Error("fast-redact  remove option may only be set when serializer is JSON.stringify");let d=!0===s?void 0:"censor"in e?e.censor:"[REDACTED]",f="function"==typeof d,m=f&&d.length>1;if(0===t.length)return r||h;p({paths:t,serialize:r,censor:d});let{wildcards:g,wcLen:y,secret:b}=o({paths:t,censor:d}),_=a();return i({secret:b,wcLen:y,serialize:r,strict:!("strict"in e)||e.strict,isCensorFct:f,censorFctTakesPath:m},c({secret:b,censor:d,compileRestore:_,serialize:r,groupRedact:l,nestedRedact:u,wildcards:g,wcLen:y}))}h.restore=h,f.rx=d,f.validator=s,e.exports=f},25489:e=>{"use strict";function t(e,t){return null!=e&&("hasOwn"in Object?Object.hasOwn(e,t):Object.prototype.hasOwnProperty.call(e,t))}function r(e,t){for(var r=-1,s=t.length,o=e;null!=o&&++r<s;)o=o[t[r]];return o}function s(e,t,r){if(e.depth===r)return s(e.parent,t,r);var o={parent:e,key:t,depth:r,children:[]};return e.children.push(o),o}function o(e,t,r){let s=e,o=[];do o.push(s.key),s=s.parent;while(null!=s.parent);return{path:o,value:t,target:r}}e.exports={groupRedact:function(e,t,s,o,i){let a=r(e,t);if(null==a||"string"==typeof a)return{keys:null,values:null,target:a,flat:!0};let l=Object.keys(a),u=l.length,c=t.length,d=i?[...t]:void 0,p=Array(u);for(var h=0;h<u;h++){let e=l[h];p[h]=a[e],i?(d[c]=e,a[e]=s(a[e],d)):o?a[e]=s(a[e]):a[e]=s}return{keys:l,values:p,target:a,flat:!0}},groupRestore:function({keys:e,values:t,target:r}){if(null==r||"string"==typeof r)return;let s=e.length;for(var o=0;o<s;o++)r[e[o]]=t[o]},nestedRedact:function(e,i,a,l,u,c,d){let p=r(i,a);if(null==p)return;let h=Object.keys(p),f=h.length;for(var m=0;m<f;m++)(function(e,r,i,a,l,u,c,d){let p=l.length,h=p-1,f=i;var m,g,y,b,_,v=-1,w=null,S=null,E=!1,k=0,I={parent:null,key:null,children:[],depth:0};if(y=m=r[i],"object"==typeof m){for(;null!=m&&++v<p&&(k+=1,i=l[v],"*"===i||S||"object"==typeof m&&(i in m));)if("*"!==i||("*"===S&&(E=!0),S=i,v===h)){if(S){let p=Object.keys(m);for(var O=0;O<p.length;O++){let w=p[O];if(_=m[w],b="*"===i,E)I=s(I,w,k),y=function e(r,i,a,l,u,c,d,p,h,f,m,g,y,b,_,v,w,S,E,k){if(0===i&&(y||"object"==typeof r&&null!==r&&a in r)){if(g=y?r:r[a],m=_!==v?g:d?p?c(g,[...l,h,...u]):c(g):c,y){let e=o(w,g,E);S.push(e),f[b]=m}else if(r[a]===m);else if(void 0===m&&void 0!==c||t(r,a)&&m===g);else{let e=o(s(w,a,k+1),g,E);S.push(e),r[a]=m}}for(let t in r)"object"==typeof r[t]&&(w=s(w,t,k),e(r[t],i-1,a,l,u,c,d,p,h,f,m,g,y,b,_,v,w,S,E,k+1))}(_,v-1,i,a,l,u,c,d,f,m,g,y,b,w,v,h,I,e,r[f],k+1);else if(b||"object"==typeof _&&null!==_&&i in _){if(y=b?_:_[i],g=v!==h?y:c?d?u(y,[...a,f,...l]):u(y):u,b){let t=o(s(I,w,k),y,r[f]);e.push(t),m[w]=g}else if(_[i]===g);else if(void 0===g&&void 0!==u||t(_,i)&&g===y)I=s(I,w,k);else{I=s(I,w,k);let t=o(s(I,i,k+1),y,r[f]);e.push(t),_[i]=g}}}S=null}else{if(y=m[i],I=s(I,i,k),g=v!==h?y:c?d?u(y,[...a,f,...l]):u(y):u,t(m,i)&&g===y||void 0===g&&void 0!==u);else{let t=o(I,y,r[f]);e.push(t),m[i]=g}m=m[i]}if("object"!=typeof m)break}}})(e,p,h[m],a,l,u,c,d);return e},nestedRestore:function(e){for(let t=0;t<e.length;t++){let{target:r,path:s,value:o}=e[t],i=r;for(let e=s.length-1;e>0;e--)i=i[s[e]];i[s[0]]=o}}}},40461:(e,t,r)=>{"use strict";let s=r(5464);e.exports=function({paths:e}){let t=[];var r=0;let o=e.reduce(function(e,o,i){var a=o.match(s).map(e=>e.replace(/'|"|`/g,""));let l="["===o[0],u=(a=a.map(e=>"["===e[0]?e.substr(1,e.length-2):e)).indexOf("*");if(u>-1){let e=a.slice(0,u),s=e.join("."),o=a.slice(u+1,a.length),i=o.length>0;r++,t.push({before:e,beforeStr:s,after:o,nested:i})}else e[o]={path:a,val:void 0,precensored:!1,circle:"",escPath:JSON.stringify(o),leadingBracket:l};return e},{});return{wildcards:t,wcLen:r,secret:o}}},92857:(e,t,r)=>{"use strict";let s=r(5464);e.exports=function({secret:e,serialize:t,wcLen:r,strict:o,isCensorFct:i,censorFctTakesPath:a},l){let u=Function("o",`
    if (typeof o !== 'object' || o == null) {
      ${!0===o?"throw Error('fast-redact: primitives cannot be redacted')":!1===t?"return o":"return this.serialize(o)"}
    }
    const { censor, secret } = this
    const originalSecret = {}
    const secretKeys = Object.keys(secret)
    for (var i = 0; i < secretKeys.length; i++) {
      originalSecret[secretKeys[i]] = secret[secretKeys[i]]
    }

    ${Object.keys(e).map(t=>{let{escPath:r,leadingBracket:o,path:l}=e[t],u=o?1:0,c=o?"":".",d=[];for(;null!==(p=s.exec(t));){let[,e]=p,{index:t,input:r}=p;t>u&&d.push(r.substring(0,t-(e?0:1)))}var p,h=d.map(e=>`o${c}${e}`).join(" && ");0===h.length?h+=`o${c}${t} != null`:h+=` && o${c}${t} != null`;let f=`
      switch (true) {
        ${d.reverse().map(e=>`
          case o${c}${e} === censor:
            secret[${r}].circle = ${JSON.stringify(e)}
            break
        `).join("\n")}
      }
    `,m=a?`val, ${JSON.stringify(l)}`:"val";return`
      if (${h}) {
        const val = o${c}${t}
        if (val === censor) {
          secret[${r}].precensored = true
        } else {
          secret[${r}].val = val
          o${c}${t} = ${i?`censor(${m})`:"censor"}
          ${f}
        }
      }
    `}).join("\n")}
    this.compileRestore()
    ${!0==r>0?`
    {
      const { wildcards, wcLen, groupRedact, nestedRedact } = this
      for (var i = 0; i < wcLen; i++) {
        const { before, beforeStr, after, nested } = wildcards[i]
        if (nested === true) {
          secret[beforeStr] = secret[beforeStr] || []
          nestedRedact(secret[beforeStr], o, before, after, censor, ${i}, ${a})
        } else secret[beforeStr] = groupRedact(o, before, censor, ${i}, ${a})
      }
    }
  `:""}
    this.secret = originalSecret
    ${!1===t?"return o":`
    var s = this.serialize(o)
    this.restore(o)
    return s
  `}
  `).bind(l);return u.state=l,!1===t&&(u.restore=e=>l.restore(e)),u}},81975:(e,t,r)=>{"use strict";let{groupRestore:s,nestedRestore:o}=r(25489);e.exports=function(){return function(){if(this.restore){this.restore.state.secret=this.secret;return}let{secret:e,wcLen:t}=this,r=Object.keys(e),i=r.map(t=>{let{circle:r,escPath:s,leadingBracket:o}=e[t],i=r?`o.${r} = secret[${s}].val`:`o${o?"":"."}${t} = secret[${s}].val`,a=`secret[${s}].val = undefined`;return`
      if (secret[${s}].val !== undefined) {
        try { ${i} } catch (e) {}
        ${a}
      }
    `}).join(""),a=t>0,l=a?{secret:e,groupRestore:s,nestedRestore:o}:{secret:e};this.restore=Function("o",function(e,t,r){let s=!0===r?`
    const keys = Object.keys(secret)
    const len = keys.length
    for (var i = len - 1; i >= ${t.length}; i--) {
      const k = keys[i]
      const o = secret[k]
      if (o) {
        if (o.flat === true) this.groupRestore(o)
        else this.nestedRestore(o)
        secret[k] = null
      }
    }
  `:"";return`
    const secret = this.secret
    ${s}
    ${e}
    return o
  `}(i,r,a)).bind(l),this.restore.state=l}}},5464:e=>{"use strict";e.exports=/[^.[\]]+|\[((?:.)*?)\]/g},30081:e=>{"use strict";e.exports=function(e){let{secret:t,censor:r,compileRestore:s,serialize:o,groupRedact:i,nestedRedact:a,wildcards:l,wcLen:u}=e,c=[{secret:t,censor:r,compileRestore:s}];return!1!==o&&c.push({serialize:o}),u>0&&c.push({groupRedact:i,nestedRedact:a,wildcards:l,wcLen:u}),Object.assign(...c)}},75887:e=>{"use strict";e.exports=function(e={}){let{ERR_PATHS_MUST_BE_STRINGS:t=()=>"fast-redact - Paths must be (non-empty) strings",ERR_INVALID_PATH:r=e=>`fast-redact  Invalid path (${e})`}=e;return function({paths:e}){e.forEach(e=>{if("string"!=typeof e)throw Error(t());try{if(//.test(e))throw Error();let t=("["===e[0]?"":".")+e.replace(/^\*/,"").replace(/\.\*/g,".").replace(/\[\*\]/g,"[]");if(/\n|\r|;/.test(t)||/\/\*/.test(t))throw Error();Function(`
            'use strict'
            const o = new Proxy({}, { get: () => o, set: () => { throw Error() } });
            const  = null;
            o${t}
            if ([o${t}].length !== 1) throw Error()`)()}catch(t){throw Error(r(e))}})}}},15485:e=>{e.exports=a,a.default=a,a.stable=c,a.stableStringify=c;var t="[...]",r="[Circular]",s=[],o=[];function i(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function a(e,a,u,c){void 0===c&&(c=i()),function e(s,o,i,a,u,c,d){if(c+=1,"object"==typeof s&&null!==s){for(p=0;p<a.length;p++)if(a[p]===s){l(r,s,o,u);return}if(void 0!==d.depthLimit&&c>d.depthLimit||void 0!==d.edgesLimit&&i+1>d.edgesLimit){l(t,s,o,u);return}if(a.push(s),Array.isArray(s))for(p=0;p<s.length;p++)e(s[p],p,p,a,s,c,d);else{var p,h=Object.keys(s);for(p=0;p<h.length;p++){var f=h[p];e(s[f],f,p,a,s,c,d)}}a.pop()}}(e,"",0,[],void 0,0,c);try{p=0===o.length?JSON.stringify(e,a,u):JSON.stringify(e,d(a),u)}catch(e){return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;0!==s.length;){var p,h=s.pop();4===h.length?Object.defineProperty(h[0],h[1],h[3]):h[0][h[1]]=h[2]}}return p}function l(e,t,r,i){var a=Object.getOwnPropertyDescriptor(i,r);void 0!==a.get?a.configurable?(Object.defineProperty(i,r,{value:e}),s.push([i,r,t,a])):o.push([t,r,e]):(i[r]=e,s.push([i,r,t]))}function u(e,t){return e<t?-1:e>t?1:0}function c(e,a,c,p){void 0===p&&(p=i());var h,f=function e(o,i,a,c,d,p,h){if(p+=1,"object"==typeof o&&null!==o){for(f=0;f<c.length;f++)if(c[f]===o){l(r,o,i,d);return}try{if("function"==typeof o.toJSON)return}catch(e){return}if(void 0!==h.depthLimit&&p>h.depthLimit||void 0!==h.edgesLimit&&a+1>h.edgesLimit){l(t,o,i,d);return}if(c.push(o),Array.isArray(o))for(f=0;f<o.length;f++)e(o[f],f,f,c,o,p,h);else{var f,m={},g=Object.keys(o).sort(u);for(f=0;f<g.length;f++){var y=g[f];e(o[y],y,f,c,o,p,h),m[y]=o[y]}if(void 0===d)return m;s.push([d,i,o]),d[i]=m}c.pop()}}(e,"",0,[],void 0,0,p)||e;try{h=0===o.length?JSON.stringify(f,a,c):JSON.stringify(f,d(a),c)}catch(e){return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;0!==s.length;){var m=s.pop();4===m.length?Object.defineProperty(m[0],m[1],m[3]):m[0][m[1]]=m[2]}}return h}function d(e){return e=void 0!==e?e:function(e,t){return t},function(t,r){if(o.length>0)for(var s=0;s<o.length;s++){var i=o[s];if(i[1]===t&&i[0]===r){r=i[2],o.splice(s,1);break}}return e.call(this,t,r)}}},93276:function(e){var t;"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global&&global,t=function(){"use strict";var e,t="3.7.7",r="function"==typeof Buffer,s="function"==typeof TextDecoder?new TextDecoder:void 0,o="function"==typeof TextEncoder?new TextEncoder:void 0,i=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),a=(e={},i.forEach(function(t,r){return e[t]=r}),e),l=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,u=String.fromCharCode.bind(String),c="function"==typeof Uint8Array.from?Uint8Array.from.bind(Uint8Array):function(e){return new Uint8Array(Array.prototype.slice.call(e,0))},d=function(e){return e.replace(/=/g,"").replace(/[+\/]/g,function(e){return"+"==e?"-":"_"})},p=function(e){return e.replace(/[^A-Za-z0-9\+\/]/g,"")},h=function(e){for(var t,r,s,o,a="",l=e.length%3,u=0;u<e.length;){if((r=e.charCodeAt(u++))>255||(s=e.charCodeAt(u++))>255||(o=e.charCodeAt(u++))>255)throw TypeError("invalid character found");a+=i[(t=r<<16|s<<8|o)>>18&63]+i[t>>12&63]+i[t>>6&63]+i[63&t]}return l?a.slice(0,l-3)+"===".substring(l):a},f="function"==typeof btoa?function(e){return btoa(e)}:r?function(e){return Buffer.from(e,"binary").toString("base64")}:h,m=r?function(e){return Buffer.from(e).toString("base64")}:function(e){for(var t=[],r=0,s=e.length;r<s;r+=4096)t.push(u.apply(null,e.subarray(r,r+4096)));return f(t.join(""))},g=function(e,t){return void 0===t&&(t=!1),t?d(m(e)):m(e)},y=function(e){if(e.length<2){var t=e.charCodeAt(0);return t<128?e:t<2048?u(192|t>>>6)+u(128|63&t):u(224|t>>>12&15)+u(128|t>>>6&63)+u(128|63&t)}var t=65536+(e.charCodeAt(0)-55296)*1024+(e.charCodeAt(1)-56320);return u(240|t>>>18&7)+u(128|t>>>12&63)+u(128|t>>>6&63)+u(128|63&t)},b=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,_=function(e){return e.replace(b,y)},v=r?function(e){return Buffer.from(e,"utf8").toString("base64")}:o?function(e){return m(o.encode(e))}:function(e){return f(_(e))},w=function(e,t){return void 0===t&&(t=!1),t?d(v(e)):v(e)},S=function(e){return w(e,!0)},E=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,k=function(e){switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return u((t>>>10)+55296)+u((1023&t)+56320);case 3:return u((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return u((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},I=function(e){return e.replace(E,k)},O=function(e){if(e=e.replace(/\s+/g,""),!l.test(e))throw TypeError("malformed base64.");e+="==".slice(2-(3&e.length));for(var t,r,s,o="",i=0;i<e.length;)t=a[e.charAt(i++)]<<18|a[e.charAt(i++)]<<12|(r=a[e.charAt(i++)])<<6|(s=a[e.charAt(i++)]),o+=64===r?u(t>>16&255):64===s?u(t>>16&255,t>>8&255):u(t>>16&255,t>>8&255,255&t);return o},T="function"==typeof atob?function(e){return atob(p(e))}:r?function(e){return Buffer.from(e,"base64").toString("binary")}:O,j=r?function(e){return c(Buffer.from(e,"base64"))}:function(e){return c(T(e).split("").map(function(e){return e.charCodeAt(0)}))},C=function(e){return j(A(e))},R=r?function(e){return Buffer.from(e,"base64").toString("utf8")}:s?function(e){return s.decode(j(e))}:function(e){return I(T(e))},A=function(e){return p(e.replace(/[-_]/g,function(e){return"-"==e?"+":"/"}))},P=function(e){return R(A(e))},N=function(e){return{value:e,enumerable:!1,writable:!0,configurable:!0}},q=function(){var e=function(e,t){return Object.defineProperty(String.prototype,e,N(t))};e("fromBase64",function(){return P(this)}),e("toBase64",function(e){return w(this,e)}),e("toBase64URI",function(){return w(this,!0)}),e("toBase64URL",function(){return w(this,!0)}),e("toUint8Array",function(){return C(this)})},M=function(){var e=function(e,t){return Object.defineProperty(Uint8Array.prototype,e,N(t))};e("toBase64",function(e){return g(this,e)}),e("toBase64URI",function(){return g(this,!0)}),e("toBase64URL",function(){return g(this,!0)})},L={version:t,VERSION:t,atob:T,atobPolyfill:O,btoa:f,btoaPolyfill:h,fromBase64:P,toBase64:w,encode:w,encodeURI:S,encodeURL:S,utob:_,btou:I,decode:P,isValid:function(e){if("string"!=typeof e)return!1;var t=e.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(t)||!/[^\s0-9a-zA-Z\-_]/.test(t)},fromUint8Array:g,toUint8Array:C,extendString:q,extendUint8Array:M,extendBuiltins:function(){q(),M()}};return L.Base64={},Object.keys(L).forEach(function(e){return L.Base64[e]=L[e]}),L},e.exports=t()},99817:(e,t,r)=>{let s=r(55315),o=r(92048),i=__dirname.split(s.sep);function a(e,t){console.error(`Could not find the node_modules folder ${e?"which contains "+e:""} in ${t.join(s.sep)}`)}e.exports=function e(t,r=i){if(r.length<1)return a(t,r),null;let l=r.concat(["node_modules"]).join(s.sep),u=t?s.join(l,t):l;if(o.existsSync(u))return l;let c=e(t,r.slice(0,-1));return c||a(t,r),c}},55298:e=>{"use strict";let t;let r={exit:[],beforeExit:[]},s={exit:function(){i("exit")},beforeExit:function(){i("beforeExit")}};function o(e){r[e].length>0||(process.removeListener(e,s[e]),0!==r.exit.length||0!==r.beforeExit.length||(t=void 0))}function i(e){for(let t of r[e]){let r=t.deref(),s=t.fn;void 0!==r&&s(r,e)}r[e]=[]}function a(e){for(let t of["exit","beforeExit"]){let s=r[t].indexOf(e);r[t].splice(s,s+1),o(t)}}function l(e,o,i){if(void 0===o)throw Error("the object can't be undefined");r[e].length>0||process.on(e,s[e]);let l=new WeakRef(o);l.fn=i,void 0===t&&(t=new FinalizationRegistry(a)),t.register(o,l),r[e].push(l)}e.exports={register:function(e,t){l("exit",e,t)},registerBeforeExit:function(e,t){l("beforeExit",e,t)},unregister:function(e){if(void 0!==t)for(let s of(t.unregister(e),["exit","beforeExit"]))r[s]=r[s].filter(t=>{let r=t.deref();return r&&r!==e}),o(s)}}},57861:(e,t,r)=>{var s=r(25745);function o(e){var t=function(){return t.called?t.value:(t.called=!0,t.value=e.apply(this,arguments))};return t.called=!1,t}function i(e){var t=function(){if(t.called)throw Error(t.onceError);return t.called=!0,t.value=e.apply(this,arguments)},r=e.name||"Function wrapped with `once`";return t.onceError=r+" shouldn't be called more than once",t.called=!1,t}e.exports=s(o),e.exports.strict=s(i),o.proto=o(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return o(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return i(this)},configurable:!0})})},91253:(e,t,r)=>{"use strict";let s=Symbol.for("pino.metadata"),o=r(40293),{Duplex:i}=r(76162),{parentPort:a,workerData:l}=r(6162);function u(e,t){process.nextTick(t,e)}e.exports=function(e,t={}){let r=!0===t.expectPinoConfig&&l?.workerData?.pinoWillSendConfig===!0,c="lines"===t.parse,d="function"==typeof t.parseLine?t.parseLine:JSON.parse,p=t.close||u,h=o(function(e){let t;try{t=d(e)}catch(t){this.emit("unknown",e,t);return}if(null===t){this.emit("unknown",e,"Null value ignored");return}return("object"!=typeof t&&(t={data:t,time:Date.now()}),h[s]&&(h.lastTime=t.time,h.lastLevel=t.level,h.lastObj=t),c)?e:t},{autoDestroy:!0});if(h._destroy=function(e,t){let r=p(e,t);r&&"function"==typeof r.then&&r.then(t,t)},!0===t.expectPinoConfig&&l?.workerData?.pinoWillSendConfig!==!0&&setImmediate(()=>{h.emit("error",Error("This transport is not compatible with the current version of pino. Please upgrade pino to the latest version."))}),!1!==t.metadata&&(h[s]=!0,h.lastTime=0,h.lastLevel=0,h.lastObj=null),r){let e={},t=function(){let e,t;let r=new Promise((r,s)=>{e=r,t=s});return r.resolve=e,r.reject=t,r}();return a.on("message",function r(s){"PINO_CONFIG"===s.code&&(e=s.config,t.resolve(),a.off("message",r))}),Object.defineProperties(h,{levels:{get:()=>e.levels},messageKey:{get:()=>e.messageKey},errorKey:{get:()=>e.errorKey}}),t.then(f)}return f();function f(){let r=e(h);if(r&&"function"==typeof r.catch)r.catch(e=>{h.destroy(e)}),r=null;else if(t.enablePipelining&&r)return i.from({writable:h,readable:r});return h}}},61326:e=>{function t(e,t){var r=!1,s=this;return Promise.all(e.map(function(){var e=arguments;return s(function(){if(!r)return t.apply(void 0,e).catch(function(e){throw r=!0,e})})}))}function r(e){return e.queue=0,e.map=t,e}e.exports=function(e){return e?r(function(e){var t=0,r=[];function s(){var s;--t<e&&(s=r.shift(),i.queue=r.length,s&&o(s.fn).then(s.resolve).catch(s.reject))}function o(e){t++;try{return Promise.resolve(e()).then(function(e){return s(),e},function(e){throw s(),e})}catch(e){return s(),Promise.reject(e)}}var i=function(s){return t>=e?new Promise(function(e,t){r.push({fn:s,resolve:e,reject:t}),i.queue=r.length}):o(s)};return i}(e)):r(function(e){return e()})}},96005:(e,t,r)=>{var s,o=r(57861),i=r(27541);try{s=r(92048)}catch(e){}var a=function(){},l=/^v?\.0/.test(process.version),u=function(e){return"function"==typeof e},c=function(e,t,r,c){c=o(c);var d=!1;e.on("close",function(){d=!0}),i(e,{readable:t,writable:r},function(e){if(e)return c(e);d=!0,c()});var p=!1;return function(t){if(!d&&!p){if(p=!0,l&&s&&(e instanceof(s.ReadStream||a)||e instanceof(s.WriteStream||a))&&u(e.close))return e.close(a);if(e.setHeader&&u(e.abort))return e.abort();if(u(e.destroy))return e.destroy();c(t||Error("stream was destroyed"))}}},d=function(e){e()},p=function(e,t){return e.pipe(t)};e.exports=function(){var e,t=Array.prototype.slice.call(arguments),r=u(t[t.length-1]||a)&&t.pop()||a;if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw Error("pump requires two streams per minimum");var s=t.map(function(o,i){var a=i<t.length-1;return c(o,a,i>0,function(t){e||(e=t),t&&s.forEach(d),a||(s.forEach(d),r(e))})});return t.reduce(p)}},10944:e=>{"use strict";function t(e){try{return JSON.stringify(e)}catch(e){return'"[Circular]"'}}e.exports=function(e,r,s){var o=s&&s.stringify||t;if("object"==typeof e&&null!==e){var i=r.length+1;if(1===i)return e;var a=Array(i);a[0]=o(e);for(var l=1;l<i;l++)a[l]=o(r[l]);return a.join(" ")}if("string"!=typeof e)return e;var u=r.length;if(0===u)return e;for(var c="",d=0,p=-1,h=e&&e.length||0,f=0;f<h;){if(37===e.charCodeAt(f)&&f+1<h){switch(p=p>-1?p:0,e.charCodeAt(f+1)){case 100:case 102:if(d>=u||null==r[d])break;p<f&&(c+=e.slice(p,f)),c+=Number(r[d]),p=f+2,f++;break;case 105:if(d>=u||null==r[d])break;p<f&&(c+=e.slice(p,f)),c+=Math.floor(Number(r[d])),p=f+2,f++;break;case 79:case 111:case 106:if(d>=u||void 0===r[d])break;p<f&&(c+=e.slice(p,f));var m=typeof r[d];if("string"===m){c+="'"+r[d]+"'",p=f+2,f++;break}if("function"===m){c+=r[d].name||"<anonymous>",p=f+2,f++;break}c+=o(r[d]),p=f+2,f++;break;case 115:if(d>=u)break;p<f&&(c+=e.slice(p,f)),c+=String(r[d]),p=f+2,f++;break;case 37:p<f&&(c+=e.slice(p,f)),c+="%",p=f+2,f++,d--}++d}++f}return -1===p?e:(p<h&&(c+=e.slice(p)),c)}},80682:(e,t)=>{"use strict";let{hasOwnProperty:r}=Object.prototype,s=h();s.configure=h,s.stringify=s,s.default=s,t.stringify=s,t.configure=h,e.exports=s;let o=/[\u0000-\u001f\u0022\u005c\ud800-\udfff]/;function i(e){return e.length<5e3&&!o.test(e)?`"${e}"`:JSON.stringify(e)}function a(e,t){if(e.length>200||t)return e.sort(t);for(let t=1;t<e.length;t++){let r=e[t],s=t;for(;0!==s&&e[s-1]>r;)e[s]=e[s-1],s--;e[s]=r}return e}let l=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(Object.getPrototypeOf(new Int8Array)),Symbol.toStringTag).get;function u(e){return void 0!==l.call(e)&&0!==e.length}function c(e,t,r){e.length<r&&(r=e.length);let s=","===t?"":" ",o=`"0":${s}${e[0]}`;for(let i=1;i<r;i++)o+=`${t}"${i}":${s}${e[i]}`;return o}function d(e,t){let s;if(r.call(e,t)){if("number"!=typeof(s=e[t]))throw TypeError(`The "${t}" argument must be of type number`);if(!Number.isInteger(s))throw TypeError(`The "${t}" argument must be an integer`);if(s<1)throw RangeError(`The "${t}" argument must be >= 1`)}return void 0===s?1/0:s}function p(e){return 1===e?"1 item":`${e} items`}function h(e){let t=function(e){if(r.call(e,"strict")){let t=e.strict;if("boolean"!=typeof t)throw TypeError('The "strict" argument must be of type boolean');if(t)return e=>{let t=`Object can not safely be stringified. Received type ${typeof e}`;throw"function"!=typeof e&&(t+=` (${e.toString()})`),Error(t)}}}(e={...e});!t||(void 0===e.bigint&&(e.bigint=!1),"circularValue"in e||(e.circularValue=Error));let s=function(e){if(r.call(e,"circularValue")){let t=e.circularValue;if("string"==typeof t)return`"${t}"`;if(null==t)return t;if(t===Error||t===TypeError)return{toString(){throw TypeError("Converting circular structure to JSON")}};throw TypeError('The "circularValue" argument must be of type string or the value null or undefined')}return'"[Circular]"'}(e),o=function(e,t){let s;if(r.call(e,t)&&"boolean"!=typeof(s=e[t]))throw TypeError(`The "${t}" argument must be of type boolean`);return void 0===s||s}(e,"bigint"),l=function(e){let t;if(r.call(e,"deterministic")&&"boolean"!=typeof(t=e.deterministic)&&"function"!=typeof t)throw TypeError('The "deterministic" argument must be of type boolean or comparator function');return void 0===t||t}(e),h="function"==typeof l?l:void 0,f=d(e,"maximumDepth"),m=d(e,"maximumBreadth");return function(e,r,d){if(arguments.length>1){let g="";if("number"==typeof d?g=" ".repeat(Math.min(d,10)):"string"==typeof d&&(g=d.slice(0,10)),null!=r){if("function"==typeof r)return function e(r,c,d,g,y,b){let _=c[r];switch("object"==typeof _&&null!==_&&"function"==typeof _.toJSON&&(_=_.toJSON(r)),typeof(_=g.call(c,r,_))){case"string":return i(_);case"object":{if(null===_)return"null";if(-1!==d.indexOf(_))return s;let t="",r=",",o=b;if(Array.isArray(_)){if(0===_.length)return"[]";if(f<d.length+1)return'"[Array]"';d.push(_),""!==y&&(b+=y,t+=`
${b}`,r=`,
${b}`);let s=Math.min(_.length,m),i=0;for(;i<s-1;i++){let s=e(String(i),_,d,g,y,b);t+=(void 0!==s?s:"null")+r}let a=e(String(i),_,d,g,y,b);if(t+=void 0!==a?a:"null",_.length-1>m){let e=_.length-m-1;t+=`${r}"... ${p(e)} not stringified"`}return""!==y&&(t+=`
${o}`),d.pop(),`[${t}]`}let c=Object.keys(_),v=c.length;if(0===v)return"{}";if(f<d.length+1)return'"[Object]"';let w="",S="";""!==y&&(b+=y,r=`,
${b}`,w=" ");let E=Math.min(v,m);l&&!u(_)&&(c=a(c,h)),d.push(_);for(let s=0;s<E;s++){let o=c[s],a=e(o,_,d,g,y,b);void 0!==a&&(t+=`${S}${i(o)}:${w}${a}`,S=r)}return v>m&&(t+=`${S}"...":${w}"${p(v-m)} not stringified"`,S=r),""!==y&&S.length>1&&(t=`
${b}${t}
${o}`),d.pop(),`{${t}}`}case"number":return isFinite(_)?String(_):t?t(_):"null";case"boolean":return!0===_?"true":"false";case"undefined":return;case"bigint":if(o)return String(_);default:return t?t(_):void 0}}("",{"":e},[],r,g,"");if(Array.isArray(r))return function e(r,a,l,u,c,d){switch("object"==typeof a&&null!==a&&"function"==typeof a.toJSON&&(a=a.toJSON(r)),typeof a){case"string":return i(a);case"object":{if(null===a)return"null";if(-1!==l.indexOf(a))return s;let t=d,r="",o=",";if(Array.isArray(a)){if(0===a.length)return"[]";if(f<l.length+1)return'"[Array]"';l.push(a),""!==c&&(d+=c,r+=`
${d}`,o=`,
${d}`);let s=Math.min(a.length,m),i=0;for(;i<s-1;i++){let t=e(String(i),a[i],l,u,c,d);r+=(void 0!==t?t:"null")+o}let h=e(String(i),a[i],l,u,c,d);if(r+=void 0!==h?h:"null",a.length-1>m){let e=a.length-m-1;r+=`${o}"... ${p(e)} not stringified"`}return""!==c&&(r+=`
${t}`),l.pop(),`[${r}]`}l.push(a);let h="";""!==c&&(d+=c,o=`,
${d}`,h=" ");let g="";for(let t of u){let s=e(t,a[t],l,u,c,d);void 0!==s&&(r+=`${g}${i(t)}:${h}${s}`,g=o)}return""!==c&&g.length>1&&(r=`
${d}${r}
${t}`),l.pop(),`{${r}}`}case"number":return isFinite(a)?String(a):t?t(a):"null";case"boolean":return!0===a?"true":"false";case"undefined":return;case"bigint":if(o)return String(a);default:return t?t(a):void 0}}("",e,[],function(e){let t=new Set;for(let r of e)("string"==typeof r||"number"==typeof r)&&t.add(String(r));return t}(r),g,"")}if(0!==g.length)return function e(r,d,g,y,b){switch(typeof d){case"string":return i(d);case"object":{if(null===d)return"null";if("function"==typeof d.toJSON){if("object"!=typeof(d=d.toJSON(r)))return e(r,d,g,y,b);if(null===d)return"null"}if(-1!==g.indexOf(d))return s;let t=b;if(Array.isArray(d)){if(0===d.length)return"[]";if(f<g.length+1)return'"[Array]"';g.push(d),b+=y;let r=`
${b}`,s=`,
${b}`,o=Math.min(d.length,m),i=0;for(;i<o-1;i++){let t=e(String(i),d[i],g,y,b);r+=(void 0!==t?t:"null")+s}let a=e(String(i),d[i],g,y,b);if(r+=void 0!==a?a:"null",d.length-1>m){let e=d.length-m-1;r+=`${s}"... ${p(e)} not stringified"`}return r+=`
${t}`,g.pop(),`[${r}]`}let o=Object.keys(d),_=o.length;if(0===_)return"{}";if(f<g.length+1)return'"[Object]"';b+=y;let v=`,
${b}`,w="",S="",E=Math.min(_,m);u(d)&&(w+=c(d,v,m),o=o.slice(d.length),E-=d.length,S=v),l&&(o=a(o,h)),g.push(d);for(let t=0;t<E;t++){let r=o[t],s=e(r,d[r],g,y,b);void 0!==s&&(w+=`${S}${i(r)}: ${s}`,S=v)}return _>m&&(w+=`${S}"...": "${p(_-m)} not stringified"`,S=v),""!==S&&(w=`
${b}${w}
${t}`),g.pop(),`{${w}}`}case"number":return isFinite(d)?String(d):t?t(d):"null";case"boolean":return!0===d?"true":"false";case"undefined":return;case"bigint":if(o)return String(d);default:return t?t(d):void 0}}("",e,[],g,"")}return function e(r,d,g){switch(typeof d){case"string":return i(d);case"object":{if(null===d)return"null";if("function"==typeof d.toJSON){if("object"!=typeof(d=d.toJSON(r)))return e(r,d,g);if(null===d)return"null"}if(-1!==g.indexOf(d))return s;let t="",o=void 0!==d.length;if(o&&Array.isArray(d)){if(0===d.length)return"[]";if(f<g.length+1)return'"[Array]"';g.push(d);let r=Math.min(d.length,m),s=0;for(;s<r-1;s++){let r=e(String(s),d[s],g);t+=(void 0!==r?r:"null")+","}let o=e(String(s),d[s],g);if(t+=void 0!==o?o:"null",d.length-1>m){let e=d.length-m-1;t+=`,"... ${p(e)} not stringified"`}return g.pop(),`[${t}]`}let y=Object.keys(d),b=y.length;if(0===b)return"{}";if(f<g.length+1)return'"[Object]"';let _="",v=Math.min(b,m);o&&u(d)&&(t+=c(d,",",m),y=y.slice(d.length),v-=d.length,_=","),l&&(y=a(y,h)),g.push(d);for(let r=0;r<v;r++){let s=y[r],o=e(s,d[s],g);void 0!==o&&(t+=`${_}${i(s)}:${o}`,_=",")}return b>m&&(t+=`${_}"...":"${p(b-m)} not stringified"`),g.pop(),`{${t}}`}case"number":return isFinite(d)?String(d):t?t(d):"null";case"boolean":return!0===d?"true":"false";case"undefined":return;case"bigint":if(o)return String(d);default:return t?t(d):void 0}}("",e,[])}}},49794:e=>{"use strict";let t="undefined"!=typeof Buffer,r=/"(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])"\s*:/,s=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/;function o(e,o,a){null==a&&null!==o&&"object"==typeof o&&(a=o,o=void 0),t&&Buffer.isBuffer(e)&&(e=e.toString()),e&&65279===e.charCodeAt(0)&&(e=e.slice(1));let l=JSON.parse(e,o);if(null===l||"object"!=typeof l)return l;let u=a&&a.protoAction||"error",c=a&&a.constructorAction||"error";if("ignore"===u&&"ignore"===c)return l;if("ignore"!==u&&"ignore"!==c){if(!1===r.test(e)&&!1===s.test(e))return l}else if("ignore"!==u&&"ignore"===c){if(!1===r.test(e))return l}else if(!1===s.test(e))return l;return i(l,{protoAction:u,constructorAction:c,safe:a&&a.safe})}function i(e,{protoAction:t="error",constructorAction:r="error",safe:s}={}){let o=[e];for(;o.length;){let e=o;for(let i of(o=[],e)){if("ignore"!==t&&Object.prototype.hasOwnProperty.call(i,"__proto__")){if(!0===s)return null;if("error"===t)throw SyntaxError("Object contains forbidden prototype property");delete i.__proto__}if("ignore"!==r&&Object.prototype.hasOwnProperty.call(i,"constructor")&&Object.prototype.hasOwnProperty.call(i.constructor,"prototype")){if(!0===s)return null;if("error"===r)throw SyntaxError("Object contains forbidden prototype property");delete i.constructor}for(let e in i){let t=i[e];t&&"object"==typeof t&&o.push(t)}}}return e}function a(e,t,r){let s=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return o(e,t,r)}finally{Error.stackTraceLimit=s}}e.exports=a,e.exports.default=a,e.exports.parse=a,e.exports.safeParse=function(e,t){let r=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return o(e,t,{safe:!0})}catch(e){return null}finally{Error.stackTraceLimit=r}},e.exports.scan=i},40293:(e,t,r)=>{"use strict";let{Transform:s}=r(76162),{StringDecoder:o}=r(74026),i=Symbol("last"),a=Symbol("decoder");function l(e,t,r){let s;if(this.overflow){if(1===(s=this[a].write(e).split(this.matcher)).length)return r();s.shift(),this.overflow=!1}else this[i]+=this[a].write(e),s=this[i].split(this.matcher);this[i]=s.pop();for(let e=0;e<s.length;e++)try{c(this,this.mapper(s[e]))}catch(e){return r(e)}if(this.overflow=this[i].length>this.maxLength,this.overflow&&!this.skipOverflow){r(Error("maximum buffer reached"));return}r()}function u(e){if(this[i]+=this[a].end(),this[i])try{c(this,this.mapper(this[i]))}catch(t){return e(t)}e()}function c(e,t){void 0!==t&&e.push(t)}function d(e){return e}e.exports=function(e,t,r){switch(e=e||/\r?\n/,t=t||d,r=r||{},arguments.length){case 1:"function"==typeof e?(t=e,e=/\r?\n/):"object"!=typeof e||e instanceof RegExp||e[Symbol.split]||(r=e,e=/\r?\n/);break;case 2:"function"==typeof e?(r=t,t=e,e=/\r?\n/):"object"==typeof t&&(r=t,t=d)}(r=Object.assign({},r)).autoDestroy=!0,r.transform=l,r.flush=u,r.readableObjectMode=!0;let c=new s(r);return c[i]="",c[a]=new o("utf8"),c.matcher=e,c.mapper=t,c.maxLength=r.maxLength,c.skipOverflow=r.skipOverflow||!1,c.overflow=!1,c._destroy=function(e,t){this._writableState.errorEmitted=!1,t(e)},c}},43543:(e,t,r)=>{"use strict";let{version:s}=r(14604),{EventEmitter:o}=r(17702),{Worker:i}=r(6162),{join:a}=r(55315),{pathToFileURL:l}=r(17360),{wait:u}=r(69623),{WRITE_INDEX:c,READ_INDEX:d}=r(45841),p=r(78893),h=r(27790),f=Symbol("kImpl"),m=p.constants.MAX_STRING_LENGTH;class g{constructor(e){this._value=e}deref(){return this._value}}class y{register(){}unregister(){}}let b=process.env.NODE_V8_COVERAGE?y:global.FinalizationRegistry||y,_=process.env.NODE_V8_COVERAGE?g:global.WeakRef||g,v=new b(e=>{e.exited||e.terminate()});function w(e){h(!e[f].sync),e[f].needDrain&&(e[f].needDrain=!1,e.emit("drain"))}function S(e){let t=this.stream.deref();if(void 0===t){this.exited=!0,this.terminate();return}switch(e.code){case"READY":this.stream=new _(t),t.flush(()=>{t[f].ready=!0,t.emit("ready")});break;case"ERROR":O(t,e.err);break;case"EVENT":Array.isArray(e.args)?t.emit(e.name,...e.args):t.emit(e.name,e.args);break;case"WARNING":process.emitWarning(e.err);break;default:O(t,Error("this should not happen: "+e.code))}}function E(e){let t=this.stream.deref();void 0!==t&&(v.unregister(t),t.worker.exited=!0,t.worker.off("exit",E),O(t,0!==e?Error("the worker thread exited"):null))}class k extends o{constructor(e={}){if(super(),e.bufferSize<4)throw Error("bufferSize must at least fit a 4-byte utf-8 char");this[f]={},this[f].stateBuf=new SharedArrayBuffer(128),this[f].state=new Int32Array(this[f].stateBuf),this[f].dataBuf=new SharedArrayBuffer(e.bufferSize||4194304),this[f].data=Buffer.from(this[f].dataBuf),this[f].sync=e.sync||!1,this[f].ending=!1,this[f].ended=!1,this[f].needDrain=!1,this[f].destroyed=!1,this[f].flushing=!1,this[f].ready=!1,this[f].finished=!1,this[f].errored=null,this[f].closed=!1,this[f].buf="",this.worker=function(e,t){let{filename:r,workerData:o}=t,u=new i(("__bundlerPathsOverrides"in globalThis?globalThis.__bundlerPathsOverrides:{})["thread-stream-worker"]||a(__dirname,"lib","worker.js"),{...t.workerOpts,trackUnmanagedFds:!1,workerData:{filename:0===r.indexOf("file://")?r:l(r).href,dataBuf:e[f].dataBuf,stateBuf:e[f].stateBuf,workerData:{$context:{threadStreamVersion:s},...o}}});return u.stream=new g(e),u.on("message",S),u.on("exit",E),v.register(e,u),u}(this,e),this.on("message",(e,t)=>{this.worker.postMessage(e,t)})}write(e){if(this[f].destroyed)return I(this,Error("the worker has exited")),!1;if(this[f].ending)return I(this,Error("the worker is ending")),!1;if(this[f].flushing&&this[f].buf.length+e.length>=m)try{C(this),this[f].flushing=!0}catch(e){return O(this,e),!1}if(this[f].buf+=e,this[f].sync)try{return C(this),!0}catch(e){return O(this,e),!1}return this[f].flushing||(this[f].flushing=!0,setImmediate(function e(t){let r=Atomics.load(t[f].state,c),s=t[f].data.length-r;if(s>0){if(0===t[f].buf.length){t[f].flushing=!1,t[f].ending?j(t):t[f].needDrain&&process.nextTick(w,t);return}let r=t[f].buf.slice(0,s),o=Buffer.byteLength(r);o<=s?(t[f].buf=t[f].buf.slice(s),T(t,r,e.bind(null,t))):t.flush(()=>{if(!t.destroyed){for(Atomics.store(t[f].state,d,0),Atomics.store(t[f].state,c,0);o>t[f].data.length;)s/=2,r=t[f].buf.slice(0,s),o=Buffer.byteLength(r);t[f].buf=t[f].buf.slice(s),T(t,r,e.bind(null,t))}})}else if(0===s){if(0===r&&0===t[f].buf.length)return;t.flush(()=>{Atomics.store(t[f].state,d,0),Atomics.store(t[f].state,c,0),e(t)})}else O(t,Error("overwritten"))},this)),this[f].needDrain=this[f].data.length-this[f].buf.length-Atomics.load(this[f].state,c)<=0,!this[f].needDrain}end(){this[f].destroyed||(this[f].ending=!0,j(this))}flush(e){if(this[f].destroyed){"function"==typeof e&&process.nextTick(e,Error("the worker has exited"));return}let t=Atomics.load(this[f].state,c);u(this[f].state,d,t,1/0,(t,r)=>{if(t){O(this,t),process.nextTick(e,t);return}if("not-equal"===r){this.flush(e);return}process.nextTick(e)})}flushSync(){this[f].destroyed||(C(this),R(this))}unref(){this.worker.unref()}ref(){this.worker.ref()}get ready(){return this[f].ready}get destroyed(){return this[f].destroyed}get closed(){return this[f].closed}get writable(){return!this[f].destroyed&&!this[f].ending}get writableEnded(){return this[f].ending}get writableFinished(){return this[f].finished}get writableNeedDrain(){return this[f].needDrain}get writableObjectMode(){return!1}get writableErrored(){return this[f].errored}}function I(e,t){setImmediate(()=>{e.emit("error",t)})}function O(e,t){e[f].destroyed||(e[f].destroyed=!0,t&&(e[f].errored=t,I(e,t)),e.worker.exited?setImmediate(()=>{e[f].closed=!0,e.emit("close")}):e.worker.terminate().catch(()=>{}).then(()=>{e[f].closed=!0,e.emit("close")}))}function T(e,t,r){let s=Atomics.load(e[f].state,c),o=Buffer.byteLength(t);return e[f].data.write(t,s),Atomics.store(e[f].state,c,s+o),Atomics.notify(e[f].state,c),r(),!0}function j(e){if(!e[f].ended&&e[f].ending&&!e[f].flushing){e[f].ended=!0;try{e.flushSync();let t=Atomics.load(e[f].state,d);Atomics.store(e[f].state,c,-1),Atomics.notify(e[f].state,c);let r=0;for(;-1!==t;){if(Atomics.wait(e[f].state,d,t,1e3),t=Atomics.load(e[f].state,d),-2===t){O(e,Error("end() failed"));return}if(10==++r){O(e,Error("end() took too long (10s)"));return}}process.nextTick(()=>{e[f].finished=!0,e.emit("finish")})}catch(t){O(e,t)}}}function C(e){let t=()=>{e[f].ending?j(e):e[f].needDrain&&process.nextTick(w,e)};for(e[f].flushing=!1;0!==e[f].buf.length;){let r=Atomics.load(e[f].state,c),s=e[f].data.length-r;if(0===s){R(e),Atomics.store(e[f].state,d,0),Atomics.store(e[f].state,c,0);continue}if(s<0)throw Error("overwritten");let o=e[f].buf.slice(0,s),i=Buffer.byteLength(o);if(i<=s)e[f].buf=e[f].buf.slice(s),T(e,o,t);else{for(R(e),Atomics.store(e[f].state,d,0),Atomics.store(e[f].state,c,0);i>e[f].buf.length;)s/=2,o=e[f].buf.slice(0,s),i=Buffer.byteLength(o);e[f].buf=e[f].buf.slice(s),T(e,o,t)}}}function R(e){if(e[f].flushing)throw Error("unable to flush while flushing");let t=Atomics.load(e[f].state,c),r=0;for(;;){let s=Atomics.load(e[f].state,d);if(-2===s)throw Error("_flushSync failed");if(s!==t)Atomics.wait(e[f].state,d,s,1e3);else break;if(10==++r)throw Error("_flushSync took too long (10s)")}}e.exports=k},45841:e=>{"use strict";e.exports={WRITE_INDEX:4,READ_INDEX:8}},69623:e=>{"use strict";e.exports={wait:function(e,t,r,s,o){let i=Date.now()+s,a=Atomics.load(e,t);if(a===r){o(null,"ok");return}let l=a,u=s=>{Date.now()>i?o(null,"timed-out"):setTimeout(()=>{l=a,(a=Atomics.load(e,t))===l?u(s>=1e3?1e3:2*s):a===r?o(null,"ok"):o(null,"not-equal")},s)};u(1)},waitDiff:function(e,t,r,s,o){let i=Date.now()+s,a=Atomics.load(e,t);if(a!==r){o(null,"ok");return}let l=s=>{Date.now()>i?o(null,"timed-out"):setTimeout(()=>{(a=Atomics.load(e,t))!==r?o(null,"ok"):l(s>=1e3?1e3:2*s)},s)};l(1)}}},25745:e=>{e.exports=function e(t,r){if(t&&r)return e(t)(r);if("function"!=typeof t)throw TypeError("need wrapper function");return Object.keys(t).forEach(function(e){s[e]=t[e]}),s;function s(){for(var e=Array(arguments.length),r=0;r<e.length;r++)e[r]=arguments[r];var s=t.apply(this,e),o=e[e.length-1];return"function"==typeof s&&s!==o&&Object.keys(o).forEach(function(e){s[e]=o[e]}),s}}},2147:(e,t,r)=>{"use strict";let s=r(38825);s.createWebSocketStream=r(78926),s.Server=r(6390),s.Receiver=r(32934),s.Sender=r(67285),s.WebSocket=s,s.WebSocketServer=s.Server,e.exports=s},76434:(e,t,r)=>{"use strict";let{EMPTY_BUFFER:s}=r(36637),o=Buffer[Symbol.species];function i(e,t,r,s,o){for(let i=0;i<o;i++)r[s+i]=e[i]^t[3&i]}function a(e,t){for(let r=0;r<e.length;r++)e[r]^=t[3&r]}if(e.exports={concat:function(e,t){if(0===e.length)return s;if(1===e.length)return e[0];let r=Buffer.allocUnsafe(t),i=0;for(let t=0;t<e.length;t++){let s=e[t];r.set(s,i),i+=s.length}return i<t?new o(r.buffer,r.byteOffset,i):r},mask:i,toArrayBuffer:function(e){return e.length===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.length)},toBuffer:function e(t){let r;return(e.readOnly=!0,Buffer.isBuffer(t))?t:(t instanceof ArrayBuffer?r=new o(t):ArrayBuffer.isView(t)?r=new o(t.buffer,t.byteOffset,t.byteLength):(r=Buffer.from(t),e.readOnly=!1),r)},unmask:a},!process.env.WS_NO_BUFFER_UTIL)try{let t=r(76118);e.exports.mask=function(e,r,s,o,a){a<48?i(e,r,s,o,a):t.mask(e,r,s,o,a)},e.exports.unmask=function(e,r){e.length<32?a(e,r):t.unmask(e,r)}}catch(e){}},36637:e=>{"use strict";let t=["nodebuffer","arraybuffer","fragments"],r="undefined"!=typeof Blob;r&&t.push("blob"),e.exports={BINARY_TYPES:t,EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",hasBlob:r,kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}},14279:(e,t,r)=>{"use strict";let{kForOnEventAttribute:s,kListener:o}=r(36637),i=Symbol("kCode"),a=Symbol("kData"),l=Symbol("kError"),u=Symbol("kMessage"),c=Symbol("kReason"),d=Symbol("kTarget"),p=Symbol("kType"),h=Symbol("kWasClean");class f{constructor(e){this[d]=null,this[p]=e}get target(){return this[d]}get type(){return this[p]}}Object.defineProperty(f.prototype,"target",{enumerable:!0}),Object.defineProperty(f.prototype,"type",{enumerable:!0});class m extends f{constructor(e,t={}){super(e),this[i]=void 0===t.code?0:t.code,this[c]=void 0===t.reason?"":t.reason,this[h]=void 0!==t.wasClean&&t.wasClean}get code(){return this[i]}get reason(){return this[c]}get wasClean(){return this[h]}}Object.defineProperty(m.prototype,"code",{enumerable:!0}),Object.defineProperty(m.prototype,"reason",{enumerable:!0}),Object.defineProperty(m.prototype,"wasClean",{enumerable:!0});class g extends f{constructor(e,t={}){super(e),this[l]=void 0===t.error?null:t.error,this[u]=void 0===t.message?"":t.message}get error(){return this[l]}get message(){return this[u]}}Object.defineProperty(g.prototype,"error",{enumerable:!0}),Object.defineProperty(g.prototype,"message",{enumerable:!0});class y extends f{constructor(e,t={}){super(e),this[a]=void 0===t.data?null:t.data}get data(){return this[a]}}function b(e,t,r){"object"==typeof e&&e.handleEvent?e.handleEvent.call(e,r):e.call(t,r)}Object.defineProperty(y.prototype,"data",{enumerable:!0}),e.exports={CloseEvent:m,ErrorEvent:g,Event:f,EventTarget:{addEventListener(e,t,r={}){let i;for(let i of this.listeners(e))if(!r[s]&&i[o]===t&&!i[s])return;if("message"===e)i=function(e,r){let s=new y("message",{data:r?e:e.toString()});s[d]=this,b(t,this,s)};else if("close"===e)i=function(e,r){let s=new m("close",{code:e,reason:r.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});s[d]=this,b(t,this,s)};else if("error"===e)i=function(e){let r=new g("error",{error:e,message:e.message});r[d]=this,b(t,this,r)};else{if("open"!==e)return;i=function(){let e=new f("open");e[d]=this,b(t,this,e)}}i[s]=!!r[s],i[o]=t,r.once?this.once(e,i):this.on(e,i)},removeEventListener(e,t){for(let r of this.listeners(e))if(r[o]===t&&!r[s]){this.removeListener(e,r);break}}},MessageEvent:y}},65295:(e,t,r)=>{"use strict";let{tokenChars:s}=r(6530);function o(e,t,r){void 0===e[t]?e[t]=[r]:e[t].push(r)}e.exports={format:function(e){return Object.keys(e).map(t=>{let r=e[t];return Array.isArray(r)||(r=[r]),r.map(e=>[t].concat(Object.keys(e).map(t=>{let r=e[t];return Array.isArray(r)||(r=[r]),r.map(e=>!0===e?t:`${t}=${e}`).join("; ")})).join("; ")).join(", ")}).join(", ")},parse:function(e){let t,r;let i=Object.create(null),a=Object.create(null),l=!1,u=!1,c=!1,d=-1,p=-1,h=-1,f=0;for(;f<e.length;f++)if(p=e.charCodeAt(f),void 0===t){if(-1===h&&1===s[p])-1===d&&(d=f);else if(0!==f&&(32===p||9===p))-1===h&&-1!==d&&(h=f);else if(59===p||44===p){if(-1===d)throw SyntaxError(`Unexpected character at index ${f}`);-1===h&&(h=f);let r=e.slice(d,h);44===p?(o(i,r,a),a=Object.create(null)):t=r,d=h=-1}else throw SyntaxError(`Unexpected character at index ${f}`)}else if(void 0===r){if(-1===h&&1===s[p])-1===d&&(d=f);else if(32===p||9===p)-1===h&&-1!==d&&(h=f);else if(59===p||44===p){if(-1===d)throw SyntaxError(`Unexpected character at index ${f}`);-1===h&&(h=f),o(a,e.slice(d,h),!0),44===p&&(o(i,t,a),a=Object.create(null),t=void 0),d=h=-1}else if(61===p&&-1!==d&&-1===h)r=e.slice(d,f),d=h=-1;else throw SyntaxError(`Unexpected character at index ${f}`)}else if(u){if(1!==s[p])throw SyntaxError(`Unexpected character at index ${f}`);-1===d?d=f:l||(l=!0),u=!1}else if(c){if(1===s[p])-1===d&&(d=f);else if(34===p&&-1!==d)c=!1,h=f;else if(92===p)u=!0;else throw SyntaxError(`Unexpected character at index ${f}`)}else if(34===p&&61===e.charCodeAt(f-1))c=!0;else if(-1===h&&1===s[p])-1===d&&(d=f);else if(-1!==d&&(32===p||9===p))-1===h&&(h=f);else if(59===p||44===p){if(-1===d)throw SyntaxError(`Unexpected character at index ${f}`);-1===h&&(h=f);let s=e.slice(d,h);l&&(s=s.replace(/\\/g,""),l=!1),o(a,r,s),44===p&&(o(i,t,a),a=Object.create(null),t=void 0),r=void 0,d=h=-1}else throw SyntaxError(`Unexpected character at index ${f}`);if(-1===d||c||32===p||9===p)throw SyntaxError("Unexpected end of input");-1===h&&(h=f);let m=e.slice(d,h);return void 0===t?o(i,m,a):(void 0===r?o(a,m,!0):l?o(a,r,m.replace(/\\/g,"")):o(a,r,m),o(i,t,a)),i}}},22008:e=>{"use strict";let t=Symbol("kDone"),r=Symbol("kRun");class s{constructor(e){this[t]=()=>{this.pending--,this[r]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[r]()}[r](){if(this.pending!==this.concurrency&&this.jobs.length){let e=this.jobs.shift();this.pending++,e(this[t])}}}e.exports=s},87647:(e,t,r)=>{"use strict";let s;let o=r(71568),i=r(76434),a=r(22008),{kStatusCode:l}=r(36637),u=Buffer[Symbol.species],c=Buffer.from([0,0,255,255]),d=Symbol("permessage-deflate"),p=Symbol("total-length"),h=Symbol("callback"),f=Symbol("buffers"),m=Symbol("error");class g{constructor(e,t,r){this._maxPayload=0|r,this._options=e||{},this._threshold=void 0!==this._options.threshold?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,s||(s=new a(void 0!==this._options.concurrencyLimit?this._options.concurrencyLimit:10))}static get extensionName(){return"permessage-deflate"}offer(){let e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:null==this._options.clientMaxWindowBits&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){let e=this._deflate[h];this._deflate.close(),this._deflate=null,e&&e(Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){let t=this._options,r=e.find(e=>(!1!==t.serverNoContextTakeover||!e.server_no_context_takeover)&&(!e.server_max_window_bits||!1!==t.serverMaxWindowBits&&("number"!=typeof t.serverMaxWindowBits||!(t.serverMaxWindowBits>e.server_max_window_bits)))&&("number"!=typeof t.clientMaxWindowBits||!!e.client_max_window_bits));if(!r)throw Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(r.server_no_context_takeover=!0),t.clientNoContextTakeover&&(r.client_no_context_takeover=!0),"number"==typeof t.serverMaxWindowBits&&(r.server_max_window_bits=t.serverMaxWindowBits),"number"==typeof t.clientMaxWindowBits?r.client_max_window_bits=t.clientMaxWindowBits:(!0===r.client_max_window_bits||!1===t.clientMaxWindowBits)&&delete r.client_max_window_bits,r}acceptAsClient(e){let t=e[0];if(!1===this._options.clientNoContextTakeover&&t.client_no_context_takeover)throw Error('Unexpected parameter "client_no_context_takeover"');if(t.client_max_window_bits){if(!1===this._options.clientMaxWindowBits||"number"==typeof this._options.clientMaxWindowBits&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw Error('Unexpected or invalid parameter "client_max_window_bits"')}else"number"==typeof this._options.clientMaxWindowBits&&(t.client_max_window_bits=this._options.clientMaxWindowBits);return t}normalizeParams(e){return e.forEach(e=>{Object.keys(e).forEach(t=>{let r=e[t];if(r.length>1)throw Error(`Parameter "${t}" must have only a single value`);if(r=r[0],"client_max_window_bits"===t){if(!0!==r){let e=+r;if(!Number.isInteger(e)||e<8||e>15)throw TypeError(`Invalid value for parameter "${t}": ${r}`);r=e}else if(!this._isServer)throw TypeError(`Invalid value for parameter "${t}": ${r}`)}else if("server_max_window_bits"===t){let e=+r;if(!Number.isInteger(e)||e<8||e>15)throw TypeError(`Invalid value for parameter "${t}": ${r}`);r=e}else if("client_no_context_takeover"===t||"server_no_context_takeover"===t){if(!0!==r)throw TypeError(`Invalid value for parameter "${t}": ${r}`)}else throw Error(`Unknown parameter "${t}"`);e[t]=r})}),e}decompress(e,t,r){s.add(s=>{this._decompress(e,t,(e,t)=>{s(),r(e,t)})})}compress(e,t,r){s.add(s=>{this._compress(e,t,(e,t)=>{s(),r(e,t)})})}_decompress(e,t,r){let s=this._isServer?"client":"server";if(!this._inflate){let e=`${s}_max_window_bits`,t="number"!=typeof this.params[e]?o.Z_DEFAULT_WINDOWBITS:this.params[e];this._inflate=o.createInflateRaw({...this._options.zlibInflateOptions,windowBits:t}),this._inflate[d]=this,this._inflate[p]=0,this._inflate[f]=[],this._inflate.on("error",_),this._inflate.on("data",b)}this._inflate[h]=r,this._inflate.write(e),t&&this._inflate.write(c),this._inflate.flush(()=>{let e=this._inflate[m];if(e){this._inflate.close(),this._inflate=null,r(e);return}let o=i.concat(this._inflate[f],this._inflate[p]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[p]=0,this._inflate[f]=[],t&&this.params[`${s}_no_context_takeover`]&&this._inflate.reset()),r(null,o)})}_compress(e,t,r){let s=this._isServer?"server":"client";if(!this._deflate){let e=`${s}_max_window_bits`,t="number"!=typeof this.params[e]?o.Z_DEFAULT_WINDOWBITS:this.params[e];this._deflate=o.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:t}),this._deflate[p]=0,this._deflate[f]=[],this._deflate.on("data",y)}this._deflate[h]=r,this._deflate.write(e),this._deflate.flush(o.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let e=i.concat(this._deflate[f],this._deflate[p]);t&&(e=new u(e.buffer,e.byteOffset,e.length-4)),this._deflate[h]=null,this._deflate[p]=0,this._deflate[f]=[],t&&this.params[`${s}_no_context_takeover`]&&this._deflate.reset(),r(null,e)})}}function y(e){this[f].push(e),this[p]+=e.length}function b(e){if(this[p]+=e.length,this[d]._maxPayload<1||this[p]<=this[d]._maxPayload){this[f].push(e);return}this[m]=RangeError("Max payload size exceeded"),this[m].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[m][l]=1009,this.removeListener("data",b),this.reset()}function _(e){this[d]._inflate=null,e[l]=1007,this[h](e)}e.exports=g},32934:(e,t,r)=>{"use strict";let{Writable:s}=r(76162),o=r(87647),{BINARY_TYPES:i,EMPTY_BUFFER:a,kStatusCode:l,kWebSocket:u}=r(36637),{concat:c,toArrayBuffer:d,unmask:p}=r(76434),{isValidStatusCode:h,isValidUTF8:f}=r(6530),m=Buffer[Symbol.species];class g extends s{constructor(e={}){super(),this._allowSynchronousEvents=void 0===e.allowSynchronousEvents||e.allowSynchronousEvents,this._binaryType=e.binaryType||i[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=0|e.maxPayload,this._skipUTF8Validation=!!e.skipUTF8Validation,this[u]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=0}_write(e,t,r){if(8===this._opcode&&0==this._state)return r();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(r)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){let t=this._buffers[0];return this._buffers[0]=new m(t.buffer,t.byteOffset+e,t.length-e),new m(t.buffer,t.byteOffset,e)}let t=Buffer.allocUnsafe(e);do{let r=this._buffers[0],s=t.length-e;e>=r.length?t.set(this._buffers.shift(),s):(t.set(new Uint8Array(r.buffer,r.byteOffset,e),s),this._buffers[0]=new m(r.buffer,r.byteOffset+e,r.length-e)),e-=r.length}while(e>0);return t}startLoop(e){this._loop=!0;do switch(this._state){case 0:this.getInfo(e);break;case 1:this.getPayloadLength16(e);break;case 2:this.getPayloadLength64(e);break;case 3:this.getMask();break;case 4:this.getData(e);break;case 5:case 6:this._loop=!1;return}while(this._loop);this._errored||e()}getInfo(e){if(this._bufferedBytes<2){this._loop=!1;return}let t=this.consume(2);if((48&t[0])!=0){e(this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3"));return}let r=(64&t[0])==64;if(r&&!this._extensions[o.extensionName]){e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"));return}if(this._fin=(128&t[0])==128,this._opcode=15&t[0],this._payloadLength=127&t[1],0===this._opcode){if(r){e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"));return}if(!this._fragmented){e(this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE"));return}this._opcode=this._fragmented}else if(1===this._opcode||2===this._opcode){if(this._fragmented){e(this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE"));return}this._compressed=r}else if(this._opcode>7&&this._opcode<11){if(!this._fin){e(this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN"));return}if(r){e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"));return}if(this._payloadLength>125||8===this._opcode&&1===this._payloadLength){e(this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH"));return}}else{e(this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE"));return}if(this._fin||this._fragmented||(this._fragmented=this._opcode),this._masked=(128&t[1])==128,this._isServer){if(!this._masked){e(this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK"));return}}else if(this._masked){e(this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK"));return}126===this._payloadLength?this._state=1:127===this._payloadLength?this._state=2:this.haveLength(e)}getPayloadLength16(e){if(this._bufferedBytes<2){this._loop=!1;return}this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(e)}getPayloadLength64(e){if(this._bufferedBytes<8){this._loop=!1;return}let t=this.consume(8),r=t.readUInt32BE(0);if(r>2097151){e(this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH"));return}this._payloadLength=4294967296*r+t.readUInt32BE(4),this.haveLength(e)}haveLength(e){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0)){e(this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH"));return}this._masked?this._state=3:this._state=4}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=4}getData(e){let t=a;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}t=this.consume(this._payloadLength),this._masked&&(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])!=0&&p(t,this._mask)}if(this._opcode>7){this.controlMessage(t,e);return}if(this._compressed){this._state=5,this.decompress(t,e);return}t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage(e)}decompress(e,t){this._extensions[o.extensionName].decompress(e,this._fin,(e,r)=>{if(e)return t(e);if(r.length){if(this._messageLength+=r.length,this._messageLength>this._maxPayload&&this._maxPayload>0){t(this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH"));return}this._fragments.push(r)}this.dataMessage(t),0===this._state&&this.startLoop(t)})}dataMessage(e){if(!this._fin){this._state=0;return}let t=this._messageLength,r=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],2===this._opcode){let s;s="nodebuffer"===this._binaryType?c(r,t):"arraybuffer"===this._binaryType?d(c(r,t)):"blob"===this._binaryType?new Blob(r):r,this._allowSynchronousEvents?(this.emit("message",s,!0),this._state=0):(this._state=6,setImmediate(()=>{this.emit("message",s,!0),this._state=0,this.startLoop(e)}))}else{let s=c(r,t);if(!this._skipUTF8Validation&&!f(s)){e(this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8"));return}5===this._state||this._allowSynchronousEvents?(this.emit("message",s,!1),this._state=0):(this._state=6,setImmediate(()=>{this.emit("message",s,!1),this._state=0,this.startLoop(e)}))}}controlMessage(e,t){if(8===this._opcode){if(0===e.length)this._loop=!1,this.emit("conclude",1005,a),this.end();else{let r=e.readUInt16BE(0);if(!h(r)){t(this.createError(RangeError,`invalid status code ${r}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE"));return}let s=new m(e.buffer,e.byteOffset+2,e.length-2);if(!this._skipUTF8Validation&&!f(s)){t(this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8"));return}this._loop=!1,this.emit("conclude",r,s),this.end()}this._state=0;return}this._allowSynchronousEvents?(this.emit(9===this._opcode?"ping":"pong",e),this._state=0):(this._state=6,setImmediate(()=>{this.emit(9===this._opcode?"ping":"pong",e),this._state=0,this.startLoop(t)}))}createError(e,t,r,s,o){this._loop=!1,this._errored=!0;let i=new e(r?`Invalid WebSocket frame: ${t}`:t);return Error.captureStackTrace(i,this.createError),i.code=o,i[l]=s,i}}e.exports=g},67285:(e,t,r)=>{"use strict";let s;let{Duplex:o}=r(76162),{randomFillSync:i}=r(84770),a=r(87647),{EMPTY_BUFFER:l,kWebSocket:u,NOOP:c}=r(36637),{isBlob:d,isValidStatusCode:p}=r(6530),{mask:h,toBuffer:f}=r(76434),m=Symbol("kByteLength"),g=Buffer.alloc(4),y=8192;class b{constructor(e,t,r){this._extensions=t||{},r&&(this._generateMask=r,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._queue=[],this._state=0,this.onerror=c,this[u]=void 0}static frame(e,t){let r,o;let a=!1,l=2,u=!1;t.mask&&(r=t.maskBuffer||g,t.generateMask?t.generateMask(r):(8192===y&&(void 0===s&&(s=Buffer.alloc(8192)),i(s,0,8192),y=0),r[0]=s[y++],r[1]=s[y++],r[2]=s[y++],r[3]=s[y++]),u=(r[0]|r[1]|r[2]|r[3])==0,l=6),"string"==typeof e?o=(!t.mask||u)&&void 0!==t[m]?t[m]:(e=Buffer.from(e)).length:(o=e.length,a=t.mask&&t.readOnly&&!u);let c=o;o>=65536?(l+=8,c=127):o>125&&(l+=2,c=126);let d=Buffer.allocUnsafe(a?o+l:l);return(d[0]=t.fin?128|t.opcode:t.opcode,t.rsv1&&(d[0]|=64),d[1]=c,126===c?d.writeUInt16BE(o,2):127===c&&(d[2]=d[3]=0,d.writeUIntBE(o,4,6)),t.mask)?(d[1]|=128,d[l-4]=r[0],d[l-3]=r[1],d[l-2]=r[2],d[l-1]=r[3],u)?[d,e]:a?(h(e,r,d,l,o),[d]):(h(e,r,e,0,o),[d,e]):[d,e]}close(e,t,r,s){let o;if(void 0===e)o=l;else if("number"==typeof e&&p(e)){if(void 0!==t&&t.length){let r=Buffer.byteLength(t);if(r>123)throw RangeError("The message must not be greater than 123 bytes");(o=Buffer.allocUnsafe(2+r)).writeUInt16BE(e,0),"string"==typeof t?o.write(t,2):o.set(t,2)}else(o=Buffer.allocUnsafe(2)).writeUInt16BE(e,0)}else throw TypeError("First argument must be a valid error code number");let i={[m]:o.length,fin:!0,generateMask:this._generateMask,mask:r,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};0!==this._state?this.enqueue([this.dispatch,o,!1,i,s]):this.sendFrame(b.frame(o,i),s)}ping(e,t,r){let s,o;if("string"==typeof e?(s=Buffer.byteLength(e),o=!1):d(e)?(s=e.size,o=!1):(s=(e=f(e)).length,o=f.readOnly),s>125)throw RangeError("The data size must not be greater than 125 bytes");let i={[m]:s,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:9,readOnly:o,rsv1:!1};d(e)?0!==this._state?this.enqueue([this.getBlobData,e,!1,i,r]):this.getBlobData(e,!1,i,r):0!==this._state?this.enqueue([this.dispatch,e,!1,i,r]):this.sendFrame(b.frame(e,i),r)}pong(e,t,r){let s,o;if("string"==typeof e?(s=Buffer.byteLength(e),o=!1):d(e)?(s=e.size,o=!1):(s=(e=f(e)).length,o=f.readOnly),s>125)throw RangeError("The data size must not be greater than 125 bytes");let i={[m]:s,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:10,readOnly:o,rsv1:!1};d(e)?0!==this._state?this.enqueue([this.getBlobData,e,!1,i,r]):this.getBlobData(e,!1,i,r):0!==this._state?this.enqueue([this.dispatch,e,!1,i,r]):this.sendFrame(b.frame(e,i),r)}send(e,t,r){let s,o;let i=this._extensions[a.extensionName],l=t.binary?2:1,u=t.compress;"string"==typeof e?(s=Buffer.byteLength(e),o=!1):d(e)?(s=e.size,o=!1):(s=(e=f(e)).length,o=f.readOnly),this._firstFragment?(this._firstFragment=!1,u&&i&&i.params[i._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(u=s>=i._threshold),this._compress=u):(u=!1,l=0),t.fin&&(this._firstFragment=!0);let c={[m]:s,fin:t.fin,generateMask:this._generateMask,mask:t.mask,maskBuffer:this._maskBuffer,opcode:l,readOnly:o,rsv1:u};d(e)?0!==this._state?this.enqueue([this.getBlobData,e,this._compress,c,r]):this.getBlobData(e,this._compress,c,r):0!==this._state?this.enqueue([this.dispatch,e,this._compress,c,r]):this.dispatch(e,this._compress,c,r)}getBlobData(e,t,r,s){this._bufferedBytes+=r[m],this._state=2,e.arrayBuffer().then(e=>{if(this._socket.destroyed){let e=Error("The socket was closed while the blob was being read");process.nextTick(_,this,e,s);return}this._bufferedBytes-=r[m];let o=f(e);t?this.dispatch(o,t,r,s):(this._state=0,this.sendFrame(b.frame(o,r),s),this.dequeue())}).catch(e=>{process.nextTick(v,this,e,s)})}dispatch(e,t,r,s){if(!t){this.sendFrame(b.frame(e,r),s);return}let o=this._extensions[a.extensionName];this._bufferedBytes+=r[m],this._state=1,o.compress(e,r.fin,(e,t)=>{if(this._socket.destroyed){_(this,Error("The socket was closed while data was being compressed"),s);return}this._bufferedBytes-=r[m],this._state=0,r.readOnly=!1,this.sendFrame(b.frame(t,r),s),this.dequeue()})}dequeue(){for(;0===this._state&&this._queue.length;){let e=this._queue.shift();this._bufferedBytes-=e[3][m],Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[3][m],this._queue.push(e)}sendFrame(e,t){2===e.length?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}}function _(e,t,r){"function"==typeof r&&r(t);for(let r=0;r<e._queue.length;r++){let s=e._queue[r],o=s[s.length-1];"function"==typeof o&&o(t)}}function v(e,t,r){_(e,t,r),e.onerror(t)}e.exports=b},78926:(e,t,r)=>{"use strict";r(38825);let{Duplex:s}=r(76162);function o(e){e.emit("close")}function i(){!this.destroyed&&this._writableState.finished&&this.destroy()}function a(e){this.removeListener("error",a),this.destroy(),0===this.listenerCount("error")&&this.emit("error",e)}e.exports=function(e,t){let r=!0,l=new s({...t,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return e.on("message",function(t,r){let s=!r&&l._readableState.objectMode?t.toString():t;l.push(s)||e.pause()}),e.once("error",function(e){l.destroyed||(r=!1,l.destroy(e))}),e.once("close",function(){l.destroyed||l.push(null)}),l._destroy=function(t,s){if(e.readyState===e.CLOSED){s(t),process.nextTick(o,l);return}let i=!1;e.once("error",function(e){i=!0,s(e)}),e.once("close",function(){i||s(t),process.nextTick(o,l)}),r&&e.terminate()},l._final=function(t){if(e.readyState===e.CONNECTING){e.once("open",function(){l._final(t)});return}null!==e._socket&&(e._socket._writableState.finished?(t(),l._readableState.endEmitted&&l.destroy()):(e._socket.once("finish",function(){t()}),e.close()))},l._read=function(){e.isPaused&&e.resume()},l._write=function(t,r,s){if(e.readyState===e.CONNECTING){e.once("open",function(){l._write(t,r,s)});return}e.send(t,s)},l.on("end",i),l.on("error",a),l}},17374:(e,t,r)=>{"use strict";let{tokenChars:s}=r(6530);e.exports={parse:function(e){let t=new Set,r=-1,o=-1,i=0;for(;i<e.length;i++){let a=e.charCodeAt(i);if(-1===o&&1===s[a])-1===r&&(r=i);else if(0!==i&&(32===a||9===a))-1===o&&-1!==r&&(o=i);else if(44===a){if(-1===r)throw SyntaxError(`Unexpected character at index ${i}`);-1===o&&(o=i);let s=e.slice(r,o);if(t.has(s))throw SyntaxError(`The "${s}" subprotocol is duplicated`);t.add(s),r=o=-1}else throw SyntaxError(`Unexpected character at index ${i}`)}if(-1===r||-1!==o)throw SyntaxError("Unexpected end of input");let a=e.slice(r,i);if(t.has(a))throw SyntaxError(`The "${a}" subprotocol is duplicated`);return t.add(a),t}}},6530:(e,t,r)=>{"use strict";let{isUtf8:s}=r(78893),{hasBlob:o}=r(36637);function i(e){let t=e.length,r=0;for(;r<t;)if((128&e[r])==0)r++;else if((224&e[r])==192){if(r+1===t||(192&e[r+1])!=128||(254&e[r])==192)return!1;r+=2}else if((240&e[r])==224){if(r+2>=t||(192&e[r+1])!=128||(192&e[r+2])!=128||224===e[r]&&(224&e[r+1])==128||237===e[r]&&(224&e[r+1])==160)return!1;r+=3}else{if((248&e[r])!=240||r+3>=t||(192&e[r+1])!=128||(192&e[r+2])!=128||(192&e[r+3])!=128||240===e[r]&&(240&e[r+1])==128||244===e[r]&&e[r+1]>143||e[r]>244)return!1;r+=4}return!0}if(e.exports={isBlob:function(e){return o&&"object"==typeof e&&"function"==typeof e.arrayBuffer&&"string"==typeof e.type&&"function"==typeof e.stream&&("Blob"===e[Symbol.toStringTag]||"File"===e[Symbol.toStringTag])},isValidStatusCode:function(e){return e>=1e3&&e<=1014&&1004!==e&&1005!==e&&1006!==e||e>=3e3&&e<=4999},isValidUTF8:i,tokenChars:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0]},s)e.exports.isValidUTF8=function(e){return e.length<24?i(e):s(e)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let t=r(34745);e.exports.isValidUTF8=function(e){return e.length<32?i(e):t(e)}}catch(e){}},6390:(e,t,r)=>{"use strict";let s=r(17702),o=r(32615),{Duplex:i}=r(76162),{createHash:a}=r(84770),l=r(65295),u=r(87647),c=r(17374),d=r(38825),{GUID:p,kWebSocket:h}=r(36637),f=/^[+/0-9A-Za-z]{22}==$/;class m extends s{constructor(e,t){if(super(),null==(e={allowSynchronousEvents:!0,autoPong:!0,maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:d,...e}).port&&!e.server&&!e.noServer||null!=e.port&&(e.server||e.noServer)||e.server&&e.noServer)throw TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(null!=e.port?(this._server=o.createServer((e,t)=>{let r=o.STATUS_CODES[426];t.writeHead(426,{"Content-Length":r.length,"Content-Type":"text/plain"}),t.end(r)}),this._server.listen(e.port,e.host,e.backlog,t)):e.server&&(this._server=e.server),this._server){let e=this.emit.bind(this,"connection");this._removeListeners=function(e,t){for(let r of Object.keys(t))e.on(r,t[r]);return function(){for(let r of Object.keys(t))e.removeListener(r,t[r])}}(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(t,r,s)=>{this.handleUpgrade(t,r,s,e)}})}!0===e.perMessageDeflate&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=e,this._state=0}address(){if(this.options.noServer)throw Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(2===this._state){e&&this.once("close",()=>{e(Error("The server is not running"))}),process.nextTick(g,this);return}if(e&&this.once("close",e),1!==this._state){if(this._state=1,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients&&this.clients.size?this._shouldEmitClose=!0:process.nextTick(g,this);else{let e=this._server;this._removeListeners(),this._removeListeners=this._server=null,e.close(()=>{g(this)})}}}shouldHandle(e){if(this.options.path){let t=e.url.indexOf("?");if((-1!==t?e.url.slice(0,t):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,t,r,s){t.on("error",y);let o=e.headers["sec-websocket-key"],i=e.headers.upgrade,a=+e.headers["sec-websocket-version"];if("GET"!==e.method){_(this,e,t,405,"Invalid HTTP method");return}if(void 0===i||"websocket"!==i.toLowerCase()){_(this,e,t,400,"Invalid Upgrade header");return}if(void 0===o||!f.test(o)){_(this,e,t,400,"Missing or invalid Sec-WebSocket-Key header");return}if(8!==a&&13!==a){_(this,e,t,400,"Missing or invalid Sec-WebSocket-Version header");return}if(!this.shouldHandle(e)){b(t,400);return}let d=e.headers["sec-websocket-protocol"],p=new Set;if(void 0!==d)try{p=c.parse(d)}catch(r){_(this,e,t,400,"Invalid Sec-WebSocket-Protocol header");return}let h=e.headers["sec-websocket-extensions"],m={};if(this.options.perMessageDeflate&&void 0!==h){let r=new u(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let e=l.parse(h);e[u.extensionName]&&(r.accept(e[u.extensionName]),m[u.extensionName]=r)}catch(r){_(this,e,t,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let i={origin:e.headers[`${8===a?"sec-websocket-origin":"origin"}`],secure:!!(e.socket.authorized||e.socket.encrypted),req:e};if(2===this.options.verifyClient.length){this.options.verifyClient(i,(i,a,l,u)=>{if(!i)return b(t,a||401,l,u);this.completeUpgrade(m,o,p,e,t,r,s)});return}if(!this.options.verifyClient(i))return b(t,401)}this.completeUpgrade(m,o,p,e,t,r,s)}completeUpgrade(e,t,r,s,o,i,c){if(!o.readable||!o.writable)return o.destroy();if(o[h])throw Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>0)return b(o,503);let d=a("sha1").update(t+p).digest("base64"),f=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${d}`],m=new this.options.WebSocket(null,void 0,this.options);if(r.size){let e=this.options.handleProtocols?this.options.handleProtocols(r,s):r.values().next().value;e&&(f.push(`Sec-WebSocket-Protocol: ${e}`),m._protocol=e)}if(e[u.extensionName]){let t=e[u.extensionName].params,r=l.format({[u.extensionName]:[t]});f.push(`Sec-WebSocket-Extensions: ${r}`),m._extensions=e}this.emit("headers",f,s),o.write(f.concat("\r\n").join("\r\n")),o.removeListener("error",y),m.setSocket(o,i,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(m),m.on("close",()=>{this.clients.delete(m),this._shouldEmitClose&&!this.clients.size&&process.nextTick(g,this)})),c(m,s)}}function g(e){e._state=2,e.emit("close")}function y(){this.destroy()}function b(e,t,r,s){r=r||o.STATUS_CODES[t],s={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(r),...s},e.once("finish",e.destroy),e.end(`HTTP/1.1 ${t} ${o.STATUS_CODES[t]}\r
`+Object.keys(s).map(e=>`${e}: ${s[e]}`).join("\r\n")+"\r\n\r\n"+r)}function _(e,t,r,s,o){if(e.listenerCount("wsClientError")){let s=Error(o);Error.captureStackTrace(s,_),e.emit("wsClientError",s,r,t)}else b(r,s,o)}e.exports=m},38825:(e,t,r)=>{"use strict";let s=r(17702),o=r(35240),i=r(32615),a=r(98216),l=r(82452),{randomBytes:u,createHash:c}=r(84770),{Duplex:d,Readable:p}=r(76162),{URL:h}=r(17360),f=r(87647),m=r(32934),g=r(67285),{isBlob:y}=r(6530),{BINARY_TYPES:b,EMPTY_BUFFER:_,GUID:v,kForOnEventAttribute:w,kListener:S,kStatusCode:E,kWebSocket:k,NOOP:I}=r(36637),{EventTarget:{addEventListener:O,removeEventListener:T}}=r(14279),{format:j,parse:C}=r(65295),{toBuffer:R}=r(76434),A=Symbol("kAborted"),P=[8,13],N=["CONNECTING","OPEN","CLOSING","CLOSED"],q=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/;class M extends s{constructor(e,t,r){super(),this._binaryType=b[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=_,this._closeTimer=null,this._errorEmitted=!1,this._extensions={},this._paused=!1,this._protocol="",this._readyState=M.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,null!==e?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,void 0===t?t=[]:Array.isArray(t)||("object"==typeof t&&null!==t?(r=t,t=[]):t=[t]),function e(t,r,s,a){let l,d,p,m;let g={allowSynchronousEvents:!0,autoPong:!0,protocolVersion:P[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...a,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(t._autoPong=g.autoPong,!P.includes(g.protocolVersion))throw RangeError(`Unsupported protocol version: ${g.protocolVersion} (supported versions: ${P.join(", ")})`);if(r instanceof h)l=r;else try{l=new h(r)}catch(e){throw SyntaxError(`Invalid URL: ${r}`)}"http:"===l.protocol?l.protocol="ws:":"https:"===l.protocol&&(l.protocol="wss:"),t._url=l.href;let y="wss:"===l.protocol,b="ws+unix:"===l.protocol;if("ws:"===l.protocol||y||b?b&&!l.pathname?d="The URL's pathname is empty":l.hash&&(d="The URL contains a fragment identifier"):d='The URL\'s protocol must be one of "ws:", "wss:", "http:", "https", or "ws+unix:"',d){let e=SyntaxError(d);if(0===t._redirects)throw e;L(t,e);return}let _=y?443:80,w=u(16).toString("base64"),S=y?o.request:i.request,E=new Set;if(g.createConnection=g.createConnection||(y?D:$),g.defaultPort=g.defaultPort||_,g.port=l.port||_,g.host=l.hostname.startsWith("[")?l.hostname.slice(1,-1):l.hostname,g.headers={...g.headers,"Sec-WebSocket-Version":g.protocolVersion,"Sec-WebSocket-Key":w,Connection:"Upgrade",Upgrade:"websocket"},g.path=l.pathname+l.search,g.timeout=g.handshakeTimeout,g.perMessageDeflate&&(p=new f(!0!==g.perMessageDeflate?g.perMessageDeflate:{},!1,g.maxPayload),g.headers["Sec-WebSocket-Extensions"]=j({[f.extensionName]:p.offer()})),s.length){for(let e of s){if("string"!=typeof e||!q.test(e)||E.has(e))throw SyntaxError("An invalid or duplicated subprotocol was specified");E.add(e)}g.headers["Sec-WebSocket-Protocol"]=s.join(",")}if(g.origin&&(g.protocolVersion<13?g.headers["Sec-WebSocket-Origin"]=g.origin:g.headers.Origin=g.origin),(l.username||l.password)&&(g.auth=`${l.username}:${l.password}`),b){let e=g.path.split(":");g.socketPath=e[0],g.path=e[1]}if(g.followRedirects){if(0===t._redirects){t._originalIpc=b,t._originalSecure=y,t._originalHostOrSocketPath=b?g.socketPath:l.host;let e=a&&a.headers;if(a={...a,headers:{}},e)for(let[t,r]of Object.entries(e))a.headers[t.toLowerCase()]=r}else if(0===t.listenerCount("redirect")){let e=b?!!t._originalIpc&&g.socketPath===t._originalHostOrSocketPath:!t._originalIpc&&l.host===t._originalHostOrSocketPath;e&&(!t._originalSecure||y)||(delete g.headers.authorization,delete g.headers.cookie,e||delete g.headers.host,g.auth=void 0)}g.auth&&!a.headers.authorization&&(a.headers.authorization="Basic "+Buffer.from(g.auth).toString("base64")),m=t._req=S(g),t._redirects&&t.emit("redirect",t.url,m)}else m=t._req=S(g);g.timeout&&m.on("timeout",()=>{U(t,m,"Opening handshake has timed out")}),m.on("error",e=>{null===m||m[A]||(m=t._req=null,L(t,e))}),m.on("response",o=>{let i=o.headers.location,l=o.statusCode;if(i&&g.followRedirects&&l>=300&&l<400){let o;if(++t._redirects>g.maxRedirects){U(t,m,"Maximum redirects exceeded");return}m.abort();try{o=new h(i,r)}catch(e){L(t,SyntaxError(`Invalid URL: ${i}`));return}e(t,o,s,a)}else t.emit("unexpected-response",m,o)||U(t,m,`Unexpected server response: ${o.statusCode}`)}),m.on("upgrade",(e,r,s)=>{let o;if(t.emit("upgrade",e),t.readyState!==M.CONNECTING)return;m=t._req=null;let i=e.headers.upgrade;if(void 0===i||"websocket"!==i.toLowerCase()){U(t,r,"Invalid Upgrade header");return}let a=c("sha1").update(w+v).digest("base64");if(e.headers["sec-websocket-accept"]!==a){U(t,r,"Invalid Sec-WebSocket-Accept header");return}let l=e.headers["sec-websocket-protocol"];if(void 0!==l?E.size?E.has(l)||(o="Server sent an invalid subprotocol"):o="Server sent a subprotocol but none was requested":E.size&&(o="Server sent no subprotocol"),o){U(t,r,o);return}l&&(t._protocol=l);let u=e.headers["sec-websocket-extensions"];if(void 0!==u){let e;if(!p){U(t,r,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}try{e=C(u)}catch(e){U(t,r,"Invalid Sec-WebSocket-Extensions header");return}let s=Object.keys(e);if(1!==s.length||s[0]!==f.extensionName){U(t,r,"Server indicated an extension that was not requested");return}try{p.accept(e[f.extensionName])}catch(e){U(t,r,"Invalid Sec-WebSocket-Extensions header");return}t._extensions[f.extensionName]=p}t.setSocket(r,s,{allowSynchronousEvents:g.allowSynchronousEvents,generateMask:g.generateMask,maxPayload:g.maxPayload,skipUTF8Validation:g.skipUTF8Validation})}),g.finishRequest?g.finishRequest(m,t):m.end()}(this,e,t,r)):(this._autoPong=r.autoPong,this._isServer=!0)}get binaryType(){return this._binaryType}set binaryType(e){b.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,t,r){let s=new m({allowSynchronousEvents:r.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:r.maxPayload,skipUTF8Validation:r.skipUTF8Validation}),o=new g(e,this._extensions,r.generateMask);this._receiver=s,this._sender=o,this._socket=e,s[k]=this,o[k]=this,e[k]=this,s.on("conclude",F),s.on("drain",V),s.on("error",W),s.on("message",Z),s.on("ping",J),s.on("pong",H),o.onerror=Y,e.setTimeout&&e.setTimeout(0),e.setNoDelay&&e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",Q),e.on("data",X),e.on("end",ee),e.on("error",et),this._readyState=M.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=M.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[f.extensionName]&&this._extensions[f.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=M.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==M.CLOSED){if(this.readyState===M.CONNECTING){U(this,this._req,"WebSocket was closed before the connection was established");return}if(this.readyState===M.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=M.CLOSING,this._sender.close(e,t,!this._isServer,e=>{!e&&(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),K(this)}}pause(){this.readyState!==M.CONNECTING&&this.readyState!==M.CLOSED&&(this._paused=!0,this._socket.pause())}ping(e,t,r){if(this.readyState===M.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");if("function"==typeof e?(r=e,e=t=void 0):"function"==typeof t&&(r=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState!==M.OPEN){B(this,e,r);return}void 0===t&&(t=!this._isServer),this._sender.ping(e||_,t,r)}pong(e,t,r){if(this.readyState===M.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");if("function"==typeof e?(r=e,e=t=void 0):"function"==typeof t&&(r=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState!==M.OPEN){B(this,e,r);return}void 0===t&&(t=!this._isServer),this._sender.pong(e||_,t,r)}resume(){this.readyState!==M.CONNECTING&&this.readyState!==M.CLOSED&&(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,t,r){if(this.readyState===M.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");if("function"==typeof t&&(r=t,t={}),"number"==typeof e&&(e=e.toString()),this.readyState!==M.OPEN){B(this,e,r);return}let s={binary:"string"!=typeof e,mask:!this._isServer,compress:!0,fin:!0,...t};this._extensions[f.extensionName]||(s.compress=!1),this._sender.send(e||_,s,r)}terminate(){if(this.readyState!==M.CLOSED){if(this.readyState===M.CONNECTING){U(this,this._req,"WebSocket was closed before the connection was established");return}this._socket&&(this._readyState=M.CLOSING,this._socket.destroy())}}}function L(e,t){e._readyState=M.CLOSING,e._errorEmitted=!0,e.emit("error",t),e.emitClose()}function $(e){return e.path=e.socketPath,a.connect(e)}function D(e){return e.path=void 0,e.servername||""===e.servername||(e.servername=a.isIP(e.host)?"":e.host),l.connect(e)}function U(e,t,r){e._readyState=M.CLOSING;let s=Error(r);Error.captureStackTrace(s,U),t.setHeader?(t[A]=!0,t.abort(),t.socket&&!t.socket.destroyed&&t.socket.destroy(),process.nextTick(L,e,s)):(t.destroy(s),t.once("error",e.emit.bind(e,"error")),t.once("close",e.emitClose.bind(e)))}function B(e,t,r){if(t){let r=y(t)?t.size:R(t).length;e._socket?e._sender._bufferedBytes+=r:e._bufferedAmount+=r}if(r){let t=Error(`WebSocket is not open: readyState ${e.readyState} (${N[e.readyState]})`);process.nextTick(r,t)}}function F(e,t){let r=this[k];r._closeFrameReceived=!0,r._closeMessage=t,r._closeCode=e,void 0!==r._socket[k]&&(r._socket.removeListener("data",X),process.nextTick(G,r._socket),1005===e?r.close():r.close(e,t))}function V(){let e=this[k];e.isPaused||e._socket.resume()}function W(e){let t=this[k];void 0!==t._socket[k]&&(t._socket.removeListener("data",X),process.nextTick(G,t._socket),t.close(e[E])),t._errorEmitted||(t._errorEmitted=!0,t.emit("error",e))}function z(){this[k].emitClose()}function Z(e,t){this[k].emit("message",e,t)}function J(e){let t=this[k];t._autoPong&&t.pong(e,!this._isServer,I),t.emit("ping",e)}function H(e){this[k].emit("pong",e)}function G(e){e.resume()}function Y(e){let t=this[k];t.readyState===M.CLOSED||(t.readyState===M.OPEN&&(t._readyState=M.CLOSING,K(t)),this._socket.end(),t._errorEmitted||(t._errorEmitted=!0,t.emit("error",e)))}function K(e){e._closeTimer=setTimeout(e._socket.destroy.bind(e._socket),3e4)}function Q(){let e;let t=this[k];this.removeListener("close",Q),this.removeListener("data",X),this.removeListener("end",ee),t._readyState=M.CLOSING,this._readableState.endEmitted||t._closeFrameReceived||t._receiver._writableState.errorEmitted||null===(e=t._socket.read())||t._receiver.write(e),t._receiver.end(),this[k]=void 0,clearTimeout(t._closeTimer),t._receiver._writableState.finished||t._receiver._writableState.errorEmitted?t.emitClose():(t._receiver.on("error",z),t._receiver.on("finish",z))}function X(e){this[k]._receiver.write(e)||this.pause()}function ee(){let e=this[k];e._readyState=M.CLOSING,e._receiver.end(),this.end()}function et(){let e=this[k];this.removeListener("error",et),this.on("error",I),e&&(e._readyState=M.CLOSING,this.destroy())}Object.defineProperty(M,"CONNECTING",{enumerable:!0,value:N.indexOf("CONNECTING")}),Object.defineProperty(M.prototype,"CONNECTING",{enumerable:!0,value:N.indexOf("CONNECTING")}),Object.defineProperty(M,"OPEN",{enumerable:!0,value:N.indexOf("OPEN")}),Object.defineProperty(M.prototype,"OPEN",{enumerable:!0,value:N.indexOf("OPEN")}),Object.defineProperty(M,"CLOSING",{enumerable:!0,value:N.indexOf("CLOSING")}),Object.defineProperty(M.prototype,"CLOSING",{enumerable:!0,value:N.indexOf("CLOSING")}),Object.defineProperty(M,"CLOSED",{enumerable:!0,value:N.indexOf("CLOSED")}),Object.defineProperty(M.prototype,"CLOSED",{enumerable:!0,value:N.indexOf("CLOSED")}),["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(e=>{Object.defineProperty(M.prototype,e,{enumerable:!0})}),["open","error","close","message"].forEach(e=>{Object.defineProperty(M.prototype,`on${e}`,{enumerable:!0,get(){for(let t of this.listeners(e))if(t[w])return t[S];return null},set(t){for(let t of this.listeners(e))if(t[w]){this.removeListener(e,t);break}"function"==typeof t&&this.addEventListener(e,t,{[w]:!0})}})}),M.prototype.addEventListener=O,M.prototype.removeEventListener=T,e.exports=M},11281:()=>{throw Error('Module parse failed: Unexpected token (2:12)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n| import * as hrana from "@libsql/hrana-client";\n> import type { InStatement, ResultSet, Transaction, TransactionMode } from "@libsql/core/api";\n| import type { SqlCache } from "./sql_cache.js";\n| export declare abstract class HranaTransaction implements Transaction {')},67861:()=>{throw Error('Module parse failed: Unexpected token (3:12)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n| /// <reference types="node" />\n| import * as hrana from "@libsql/hrana-client";\n> import type { Config, Client } from "@libsql/core/api";\n| import type { InStatement, ResultSet, Transaction, IntMode, InArgs, Replicated } from "@libsql/core/api";\n| import { TransactionMode } from "@libsql/core/api";')},62983:()=>{throw Error('Module parse failed: Unexpected token (1:12)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n> import type { Config, Client } from "@libsql/core/api";\n| export * from "@libsql/core/api";\n| /** Creates a {@link Client} object.')},46801:()=>{throw Error('Module parse failed: Unexpected token (1:12)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n> import type * as hrana from "@libsql/hrana-client";\n| export declare class SqlCache {\n|     #private;')},44469:()=>{throw Error('Module parse failed: Unexpected token (2:12)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n| import Database from "libsql";\n> import type { Config, IntMode, Client, Transaction, TransactionMode, ResultSet, InStatement, InArgs, Replicated } from "@libsql/core/api";\n| import type { ExpandedConfig } from "@libsql/core/config";\n| export * from "@libsql/core/api";')},12190:()=>{throw Error('Module parse failed: Unexpected token (1:12)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n> import type { Config, Client } from "@libsql/core/api";\n| import type { ExpandedConfig } from "@libsql/core/config";\n| export * from "@libsql/core/api";')},76201:()=>{throw Error('Module parse failed: Unexpected token (3:12)\nFile was processed with these loaders:\n * ../node_modules/.pnpm/next@14.2.24_@opentelemetry+api@1.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n| /// <reference types="node" />\n| import * as hrana from "@libsql/hrana-client";\n> import type { Config, IntMode, Client, Transaction, ResultSet, InStatement, InArgs, Replicated } from "@libsql/core/api";\n| import { TransactionMode } from "@libsql/core/api";\n| import type { ExpandedConfig } from "@libsql/core/config";')},82630:(e,t,r)=>{"use strict";let{load:s,currentTarget:o}=r(60452),{familySync:i,GLIBC:a}=r(96474),{databaseOpen:l,databaseOpenWithRpcSync:u,databaseInTransaction:c,databaseClose:d,databaseSyncSync:p,databaseSyncUntilSync:h,databaseExecSync:f,databasePrepareSync:m,databaseDefaultSafeIntegers:g,databaseLoadExtension:y,databaseMaxWriteReplicationIndex:b,statementRaw:_,statementIsReader:v,statementGet:w,statementRun:S,statementRowsSync:E,statementColumns:k,statementSafeIntegers:I,rowsNext:O}=function(){if(process.env.LIBSQL_JS_DEV)return s(__dirname);let e=o();if(i()==a)switch(e){case"linux-x64-musl":e="linux-x64-gnu";break;case"linux-arm64-musl":e="linux-arm64-gnu"}return r(6427)(`./${e}`)}(),T=r(64166);function j(e){return e.libsqlError?new T(e.message,e.code,e.rawCode):e}class C{constructor(e,t){let r=t?.encryptionCipher??"aes256cbc";if(t&&t.syncUrl){var s="";t.syncAuth?(console.warn("Warning: The `syncAuth` option is deprecated, please use `authToken` option instead."),s=t.syncAuth):t.authToken&&(s=t.authToken);let o=t?.encryptionKey??"",i=t?.syncPeriod??0,a=t?.readYourWrites??!0;this.db=u(e,t.syncUrl,s,r,o,i,a)}else{let s=t?.authToken??"",o=t?.encryptionKey??"";this.db=l(e,s,r,o)}this.memory=":memory:"===e,this.readonly=!1,this.name="",this.open=!0;let o=this.db;Object.defineProperties(this,{inTransaction:{get:()=>c(o)}})}sync(){return p.call(this.db)}syncUntil(e){return h.call(this.db,e)}prepare(e){try{let t=m.call(this.db,e);return new R(t)}catch(e){throw j(e)}}transaction(e){if("function"!=typeof e)throw TypeError("Expected first argument to be a function");let t=this,r=r=>(...s)=>{t.exec("BEGIN "+r);try{let r=e(...s);return t.exec("COMMIT"),r}catch(e){throw t.exec("ROLLBACK"),e}},s={default:{value:r("")},deferred:{value:r("DEFERRED")},immediate:{value:r("IMMEDIATE")},exclusive:{value:r("EXCLUSIVE")},database:{value:this,enumerable:!0}};return Object.defineProperties(s.default.value,s),Object.defineProperties(s.deferred.value,s),Object.defineProperties(s.immediate.value,s),Object.defineProperties(s.exclusive.value,s),s.default.value}pragma(e,t){if(null==t&&(t={}),"string"!=typeof e)throw TypeError("Expected first argument to be a string");if("object"!=typeof t)throw TypeError("Expected second argument to be an options object");let r=t.simple,s=this.prepare(`PRAGMA ${e}`,this,!0);return r?s.pluck().get():s.all()}backup(e,t){throw Error("not implemented")}serialize(e){throw Error("not implemented")}function(e,t,r){if(null==t&&(t={}),"function"==typeof t&&(r=t,t={}),"string"!=typeof e)throw TypeError("Expected first argument to be a string");if("function"!=typeof r)throw TypeError("Expected last argument to be a function");if("object"!=typeof t)throw TypeError("Expected second argument to be an options object");if(!e)throw TypeError("User-defined function name cannot be an empty string");throw Error("not implemented")}aggregate(e,t){if("string"!=typeof e)throw TypeError("Expected first argument to be a string");if("object"!=typeof t||null===t)throw TypeError("Expected second argument to be an options object");if(!e)throw TypeError("User-defined function name cannot be an empty string");throw Error("not implemented")}table(e,t){if("string"!=typeof e)throw TypeError("Expected first argument to be a string");if(!e)throw TypeError("Virtual table module name cannot be an empty string");throw Error("not implemented")}loadExtension(...e){y.call(this.db,...e)}maxWriteReplicationIndex(){return b.call(this.db)}exec(e){try{f.call(this.db,e)}catch(e){throw j(e)}}close(){d.call(this.db),this.open=!1}defaultSafeIntegers(e){return g.call(this.db,e??!0),this}unsafeMode(...e){throw Error("not implemented")}}class R{constructor(e){this.stmt=e}raw(e){return _.call(this.stmt,e??!0),this}get reader(){return v.call(this.stmt)}run(...e){try{if(1==e.length&&"object"==typeof e[0])return S.call(this.stmt,e[0]);return S.call(this.stmt,e.flat())}catch(e){throw j(e)}}get(...e){return 1==e.length&&"object"==typeof e[0]?w.call(this.stmt,e[0]):w.call(this.stmt,e.flat())}iterate(...e){var t=void 0;return t=1==e.length&&"object"==typeof e[0]?E.call(this.stmt,e[0]):E.call(this.stmt,e.flat()),{nextRows:Array(100),nextRowIndex:100,next(){100===this.nextRowIndex&&(O.call(t,this.nextRows),this.nextRowIndex=0);let e=this.nextRows[this.nextRowIndex];return(this.nextRows[this.nextRowIndex]=void 0,e)?(this.nextRowIndex++,{value:e,done:!1}):{done:!0}},[Symbol.iterator](){return this}}}all(...e){let t=[];for(let r of this.iterate(...e))t.push(r);return t}columns(){return k.call(this.stmt)}safeIntegers(e){return I.call(this.stmt,e??!0),this}}e.exports=C,e.exports.SqliteError=T},64166:e=>{"use strict";let t={value:"SqliteError",writable:!0,enumerable:!1,configurable:!0};function r(e,s,o){if(new.target!==r)return new r(e,s);if("string"!=typeof s)throw TypeError("Expected second argument to be a string");Error.call(this,e),t.value=""+e,Object.defineProperty(this,"message",t),Error.captureStackTrace(this,r),this.code=s,this.rawCode=o}Object.setPrototypeOf(r,Error),Object.setPrototypeOf(r.prototype,Error.prototype),Object.defineProperty(r.prototype,"name",t),e.exports=r},42147:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LibsqlError=void 0;class r extends Error{code;rawCode;constructor(e,t,r,s){void 0!==t&&(e=`${t}: ${e}`),super(e,{cause:s}),this.code=t,this.rawCode=r,this.name="LibsqlError"}}t.LibsqlError=r},43682:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.expandConfig=t.isInMemoryConfig=void 0;let s=r(42147),o=r(73746),i=r(77806),a=":memory:";t.isInMemoryConfig=function(e){return"file"===e.scheme&&(":memory:"===e.path||e.path.startsWith(":memory:?"))},t.expandConfig=function(e,t){let r,l;if("object"!=typeof e)throw TypeError(`Expected client configuration as object, got ${typeof e}`);let{url:u,authToken:c,tls:d,intMode:p,concurrency:h}=e;h=Math.max(0,h||20),p??="number";let f=[];u===a&&(u="file::memory:");let m=(0,o.parseUri)(u),g=m.scheme.toLowerCase(),y="file"===g&&m.path===a&&void 0===m.authority;for(let{key:e,value:t}of(r=y?{cache:{values:["shared","private"],update:(e,t)=>f.push(`${e}=${t}`)}}:{tls:{values:["0","1"],update:(e,t)=>d="1"===t},authToken:{update:(e,t)=>c=t}},m.query?.pairs??[])){if(!Object.hasOwn(r,e))throw new s.LibsqlError(`Unsupported URL query parameter ${JSON.stringify(e)}`,"URL_PARAM_NOT_SUPPORTED");let o=r[e];if(void 0!==o.values&&!o.values.includes(t))throw new s.LibsqlError(`Unknown value for the "${e}" query argument: ${JSON.stringify(t)}. Supported values are: [${o.values.map(e=>'"'+e+'"').join(", ")}]`,"URL_INVALID");void 0!==o.update&&o?.update(e,t)}let b=0===f.length?"":`?${f.join("&")}`,_=m.path+b;if("libsql"===g){if(!1===d){if(m.authority?.port===void 0)throw new s.LibsqlError('A "libsql:" URL with ?tls=0 must specify an explicit port',"URL_INVALID");l=t?"http":"ws"}else l=t?"https":"wss"}else l=g;if("http"===l||"ws"===l?d??=!1:d??=!0,"http"!==l&&"ws"!==l&&"https"!==l&&"wss"!==l&&"file"!==l)throw new s.LibsqlError(`The client supports only "libsql:", "wss:", "ws:", "https:", "http:" and "file:" URLs, got ${JSON.stringify(m.scheme+":")}. For more information, please read ${i.supportedUrlLink}`,"URL_SCHEME_NOT_SUPPORTED");if("number"!==p&&"bigint"!==p&&"string"!==p)throw TypeError(`Invalid value for intMode, expected "number", "bigint" or "string", got ${JSON.stringify(p)}`);if(void 0!==m.fragment)throw new s.LibsqlError(`URL fragments are not supported: ${JSON.stringify("#"+m.fragment)}`,"URL_INVALID");return y?{scheme:"file",tls:!1,path:_,intMode:p,concurrency:h,syncUrl:e.syncUrl,syncInterval:e.syncInterval,fetch:e.fetch,authToken:void 0,encryptionKey:void 0,authority:void 0}:{scheme:l,tls:d,authority:m.authority,path:_,authToken:c,intMode:p,concurrency:h,encryptionKey:e.encryptionKey,syncUrl:e.syncUrl,syncInterval:e.syncInterval,fetch:e.fetch}}},73746:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.encodeBaseUrl=t.parseUri=void 0;let s=r(42147);t.parseUri=function(e){let t=o.exec(e);if(null===t)throw new s.LibsqlError(`The URL '${e}' is not in a valid format`,"URL_INVALID");let r=t.groups,l=r.scheme,u=void 0!==r.authority?function(e){let t=i.exec(e);if(null===t)throw new s.LibsqlError("The authority part of the URL is not in a valid format","URL_INVALID");let r=t.groups;return{host:a(r.host_br??r.host),port:r.port?parseInt(r.port,10):void 0,userinfo:void 0!==r.username?{username:a(r.username),password:void 0!==r.password?a(r.password):void 0}:void 0}}(r.authority):void 0;return{scheme:l,authority:u,path:a(r.path),query:void 0!==r.query?function(e){let t=e.split("&"),r=[];for(let e of t){let t,s;if(""===e)continue;let o=e.indexOf("=");o<0?(t=e,s=""):(t=e.substring(0,o),s=e.substring(o+1)),r.push({key:a(t.replaceAll("+"," ")),value:a(s.replaceAll("+"," "))})}return{pairs:r}}(r.query):void 0,fragment:void 0!==r.fragment?a(r.fragment):void 0}};let o=RegExp("^(?<scheme>[A-Za-z][A-Za-z.+-]*):(//(?<authority>[^/?#]*))?(?<path>[^?#]*)(\\?(?<query>[^#]*))?(#(?<fragment>.*))?$","su"),i=RegExp("^((?<username>[^:]*)(:(?<password>.*))?@)?((?<host>[^:\\[\\]]*)|(\\[(?<host_br>[^\\[\\]]*)\\]))(:(?<port>[0-9]*))?$","su");function a(e){try{return decodeURIComponent(e)}catch(e){if(e instanceof URIError)throw new s.LibsqlError(`URL component has invalid percent encoding: ${e}`,"URL_INVALID",void 0,e);throw e}}t.encodeBaseUrl=function(e,t,r){var o,i;if(void 0===t)throw new s.LibsqlError(`URL with scheme ${JSON.stringify(e+":")} requires authority (the "//" part)`,"URL_INVALID");let a=`${e}:`,l=(o=t.host).includes(":")?`[${encodeURI(o)}]`:encodeURI(o),u=void 0!==(i=t.port)?`:${i}`:"",c=function(e){if(void 0===e)return"";let t=encodeURIComponent(e.username),r=void 0!==e.password?`:${encodeURIComponent(e.password)}`:"";return`${t}${r}@`}(t.userinfo),d=`//${c}${l}${u}`,p=r.split("/").map(encodeURIComponent).join("/");return""===p||p.startsWith("/")||(p="/"+p),new URL(`${a}${d}${p}`)}},77806:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ResultSetImpl=t.transactionModeToBegin=t.supportedUrlLink=void 0;let s=r(93276);t.supportedUrlLink="https://github.com/libsql/libsql-client-ts#supported-urls",t.transactionModeToBegin=function(e){if("write"===e)return"BEGIN IMMEDIATE";if("read"===e)return"BEGIN TRANSACTION READONLY";if("deferred"===e)return"BEGIN DEFERRED";throw RangeError('Unknown transaction mode, supported values are "write", "read" and "deferred"')};class o{columns;columnTypes;rows;rowsAffected;lastInsertRowid;constructor(e,t,r,s,o){this.columns=e,this.columnTypes=t,this.rows=r,this.rowsAffected=s,this.lastInsertRowid=o}toJSON(){return{columns:this.columns,columnTypes:this.columnTypes,rows:this.rows.map(i),rowsAffected:this.rowsAffected,lastInsertRowid:void 0!==this.lastInsertRowid?""+this.lastInsertRowid:null}}}function i(e){return Array.prototype.map.call(e,a)}function a(e){return"bigint"==typeof e?""+e:e instanceof ArrayBuffer?s.Base64.fromUint8Array(new Uint8Array(e)):e}t.ResultSetImpl=o},92101:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BatchCond=t.BatchStep=t.Batch=void 0;let s=r(43615),o=r(45863),i=r(87155),a=r(54766);class l{_stream;#e;_steps;#t;constructor(e,t){this._stream=e,this.#e=t,this._steps=[],this.#t=!1}step(){return new c(this)}execute(){var e,t;if(this.#t)throw new s.MisuseError("This batch has already been executed");this.#t=!0;let r={steps:this._steps.map(e=>e.proto)};return this.#e?u(this._stream,this._steps,r):(e=this._stream,t=this._steps,e._batch(r).then(e=>{for(let r=0;r<t.length;++r){let s=e.stepResults.get(r),o=e.stepErrors.get(r);t[r].callback(s,o)}}))}}async function u(e,t,r){let i=await e._openCursor(r);try{let e,r=0,l=[];for(;;){let u=await i.next();if(void 0===u)break;if("step_begin"===u.type){if(u.step<r||u.step>=t.length)throw new s.ProtoError("Server produced StepBeginEntry for unexpected step");if(void 0!==e)throw new s.ProtoError("Server produced StepBeginEntry before terminating previous step");for(let e=r;e<u.step;++e)t[e].callback(void 0,void 0);r=u.step+1,e=u,l=[]}else if("step_end"===u.type){if(void 0===e)throw new s.ProtoError("Server produced StepEndEntry but no step is active");let r={cols:e.cols,rows:l,affectedRowCount:u.affectedRowCount,lastInsertRowid:u.lastInsertRowid};t[e.step].callback(r,void 0),e=void 0,l=[]}else if("step_error"===u.type){if(void 0===e){if(u.step>=t.length)throw new s.ProtoError("Server produced StepErrorEntry for unexpected step");for(let e=r;e<u.step;++e)t[e].callback(void 0,void 0)}else{if(u.step!==e.step)throw new s.ProtoError("Server produced StepErrorEntry for unexpected step");e=void 0,l=[]}t[u.step].callback(void 0,u.error),r=u.step+1}else if("row"===u.type){if(void 0===e)throw new s.ProtoError("Server produced RowEntry but no step is active");l.push(u.row)}else if("error"===u.type)throw(0,o.errorFromProto)(u.error);else if("none"===u.type)throw new s.ProtoError("Server produced unrecognized CursorEntry");else throw(0,a.impossible)(u,"Impossible CursorEntry")}if(void 0!==e)throw new s.ProtoError("Server closed Cursor before terminating active step");for(let e=r;e<t.length;++e)t[e].callback(void 0,void 0)}finally{i.close()}}t.Batch=l;class c{_batch;#r;_index;constructor(e){this._batch=e,this.#r=[],this._index=void 0}condition(e){return this.#r.push(e._proto),this}query(e){return this.#s(e,!0,o.rowsResultFromProto)}queryRow(e){return this.#s(e,!0,o.rowResultFromProto)}queryValue(e){return this.#s(e,!0,o.valueResultFromProto)}run(e){return this.#s(e,!1,o.stmtResultFromProto)}#s(e,t,r){if(void 0!==this._index)throw new s.MisuseError("This BatchStep has already been added to the batch");let a={stmt:(0,i.stmtToProto)(this._batch._stream._sqlOwner(),e,t),condition:0===this.#r.length?void 0:1===this.#r.length?this.#r[0]:{type:"and",conds:this.#r.slice()}};return new Promise((e,t)=>{this._index=this._batch._steps.length,this._batch._steps.push({proto:a,callback:(i,a)=>{void 0!==i&&void 0!==a?t(new s.ProtoError("Server returned both result and error")):void 0!==a?t((0,o.errorFromProto)(a)):void 0!==i?e(r(i,this._batch._stream.intMode)):e(void 0)}})})}}t.BatchStep=c;class d{_batch;_proto;constructor(e,t){this._batch=e,this._proto=t}static ok(e){return new d(e._batch,{type:"ok",step:p(e)})}static error(e){return new d(e._batch,{type:"error",step:p(e)})}static not(e){return new d(e._batch,{type:"not",cond:e._proto})}static and(e,t){for(let r of t)h(e,r);return new d(e,{type:"and",conds:t.map(e=>e._proto)})}static or(e,t){for(let r of t)h(e,r);return new d(e,{type:"or",conds:t.map(e=>e._proto)})}static isAutocommit(e){return e._stream.client()._ensureVersion(3,"BatchCond.isAutocommit()"),new d(e,{type:"is_autocommit"})}}function p(e){if(void 0===e._index)throw new s.MisuseError("Cannot add a condition referencing a step that has not been added to the batch");return e._index}function h(e,t){if(t._batch!==e)throw new s.MisuseError("Cannot mix BatchCond objects for different Batch objects")}t.BatchCond=d},3665:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ByteQueue=void 0;class r{#n;#o;#i;constructor(e){this.#n=new Uint8Array(new ArrayBuffer(e)),this.#o=0,this.#i=0}get length(){return this.#i-this.#o}data(){return this.#n.slice(this.#o,this.#i)}push(e){this.#a(e.byteLength),this.#n.set(e,this.#i),this.#i+=e.byteLength}#a(e){if(this.#i+e<=this.#n.byteLength)return;let t=this.#i-this.#o;if(t+e<=this.#n.byteLength&&2*this.#i>=this.#n.byteLength)this.#n.copyWithin(0,this.#o,this.#i);else{let r=this.#n.byteLength;do r*=2;while(t+e>r);let s=new Uint8Array(new ArrayBuffer(r));s.set(this.#n.slice(this.#o,this.#i),0),this.#n=s}this.#i=t,this.#o=0}shift(e){this.#o+=e}}t.ByteQueue=r},15022:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Client=void 0;class r{constructor(){this.intMode="number"}intMode}t.Client=r},36328:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Cursor=void 0;class r{}t.Cursor=r},80958:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.describeResultFromProto=void 0,t.describeResultFromProto=function(e){return{paramNames:e.params.map(e=>e.name),columns:e.cols,isExplain:e.isExplain,isReadonly:e.isReadonly}}},44760:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.writeProtobufMessage=t.readProtobufMessage=t.writeJsonObject=t.readJsonObject=void 0;var s=r(74963);Object.defineProperty(t,"readJsonObject",{enumerable:!0,get:function(){return s.readJsonObject}});var o=r(26739);Object.defineProperty(t,"writeJsonObject",{enumerable:!0,get:function(){return o.writeJsonObject}});var i=r(35346);Object.defineProperty(t,"readProtobufMessage",{enumerable:!0,get:function(){return i.readProtobufMessage}});var a=r(14972);Object.defineProperty(t,"writeProtobufMessage",{enumerable:!0,get:function(){return a.writeProtobufMessage}})},74963:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.readJsonObject=t.arrayObjectsMap=t.object=t.array=t.boolean=t.number=t.stringOpt=t.string=void 0;let s=r(43615);function o(e){if(Array.isArray(e))return e;throw a(e,"array")}function i(e){if(null!==e&&"object"==typeof e&&!Array.isArray(e))return e;throw a(e,"object")}function a(e,t){if(void 0===e)return new s.ProtoError(`Expected ${t}, but the property was missing`);let r=typeof e;return null===e?r="null":Array.isArray(e)&&(r="array"),new s.ProtoError(`Expected ${t}, received ${r}`)}t.string=function(e){if("string"==typeof e)return e;throw a(e,"string")},t.stringOpt=function(e){if(null!=e){if("string"==typeof e)return e;throw a(e,"string or null")}},t.number=function(e){if("number"==typeof e)return e;throw a(e,"number")},t.boolean=function(e){if("boolean"==typeof e)return e;throw a(e,"boolean")},t.array=o,t.object=i,t.arrayObjectsMap=function(e,t){return o(e).map(e=>t(i(e)))},t.readJsonObject=function(e,t){return t(i(e))}},26739:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.writeJsonObject=t.ObjectWriter=void 0;class r{#l;#u;constructor(e){this.#l=e,this.#u=!1}begin(){this.#l.push("{"),this.#u=!0}end(){this.#l.push("}"),this.#u=!1}#c(e){this.#u?(this.#l.push('"'),this.#u=!1):this.#l.push(',"'),this.#l.push(e),this.#l.push('":')}string(e,t){this.#c(e),this.#l.push(JSON.stringify(t))}stringRaw(e,t){this.#c(e),this.#l.push('"'),this.#l.push(t),this.#l.push('"')}number(e,t){this.#c(e),this.#l.push(""+t)}boolean(e,t){this.#c(e),this.#l.push(t?"true":"false")}object(e,t,r){this.#c(e),this.begin(),r(this,t),this.end()}arrayObjects(e,t,r){this.#c(e),this.#l.push("[");for(let e=0;e<t.length;++e)0!==e&&this.#l.push(","),this.begin(),r(this,t[e]),this.end();this.#l.push("]")}}t.ObjectWriter=r,t.writeJsonObject=function(e,t){let s=[],o=new r(s);return o.begin(),t(o,e),o.end(),s.join("")}},35346:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.readProtobufMessage=t.FieldReader=void 0;let s=r(43615),o=r(60887);class i{#n;#d;#p;constructor(e){this.#n=e,this.#d=new DataView(e.buffer,e.byteOffset,e.byteLength),this.#p=0}varint(){let e=0;for(let t=0;;t+=7){let r=this.#n[this.#p++];if(e|=(127&r)<<t,!(128&r))break}return e}varintBig(){let e=0n;for(let t=0n;;t+=7n){let r=this.#n[this.#p++];if(e|=BigInt(127&r)<<t,!(128&r))break}return e}bytes(e){let t=new Uint8Array(this.#n.buffer,this.#n.byteOffset+this.#p,e);return this.#p+=e,t}double(){let e=this.#d.getFloat64(this.#p,!0);return this.#p+=8,e}skipVarint(){for(;128&this.#n[this.#p++];);}skip(e){this.#p+=e}eof(){return this.#p>=this.#n.byteLength}}class a{#h;#f;constructor(e){this.#h=e,this.#f=-1}setup(e){this.#f=e}#m(e){if(this.#f!==e)throw new s.ProtoError(`Expected wire type ${e}, got ${this.#f}`);this.#f=-1}bytes(){this.#m(o.LENGTH_DELIMITED);let e=this.#h.varint();return this.#h.bytes(e)}string(){return new TextDecoder().decode(this.bytes())}message(e){return l(this.bytes(),e)}int32(){return this.#m(o.VARINT),this.#h.varint()}uint32(){return this.int32()}bool(){return 0!==this.int32()}uint64(){return this.#m(o.VARINT),this.#h.varintBig()}sint64(){let e=this.uint64();return e>>1n^-(1n&e)}double(){return this.#m(o.FIXED_64),this.#h.double()}maybeSkip(){if(!(this.#f<0)){if(this.#f===o.VARINT)this.#h.skipVarint();else if(this.#f===o.FIXED_64)this.#h.skip(8);else if(this.#f===o.LENGTH_DELIMITED){let e=this.#h.varint();this.#h.skip(e)}else if(this.#f===o.FIXED_32)this.#h.skip(4);else throw new s.ProtoError(`Unexpected wire type ${this.#f}`);this.#f=-1}}}function l(e,t){let r=new i(e),s=new a(r),o=t.default();for(;!r.eof();){let e=r.varint(),i=e>>3,a=7&e;s.setup(a);let l=t[i];if(void 0!==l){let e=l(s,o);void 0!==e&&(o=e)}s.maybeSkip()}return o}t.FieldReader=a,t.readProtobufMessage=l},14972:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.writeProtobufMessage=t.MessageWriter=void 0;let s=r(60887);class o{#g;#n;#d;#p;constructor(){this.#g=new ArrayBuffer(256),this.#n=new Uint8Array(this.#g),this.#d=new DataView(this.#g),this.#p=0}#y(e){if(this.#p+e<=this.#g.byteLength)return;let t=this.#g.byteLength;for(;t<this.#p+e;)t*=2;let r=new ArrayBuffer(t),s=new Uint8Array(r),o=new DataView(r);s.set(new Uint8Array(this.#g,0,this.#p)),this.#g=r,this.#n=s,this.#d=o}#b(e){this.#y(5),e|=0;do{let t=127&e;e>>>=7,t|=e?128:0,this.#n[this.#p++]=t}while(e)}#_(e){this.#y(10),e&=0xffffffffffffffffn;do{let t=Number(127n&e);e>>=7n,t|=e?128:0,this.#n[this.#p++]=t}while(e)}#v(e,t){this.#b(e<<3|t)}bytes(e,t){this.#v(e,s.LENGTH_DELIMITED),this.#b(t.byteLength),this.#y(t.byteLength),this.#n.set(t,this.#p),this.#p+=t.byteLength}string(e,t){this.bytes(e,new TextEncoder().encode(t))}message(e,t,r){let s=new o;r(s,t),this.bytes(e,s.data())}int32(e,t){this.#v(e,s.VARINT),this.#b(t)}uint32(e,t){this.int32(e,t)}bool(e,t){this.int32(e,t?1:0)}sint64(e,t){this.#v(e,s.VARINT),this.#_(t<<1n^t>>63n)}double(e,t){this.#v(e,s.FIXED_64),this.#y(8),this.#d.setFloat64(this.#p,t,!0),this.#p+=8}data(){return new Uint8Array(this.#g,0,this.#p)}}t.MessageWriter=o,t.writeProtobufMessage=function(e,t){let r=new o;return t(r,e),r.data()}},60887:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FIXED_32=t.GROUP_END=t.GROUP_START=t.LENGTH_DELIMITED=t.FIXED_64=t.VARINT=void 0,t.VARINT=0,t.FIXED_64=1,t.LENGTH_DELIMITED=2,t.GROUP_START=3,t.GROUP_END=4,t.FIXED_32=5},43615:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MisuseError=t.InternalError=t.ProtocolVersionError=t.LibsqlUrlParseError=t.HttpServerError=t.WebSocketError=t.WebSocketUnsupportedError=t.ClosedError=t.ResponseError=t.ProtoError=t.ClientError=void 0;class r extends Error{constructor(e){super(e),this.name="ClientError"}}t.ClientError=r;class s extends r{constructor(e){super(e),this.name="ProtoError"}}t.ProtoError=s;class o extends r{code;proto;constructor(e,t){super(e),this.name="ResponseError",this.code=t.code,this.proto=t,this.stack=void 0}}t.ResponseError=o;class i extends r{constructor(e,t){void 0!==t?(super(`${e}: ${t}`),this.cause=t):super(e),this.name="ClosedError"}}t.ClosedError=i;class a extends r{constructor(e){super(e),this.name="WebSocketUnsupportedError"}}t.WebSocketUnsupportedError=a;class l extends r{constructor(e){super(e),this.name="WebSocketError"}}t.WebSocketError=l;class u extends r{status;constructor(e,t){super(e),this.status=t,this.name="HttpServerError"}}t.HttpServerError=u;class c extends r{constructor(e){super(e),this.name="LibsqlUrlParseError"}}t.LibsqlUrlParseError=c;class d extends r{constructor(e){super(e),this.name="ProtocolVersionError"}}t.ProtocolVersionError=d;class p extends r{constructor(e){super(e),this.name="InternalError"}}t.InternalError=p;class h extends r{constructor(e){super(e),this.name="MisuseError"}}t.MisuseError=h},44351:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HttpClient=t.checkEndpoints=void 0;let s=r(14219),o=r(15022),i=r(43615),a=r(32444);t.checkEndpoints=[{versionPath:"v3-protobuf",pipelinePath:"v3-protobuf/pipeline",cursorPath:"v3-protobuf/cursor",version:3,encoding:"protobuf"}];let l={versionPath:"v2",pipelinePath:"v2/pipeline",cursorPath:void 0,version:2,encoding:"json"};class u extends o.Client{#w;#x;#S;#E;#k;_endpointPromise;_endpoint;constructor(e,t,r,o=2){super(),this.#w=e,this.#x=t,this.#S=r??s.fetch,this.#E=void 0,this.#k=new Set,3==o?(this._endpointPromise=c(this.#S,this.#w),this._endpointPromise.then(e=>this._endpoint=e,e=>this.#I(e))):(this._endpointPromise=Promise.resolve(l),this._endpointPromise.then(e=>this._endpoint=e,e=>this.#I(e)))}async getVersion(){return void 0!==this._endpoint?this._endpoint.version:(await this._endpointPromise).version}_ensureVersion(e,t){if(!(e<=l.version)){if(void 0===this._endpoint)throw new i.ProtocolVersionError(`${t} is supported only on protocol version ${e} and higher, but the version supported by the HTTP server is not yet known. Use Client.getVersion() to wait until the version is available.`);if(this._endpoint.version<e)throw new i.ProtocolVersionError(`${t} is supported only on protocol version ${e} and higher, but the HTTP server only supports version ${this._endpoint.version}.`)}}openStream(){if(void 0!==this.#E)throw new i.ClosedError("Client is closed",this.#E);let e=new a.HttpStream(this,this.#w,this.#x,this.#S);return this.#k.add(e),e}_streamClosed(e){this.#k.delete(e)}close(){this.#I(new i.ClientError("Client was manually closed"))}get closed(){return void 0!==this.#E}#I(e){if(void 0===this.#E)for(let t of(this.#E=e,Array.from(this.#k)))t._setClosed(new i.ClosedError("Client was closed",e))}}async function c(e,r){for(let o of t.checkEndpoints){let t=new URL(o.versionPath,r),i=new s.Request(t.toString(),{method:"GET"}),a=await e(i);if(await a.arrayBuffer(),a.ok)return o}return l}t.HttpClient=u},70588:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var o=Object.getOwnPropertyDescriptor(t,r);(!o||("get"in o?!t.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,o)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&s(t,e,r);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.HttpCursor=void 0;let a=r(3665),l=r(36328),u=i(r(74963)),c=i(r(35346)),d=r(43615),p=r(54766),h=r(4924),f=r(42490),m=r(76950),g=r(77682);class y extends l.Cursor{#O;#T;#h;#j;#E;#C;constructor(e,t){super(),this.#O=e,this.#T=t,this.#h=void 0,this.#j=new a.ByteQueue(16384),this.#E=void 0,this.#C=!1}async open(e){if(null===e.body)throw new d.ProtoError("No response body for cursor request");this.#h=e.body.getReader();let t=await this.#R(h.CursorRespBody,f.CursorRespBody);if(void 0===t)throw new d.ProtoError("Empty response to cursor request");return t}next(){return this.#R(m.CursorEntry,g.CursorEntry)}close(){this._setClosed(new d.ClientError("Cursor was manually closed"))}_setClosed(e){void 0===this.#E&&(this.#E=e,this.#O._cursorClosed(this),void 0!==this.#h&&this.#h.cancel())}get closed(){return void 0!==this.#E}async #R(e,t){for(;;){if(this.#C)return;if(void 0!==this.#E)throw new d.ClosedError("Cursor is closed",this.#E);if("json"===this.#T){let t=this.#A();if(void 0!==t){let r=JSON.parse(new TextDecoder().decode(t));return u.readJsonObject(r,e)}}else if("protobuf"===this.#T){let e=this.#P();if(void 0!==e)return c.readProtobufMessage(e,t)}else throw(0,p.impossible)(this.#T,"Impossible encoding");if(void 0===this.#h)throw new d.InternalError("Attempted to read from HTTP cursor before it was opened");let{value:r,done:s}=await this.#h.read();if(s&&0===this.#j.length)this.#C=!0;else if(s)throw new d.ProtoError("Unexpected end of cursor stream");else this.#j.push(r)}}#A(){let e=this.#j.data(),t=e.indexOf(10);if(t<0)return;let r=e.slice(0,t);return this.#j.shift(t+1),r}#P(){let e=this.#j.data(),t=0,r=0;for(;;){if(r>=e.byteLength)return;let s=e[r];if(t|=(127&s)<<7*r,r+=1,!(128&s))break}if(e.byteLength<r+t)return;let s=e.slice(r,r+t);return this.#j.shift(r+t),s}}t.HttpCursor=y},4924:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var o=Object.getOwnPropertyDescriptor(t,r);(!o||("get"in o?!t.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,o)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&s(t,e,r);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.CursorRespBody=t.PipelineRespBody=void 0;let a=r(43615),l=i(r(74963)),u=r(76950);function c(e){let t=l.string(e.type);if("ok"===t)return{type:"ok",response:function(e){let t=l.string(e.type);if("close"===t)return{type:"close"};if("execute"===t)return{type:"execute",result:(0,u.StmtResult)(l.object(e.result))};if("batch"===t)return{type:"batch",result:(0,u.BatchResult)(l.object(e.result))};if("sequence"===t)return{type:"sequence"};if("describe"===t)return{type:"describe",result:(0,u.DescribeResult)(l.object(e.result))};if("store_sql"===t)return{type:"store_sql"};if("close_sql"===t)return{type:"close_sql"};else if("get_autocommit"===t)return{type:"get_autocommit",isAutocommit:l.boolean(e.is_autocommit)};else throw new a.ProtoError("Unexpected type of StreamResponse")}(l.object(e.response))};if("error"===t)return{type:"error",error:(0,u.Error)(l.object(e.error))};throw new a.ProtoError("Unexpected type of StreamResult")}t.PipelineRespBody=function(e){return{baton:l.stringOpt(e.baton),baseUrl:l.stringOpt(e.base_url),results:l.arrayObjectsMap(e.results,c)}},t.CursorRespBody=function(e){return{baton:l.stringOpt(e.baton),baseUrl:l.stringOpt(e.base_url)}}},62948:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CursorReqBody=t.PipelineReqBody=void 0;let s=r(74982),o=r(54766);function i(e,t){if(e.stringRaw("type",t.type),"close"===t.type);else if("execute"===t.type)e.object("stmt",t.stmt,s.Stmt);else if("batch"===t.type)e.object("batch",t.batch,s.Batch);else if("sequence"===t.type)void 0!==t.sql&&e.string("sql",t.sql),void 0!==t.sqlId&&e.number("sql_id",t.sqlId);else if("describe"===t.type)void 0!==t.sql&&e.string("sql",t.sql),void 0!==t.sqlId&&e.number("sql_id",t.sqlId);else if("store_sql"===t.type)e.number("sql_id",t.sqlId),e.string("sql",t.sql);else if("close_sql"===t.type)e.number("sql_id",t.sqlId);else if("get_autocommit"===t.type);else throw(0,o.impossible)(t,"Impossible type of StreamRequest")}t.PipelineReqBody=function(e,t){void 0!==t.baton&&e.string("baton",t.baton),e.arrayObjects("requests",t.requests,i)},t.CursorReqBody=function(e,t){void 0!==t.baton&&e.string("baton",t.baton),e.object("batch",t.batch,s.Batch)}},15681:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var o=Object.getOwnPropertyDescriptor(t,r);(!o||("get"in o?!t.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,o)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(97428),t)},42490:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CursorRespBody=t.PipelineRespBody=void 0;let s=r(77682);t.PipelineRespBody={default:()=>({baton:void 0,baseUrl:void 0,results:[]}),1(e,t){t.baton=e.string()},2(e,t){t.baseUrl=e.string()},3(e,t){t.results.push(e.message(o))}};let o={default:()=>({type:"none"}),1:e=>({type:"ok",response:e.message(i)}),2:e=>({type:"error",error:e.message(s.Error)})},i={default:()=>({type:"none"}),1:e=>({type:"close"}),2:e=>e.message(a),3:e=>e.message(l),4:e=>({type:"sequence"}),5:e=>e.message(u),6:e=>({type:"store_sql"}),7:e=>({type:"close_sql"}),8:e=>e.message(c)},a={default:()=>({type:"execute",result:s.StmtResult.default()}),1(e,t){t.result=e.message(s.StmtResult)}},l={default:()=>({type:"batch",result:s.BatchResult.default()}),1(e,t){t.result=e.message(s.BatchResult)}},u={default:()=>({type:"describe",result:s.DescribeResult.default()}),1(e,t){t.result=e.message(s.DescribeResult)}},c={default:()=>({type:"get_autocommit",isAutocommit:!1}),1(e,t){t.isAutocommit=e.bool()}};t.CursorRespBody={default:()=>({baton:void 0,baseUrl:void 0}),1(e,t){t.baton=e.string()},2(e,t){t.baseUrl=e.string()}}},81667:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CursorReqBody=t.PipelineReqBody=void 0;let s=r(85295),o=r(54766);function i(e,t){if("close"===t.type)e.message(1,t,a);else if("execute"===t.type)e.message(2,t,l);else if("batch"===t.type)e.message(3,t,u);else if("sequence"===t.type)e.message(4,t,c);else if("describe"===t.type)e.message(5,t,d);else if("store_sql"===t.type)e.message(6,t,p);else if("close_sql"===t.type)e.message(7,t,h);else if("get_autocommit"===t.type)e.message(8,t,f);else throw(0,o.impossible)(t,"Impossible type of StreamRequest")}function a(e,t){}function l(e,t){e.message(1,t.stmt,s.Stmt)}function u(e,t){e.message(1,t.batch,s.Batch)}function c(e,t){void 0!==t.sql&&e.string(1,t.sql),void 0!==t.sqlId&&e.int32(2,t.sqlId)}function d(e,t){void 0!==t.sql&&e.string(1,t.sql),void 0!==t.sqlId&&e.int32(2,t.sqlId)}function p(e,t){e.int32(1,t.sqlId),e.string(2,t.sql)}function h(e,t){e.int32(1,t.sqlId)}function f(e,t){}t.PipelineReqBody=function(e,t){for(let r of(void 0!==t.baton&&e.string(1,t.baton),t.requests))e.message(2,r,i)},t.CursorReqBody=function(e,t){void 0!==t.baton&&e.string(1,t.baton),e.message(2,t.batch,s.Batch)}},32444:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HttpStream=void 0;let s=r(14219),o=r(43615),i=r(44760),a=r(62476),l=r(85054),u=r(61097),c=r(45863),d=r(95083),p=r(53044),h=r(54766),f=r(70588),m=r(62948),g=r(81667),y=r(62948),b=r(81667),_=r(4924),v=r(42490);class w extends p.Stream{#N;#q;#x;#S;#M;#j;#L;#$;#D;#U;#E;#B;constructor(e,t,r,s){super(e.intMode),this.#N=e,this.#q=t.toString(),this.#x=r,this.#S=s,this.#M=void 0,this.#j=new l.Queue,this.#L=!1,this.#D=!1,this.#U=!1,this.#E=void 0,this.#B=new a.IdAlloc}client(){return this.#N}_sqlOwner(){return this}storeSql(e){let t=this.#B.alloc();return this.#F({type:"store_sql",sqlId:t,sql:e}).then(()=>void 0,e=>this._setClosed(e)),new d.Sql(this,t)}_closeSql(e){void 0===this.#E&&this.#F({type:"close_sql",sqlId:e}).then(()=>this.#B.free(e),e=>this._setClosed(e))}_execute(e){return this.#F({type:"execute",stmt:e}).then(e=>e.result)}_batch(e){return this.#F({type:"batch",batch:e}).then(e=>e.result)}_describe(e){return this.#F({type:"describe",sql:e.sql,sqlId:e.sqlId}).then(e=>e.result)}_sequence(e){return this.#F({type:"sequence",sql:e.sql,sqlId:e.sqlId}).then(e=>{})}getAutocommit(){return this.#N._ensureVersion(3,"getAutocommit()"),this.#F({type:"get_autocommit"}).then(e=>e.isAutocommit)}#F(e){return new Promise((t,r)=>{this.#V({type:"pipeline",request:e,responseCallback:t,errorCallback:r})})}_openCursor(e){return new Promise((t,r)=>{this.#V({type:"cursor",batch:e,cursorCallback:t,errorCallback:r})})}_cursorClosed(e){if(e!==this.#$)throw new o.InternalError("Cursor was closed, but it was not associated with the stream");this.#$=void 0,(0,u.queueMicrotask)(()=>this.#W())}close(){this._setClosed(new o.ClientError("Stream was manually closed"))}closeGracefully(){this.#D=!0,(0,u.queueMicrotask)(()=>this.#W())}get closed(){return void 0!==this.#E||this.#D}_setClosed(e){if(void 0===this.#E){for(this.#E=e,void 0!==this.#$&&this.#$._setClosed(e),this.#N._streamClosed(this);;){let t=this.#j.shift();if(void 0!==t)t.errorCallback(e);else break}(void 0!==this.#M||this.#L)&&!this.#U&&(this.#j.push({type:"pipeline",request:{type:"close"},responseCallback:()=>void 0,errorCallback:()=>void 0}),this.#U=!0,(0,u.queueMicrotask)(()=>this.#W()))}}#V(e){if(void 0!==this.#E)throw new o.ClosedError("Stream is closed",this.#E);if(this.#D)throw new o.ClosedError("Stream is closing",void 0);this.#j.push(e),(0,u.queueMicrotask)(()=>this.#W())}#W(){if(this.#L||void 0!==this.#$)return;if(this.#D&&0===this.#j.length){this._setClosed(new o.ClientError("Stream was gracefully closed"));return}let e=this.#N._endpoint;if(void 0===e){this.#N._endpointPromise.then(()=>this.#W(),e=>this._setClosed(e));return}let t=this.#j.shift();if(void 0!==t){if("pipeline"===t.type){let r=[t];for(;;){let e=this.#j.first();if(void 0!==e&&"pipeline"===e.type)r.push(e),this.#j.shift();else if(void 0===e&&this.#D&&!this.#U){r.push({type:"pipeline",request:{type:"close"},responseCallback:()=>void 0,errorCallback:()=>void 0}),this.#U=!0;break}else break}this.#z(e,r)}else if("cursor"===t.type)this.#Z(e,t);else throw(0,h.impossible)(t,"Impossible type of QueueEntry")}}#z(e,t){this.#J(()=>this.#H(t,e),t=>S(t,e.encoding),e=>e.baton,e=>e.baseUrl,e=>(function(e,t){if(t.results.length!==e.length)throw new o.ProtoError("Server returned unexpected number of pipeline results");for(let r=0;r<e.length;++r){let s=t.results[r],i=e[r];if("ok"===s.type){if(s.response.type!==i.request.type)throw new o.ProtoError("Received unexpected type of response");i.responseCallback(s.response)}else if("error"===s.type)i.errorCallback((0,c.errorFromProto)(s.error));else if("none"===s.type)throw new o.ProtoError("Received unrecognized type of StreamResult");else throw(0,h.impossible)(s,"Received impossible type of StreamResult")}})(t,e),e=>t.forEach(t=>t.errorCallback(e)))}#Z(e,t){let r=new f.HttpCursor(this,e.encoding);this.#$=r,this.#J(()=>this.#G(t,e),e=>r.open(e),e=>e.baton,e=>e.baseUrl,e=>t.cursorCallback(r),e=>t.errorCallback(e))}#J(e,t,r,s,o,i){let a;try{let t=e();a=(0,this.#S)(t)}catch(e){a=Promise.reject(e)}this.#L=!0,a.then(e=>e.ok?t(e):E(e).then(e=>{throw e})).then(e=>{this.#M=r(e),this.#q=s(e)??this.#q,o(e)}).catch(e=>{this._setClosed(e),i(e)}).finally(()=>{this.#L=!1,this.#W()})}#H(e,t){return this.#Y(new URL(t.pipelinePath,this.#q),{baton:this.#M,requests:e.map(e=>e.request)},t.encoding,m.PipelineReqBody,g.PipelineReqBody)}#G(e,t){if(void 0===t.cursorPath)throw new o.ProtocolVersionError(`Cursors are supported only on protocol version 3 and higher, but the HTTP server only supports version ${t.version}.`);return this.#Y(new URL(t.cursorPath,this.#q),{baton:this.#M,batch:e.batch},t.encoding,y.CursorReqBody,b.CursorReqBody)}#Y(e,t,r,o,a){let l,u;if("json"===r)l=(0,i.writeJsonObject)(t,o),u="application/json";else if("protobuf"===r)l=(0,i.writeProtobufMessage)(t,a),u="application/x-protobuf";else throw(0,h.impossible)(r,"Impossible encoding");let c=new s.Headers;return c.set("content-type",u),void 0!==this.#x&&c.set("authorization",`Bearer ${this.#x}`),new s.Request(e.toString(),{method:"POST",headers:c,body:l})}}async function S(e,t){if("json"===t){let t=await e.json();return(0,i.readJsonObject)(t,_.PipelineRespBody)}if("protobuf"===t){let t=await e.arrayBuffer();return(0,i.readProtobufMessage)(new Uint8Array(t),v.PipelineRespBody)}throw await e.body?.cancel(),(0,h.impossible)(t,"Impossible encoding")}async function E(e){let t=e.headers.get("content-type")??"text/plain",r=`Server returned HTTP status ${e.status}`;if("application/json"===t){let t=await e.json();return"message"in t?(0,c.errorFromProto)(t):new o.HttpServerError(r,e.status)}if("text/plain"===t){let t=(await e.text()).trim();return""!==t&&(r+=`: ${t}`),new o.HttpServerError(r,e.status)}return await e.body?.cancel(),new o.HttpServerError(r,e.status)}t.HttpStream=w},62476:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IdAlloc=void 0;let s=r(43615);class o{#K;#Q;constructor(){this.#K=new Set,this.#Q=new Set}alloc(){for(let e of this.#Q)return this.#Q.delete(e),this.#K.add(e),this.#K.has(this.#K.size-1)||this.#Q.add(this.#K.size-1),e;let e=this.#K.size;return this.#K.add(e),e}free(e){if(!this.#K.delete(e))throw new s.InternalError("Freeing an id that is not allocated");this.#Q.delete(this.#K.size),e<this.#K.size&&this.#Q.add(e)}}t.IdAlloc=o},45060:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var o=Object.getOwnPropertyDescriptor(t,r);(!o||("get"in o?!t.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,o)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.openHttp=t.openWs=t.WsStream=t.WsClient=t.HttpStream=t.HttpClient=t.Stream=t.Stmt=t.Sql=t.parseLibsqlUrl=t.BatchCond=t.BatchStep=t.Batch=t.Client=t.Headers=t.Request=t.fetch=t.WebSocket=void 0;let i=r(8650),a=r(99324),l=r(43615),u=r(44351),c=r(99324);var d=r(8650);Object.defineProperty(t,"WebSocket",{enumerable:!0,get:function(){return d.WebSocket}});var p=r(14219);Object.defineProperty(t,"fetch",{enumerable:!0,get:function(){return p.fetch}}),Object.defineProperty(t,"Request",{enumerable:!0,get:function(){return p.Request}}),Object.defineProperty(t,"Headers",{enumerable:!0,get:function(){return p.Headers}});var h=r(15022);Object.defineProperty(t,"Client",{enumerable:!0,get:function(){return h.Client}}),o(r(43615),t);var f=r(92101);Object.defineProperty(t,"Batch",{enumerable:!0,get:function(){return f.Batch}}),Object.defineProperty(t,"BatchStep",{enumerable:!0,get:function(){return f.BatchStep}}),Object.defineProperty(t,"BatchCond",{enumerable:!0,get:function(){return f.BatchCond}});var m=r(21921);Object.defineProperty(t,"parseLibsqlUrl",{enumerable:!0,get:function(){return m.parseLibsqlUrl}});var g=r(95083);Object.defineProperty(t,"Sql",{enumerable:!0,get:function(){return g.Sql}});var y=r(87155);Object.defineProperty(t,"Stmt",{enumerable:!0,get:function(){return y.Stmt}});var b=r(53044);Object.defineProperty(t,"Stream",{enumerable:!0,get:function(){return b.Stream}});var _=r(44351);Object.defineProperty(t,"HttpClient",{enumerable:!0,get:function(){return _.HttpClient}});var v=r(32444);Object.defineProperty(t,"HttpStream",{enumerable:!0,get:function(){return v.HttpStream}});var w=r(99324);Object.defineProperty(t,"WsClient",{enumerable:!0,get:function(){return w.WsClient}});var S=r(62167);Object.defineProperty(t,"WsStream",{enumerable:!0,get:function(){return S.WsStream}}),t.openWs=function(e,t,r=2){if(void 0===i.WebSocket)throw new l.WebSocketUnsupportedError("WebSockets are not supported in this environment");var s=void 0;s=3==r?Array.from(a.subprotocolsV3.keys()):Array.from(a.subprotocolsV2.keys());let o=new i.WebSocket(e,s);return new c.WsClient(o,t)},t.openHttp=function(e,t,r,s=2){return new u.HttpClient(e instanceof URL?e:new URL(e),t,r,s)}},21921:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseLibsqlUrl=void 0;let s=r(43615);t.parseLibsqlUrl=function(e){let t,r,o,i;let a=new URL(e);for(let[e,t]of a.searchParams.entries())if("authToken"===e)o=t;else if("tls"===e){if("0"===t)i=!1;else if("1"===t)i=!0;else throw new s.LibsqlUrlParseError(`Unknown value for the "tls" query argument: ${JSON.stringify(t)}`)}else throw new s.LibsqlUrlParseError(`Unknown URL query argument ${JSON.stringify(e)}`);if(("http:"===a.protocol||"ws:"===a.protocol)&&!0===i)throw new s.LibsqlUrlParseError(`A ${JSON.stringify(a.protocol)} URL cannot opt into TLS using ?tls=1`);if(("https:"===a.protocol||"wss:"===a.protocol)&&!1===i)throw new s.LibsqlUrlParseError(`A ${JSON.stringify(a.protocol)} URL cannot opt out of TLS using ?tls=0`);if("http:"===a.protocol||"https:"===a.protocol)r=a.protocol;else if("ws:"===a.protocol||"wss:"===a.protocol)t=a.protocol;else if("libsql:"===a.protocol){if(!1===i){if(!a.port)throw new s.LibsqlUrlParseError('A "libsql:" URL with ?tls=0 must specify an explicit port');r="http:",t="ws:"}else r="https:",t="wss:"}else throw new s.LibsqlUrlParseError(`This client does not support ${JSON.stringify(a.protocol)} URLs. Please use a "libsql:", "ws:", "wss:", "http:" or "https:" URL instead.`);if(a.username||a.password)throw new s.LibsqlUrlParseError('This client does not support HTTP Basic authentication with a username and password. You can authenticate using a token passed in the "authToken" URL query parameter.');if(a.hash)throw new s.LibsqlUrlParseError("URL fragments are not supported");let l=a.pathname;return"/"===l&&(l=""),{hranaWsUrl:void 0!==t?`${t}//${a.host}${l}`:void 0,hranaHttpUrl:void 0!==r?`${r}//${a.host}${l}`:void 0,authToken:o}}},85054:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Queue=void 0;class r{#X;#ee;constructor(){this.#X=[],this.#ee=[]}get length(){return this.#X.length+this.#ee.length}push(e){this.#X.push(e)}shift(){return 0===this.#ee.length&&this.#X.length>0&&(this.#ee=this.#X.reverse(),this.#X=[]),this.#ee.pop()}first(){return 0!==this.#ee.length?this.#ee[this.#ee.length-1]:this.#X[0]}}t.Queue=r},61097:(e,t)=>{"use strict";if(Object.defineProperty(t,"__esModule",{value:!0}),t.queueMicrotask=void 0,"undefined"!=typeof queueMicrotask)t.queueMicrotask=queueMicrotask;else{let e=Promise.resolve();t.queueMicrotask=t=>{e.then(t)}}},45863:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errorFromProto=t.valueResultFromProto=t.rowResultFromProto=t.rowsResultFromProto=t.stmtResultFromProto=void 0;let s=r(43615),o=r(8066);function i(e){return{affectedRowCount:e.affectedRowCount,lastInsertRowid:e.lastInsertRowid,columnNames:e.cols.map(e=>e.name),columnDecltypes:e.cols.map(e=>e.decltype)}}function a(e,t,r){let s={};Object.defineProperty(s,"length",{value:t.length});for(let i=0;i<t.length;++i){let a=(0,o.valueFromProto)(t[i],r);Object.defineProperty(s,i,{value:a});let l=e[i];void 0===l||Object.hasOwn(s,l)||Object.defineProperty(s,l,{value:a,enumerable:!0,configurable:!0,writable:!0})}return s}t.stmtResultFromProto=i,t.rowsResultFromProto=function(e,t){let r=i(e),s=e.rows.map(e=>a(r.columnNames,e,t));return{...r,rows:s}},t.rowResultFromProto=function(e,t){let r;let s=i(e);return e.rows.length>0&&(r=a(s.columnNames,e.rows[0],t)),{...s,row:r}},t.valueResultFromProto=function(e,t){let r;let s=i(e);return e.rows.length>0&&s.columnNames.length>0&&(r=(0,o.valueFromProto)(e.rows[0][0],t)),{...s,value:r}},t.errorFromProto=function(e){return new s.ResponseError(e.message,e)}},76950:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var o=Object.getOwnPropertyDescriptor(t,r);(!o||("get"in o?!t.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,o)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&s(t,e,r);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Value=t.DescribeResult=t.CursorEntry=t.BatchResult=t.StmtResult=t.Error=void 0;let a=r(93276),l=r(43615),u=i(r(74963));function c(e){return{message:u.string(e.message),code:u.stringOpt(e.code)}}function d(e){let t=u.arrayObjectsMap(e.cols,p),r=u.array(e.rows).map(e=>u.arrayObjectsMap(e,m)),s=u.number(e.affected_row_count),o=u.stringOpt(e.last_insert_rowid);return{cols:t,rows:r,affectedRowCount:s,lastInsertRowid:void 0!==o?BigInt(o):void 0}}function p(e){return{name:u.stringOpt(e.name),decltype:u.stringOpt(e.decltype)}}function h(e){return{name:u.stringOpt(e.name)}}function f(e){return{name:u.string(e.name),decltype:u.stringOpt(e.decltype)}}function m(e){let t=u.string(e.type);if("null"===t)return null;if("integer"===t)return BigInt(u.string(e.value));if("float"===t)return u.number(e.value);if("text"===t)return u.string(e.value);if("blob"===t)return a.Base64.toUint8Array(u.string(e.base64));throw new l.ProtoError("Unexpected type of Value")}t.Error=c,t.StmtResult=d,t.BatchResult=function(e){let t=new Map;u.array(e.step_results).forEach((e,r)=>{null!==e&&t.set(r,d(u.object(e)))});let r=new Map;return u.array(e.step_errors).forEach((e,t)=>{null!==e&&r.set(t,c(u.object(e)))}),{stepResults:t,stepErrors:r}},t.CursorEntry=function(e){let t=u.string(e.type);if("step_begin"===t)return{type:"step_begin",step:u.number(e.step),cols:u.arrayObjectsMap(e.cols,p)};if("step_end"===t){let t=u.number(e.affected_row_count),r=u.stringOpt(e.last_insert_rowid);return{type:"step_end",affectedRowCount:t,lastInsertRowid:void 0!==r?BigInt(r):void 0}}if("step_error"===t)return{type:"step_error",step:u.number(e.step),error:c(u.object(e.error))};if("row"===t)return{type:"row",row:u.arrayObjectsMap(e.row,m)};if("error"===t)return{type:"error",error:c(u.object(e.error))};throw new l.ProtoError("Unexpected type of CursorEntry")},t.DescribeResult=function(e){let t=u.arrayObjectsMap(e.params,h);return{params:t,cols:u.arrayObjectsMap(e.cols,f),isExplain:u.boolean(e.is_explain),isReadonly:u.boolean(e.is_readonly)}},t.Value=m},74982:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Batch=t.Stmt=void 0;let s=r(93276),o=r(54766);function i(e,t){void 0!==t.sql&&e.string("sql",t.sql),void 0!==t.sqlId&&e.number("sql_id",t.sqlId),e.arrayObjects("args",t.args,c),e.arrayObjects("named_args",t.namedArgs,a),e.boolean("want_rows",t.wantRows)}function a(e,t){e.string("name",t.name),e.object("value",t.value,c)}function l(e,t){void 0!==t.condition&&e.object("condition",t.condition,u),e.object("stmt",t.stmt,i)}function u(e,t){if(e.stringRaw("type",t.type),"ok"===t.type||"error"===t.type)e.number("step",t.step);else if("not"===t.type)e.object("cond",t.cond,u);else if("and"===t.type||"or"===t.type)e.arrayObjects("conds",t.conds,u);else if("is_autocommit"===t.type);else throw(0,o.impossible)(t,"Impossible type of BatchCond")}function c(e,t){if(null===t)e.stringRaw("type","null");else if("bigint"==typeof t)e.stringRaw("type","integer"),e.stringRaw("value",""+t);else if("number"==typeof t)e.stringRaw("type","float"),e.number("value",t);else if("string"==typeof t)e.stringRaw("type","text"),e.string("value",t);else if(t instanceof Uint8Array)e.stringRaw("type","blob"),e.stringRaw("base64",s.Base64.fromUint8Array(t));else if(void 0===t);else throw(0,o.impossible)(t,"Impossible type of Value")}t.Stmt=i,t.Batch=function(e,t){e.arrayObjects("steps",t.steps,l)}},97428:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},77682:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DescribeResult=t.CursorEntry=t.BatchResult=t.StmtResult=t.Error=void 0,t.Error={default:()=>({message:"",code:void 0}),1(e,t){t.message=e.string()},2(e,t){t.code=e.string()}},t.StmtResult={default:()=>({cols:[],rows:[],affectedRowCount:0,lastInsertRowid:void 0}),1(e,t){t.cols.push(e.message(r))},2(e,t){t.rows.push(e.message(s))},3(e,t){t.affectedRowCount=Number(e.uint64())},4(e,t){t.lastInsertRowid=e.sint64()}};let r={default:()=>({name:void 0,decltype:void 0}),1(e,t){t.name=e.string()},2(e,t){t.decltype=e.string()}},s={default:()=>[],1(e,t){t.push(e.message(p))}};t.BatchResult={default:()=>({stepResults:new Map,stepErrors:new Map}),1(e,t){let[r,s]=e.message(o);t.stepResults.set(r,s)},2(e,t){let[r,s]=e.message(i);t.stepErrors.set(r,s)}};let o={default:()=>[0,t.StmtResult.default()],1(e,t){t[0]=e.uint32()},2(e,r){r[1]=e.message(t.StmtResult)}},i={default:()=>[0,t.Error.default()],1(e,t){t[0]=e.uint32()},2(e,r){r[1]=e.message(t.Error)}};t.CursorEntry={default:()=>({type:"none"}),1:e=>e.message(a),2:e=>e.message(l),3:e=>e.message(u),4:e=>({type:"row",row:e.message(s)}),5:e=>({type:"error",error:e.message(t.Error)})};let a={default:()=>({type:"step_begin",step:0,cols:[]}),1(e,t){t.step=e.uint32()},2(e,t){t.cols.push(e.message(r))}},l={default:()=>({type:"step_end",affectedRowCount:0,lastInsertRowid:void 0}),1(e,t){t.affectedRowCount=e.uint32()},2(e,t){t.lastInsertRowid=e.uint64()}},u={default:()=>({type:"step_error",step:0,error:t.Error.default()}),1(e,t){t.step=e.uint32()},2(e,r){r.error=e.message(t.Error)}};t.DescribeResult={default:()=>({params:[],cols:[],isExplain:!1,isReadonly:!1}),1(e,t){t.params.push(e.message(c))},2(e,t){t.cols.push(e.message(d))},3(e,t){t.isExplain=e.bool()},4(e,t){t.isReadonly=e.bool()}};let c={default:()=>({name:void 0}),1(e,t){t.name=e.string()}},d={default:()=>({name:"",decltype:void 0}),1(e,t){t.name=e.string()},2(e,t){t.decltype=e.string()}},p={default(){},1:e=>null,2:e=>e.sint64(),3:e=>e.double(),4:e=>e.string(),5:e=>e.bytes()}},85295:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Batch=t.Stmt=void 0;let s=r(54766);function o(e,t){for(let r of(void 0!==t.sql&&e.string(1,t.sql),void 0!==t.sqlId&&e.int32(2,t.sqlId),t.args))e.message(3,r,c);for(let r of t.namedArgs)e.message(4,r,i);e.bool(5,t.wantRows)}function i(e,t){e.string(1,t.name),e.message(2,t.value,c)}function a(e,t){void 0!==t.condition&&e.message(1,t.condition,l),e.message(2,t.stmt,o)}function l(e,t){if("ok"===t.type)e.uint32(1,t.step);else if("error"===t.type)e.uint32(2,t.step);else if("not"===t.type)e.message(3,t.cond,l);else if("and"===t.type)e.message(4,t.conds,u);else if("or"===t.type)e.message(5,t.conds,u);else if("is_autocommit"===t.type)e.message(6,void 0,d);else throw(0,s.impossible)(t,"Impossible type of BatchCond")}function u(e,t){for(let r of t)e.message(1,r,l)}function c(e,t){if(null===t)e.message(1,void 0,d);else if("bigint"==typeof t)e.sint64(2,t);else if("number"==typeof t)e.double(3,t);else if("string"==typeof t)e.string(4,t);else if(t instanceof Uint8Array)e.bytes(5,t);else if(void 0===t);else throw(0,s.impossible)(t,"Impossible type of Value")}function d(e,t){}t.Stmt=o,t.Batch=function(e,t){for(let r of t.steps)e.message(1,r,a)}},95083:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sqlToProto=t.Sql=void 0;let s=r(43615);class o{#et;#er;#E;constructor(e,t){this.#et=e,this.#er=t,this.#E=void 0}_getSqlId(e){if(this.#et!==e)throw new s.MisuseError("Attempted to use SQL text opened with other object");if(void 0!==this.#E)throw new s.ClosedError("SQL text is closed",this.#E);return this.#er}close(){this._setClosed(new s.ClientError("SQL text was manually closed"))}_setClosed(e){void 0===this.#E&&(this.#E=e,this.#et._closeSql(this.#er))}get closed(){return void 0!==this.#E}}t.Sql=o,t.sqlToProto=function(e,t){return t instanceof o?{sqlId:t._getSqlId(e)}:{sql:""+t}}},87155:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.stmtToProto=t.Stmt=void 0;let s=r(95083),o=r(8066);class i{sql;_args;_namedArgs;constructor(e){this.sql=e,this._args=[],this._namedArgs=new Map}bindIndexes(e){for(let t of(this._args.length=0,e))this._args.push((0,o.valueToProto)(t));return this}bindIndex(e,t){if(e!==(0|e)||e<=0)throw RangeError("Index of a positional argument must be positive integer");for(;this._args.length<e;)this._args.push(null);return this._args[e-1]=(0,o.valueToProto)(t),this}bindName(e,t){return this._namedArgs.set(e,(0,o.valueToProto)(t)),this}unbindAll(){return this._args.length=0,this._namedArgs.clear(),this}}t.Stmt=i,t.stmtToProto=function(e,t,r){let a;let l=[],u=[];if(t instanceof i)for(let[e,r]of(a=t.sql,l=t._args,t._namedArgs.entries()))u.push({name:e,value:r});else Array.isArray(t)?(a=t[0],Array.isArray(t[1])?l=t[1].map(e=>(0,o.valueToProto)(e)):u=Object.entries(t[1]).map(([e,t])=>({name:e,value:(0,o.valueToProto)(t)}))):a=t;let{sql:c,sqlId:d}=(0,s.sqlToProto)(e,a);return{sql:c,sqlId:d,args:l,namedArgs:u,wantRows:r}}},53044:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Stream=void 0;let s=r(92101),o=r(80958),i=r(45863),a=r(95083),l=r(87155);class u{constructor(e){this.intMode=e}query(e){return this.#es(e,!0,i.rowsResultFromProto)}queryRow(e){return this.#es(e,!0,i.rowResultFromProto)}queryValue(e){return this.#es(e,!0,i.valueResultFromProto)}run(e){return this.#es(e,!1,i.stmtResultFromProto)}#es(e,t,r){let s=(0,l.stmtToProto)(this._sqlOwner(),e,t);return this._execute(s).then(e=>r(e,this.intMode))}batch(e=!1){return new s.Batch(this,e)}describe(e){let t=(0,a.sqlToProto)(this._sqlOwner(),e);return this._describe(t).then(o.describeResultFromProto)}sequence(e){let t=(0,a.sqlToProto)(this._sqlOwner(),e);return this._sequence(t)}intMode}t.Stream=u},54766:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.impossible=void 0;let s=r(43615);t.impossible=function(e,t){throw new s.InternalError(t)}},8066:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.valueFromProto=t.valueToProto=void 0;let s=r(43615),o=r(54766);t.valueToProto=function(e){if(null===e)return null;if("string"==typeof e)return e;if("number"==typeof e){if(!Number.isFinite(e))throw RangeError("Only finite numbers (not Infinity or NaN) can be passed as arguments");return e}if("bigint"==typeof e){if(e<i||e>a)throw RangeError("This bigint value is too large to be represented as a 64-bit integer and passed as argument");return e}if("boolean"==typeof e)return e?1n:0n;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(e instanceof Uint8Array)return e;else if(e instanceof Date)return+e.valueOf();else if("object"==typeof e)return""+e.toString();else throw TypeError("Unsupported type of value")};let i=-0x8000000000000000n,a=0x7fffffffffffffffn;t.valueFromProto=function(e,t){if(null===e)return null;if("number"==typeof e||"string"==typeof e)return e;if("bigint"==typeof e){if("number"===t){let t=Number(e);if(!Number.isSafeInteger(t))throw RangeError("Received integer which is too large to be safely represented as a JavaScript number");return t}if("bigint"===t)return e;if("string"===t)return""+e;throw new s.MisuseError("Invalid value for IntMode")}if(e instanceof Uint8Array)return e.slice().buffer;if(void 0===e)throw new s.ProtoError("Received unrecognized type of Value");throw(0,o.impossible)(e,"Impossible type of Value")}},99324:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WsClient=t.subprotocolsV3=t.subprotocolsV2=void 0;let s=r(15022),o=r(44760),i=r(43615),a=r(62476),l=r(45863),u=r(95083),c=r(54766),d=r(62167),p=r(74150),h=r(96081),f=r(23841),m=r(10789);t.subprotocolsV2=new Map([["hrana2",{version:2,encoding:"json"}],["hrana1",{version:1,encoding:"json"}]]),t.subprotocolsV3=new Map([["hrana3-protobuf",{version:3,encoding:"protobuf"}],["hrana3",{version:3,encoding:"json"}],["hrana2",{version:2,encoding:"json"}],["hrana1",{version:1,encoding:"json"}]]);class g extends s.Client{#en;#eo;#ei;#E;#ea;#el;#eu;#ec;#ed;_streamIdAlloc;_cursorIdAlloc;#B;constructor(e,t){super(),this.#en=e,this.#eo=[],this.#ei=!1,this.#E=void 0,this.#ea=!1,this.#el=void 0,this.#eu=!1,this.#ec=new Map,this.#ed=new a.IdAlloc,this._streamIdAlloc=new a.IdAlloc,this._cursorIdAlloc=new a.IdAlloc,this.#B=new a.IdAlloc,this.#en.binaryType="arraybuffer",this.#en.addEventListener("open",()=>this.#ep()),this.#en.addEventListener("close",e=>this.#eh(e)),this.#en.addEventListener("error",e=>this.#ef(e)),this.#en.addEventListener("message",e=>this.#em(e)),this.#eg({type:"hello",jwt:t})}#eg(e){if(void 0!==this.#E)throw new i.InternalError("Trying to send a message on a closed client");this.#ei?this.#ey(e):this.#eo.push({openCallback:()=>this.#ey(e),errorCallback:()=>void 0})}#ep(){let e=this.#en.protocol;if(void 0===e){this.#I(new i.ClientError("The `WebSocket.protocol` property is undefined. This most likely means that the WebSocket implementation provided by the environment is broken. If you are using Miniflare 2, please update to Miniflare 3, which fixes this problem."));return}if(""===e)this.#el={version:1,encoding:"json"};else if(this.#el=t.subprotocolsV3.get(e),void 0===this.#el){this.#I(new i.ProtoError(`Unrecognized WebSocket subprotocol: ${JSON.stringify(e)}`));return}for(let e of this.#eo)e.openCallback();this.#eo.length=0,this.#ei=!0}#ey(e){let t=this.#el.encoding;if("json"===t){let t=(0,o.writeJsonObject)(e,p.ClientMsg);this.#en.send(t)}else if("protobuf"===t){let t=(0,o.writeProtobufMessage)(e,h.ClientMsg);this.#en.send(t)}else throw(0,c.impossible)(t,"Impossible encoding")}getVersion(){return new Promise((e,t)=>{this.#eu=!0,void 0!==this.#E?t(this.#E):this.#ei?e(this.#el.version):this.#eo.push({openCallback:()=>e(this.#el.version),errorCallback:t})})}_ensureVersion(e,t){if(void 0!==this.#el&&this.#eu){if(this.#el.version<e)throw new i.ProtocolVersionError(`${t} is supported on protocol version ${e} and higher, but the WebSocket server only supports version ${this.#el.version}`)}else throw new i.ProtocolVersionError(`${t} is supported only on protocol version ${e} and higher, but the version supported by the WebSocket server is not yet known. Use Client.getVersion() to wait until the version is available.`)}_sendRequest(e,t){if(void 0!==this.#E){t.errorCallback(new i.ClosedError("Client is closed",this.#E));return}let r=this.#ed.alloc();this.#ec.set(r,{...t,type:e.type}),this.#eg({type:"request",requestId:r,request:e})}#ef(e){let t=e.message;this.#I(new i.WebSocketError(t??"WebSocket was closed due to an error"))}#eh(e){let t=`WebSocket was closed with code ${e.code}`;e.reason&&(t+=`: ${e.reason}`),this.#I(new i.WebSocketError(t))}#I(e){if(void 0===this.#E){for(let t of(this.#E=e,this.#eo))t.errorCallback(e);for(let[t,r]of(this.#eo.length=0,this.#ec.entries()))r.errorCallback(e),this.#ed.free(t);this.#ec.clear(),this.#en.close()}}#em(e){if(void 0===this.#E)try{let t;let r=this.#el.encoding;if("json"===r){if("string"!=typeof e.data){this.#en.close(3003,"Only text messages are accepted with JSON encoding"),this.#I(new i.ProtoError("Received non-text message from server with JSON encoding"));return}t=(0,o.readJsonObject)(JSON.parse(e.data),f.ServerMsg)}else if("protobuf"===r){if(!(e.data instanceof ArrayBuffer)){this.#en.close(3003,"Only binary messages are accepted with Protobuf encoding"),this.#I(new i.ProtoError("Received non-binary message from server with Protobuf encoding"));return}t=(0,o.readProtobufMessage)(new Uint8Array(e.data),m.ServerMsg)}else throw(0,c.impossible)(r,"Impossible encoding");this.#eb(t)}catch(e){this.#en.close(3007,"Could not handle message"),this.#I(e)}}#eb(e){if("none"===e.type)throw new i.ProtoError("Received an unrecognized ServerMsg");if("hello_ok"===e.type||"hello_error"===e.type){if(this.#ea)throw new i.ProtoError("Received a duplicated hello response");if(this.#ea=!0,"hello_error"===e.type)throw(0,l.errorFromProto)(e.error);return}if(!this.#ea)throw new i.ProtoError("Received a non-hello message before a hello response");if("response_ok"===e.type){let t=e.requestId,r=this.#ec.get(t);if(this.#ec.delete(t),void 0===r)throw new i.ProtoError("Received unexpected OK response");this.#ed.free(t);try{if(r.type!==e.response.type)throw console.dir({responseState:r,msg:e}),new i.ProtoError("Received unexpected type of response");r.responseCallback(e.response)}catch(e){throw r.errorCallback(e),e}}else if("response_error"===e.type){let t=e.requestId,r=this.#ec.get(t);if(this.#ec.delete(t),void 0===r)throw new i.ProtoError("Received unexpected error response");this.#ed.free(t),r.errorCallback((0,l.errorFromProto)(e.error))}else throw(0,c.impossible)(e,"Impossible ServerMsg type")}openStream(){return d.WsStream.open(this)}storeSql(e){this._ensureVersion(2,"storeSql()");let t=this.#B.alloc(),r=new u.Sql(this,t);return this._sendRequest({type:"store_sql",sqlId:t,sql:e},{responseCallback:()=>void 0,errorCallback:e=>r._setClosed(e)}),r}_closeSql(e){void 0===this.#E&&this._sendRequest({type:"close_sql",sqlId:e},{responseCallback:()=>this.#B.free(e),errorCallback:e=>this.#I(e)})}close(){this.#I(new i.ClientError("Client was manually closed"))}get closed(){return void 0!==this.#E}}t.WsClient=g},99281:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WsCursor=void 0;let s=r(43615),o=r(36328),i=r(85054);class a extends o.Cursor{#N;#O;#e_;#ev;#ew;#E;#C;constructor(e,t,r){super(),this.#N=e,this.#O=t,this.#e_=r,this.#ev=new i.Queue,this.#ew=new i.Queue,this.#E=void 0,this.#C=!1}async next(){for(;;){if(void 0!==this.#E)throw new s.ClosedError("Cursor is closed",this.#E);for(;!this.#C&&this.#ew.length<10;)this.#ew.push(this.#S());let e=this.#ev.shift();if(this.#C||void 0!==e)return e;await this.#ew.shift().then(e=>{if(void 0!==e){for(let t of e.entries)this.#ev.push(t);this.#C||=e.done}})}}#S(){return this.#O._sendCursorRequest(this,{type:"fetch_cursor",cursorId:this.#e_,maxCount:1e3}).then(e=>e,e=>{this._setClosed(e)})}_setClosed(e){void 0===this.#E&&(this.#E=e,this.#O._sendCursorRequest(this,{type:"close_cursor",cursorId:this.#e_}).catch(()=>void 0),this.#O._cursorClosed(this))}close(){this._setClosed(new s.ClientError("Cursor was manually closed"))}get closed(){return void 0!==this.#E}}t.WsCursor=a},23841:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var o=Object.getOwnPropertyDescriptor(t,r);(!o||("get"in o?!t.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,o)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&s(t,e,r);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.ServerMsg=void 0;let a=r(43615),l=i(r(74963)),u=r(76950);t.ServerMsg=function(e){let t=l.string(e.type);if("hello_ok"===t)return{type:"hello_ok"};if("hello_error"===t)return{type:"hello_error",error:(0,u.Error)(l.object(e.error))};if("response_ok"===t)return{type:"response_ok",requestId:l.number(e.request_id),response:function(e){let t=l.string(e.type);if("open_stream"===t)return{type:"open_stream"};if("close_stream"===t)return{type:"close_stream"};if("execute"===t)return{type:"execute",result:(0,u.StmtResult)(l.object(e.result))};if("batch"===t)return{type:"batch",result:(0,u.BatchResult)(l.object(e.result))};if("open_cursor"===t)return{type:"open_cursor"};if("close_cursor"===t)return{type:"close_cursor"};if("fetch_cursor"===t)return{type:"fetch_cursor",entries:l.arrayObjectsMap(e.entries,u.CursorEntry),done:l.boolean(e.done)};else if("sequence"===t)return{type:"sequence"};else if("describe"===t)return{type:"describe",result:(0,u.DescribeResult)(l.object(e.result))};else if("store_sql"===t)return{type:"store_sql"};else if("close_sql"===t)return{type:"close_sql"};else if("get_autocommit"===t)return{type:"get_autocommit",isAutocommit:l.boolean(e.is_autocommit)};else throw new a.ProtoError("Unexpected type of Response")}(l.object(e.response))};if("response_error"===t)return{type:"response_error",requestId:l.number(e.request_id),error:(0,u.Error)(l.object(e.error))};throw new a.ProtoError("Unexpected type of ServerMsg")}},74150:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ClientMsg=void 0;let s=r(74982),o=r(54766);function i(e,t){if(e.stringRaw("type",t.type),"open_stream"===t.type)e.number("stream_id",t.streamId);else if("close_stream"===t.type)e.number("stream_id",t.streamId);else if("execute"===t.type)e.number("stream_id",t.streamId),e.object("stmt",t.stmt,s.Stmt);else if("batch"===t.type)e.number("stream_id",t.streamId),e.object("batch",t.batch,s.Batch);else if("open_cursor"===t.type)e.number("stream_id",t.streamId),e.number("cursor_id",t.cursorId),e.object("batch",t.batch,s.Batch);else if("close_cursor"===t.type)e.number("cursor_id",t.cursorId);else if("fetch_cursor"===t.type)e.number("cursor_id",t.cursorId),e.number("max_count",t.maxCount);else if("sequence"===t.type)e.number("stream_id",t.streamId),void 0!==t.sql&&e.string("sql",t.sql),void 0!==t.sqlId&&e.number("sql_id",t.sqlId);else if("describe"===t.type)e.number("stream_id",t.streamId),void 0!==t.sql&&e.string("sql",t.sql),void 0!==t.sqlId&&e.number("sql_id",t.sqlId);else if("store_sql"===t.type)e.number("sql_id",t.sqlId),e.string("sql",t.sql);else if("close_sql"===t.type)e.number("sql_id",t.sqlId);else if("get_autocommit"===t.type)e.number("stream_id",t.streamId);else throw(0,o.impossible)(t,"Impossible type of Request")}t.ClientMsg=function(e,t){if(e.stringRaw("type",t.type),"hello"===t.type)void 0!==t.jwt&&e.string("jwt",t.jwt);else if("request"===t.type)e.number("request_id",t.requestId),e.object("request",t.request,i);else throw(0,o.impossible)(t,"Impossible type of ClientMsg")}},69342:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var o=Object.getOwnPropertyDescriptor(t,r);(!o||("get"in o?!t.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,o)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(97428),t)},10789:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ServerMsg=void 0;let s=r(77682);t.ServerMsg={default:()=>({type:"none"}),1:e=>({type:"hello_ok"}),2:e=>e.message(o),3:e=>e.message(a),4:e=>e.message(i)};let o={default:()=>({type:"hello_error",error:s.Error.default()}),1(e,t){t.error=e.message(s.Error)}},i={default:()=>({type:"response_error",requestId:0,error:s.Error.default()}),1(e,t){t.requestId=e.int32()},2(e,t){t.error=e.message(s.Error)}},a={default:()=>({type:"response_ok",requestId:0,response:{type:"none"}}),1(e,t){t.requestId=e.int32()},2(e,t){t.response={type:"open_stream"}},3(e,t){t.response={type:"close_stream"}},4(e,t){t.response=e.message(l)},5(e,t){t.response=e.message(u)},6(e,t){t.response={type:"open_cursor"}},7(e,t){t.response={type:"close_cursor"}},8(e,t){t.response=e.message(c)},9(e,t){t.response={type:"sequence"}},10(e,t){t.response=e.message(d)},11(e,t){t.response={type:"store_sql"}},12(e,t){t.response={type:"close_sql"}},13(e,t){t.response=e.message(p)}},l={default:()=>({type:"execute",result:s.StmtResult.default()}),1(e,t){t.result=e.message(s.StmtResult)}},u={default:()=>({type:"batch",result:s.BatchResult.default()}),1(e,t){t.result=e.message(s.BatchResult)}},c={default:()=>({type:"fetch_cursor",entries:[],done:!1}),1(e,t){t.entries.push(e.message(s.CursorEntry))},2(e,t){t.done=e.bool()}},d={default:()=>({type:"describe",result:s.DescribeResult.default()}),1(e,t){t.result=e.message(s.DescribeResult)}},p={default:()=>({type:"get_autocommit",isAutocommit:!1}),1(e,t){t.isAutocommit=e.bool()}}},96081:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ClientMsg=void 0;let s=r(85295),o=r(54766);function i(e,t){void 0!==t.jwt&&e.string(1,t.jwt)}function a(e,t){e.int32(1,t.requestId);let r=t.request;if("open_stream"===r.type)e.message(2,r,l);else if("close_stream"===r.type)e.message(3,r,u);else if("execute"===r.type)e.message(4,r,c);else if("batch"===r.type)e.message(5,r,d);else if("open_cursor"===r.type)e.message(6,r,p);else if("close_cursor"===r.type)e.message(7,r,h);else if("fetch_cursor"===r.type)e.message(8,r,f);else if("sequence"===r.type)e.message(9,r,m);else if("describe"===r.type)e.message(10,r,g);else if("store_sql"===r.type)e.message(11,r,y);else if("close_sql"===r.type)e.message(12,r,b);else if("get_autocommit"===r.type)e.message(13,r,_);else throw(0,o.impossible)(r,"Impossible type of Request")}function l(e,t){e.int32(1,t.streamId)}function u(e,t){e.int32(1,t.streamId)}function c(e,t){e.int32(1,t.streamId),e.message(2,t.stmt,s.Stmt)}function d(e,t){e.int32(1,t.streamId),e.message(2,t.batch,s.Batch)}function p(e,t){e.int32(1,t.streamId),e.int32(2,t.cursorId),e.message(3,t.batch,s.Batch)}function h(e,t){e.int32(1,t.cursorId)}function f(e,t){e.int32(1,t.cursorId),e.uint32(2,t.maxCount)}function m(e,t){e.int32(1,t.streamId),void 0!==t.sql&&e.string(2,t.sql),void 0!==t.sqlId&&e.int32(3,t.sqlId)}function g(e,t){e.int32(1,t.streamId),void 0!==t.sql&&e.string(2,t.sql),void 0!==t.sqlId&&e.int32(3,t.sqlId)}function y(e,t){e.int32(1,t.sqlId),e.string(2,t.sql)}function b(e,t){e.int32(1,t.sqlId)}function _(e,t){e.int32(1,t.streamId)}t.ClientMsg=function(e,t){if("hello"===t.type)e.message(1,t,i);else if("request"===t.type)e.message(2,t,a);else throw(0,o.impossible)(t,"Impossible type of ClientMsg")}},62167:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WsStream=void 0;let s=r(43615),o=r(85054),i=r(53044),a=r(99281);class l extends i.Stream{#N;#ex;#j;#$;#D;#E;static open(e){let t=e._streamIdAlloc.alloc(),r=new l(e,t);return e._sendRequest({type:"open_stream",streamId:t},{responseCallback:()=>void 0,errorCallback:e=>r.#I(e)}),r}constructor(e,t){super(e.intMode),this.#N=e,this.#ex=t,this.#j=new o.Queue,this.#$=void 0,this.#D=!1,this.#E=void 0}client(){return this.#N}_sqlOwner(){return this.#N}_execute(e){return this.#F({type:"execute",streamId:this.#ex,stmt:e}).then(e=>e.result)}_batch(e){return this.#F({type:"batch",streamId:this.#ex,batch:e}).then(e=>e.result)}_describe(e){return this.#N._ensureVersion(2,"describe()"),this.#F({type:"describe",streamId:this.#ex,sql:e.sql,sqlId:e.sqlId}).then(e=>e.result)}_sequence(e){return this.#N._ensureVersion(2,"sequence()"),this.#F({type:"sequence",streamId:this.#ex,sql:e.sql,sqlId:e.sqlId}).then(e=>{})}getAutocommit(){return this.#N._ensureVersion(3,"getAutocommit()"),this.#F({type:"get_autocommit",streamId:this.#ex}).then(e=>e.isAutocommit)}#F(e){return new Promise((t,r)=>{this.#V({type:"request",request:e,responseCallback:t,errorCallback:r})})}_openCursor(e){return this.#N._ensureVersion(3,"cursor"),new Promise((t,r)=>{this.#V({type:"cursor",batch:e,cursorCallback:t,errorCallback:r})})}_sendCursorRequest(e,t){if(e!==this.#$)throw new s.InternalError("Cursor not associated with the stream attempted to execute a request");return new Promise((e,r)=>{void 0!==this.#E?r(new s.ClosedError("Stream is closed",this.#E)):this.#N._sendRequest(t,{responseCallback:e,errorCallback:r})})}_cursorClosed(e){if(e!==this.#$)throw new s.InternalError("Cursor was closed, but it was not associated with the stream");this.#$=void 0,this.#W()}#V(e){void 0!==this.#E?e.errorCallback(new s.ClosedError("Stream is closed",this.#E)):this.#D?e.errorCallback(new s.ClosedError("Stream is closing",void 0)):(this.#j.push(e),this.#W())}#W(){for(;;){let e=this.#j.first();if(void 0===e&&void 0===this.#$&&this.#D){this.#I(new s.ClientError("Stream was gracefully closed"));break}if(e?.type==="request"&&void 0===this.#$){let{request:t,responseCallback:r,errorCallback:s}=e;this.#j.shift(),this.#N._sendRequest(t,{responseCallback:r,errorCallback:s})}else if(e?.type==="cursor"&&void 0===this.#$){let{batch:t,cursorCallback:r}=e;this.#j.shift();let s=this.#N._cursorIdAlloc.alloc(),o=new a.WsCursor(this.#N,this,s),i={type:"open_cursor",streamId:this.#ex,cursorId:s,batch:t},l=()=>void 0,u=e=>o._setClosed(e);this.#N._sendRequest(i,{responseCallback:l,errorCallback:u}),this.#$=o,r(o)}else break}}#I(e){if(void 0!==this.#E)return;for(this.#E=e,void 0!==this.#$&&this.#$._setClosed(e);;){let t=this.#j.shift();if(void 0!==t)t.errorCallback(e);else break}let t={type:"close_stream",streamId:this.#ex};this.#N._sendRequest(t,{responseCallback:()=>this.#N._streamIdAlloc.free(this.#ex),errorCallback:()=>void 0})}close(){this.#I(new s.ClientError("Stream was manually closed"))}closeGracefully(){this.#D=!0,this.#W()}get closed(){return void 0!==this.#E||this.#D}}t.WsStream=l},14219:e=>{"use strict";let t=Request,r=Headers,s=fetch;e.exports={fetch:s,Request:t,Headers:r}},87411:e=>{"use strict";e.exports.fetch=fetch,e.exports.Request=Request,e.exports.Headers=Headers},8650:(e,t,r)=>{"use strict";let{WebSocket:s}=r(2147);e.exports={WebSocket:s}},98613:e=>{"use strict";var t;"undefined"!=typeof WebSocket?t=WebSocket:"undefined"!=typeof global?t=global.WebSocket:"undefined"!=typeof window?t=window.WebSocket:"undefined"!=typeof self&&(t=self.WebSocket),e.exports={WebSocket:t}},92881:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach(function(r){if("default"!==r){var s=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:function(){return e[r]}})}}),t.default=e,Object.freeze(t)}(r(74175));let{env:o={},argv:i=[],platform:a=""}="undefined"==typeof process?{}:process,l="NO_COLOR"in o||i.includes("--no-color"),u="FORCE_COLOR"in o||i.includes("--color"),c="dumb"===o.TERM,d=s&&s.isatty&&s.isatty(1)&&o.TERM&&!c,p=!l&&(u||"win32"===a&&!c||d||"CI"in o&&("GITHUB_ACTIONS"in o||"GITLAB_CI"in o||"CIRCLECI"in o)),h=(e,t,r,s,o=t.substring(0,e)+s,i=t.substring(e+r.length),a=i.indexOf(r))=>o+(a<0?i:h(a,i,r,s)),f=(e,t,r,s,o)=>e<0?r+t+s:r+h(e,t,s,o)+s,m=(e,t,r=e,s=e.length+1)=>o=>o||!(""===o||void 0===o)?f((""+o).indexOf(t,s),o,e,t,r):"",g=(e,t,r)=>m(`\x1b[${e}m`,`\x1b[${t}m`,r),y={reset:g(0,0),bold:g(1,22,"\x1b[22m\x1b[1m"),dim:g(2,22,"\x1b[22m\x1b[2m"),italic:g(3,23),underline:g(4,24),inverse:g(7,27),hidden:g(8,28),strikethrough:g(9,29),black:g(30,39),red:g(31,39),green:g(32,39),yellow:g(33,39),blue:g(34,39),magenta:g(35,39),cyan:g(36,39),white:g(37,39),gray:g(90,39),bgBlack:g(40,49),bgRed:g(41,49),bgGreen:g(42,49),bgYellow:g(43,49),bgBlue:g(44,49),bgMagenta:g(45,49),bgCyan:g(46,49),bgWhite:g(47,49),blackBright:g(90,39),redBright:g(91,39),greenBright:g(92,39),yellowBright:g(93,39),blueBright:g(94,39),magentaBright:g(95,39),cyanBright:g(96,39),whiteBright:g(97,39),bgBlackBright:g(100,49),bgRedBright:g(101,49),bgGreenBright:g(102,49),bgYellowBright:g(103,49),bgBlueBright:g(104,49),bgMagentaBright:g(105,49),bgCyanBright:g(106,49),bgWhiteBright:g(107,49)},b=({useColor:e=p}={})=>e?y:Object.keys(y).reduce((e,t)=>({...e,[t]:String}),{}),{reset:_,bold:v,dim:w,italic:S,underline:E,inverse:k,hidden:I,strikethrough:O,black:T,red:j,green:C,yellow:R,blue:A,magenta:P,cyan:N,white:q,gray:M,bgBlack:L,bgRed:$,bgGreen:D,bgYellow:U,bgBlue:B,bgMagenta:F,bgCyan:V,bgWhite:W,blackBright:z,redBright:Z,greenBright:J,yellowBright:H,blueBright:G,magentaBright:Y,cyanBright:K,whiteBright:Q,bgBlackBright:X,bgRedBright:ee,bgGreenBright:et,bgYellowBright:er,bgBlueBright:es,bgMagentaBright:en,bgCyanBright:eo,bgWhiteBright:ei}=b();t.bgBlack=L,t.bgBlackBright=X,t.bgBlue=B,t.bgBlueBright=es,t.bgCyan=V,t.bgCyanBright=eo,t.bgGreen=D,t.bgGreenBright=et,t.bgMagenta=F,t.bgMagentaBright=en,t.bgRed=$,t.bgRedBright=ee,t.bgWhite=W,t.bgWhiteBright=ei,t.bgYellow=U,t.bgYellowBright=er,t.black=T,t.blackBright=z,t.blue=A,t.blueBright=G,t.bold=v,t.createColors=b,t.cyan=N,t.cyanBright=K,t.dim=w,t.gray=M,t.green=C,t.greenBright=J,t.hidden=I,t.inverse=k,t.isColorSupported=p,t.italic=S,t.magenta=P,t.magentaBright=Y,t.red=j,t.redBright=Z,t.reset=_,t.strikethrough=O,t.underline=E,t.white=q,t.whiteBright=Q,t.yellow=R,t.yellowBright=H},5331:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Function.prototype.toString,s=Object.create,o=Object.prototype.toString,i=function(){function e(){this._keys=[],this._values=[]}return e.prototype.has=function(e){return!!~this._keys.indexOf(e)},e.prototype.get=function(e){return this._values[this._keys.indexOf(e)]},e.prototype.set=function(e,t){this._keys.push(e),this._values.push(t)},e}(),a="undefined"!=typeof WeakMap?function(){return new WeakMap}:function(){return new i};function l(e){if(!e)return s(null);var t=e.constructor;if(t===Object)return e===Object.prototype?{}:s(e);if(t&&~r.call(t).indexOf("[native code]"))try{return new t}catch(e){}return s(e)}var u="g"===/test/g.flags?function(e){return e.flags}:function(e){var t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t};function c(e){var t=o.call(e);return t.substring(8,t.length-1)}var d="undefined"!=typeof Symbol?function(e){return e[Symbol.toStringTag]||c(e)}:c,p=Object.defineProperty,h=Object.getOwnPropertyDescriptor,f=Object.getOwnPropertyNames,m=Object.getOwnPropertySymbols,g=Object.prototype,y=g.hasOwnProperty,b=g.propertyIsEnumerable,_="function"==typeof m,v=_?function(e){return f(e).concat(m(e))}:f;function w(e,t,r){for(var s=v(e),o=0,i=s.length,a=void 0,l=void 0;o<i;++o)if("callee"!==(a=s[o])&&"caller"!==a){if(!(l=h(e,a))){t[a]=r.copier(e[a],r);continue}l.get||l.set||(l.value=r.copier(l.value,r));try{p(t,a,l)}catch(e){t[a]=l.value}}return t}function S(e,t){return e.slice(0)}function E(e,t){var r=new t.Constructor;return t.cache.set(e,r),e.forEach(function(e,s){r.set(s,t.copier(e,t))}),r}function k(e,t){return new t.Constructor(e.valueOf())}function I(e,t){return e}function O(e,t){var r=new t.Constructor;return t.cache.set(e,r),e.forEach(function(e){r.add(t.copier(e,t))}),r}var T=Array.isArray,j=Object.assign,C=Object.getPrototypeOf||function(e){return e.__proto__},R={array:function(e,t){var r=new t.Constructor;t.cache.set(e,r);for(var s=0,o=e.length;s<o;++s)r[s]=t.copier(e[s],t);return r},arrayBuffer:S,blob:function(e,t){return e.slice(0,e.size,e.type)},dataView:function(e,t){return new t.Constructor(S(e.buffer))},date:function(e,t){return new t.Constructor(e.getTime())},error:I,map:E,object:_?function(e,t){var r=l(t.prototype);for(var s in t.cache.set(e,r),e)y.call(e,s)&&(r[s]=t.copier(e[s],t));for(var o=m(e),i=0,a=o.length,u=void 0;i<a;++i)u=o[i],b.call(e,u)&&(r[u]=t.copier(e[u],t));return r}:function(e,t){var r=l(t.prototype);for(var s in t.cache.set(e,r),e)y.call(e,s)&&(r[s]=t.copier(e[s],t));return r},regExp:function(e,t){var r=new t.Constructor(e.source,u(e));return r.lastIndex=e.lastIndex,r},set:O},A=j({},R,{array:function(e,t){var r=new t.Constructor;return t.cache.set(e,r),w(e,r,t)},map:function(e,t){return w(e,E(e,t),t)},object:function(e,t){var r=l(t.prototype);return t.cache.set(e,r),w(e,r,t)},set:function(e,t){return w(e,O(e,t),t)}});function P(e){var t,r={Arguments:(t=j({},R,e)).object,Array:t.array,ArrayBuffer:t.arrayBuffer,Blob:t.blob,Boolean:k,DataView:t.dataView,Date:t.date,Error:t.error,Float32Array:t.arrayBuffer,Float64Array:t.arrayBuffer,Int8Array:t.arrayBuffer,Int16Array:t.arrayBuffer,Int32Array:t.arrayBuffer,Map:t.map,Number:k,Object:t.object,Promise:I,RegExp:t.regExp,Set:t.set,String:k,WeakMap:I,WeakSet:I,Uint8Array:t.arrayBuffer,Uint8ClampedArray:t.arrayBuffer,Uint16Array:t.arrayBuffer,Uint32Array:t.arrayBuffer,Uint64Array:t.arrayBuffer},s=r.Array,o=r.Object;function i(e,t){if(t.prototype=t.Constructor=void 0,!e||"object"!=typeof e)return e;if(t.cache.has(e))return t.cache.get(e);if(t.prototype=C(e),t.Constructor=t.prototype&&t.prototype.constructor,!t.Constructor||t.Constructor===Object)return o(e,t);if(T(e))return s(e,t);var i=r[d(e)];return i?i(e,t):"function"==typeof e.then?e:o(e,t)}return function(e){return i(e,{Constructor:void 0,cache:a(),copier:i,prototype:void 0})}}function N(e){return P(j({},A,e))}var q=N({}),M=P({});t.copyStrict=q,t.createCopier=P,t.createStrictCopier=N,t.default=M},65289:(e,t,r)=>{"use strict";let{isColorSupported:s}=r(92881),o=r(96005),{Transform:i}=r(76162),a=r(91253),l=r(75591),{ERROR_LIKE_KEYS:u,LEVEL_KEY:c,LEVEL_LABEL:d,MESSAGE_KEY:p,TIMESTAMP_KEY:h}=r(97206),{buildSafeSonicBoom:f,parseFactoryOptions:m}=r(35954),g=r(40403),y={colorize:s,colorizeObjects:!0,crlf:!1,customColors:null,customLevels:null,customPrettifiers:{},errorLikeObjectKeys:u,errorProps:"",hideObject:!1,ignore:"hostname",include:void 0,levelFirst:!1,levelKey:c,levelLabel:d,messageFormat:null,messageKey:p,minimumLevel:void 0,outputStream:process.stdout,singleLine:!1,timestampKey:h,translateTime:!0,useOnlyCustomProps:!0};function b(e){let t=m(Object.assign({},y,e));return g.bind({...t,context:t})}function _(e={}){let t,r=b(e);return a(function(s){s.on("message",function t(o){o&&"PINO_CONFIG"===o.code&&(Object.assign(e,{messageKey:o.config.messageKey,errorLikeObjectKeys:Array.from(new Set([...e.errorLikeObjectKeys||u,o.config.errorKey])),customLevels:o.config.levels.values}),r=b(e),s.off("message",t))});let a=new i({objectMode:!0,autoDestroy:!0,transform(e,t,s){s(null,r(e))}});return t="object"==typeof e.destination&&"function"==typeof e.destination.write?e.destination:f({dest:e.destination||1,append:e.append,mkdir:e.mkdir,sync:e.sync}),s.on("unknown",function(e){t.write(e+"\n")}),o(s,a,t),a},{parse:"lines",close(e,r){t.on("close",()=>{r(e)})}})}e.exports=_,e.exports.build=_,e.exports.PinoPretty=_,e.exports.prettyFactory=b,e.exports.colorizerFactory=l,e.exports.isColorSupported=s,e.exports.default=_},75591:(e,t,r)=>{"use strict";let s=e=>e,o={default:s,60:s,50:s,40:s,30:s,20:s,10:s,message:s,greyMessage:s},{createColors:i}=r(92881),a=r(36489),l=i({useColor:!0}),{white:u,bgRed:c,red:d,yellow:p,green:h,blue:f,gray:m,cyan:g}=l,y={default:u,60:c,50:d,40:p,30:h,20:f,10:m,message:g,greyMessage:m};function b(e){return function(t,r,{customLevels:s,customLevelNames:o}={}){let[i,l]=a(e,s,o)(t);return Object.prototype.hasOwnProperty.call(r,l)?r[l](i):r.default(i)}}e.exports=function(e=!1,t,r){return e&&void 0!==t?function(e,t){let r=e.reduce(function(e,[t,r]){return e[t]="function"==typeof l[r]?l[r]:u,e},{default:u,message:g,greyMessage:m}),s=t?r:Object.assign({},y,r),o=b(t),i=function(e,t){return o(e,s,t)};return i.colors=l,i.message=i.message||s.message,i.greyMessage=i.greyMessage||s.greyMessage,i}(t,r):e?function(e){let t=b(e),r=function(e,r){return t(e,y,r)};return r.message=y.message,r.greyMessage=y.greyMessage,r.colors=l,r}(r):function(e){let t=b(e),r=function(e,r){return t(e,o,r)};return r.message=o.message,r.greyMessage=o.greyMessage,r.colors=i({useColor:!1}),r}(r)}},97206:e=>{"use strict";e.exports={DATE_FORMAT:"yyyy-mm-dd HH:MM:ss.l o",DATE_FORMAT_SIMPLE:"HH:MM:ss.l",ERROR_LIKE_KEYS:["err","error"],MESSAGE_KEY:"msg",LEVEL_KEY:"level",LEVEL_LABEL:"levelLabel",TIMESTAMP_KEY:"time",LEVELS:{default:"USERLVL",60:"FATAL",50:"ERROR",40:"WARN",30:"INFO",20:"DEBUG",10:"TRACE"},LEVEL_NAMES:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},LOGGER_KEYS:["pid","hostname","name","level","time","timestamp","caller"]}},40403:(e,t,r)=>{"use strict";e.exports=function(e){let t;if(o(e))t=e;else{let r=g(e);if(r.err||!o(r.value))return e+this.EOL;t=r.value}if(this.minimumLevel){let e;if((e=(this.useOnlyCustomProps?this.customLevels:void 0!==this.customLevelNames[this.minimumLevel])?this.customLevelNames[this.minimumLevel]:m[this.minimumLevel])||(e="string"==typeof this.minimumLevel?m[this.minimumLevel]:m[h[this.minimumLevel].toLowerCase()]),t[void 0===this.levelKey?f:this.levelKey]<e)return}let r=l({log:t,context:this.context});(this.ignoreKeys||this.includeKeys)&&(t=p({log:t,context:this.context}));let s=a({log:t,context:{...this.context,...this.context.customProperties}}),y=u({log:t,context:this.context}),b=d({log:t,context:this.context}),_="";if(this.levelFirst&&s&&(_=`${s}`),b&&""===_?_=`${b}`:b&&(_=`${_} ${b}`),!this.levelFirst&&s&&(_=_.length>0?`${_} ${s}`:s),y&&(_=_.length>0?`${_} ${y}:`:y),!1===_.endsWith(":")&&""!==_&&(_+=":"),void 0!==r&&(_=_.length>0?`${_} ${r}`:r),_.length>0&&!this.singleLine&&(_+=this.EOL),"Error"===t.type&&"string"==typeof t.stack){let e=i({log:t,context:this.context});this.singleLine&&(_+=this.EOL),_+=e}else if(!1===this.hideObject){let e=[this.messageKey,this.levelKey,this.timestampKey].map(e=>e.replaceAll(/\\/g,"")).filter(e=>"string"==typeof t[e]||"number"==typeof t[e]||"boolean"==typeof t[e]),r=c({log:t,skipKeys:e,context:this.context});this.singleLine&&!/^\s$/.test(r)&&(_+=" "),_+=r}return _};let s=r(49794),o=r(92847),i=r(86897),a=r(92558),l=r(18332),u=r(10415),c=r(57122),d=r(98629),p=r(76841),{LEVELS:h,LEVEL_KEY:f,LEVEL_NAMES:m}=r(97206),g=e=>{try{return{value:s.parse(e,{protoAction:"remove"})}}catch(e){return{err:e}}}},37277:(e,t,r)=>{"use strict";e.exports=function(e){let t=new o(e);return t.on("error",function e(r){if("EPIPE"===r.code){t.write=i,t.end=i,t.flushSync=i,t.destroy=i;return}t.removeListener("error",e)}),process.env.NODE_V8_COVERAGE||e.sync||!s||function(e){if(global.WeakRef&&global.WeakMap&&global.FinalizationRegistry){let t=r(55298);t.register(e,a),e.on("close",function(){t.unregister(e)})}}(t),t};let{isMainThread:s}=r(6162),o=r(59190),i=r(87331);function a(e,t){e.destroyed||("beforeExit"===t?(e.flush(),e.on("drain",function(){e.end()})):e.flushSync())}},7139:(e,t,r)=>{"use strict";e.exports=function(e){let t=new Date(e);return s(t)?t:t=new Date(+e)};let s=r(35781)},81549:(e,t,r)=>{"use strict";e.exports=function(e,t){let r=o(t),i=r.pop();null!==(e=s(e,r))&&"object"==typeof e&&Object.prototype.hasOwnProperty.call(e,i)&&delete e[i]};let s=r(23453),o=r(88416)},76841:(e,t,r)=>{"use strict";e.exports=function({log:e,context:t}){let{ignoreKeys:r,includeKeys:s}=t,a=o(e);if(s){let e={};return s.forEach(t=>{e[t]=a[t]}),e}return r.forEach(e=>{i(a,e)}),a};let{createCopier:s}=r(5331),o=s({}),i=r(81549)},86390:(e,t,r)=>{"use strict";e.exports=function(e,t=!1){if(!1===t)return e;let r=a(e);if(!l(r))return e;if(!0===t)return i(r,o);let u=t.toUpperCase();if("SYS:STANDARD"===u)return i(r,s);let c=u.substr(0,4);return"SYS:"===c||"UTC:"===c?"UTC:"===c?i(r,t):i(r,t.slice(4)):i(r,`UTC:${t}`)};let{DATE_FORMAT:s,DATE_FORMAT_SIMPLE:o}=r(97206),i=r(71827),a=r(7139),l=r(35781)},36489:(e,t,r)=>{"use strict";e.exports=function(e,t,r){let i=e?t||s:Object.assign({},s,t),a=e?r||o:Object.assign({},o,r);return function(e){let t="default";return t=Number.isInteger(+e)?Object.prototype.hasOwnProperty.call(i,e)?e:t:Object.prototype.hasOwnProperty.call(a,e.toLowerCase())?a[e.toLowerCase()]:t,[i[t],t]}};let{LEVELS:s,LEVEL_NAMES:o}=r(97206)},23453:(e,t,r)=>{"use strict";e.exports=function(e,t){for(let r of Array.isArray(t)?t:s(t)){if(!Object.prototype.hasOwnProperty.call(e,r))return;e=e[r]}return e};let s=r(88416)},46527:e=>{"use strict";e.exports=function(e){return e?"string"==typeof e?e.split(",").reduce((e,t,r)=>{let[s,o=r]=t.split(":");return e[s.toLowerCase()]=o,e},{}):"[object Object]"===Object.prototype.toString.call(e)?Object.keys(e).reduce((t,r)=>(t[r.toLowerCase()]=e[r],t),{}):{}:{}}},746:e=>{"use strict";e.exports=function(e){return e?"string"==typeof e?e.split(",").reduce((e,t,r)=>{let[s,o=r]=t.split(":");return e[o]=s.toUpperCase(),e},{default:"USERLVL"}):"[object Object]"===Object.prototype.toString.call(e)?Object.keys(e).reduce((t,r)=>(t[e[r]]=r.toUpperCase(),t),{default:"USERLVL"}):{}:{}}},35954:(e,t,r)=>{"use strict";e.exports={buildSafeSonicBoom:r(37277),createDate:r(7139),deleteLogProperty:r(81549),filterLog:r(76841),formatTime:r(86390),getPropertyValue:r(23453),handleCustomLevelsNamesOpts:r(46527),handleCustomLevelsOpts:r(746),interpretConditionals:r(92681),isObject:r(92847),isValidDate:r(35781),joinLinesWithIndentation:r(26808),noop:r(87331),parseFactoryOptions:r(68910),prettifyErrorLog:r(86897),prettifyError:r(30190),prettifyLevel:r(92558),prettifyMessage:r(18332),prettifyMetadata:r(10415),prettifyObject:r(57122),prettifyTime:r(98629),splitPropertyKey:r(88416),getLevelLabelData:r(36489)}},92681:(e,t,r)=>{"use strict";e.exports=function(e,t){return(e=(e=(e=e.replace(/{if (.*?)}(.*?){end}/g,function(e,r,o){let i=s(t,r);return i&&o.includes(r)?o.replace(RegExp("{"+r+"}","g"),i):""})).replace(/{if (.*?)}/g,"")).replace(/{end}/g,"")).replace(/\s+/g," ").trim()};let s=r(23453)},92847:e=>{"use strict";e.exports=function(e){return"[object Object]"===Object.prototype.toString.apply(e)}},35781:e=>{"use strict";e.exports=function(e){return e instanceof Date&&!Number.isNaN(e.getTime())}},26808:e=>{"use strict";e.exports=function({input:e,ident:t="    ",eol:r="\n"}){let s=e.split(/\r?\n/);for(let e=1;e<s.length;e+=1)s[e]=t+s[e];return s.join(r)}},87331:e=>{"use strict";e.exports=function(){}},68910:(e,t,r)=>{"use strict";e.exports=function(e){let t;let r=e.crlf?"\r\n":"\n",{customPrettifiers:u,errorLikeObjectKeys:c,hideObject:d,levelFirst:p,levelKey:h,levelLabel:f,messageFormat:m,messageKey:g,minimumLevel:y,singleLine:b,timestampKey:_,translateTime:v}=e,w=e.errorProps.split(","),S="boolean"==typeof e.useOnlyCustomProps?e.useOnlyCustomProps:"true"===e.useOnlyCustomProps,E=i(e.customLevels),k=a(e.customLevels),I=l(S,E,k);if(e.customColors){if("string"==typeof e.customColors)t=e.customColors.split(",").reduce((t,r)=>{let[o,i]=r.split(":"),a=(S?e.customLevels:void 0!==k[o])?k[o]:s[o];return t.push([void 0!==a?a:o,i]),t},[]);else if("object"==typeof e.customColors)t=Object.keys(e.customColors).reduce((t,r)=>{let[o,i]=[r,e.customColors[r]],a=(S?e.customLevels:void 0!==k[o])?k[o]:s[o];return t.push([void 0!==a?a:o,i]),t},[]);else throw Error("options.customColors must be of type string or object.")}let O={customLevels:E,customLevelNames:k};!0!==S||e.customLevels||(O.customLevels=void 0,O.customLevelNames=void 0);let T=void 0!==e.include?new Set(e.include.split(",")):void 0,j=!T&&e.ignore?new Set(e.ignore.split(",")):void 0,C=o(e.colorize,t,S),R=e.colorizeObjects?C:o(!1,[],!1);return{EOL:r,IDENT:"    ",colorizer:C,customColors:t,customLevelNames:k,customLevels:E,customPrettifiers:u,customProperties:O,errorLikeObjectKeys:c,errorProps:w,getLevelLabelData:I,hideObject:d,ignoreKeys:j,includeKeys:T,levelFirst:p,levelKey:h,levelLabel:f,messageFormat:m,messageKey:g,minimumLevel:y,objectColorizer:R,singleLine:b,timestampKey:_,translateTime:v,useOnlyCustomProps:S}};let{LEVEL_NAMES:s}=r(97206),o=r(75591),i=r(746),a=r(46527),l=r(36489)},86897:(e,t,r)=>{"use strict";e.exports=function({log:e,context:t}){let{EOL:r,IDENT:l,errorProps:u,messageKey:c}=t,d=i({input:e.stack,ident:l,eol:r}),p=`${l}${d}${r}`;if(u.length>0){let i;let d=s.concat(c,"type","stack");i="*"===u[0]?Object.keys(e).filter(e=>!1===d.includes(e)):u.filter(e=>!1===d.includes(e));for(let s=0;s<i.length;s+=1){let u=i[s];if(u in e!=!1){if(o(e[u])){let s=a({log:e[u],excludeLoggerKeys:!1,context:{...t,IDENT:l+l}});p=`${p}${l}${u}: {${r}${s}${l}}${r}`;continue}p=`${p}${l}${u}: ${e[u]}${r}`}}}return p};let{LOGGER_KEYS:s}=r(97206),o=r(92847),i=r(26808),a=r(57122)},30190:(e,t,r)=>{"use strict";e.exports=function({keyName:e,lines:t,eol:r,ident:o}){let i="",a=s({input:t,ident:o,eol:r}),l=`${o}${e}: ${a}${r}`.split(r);for(let e=0;e<l.length;e+=1){0!==e&&(i+=r);let t=l[e];if(/^\s*"stack"/.test(t)){let e=/^(\s*"stack":)\s*(".*"),?$/.exec(t);if(e&&3===e.length){let s=/^\s*/.exec(t)[0].length+4,o=" ".repeat(s),a=e[2];i+=e[1]+r+o+JSON.parse(a).replace(/\n/g,r+o)}else i+=t}else i+=t}return i};let s=r(26808)},92558:(e,t,r)=>{"use strict";e.exports=function({log:e,context:t}){let{colorizer:r,customLevels:o,customLevelNames:i,levelKey:a,getLevelLabelData:l}=t,u=t.customPrettifiers?.level,c=s(e,a);if(void 0===c)return;let d=r(c,{customLevels:o,customLevelNames:i});if(u){let[t]=l(c);return u(c,a,e,{label:t,labelColorized:d,colors:r.colors})}return d};let s=r(23453)},18332:(e,t,r)=>{"use strict";e.exports=function({log:e,context:t}){let{colorizer:r,customLevels:a,levelKey:l,levelLabel:u,messageFormat:c,messageKey:d,useOnlyCustomProps:p}=t;if(c&&"string"==typeof c){let t=String(i(c,e)).replace(/{([^{}]+)}/g,function(t,r){let i;return r===u&&void 0!==(i=o(e,l))?(p?void 0===a:void 0===a[i])?s[i]:a[i]:o(e,r)||""});return r.message(t)}if(c&&"function"==typeof c){let t=c(e,d,u,{colors:r.colors});return r.message(t)}if(d in e!=!1&&("string"==typeof e[d]||"number"==typeof e[d]||"boolean"==typeof e[d]))return r.message(e[d])};let{LEVELS:s}=r(97206),o=r(23453),i=r(92681)},10415:e=>{"use strict";e.exports=function({log:e,context:t}){let{customPrettifiers:r,colorizer:s}=t,o="";if(e.name||e.pid||e.hostname){if(o+="(",e.name&&(o+=r.name?r.name(e.name,"name",e,{colors:s.colors}):e.name),e.pid){let t=r.pid?r.pid(e.pid,"pid",e,{colors:s.colors}):e.pid;e.name&&e.pid?o+="/"+t:o+=t}if(e.hostname){let t=r.hostname?r.hostname(e.hostname,"hostname",e,{colors:s.colors}):e.hostname;o+=`${"("===o?"on":" on"} ${t}`}o+=")"}if(e.caller){let t=r.caller?r.caller(e.caller,"caller",e,{colors:s.colors}):e.caller;o+=`${""===o?"":" "}<${t}>`}if(""!==o)return o}},57122:(e,t,r)=>{"use strict";e.exports=function({log:e,excludeLoggerKeys:t=!0,skipKeys:r=[],context:l}){let{EOL:u,IDENT:c,customPrettifiers:d,errorLikeObjectKeys:p,objectColorizer:h,singleLine:f,colorizer:m}=l,g=[].concat(r);!0===t&&Array.prototype.push.apply(g,s);let y="",{plain:b,errors:_}=Object.entries(e).reduce(({plain:t,errors:r},[s,o])=>{if(!1===g.includes(s)){let i="function"==typeof d[s]?d[s](o,s,e,{colors:m.colors}):o;p.includes(s)?r[s]=i:t[s]=i}return{plain:t,errors:r}},{plain:{},errors:{}});return f?(Object.keys(b).length>0&&(y+=h.greyMessage(o(b))),y+=u,y=y.replace(/\\\\/gi,"\\")):Object.entries(b).forEach(([e,t])=>{let r="function"==typeof d[e]?t:o(t,null,2);if(void 0===r)return;let s=i({input:r=r.replace(/\\\\/gi,"\\"),ident:c,eol:u});y+=`${c}${e}:${s.startsWith(u)?"":" "}${s}${u}`}),Object.entries(_).forEach(([e,t])=>{let r="function"==typeof d[e]?t:o(t,null,2);void 0!==r&&(y+=a({keyName:e,lines:r,eol:u,ident:c}))}),y};let{LOGGER_KEYS:s}=r(97206),o=r(15485),i=r(26808),a=r(30190)},98629:(e,t,r)=>{"use strict";e.exports=function({log:e,context:t}){let{timestampKey:r,translateTime:o}=t,i=t.customPrettifiers?.time,a=null;if(r in e?a=e[r]:"timestamp"in e&&(a=e.timestamp),null===a)return;let l=o?s(a,o):a;return i?i(l):`[${l}]`};let s=r(86390)},88416:e=>{"use strict";e.exports=function(e){let t=[],r=!1,s="";for(let o=0;o<e.length;o++){let i=e.charAt(o);if("\\"===i){r=!0;continue}if(r){r=!1,s+=i;continue}if("."===i){t.push(s),s="";continue}s+=i}return s.length&&t.push(s),t}},86702:(e,t,r)=>{"use strict";let s=r(21078),o=r(89015),i=r(54484),a=r(87824);e.exports={err:s,errWithCause:o,mapHttpRequest:i.mapHttpRequest,mapHttpResponse:a.mapHttpResponse,req:i.reqSerializer,res:a.resSerializer,wrapErrorSerializer:function(e){return e===s?e:function(t){return e(s(t))}},wrapRequestSerializer:function(e){return e===i.reqSerializer?e:function(t){return e(i.reqSerializer(t))}},wrapResponseSerializer:function(e){return e===a.resSerializer?e:function(t){return e(a.resSerializer(t))}}}},99475:e=>{"use strict";let t=e=>e&&"string"==typeof e.message,r=e=>{if(!e)return;let r=e.cause;if("function"!=typeof r)return t(r)?r:void 0;{let r=e.cause();return t(r)?r:void 0}},s=(e,o)=>{if(!t(e))return"";let i=e.stack||"";if(o.has(e))return i+"\ncauses have become circular...";let a=r(e);return a?(o.add(e),i+"\ncaused by: "+s(a,o)):i},o=(e,s,i)=>{if(!t(e))return"";let a=i?"":e.message||"";if(s.has(e))return a+": ...";let l=r(e);if(!l)return a;{s.add(e);let t="function"==typeof e.cause;return a+(t?"":": ")+o(l,s,t)}};e.exports={isErrorLike:t,getErrorCause:r,stackWithCauses:e=>s(e,new Set),messageWithCauses:e=>o(e,new Set)}},79279:e=>{"use strict";let t=Symbol("circular-ref-tag"),r=Symbol("pino-raw-err-ref"),s=Object.create({},{type:{enumerable:!0,writable:!0,value:void 0},message:{enumerable:!0,writable:!0,value:void 0},stack:{enumerable:!0,writable:!0,value:void 0},aggregateErrors:{enumerable:!0,writable:!0,value:void 0},raw:{enumerable:!1,get:function(){return this[r]},set:function(e){this[r]=e}}});Object.defineProperty(s,r,{writable:!0,value:{}}),e.exports={pinoErrProto:s,pinoErrorSymbols:{seen:t,rawSymbol:r}}},89015:(e,t,r)=>{"use strict";e.exports=function e(t){if(!s(t))return t;t[a]=void 0;let r=Object.create(o);for(let o in r.type="[object Function]"===l.call(t.constructor)?t.constructor.name:t.name,r.message=t.message,r.stack=t.stack,Array.isArray(t.errors)&&(r.aggregateErrors=t.errors.map(t=>e(t))),s(t.cause)&&!Object.prototype.hasOwnProperty.call(t.cause,a)&&(r.cause=e(t.cause)),t)if(void 0===r[o]){let i=t[o];s(i)?Object.prototype.hasOwnProperty.call(i,a)||(r[o]=e(i)):r[o]=i}return delete t[a],r.raw=t,r};let{isErrorLike:s}=r(99475),{pinoErrProto:o,pinoErrorSymbols:i}=r(79279),{seen:a}=i,{toString:l}=Object.prototype},21078:(e,t,r)=>{"use strict";e.exports=function e(t){if(!i(t))return t;t[u]=void 0;let r=Object.create(a);for(let a in r.type="[object Function]"===c.call(t.constructor)?t.constructor.name:t.name,r.message=s(t),r.stack=o(t),Array.isArray(t.errors)&&(r.aggregateErrors=t.errors.map(t=>e(t))),t)if(void 0===r[a]){let s=t[a];i(s)?"cause"===a||Object.prototype.hasOwnProperty.call(s,u)||(r[a]=e(s)):r[a]=s}return delete t[u],r.raw=t,r};let{messageWithCauses:s,stackWithCauses:o,isErrorLike:i}=r(99475),{pinoErrProto:a,pinoErrorSymbols:l}=r(79279),{seen:u}=l,{toString:c}=Object.prototype},54484:e=>{"use strict";e.exports={mapHttpRequest:function(e){return{req:s(e)}},reqSerializer:s};let t=Symbol("pino-raw-req-ref"),r=Object.create({},{id:{enumerable:!0,writable:!0,value:""},method:{enumerable:!0,writable:!0,value:""},url:{enumerable:!0,writable:!0,value:""},query:{enumerable:!0,writable:!0,value:""},params:{enumerable:!0,writable:!0,value:""},headers:{enumerable:!0,writable:!0,value:{}},remoteAddress:{enumerable:!0,writable:!0,value:""},remotePort:{enumerable:!0,writable:!0,value:""},raw:{enumerable:!1,get:function(){return this[t]},set:function(e){this[t]=e}}});function s(e){let t=e.info||e.socket,s=Object.create(r);if(s.id="function"==typeof e.id?e.id():e.id||(e.info?e.info.id:void 0),s.method=e.method,e.originalUrl)s.url=e.originalUrl;else{let t=e.path;s.url="string"==typeof t?t:e.url?e.url.path||e.url:void 0}return e.query&&(s.query=e.query),e.params&&(s.params=e.params),s.headers=e.headers,s.remoteAddress=t&&t.remoteAddress,s.remotePort=t&&t.remotePort,s.raw=e.raw||e,s}Object.defineProperty(r,t,{writable:!0,value:{}})},87824:e=>{"use strict";e.exports={mapHttpResponse:function(e){return{res:s(e)}},resSerializer:s};let t=Symbol("pino-raw-res-ref"),r=Object.create({},{statusCode:{enumerable:!0,writable:!0,value:0},headers:{enumerable:!0,writable:!0,value:""},raw:{enumerable:!1,get:function(){return this[t]},set:function(e){this[t]=e}}});function s(e){let t=Object.create(r);return t.statusCode=e.headersSent?e.statusCode:null,t.headers=e.getHeaders?e.getHeaders():e._headers,t.raw=e,t}Object.defineProperty(r,t,{writable:!0,value:{}})},70473:e=>{"use strict";function t(e,t){return t}e.exports=function(){let e=Error.prepareStackTrace;Error.prepareStackTrace=t;let r=Error().stack;if(Error.prepareStackTrace=e,!Array.isArray(r))return;let s=r.slice(2),o=[];for(let e of s)e&&o.push(e.getFileName());return o}},90765:e=>{e.exports={DEFAULT_LEVELS:{trace:10,debug:20,info:30,warn:40,error:50,fatal:60},SORTING_ORDER:{ASC:"ASC",DESC:"DESC"}}},53617:(e,t,r)=>{"use strict";let{lsCacheSym:s,levelValSym:o,useOnlyCustomLevelsSym:i,streamSym:a,formattersSym:l,hooksSym:u,levelCompSym:c}=r(83840),{noop:d,genLog:p}=r(3245),{DEFAULT_LEVELS:h,SORTING_ORDER:f}=r(90765),m={fatal:e=>{let t=p(h.fatal,e);return function(...e){let r=this[a];if(t.call(this,...e),"function"==typeof r.flushSync)try{r.flushSync()}catch(e){}}},error:e=>p(h.error,e),warn:e=>p(h.warn,e),info:e=>p(h.info,e),debug:e=>p(h.debug,e),trace:e=>p(h.trace,e)},g=Object.keys(h).reduce((e,t)=>(e[h[t]]=t,e),{}),y=Object.keys(g).reduce((e,t)=>(e[t]='{"level":'+Number(t),e),{});function b(e,t,r){return e===f.DESC?t<=r:t>=r}e.exports={initialLsCache:y,genLsCache:function(e){let t=e[l].level,{labels:r}=e.levels,o={};for(let e in r){let s=t(r[e],Number(e));o[e]=JSON.stringify(s).slice(0,-1)}return e[s]=o,e},levelMethods:m,getLevel:function(e){let{levels:t,levelVal:r}=this;return t&&t.labels?t.labels[r]:""},setLevel:function(e){let{labels:t,values:r}=this.levels;if("number"==typeof e){if(void 0===t[e])throw Error("unknown level value"+e);e=t[e]}if(void 0===r[e])throw Error("unknown level "+e);let s=this[o],a=this[o]=r[e],l=this[i],h=this[c],f=this[u].logMethod;for(let e in r){if(!1===h(r[e],a)){this[e]=d;continue}this[e]=!function(e,t){if(t)return!1;switch(e){case"fatal":case"error":case"warn":case"info":case"debug":case"trace":return!0;default:return!1}}(e,l)?p(r[e],f):m[e](f)}this.emit("level-change",e,a,t[s],s,this)},isLevelEnabled:function(e){let{values:t}=this.levels,r=t[e];return void 0!==r&&this[c](r,this[o])},mappings:function(e=null,t=!1){let r=e?Object.keys(e).reduce((t,r)=>(t[e[r]]=r,t),{}):null;return{labels:Object.assign(Object.create(Object.prototype,{Infinity:{value:"silent"}}),t?null:g,r),values:Object.assign(Object.create(Object.prototype,{silent:{value:1/0}}),t?null:h,e)}},assertNoLevelCollisions:function(e,t){let{labels:r,values:s}=e;for(let e in t){if(e in s)throw Error("levels cannot be overridden");if(t[e]in r)throw Error("pre-existing level values cannot be used for new levels")}},assertDefaultLevelFound:function(e,t,r){if("number"==typeof e){if(![].concat(Object.keys(t||{}).map(e=>t[e]),r?[]:Object.keys(g).map(e=>+e),1/0).includes(e))throw Error(`default level:${e} must be included in custom levels`);return}if(!(e in Object.assign(Object.create(Object.prototype,{silent:{value:1/0}}),r?null:h,t)))throw Error(`default level:${e} must be included in custom levels`)},genLevelComparison:function(e){return"string"==typeof e?b.bind(null,e):e},assertLevelComparison:function(e){if(!("function"==typeof e||"string"==typeof e&&Object.values(f).includes(e)))throw Error('Levels comparison should be one of "ASC", "DESC" or "function" type')}}},26571:e=>{"use strict";e.exports={version:"9.6.0"}},80004:(e,t,r)=>{"use strict";let s=Symbol.for("pino.metadata"),{DEFAULT_LEVELS:o}=r(90765),i=o.info;function a(e,t){return e.level-t.level}e.exports=function(e,t){let r=0;e=e||[],t=t||{dedupe:!1};let l=Object.create(o);l.silent=1/0,t.levels&&"object"==typeof t.levels&&Object.keys(t.levels).forEach(e=>{l[e]=t.levels[e]});let u={write:c,add:h,emit:d,flushSync:p,end:function(){for(let{stream:e}of this.streams)"function"==typeof e.flushSync&&e.flushSync(),e.end()},minLevel:0,streams:[],clone:function e(t){let r=Array(this.streams.length);for(let e=0;e<r.length;e++)r[e]={level:t,stream:this.streams[e].stream};return{write:c,add:h,minLevel:t,streams:r,clone:e,emit:d,flushSync:p,[s]:!0}},[s]:!0,streamLevels:l};return Array.isArray(e)?e.forEach(h,u):h.call(u,e),e=null,u;function c(e){var r,o,i,a;let l,u;let c=this.lastLevel,{streams:d}=this,p=0;for(let h=(r=d.length,t.dedupe?r-1:0);o=h,i=d.length,t.dedupe?o>=0:o<i;a=h,h=t.dedupe?a-1:a+1)if((l=d[h]).level<=c){if(0!==p&&p!==l.level)break;if((u=l.stream)[s]){let{lastTime:e,lastMsg:t,lastObj:r,lastLogger:s}=this;u.lastLevel=c,u.lastTime=e,u.lastMsg=t,u.lastObj=r,u.lastLogger=s}u.write(e),t.dedupe&&(p=l.level)}else if(!t.dedupe)break}function d(...e){for(let{stream:t}of this.streams)"function"==typeof t.emit&&t.emit(...e)}function p(){for(let{stream:e}of this.streams)"function"==typeof e.flushSync&&e.flushSync()}function h(e){if(!e)return u;let t="function"==typeof e.write||e.stream,s=e.write?e:e.stream;if(!t)throw Error("stream object needs to implement either StreamEntry or DestinationStream interface");let{streams:o,streamLevels:l}=this,c={stream:s,level:"number"==typeof e.levelVal?e.levelVal:"string"==typeof e.level?l[e.level]:"number"==typeof e.level?e.level:i,levelVal:void 0,id:r++};return o.unshift(c),o.sort(a),this.minLevel=o[0].level,u}}},80842:(e,t,r)=>{"use strict";let{EventEmitter:s}=r(15673),{lsCacheSym:o,levelValSym:i,setLevelSym:a,getLevelSym:l,chindingsSym:u,parsedChindingsSym:c,mixinSym:d,asJsonSym:p,writeSym:h,mixinMergeStrategySym:f,timeSym:m,timeSliceIndexSym:g,streamSym:y,serializersSym:b,formattersSym:_,errorKeySym:v,messageKeySym:w,useOnlyCustomLevelsSym:S,needsMetadataGsym:E,redactFmtSym:k,stringifySym:I,formatOptsSym:O,stringifiersSym:T,msgPrefixSym:j,hooksSym:C}=r(83840),{getLevel:R,setLevel:A,isLevelEnabled:P,mappings:N,initialLsCache:q,genLsCache:M,assertNoLevelCollisions:L}=r(53617),{asChindings:$,asJson:D,buildFormatters:U,stringify:B}=r(3245),{version:F}=r(26571),V=r(27378),W={constructor:class{},child:function(e,t){if(!e)throw Error("missing bindings for child Pino");t=t||{};let r=this[b],s=this[_],o=Object.create(this);if(!0===t.hasOwnProperty("serializers")){for(let e in o[b]=Object.create(null),r)o[b][e]=r[e];let e=Object.getOwnPropertySymbols(r);for(var i=0;i<e.length;i++){let t=e[i];o[b][t]=r[t]}for(let e in t.serializers)o[b][e]=t.serializers[e];let s=Object.getOwnPropertySymbols(t.serializers);for(var l=0;l<s.length;l++){let e=s[l];o[b][e]=t.serializers[e]}}else o[b]=r;if(t.hasOwnProperty("formatters")){let{level:e,bindings:r,log:i}=t.formatters;o[_]=U(e||s.level,r||z,i||s.log)}else o[_]=U(s.level,z,s.log);if(!0===t.hasOwnProperty("customLevels")&&(L(this.levels,t.customLevels),o.levels=N(t.customLevels,o[S]),M(o)),"object"==typeof t.redact&&null!==t.redact||Array.isArray(t.redact)){o.redact=t.redact;let e=V(o.redact,B),r={stringify:e[k]};o[I]=B,o[T]=e,o[O]=r}"string"==typeof t.msgPrefix&&(o[j]=(this[j]||"")+t.msgPrefix),o[u]=$(o,e);let c=t.level||this.level;return o[a](c),this.onChild(o),o},bindings:function(){let e=this[u],t=JSON.parse(`{${e.substr(1)}}`);return delete t.pid,delete t.hostname,t},setBindings:function(e){let t=$(this,e);this[u]=t,delete this[c]},flush:function(e){if(null!=e&&"function"!=typeof e)throw Error("callback must be a function");let t=this[y];"function"==typeof t.flush?t.flush(e||J):e&&e()},isLevelEnabled:P,version:F,get level(){return this[l]()},set level(lvl){this[a](lvl)},get levelVal(){return this[i]},set levelVal(n){throw Error("levelVal is read-only")},[o]:q,[h]:function(e,t,r){let s;let o=this[m](),i=this[d],a=this[v],l=this[w],u=this[f]||Z,c=this[C].streamWrite;null==e?s={}:e instanceof Error?(s={[a]:e},void 0===t&&(t=e.message)):(s=e,void 0===t&&void 0===e[l]&&e[a]&&(t=e[a].message)),i&&(s=u(s,i(s,r,this)));let h=this[p](s,t,r,o),b=this[y];!0===b[E]&&(b.lastLevel=r,b.lastObj=s,b.lastMsg=t,b.lastTime=o.slice(this[g]),b.lastLogger=this),b.write(c?c(h):h)},[p]:D,[l]:R,[a]:A};Object.setPrototypeOf(W,s.prototype),e.exports=function(){return Object.create(W)};let z=e=>e;function Z(e,t){return Object.assign(t,e)}function J(){}},27378:(e,t,r)=>{"use strict";let s=r(78598),{redactFmtSym:o,wildcardFirstSym:i}=r(83840),{rx:a,validator:l}=s,u=l({ERR_PATHS_MUST_BE_STRINGS:()=>"pino  redacted paths must be strings",ERR_INVALID_PATH:e=>`pino  redact paths array contains an invalid path (${e})`}),c="[Redacted]";e.exports=function(e,t){let{paths:r,censor:l}=function(e){if(Array.isArray(e))return u(e={paths:e,censor:c}),e;let{paths:t,censor:r=c,remove:s}=e;if(!1===Array.isArray(t))throw Error("pino  redact must contain an array of strings");return!0===s&&(r=void 0),u({paths:t,censor:r}),{paths:t,censor:r}}(e),d=r.reduce((e,t)=>{a.lastIndex=0;let r=a.exec(t),s=a.exec(t),o=void 0!==r[1]?r[1].replace(/^(?:"|'|`)(.*)(?:"|'|`)$/,"$1"):r[0];if("*"===o&&(o=i),null===s)return e[o]=null,e;if(null===e[o])return e;let{index:l}=s,u=`${t.substr(l,t.length-1)}`;return e[o]=e[o]||[],o!==i&&0===e[o].length&&e[o].push(...e[i]||[]),o===i&&Object.keys(e).forEach(function(t){e[t]&&e[t].push(u)}),e[o].push(u),e},{}),p={[o]:s({paths:r,censor:l,serialize:t,strict:!1})},h=(...e)=>"function"==typeof l?t(l(...e)):t(l);return[...Object.keys(d),...Object.getOwnPropertySymbols(d)].reduce((e,r)=>{if(null===d[r])e[r]=e=>h(e,[r]);else{let o="function"==typeof l?(e,t)=>l(e,[r,...t]):l;e[r]=s({paths:d[r],censor:o,serialize:t,strict:!1})}return e},p)}},83840:e=>{"use strict";let t=Symbol("pino.setLevel"),r=Symbol("pino.getLevel"),s=Symbol("pino.levelVal"),o=Symbol("pino.levelComp"),i=Symbol("pino.useLevelLabels"),a=Symbol("pino.useOnlyCustomLevels"),l=Symbol("pino.mixin"),u=Symbol("pino.lsCache"),c=Symbol("pino.chindings"),d=Symbol("pino.asJson"),p=Symbol("pino.write"),h=Symbol("pino.redactFmt"),f=Symbol("pino.time"),m=Symbol("pino.timeSliceIndex"),g=Symbol("pino.stream"),y=Symbol("pino.stringify"),b=Symbol("pino.stringifySafe"),_=Symbol("pino.stringifiers"),v=Symbol("pino.end"),w=Symbol("pino.formatOpts"),S=Symbol("pino.messageKey"),E=Symbol("pino.errorKey"),k=Symbol("pino.nestedKey"),I=Symbol("pino.nestedKeyStr"),O=Symbol("pino.mixinMergeStrategy"),T=Symbol("pino.msgPrefix"),j=Symbol("pino.wildcardFirst"),C=Symbol.for("pino.serializers"),R=Symbol.for("pino.formatters"),A=Symbol.for("pino.hooks"),P=Symbol.for("pino.metadata");e.exports={setLevelSym:t,getLevelSym:r,levelValSym:s,levelCompSym:o,useLevelLabelsSym:i,mixinSym:l,lsCacheSym:u,chindingsSym:c,asJsonSym:d,writeSym:p,serializersSym:C,redactFmtSym:h,timeSym:f,timeSliceIndexSym:m,streamSym:g,stringifySym:y,stringifySafeSym:b,stringifiersSym:_,endSym:v,formatOptsSym:w,messageKeySym:S,errorKeySym:E,nestedKeySym:k,wildcardFirstSym:j,needsMetadataGsym:P,useOnlyCustomLevelsSym:a,formattersSym:R,hooksSym:A,nestedKeyStrSym:I,mixinMergeStrategySym:O,msgPrefixSym:T}},24672:e=>{"use strict";e.exports={nullTime:()=>"",epochTime:()=>`,"time":${Date.now()}`,unixTime:()=>`,"time":${Math.round(Date.now()/1e3)}`,isoTime:()=>`,"time":"${new Date(Date.now()).toISOString()}"`}},3245:(e,t,r)=>{"use strict";let s=r(10944),{mapHttpRequest:o,mapHttpResponse:i}=r(86702),a=r(59190),l=r(55298),{lsCacheSym:u,chindingsSym:c,writeSym:d,serializersSym:p,formatOptsSym:h,endSym:f,stringifiersSym:m,stringifySym:g,stringifySafeSym:y,wildcardFirstSym:b,nestedKeySym:_,formattersSym:v,messageKeySym:w,errorKeySym:S,nestedKeyStrSym:E,msgPrefixSym:k}=r(83840),{isMainThread:I}=r(6162),O=r(70897);function T(){}function j(e){let t="",r=0,s=!1,o=255,i=e.length;if(i>100)return JSON.stringify(e);for(var a=0;a<i&&o>=32;a++)(34===(o=e.charCodeAt(a))||92===o)&&(t+=e.slice(r,a)+"\\",r=a,s=!0);return s?t+=e.slice(r):t=e,o<32?JSON.stringify(e):'"'+t+'"'}let C=process.env.NODE_V8_COVERAGE||process.env.V8_COVERAGE;function R(e){let t=new a(e);return t.on("error",function e(r){if("EPIPE"===r.code){t.write=T,t.end=T,t.flushSync=T,t.destroy=T;return}t.removeListener("error",e),t.emit("error",r)}),C||e.sync||!I||(l.register(t,A),t.on("close",function(){l.unregister(t)})),t}function A(e,t){e.destroyed||("beforeExit"===t?(e.flush(),e.on("drain",function(){e.end()})):e.flushSync())}e.exports={noop:T,buildSafeSonicBoom:R,asChindings:function(e,t){let r;let s=e[c],o=e[g],i=e[y],a=e[m],l=a[b],u=e[p];for(let c in t=(0,e[v].bindings)(t))if(r=t[c],!0===("level"!==c&&"serializers"!==c&&"formatters"!==c&&"customLevels"!==c&&t.hasOwnProperty(c)&&void 0!==r)){if(r=u[c]?u[c](r):r,void 0===(r=(a[c]||l||o)(r,i)))continue;s+=',"'+c+'":'+r}return s},asJson:function(e,t,r,s){let o;let i=this[g],a=this[y],l=this[m],d=this[f],h=this[c],k=this[p],I=this[v],O=this[w],T=this[S],C=this[u][r]+s;C+=h,I.log&&(e=I.log(e));let R=l[b],A="";for(let t in e)if(o=e[t],Object.prototype.hasOwnProperty.call(e,t)&&void 0!==o){k[t]?o=k[t](o):t===T&&k.err&&(o=k.err(o));let e=l[t]||R;switch(typeof o){case"undefined":case"function":continue;case"number":!1===Number.isFinite(o)&&(o=null);case"boolean":e&&(o=e(o));break;case"string":o=(e||j)(o);break;default:o=(e||i)(o,a)}if(void 0===o)continue;A+=","+j(t)+":"+o}let P="";if(void 0!==t){o=k[O]?k[O](t):t;let e=l[O]||R;switch(typeof o){case"function":break;case"number":!1===Number.isFinite(o)&&(o=null);case"boolean":e&&(o=e(o)),P=',"'+O+'":'+o;break;case"string":P=',"'+O+'":'+(o=(e||j)(o));break;default:P=',"'+O+'":'+(o=(e||i)(o,a))}}return this[_]&&A?C+this[E]+A.slice(1)+"}"+P+d:C+A+P+d},genLog:function(e,t){if(!t)return r;return function(...s){t.call(this,s,r,e)};function r(t,...a){if("object"==typeof t){let r,l=t;null!==t&&(t.method&&t.headers&&t.socket?t=o(t):"function"==typeof t.setHeader&&(t=i(t))),null===l&&0===a.length?r=[null]:(l=a.shift(),r=a),"string"==typeof this[k]&&null!=l&&(l=this[k]+l),this[d](t,s(l,r,this[h]),e)}else{let r=void 0===t?a.shift():t;"string"==typeof this[k]&&null!=r&&(r=this[k]+r),this[d](null,s(r,a,this[h]),e)}}},createArgsNormalizer:function(e){return function(t,r,s={},o){if("string"==typeof s)o=R({dest:s}),s={};else if("string"==typeof o){if(s&&s.transport)throw Error("only one of option.transport or stream can be specified");o=R({dest:o})}else if(s instanceof a||s.writable||s._writableState)o=s,s={};else if(s.transport){let e;if(s.transport instanceof a||s.transport.writable||s.transport._writableState)throw Error("option.transport do not allow stream, please pass to option directly. e.g. pino(transport)");if(s.transport.targets&&s.transport.targets.length&&s.formatters&&"function"==typeof s.formatters.level)throw Error("option.transport.targets do not allow custom level formatters");s.customLevels&&(e=s.useOnlyCustomLevels?s.customLevels:Object.assign({},s.levels,s.customLevels)),o=O({caller:r,...s.transport,levels:e})}if((s=Object.assign({},e,s)).serializers=Object.assign({},e.serializers,s.serializers),s.formatters=Object.assign({},e.formatters,s.formatters),s.prettyPrint)throw Error("prettyPrint option is no longer supported, see the pino-pretty package (https://github.com/pinojs/pino-pretty)");let{enabled:i,onChild:l}=s;if(!1===i&&(s.level="silent"),l||(s.onChild=T),!o){var u;(u=process.stdout).write!==u.constructor.prototype.write?o=process.stdout:o=R({fd:process.stdout.fd||1})}return{opts:s,stream:o}}},stringify:function(e,t){try{return JSON.stringify(e)}catch(r){try{return(t||this[y])(e)}catch(e){return'"[unable to serialize, circular reference is too complex to analyze]"'}}},buildFormatters:function(e,t,r){return{level:e,bindings:t,log:r}},normalizeDestFileDescriptor:function(e){let t=Number(e);return"string"==typeof e&&Number.isFinite(t)?t:void 0===e?1:e}}},70897:(e,t,r)=>{"use strict";let{createRequire:s}=r(85807),o=r(70473),{join:i,isAbsolute:a,sep:l}=r(49411),u=r(66263),c=r(55298),d=r(43543);function p(e){e.ref(),e.flushSync(),e.end(),e.once("close",function(){e.unref()})}function h(e){e.flushSync()}e.exports=function(e){let{pipeline:t,targets:r,levels:f,dedupe:m,worker:g={},caller:y=o(),sync:b=!1}=e,_={...e.options},v="string"==typeof y?[y]:y,w="__bundlerPathsOverrides"in globalThis?globalThis.__bundlerPathsOverrides:{},S=e.target;if(S&&r)throw Error("only one of target or targets can be specified");return r?(S=w["pino-worker"]||i(__dirname,"worker.js"),_.targets=r.filter(e=>e.target).map(e=>({...e,target:E(e.target)})),_.pipelines=r.filter(e=>e.pipeline).map(e=>e.pipeline.map(t=>({...t,level:e.level,target:E(t.target)})))):t&&(S=w["pino-worker"]||i(__dirname,"worker.js"),_.pipelines=[t.map(e=>({...e,target:E(e.target)}))]),f&&(_.levels=f),m&&(_.dedupe=m),_.pinoWillSendConfig=!0,function(e,t,r,s){let o=new d({filename:e,workerData:t,workerOpts:r,sync:s});function i(){o.closed||(o.flushSync(),u(100),o.end())}return o.on("ready",function(){process.removeListener("exit",i),o.unref(),!1!==r.autoEnd&&(c.register(o,p),c.registerBeforeExit(o,h),o.on("close",function(){c.unregister(o)}))}),o.on("close",function(){process.removeListener("exit",i)}),process.on("exit",i),o}(E(S),_,g,b);function E(e){let t;if(a(e=w[e]||e)||0===e.indexOf("file://"))return e;if("pino/file"===e)return i(__dirname,"..","file.js");for(let r of v)try{let o="node:repl"===r?process.cwd()+l:r;t=s(o).resolve(e);break}catch(e){continue}if(!t)throw Error(`unable to determine transport target for "${e}"`);return t}}},93018:(e,t,r)=>{"use strict";let s=r(70612),o=r(86702),i=r(70473),a=r(27378),l=r(24672),u=r(80842),c=r(83840),{configure:d}=r(80682),{assertDefaultLevelFound:p,mappings:h,genLsCache:f,genLevelComparison:m,assertLevelComparison:g}=r(53617),{DEFAULT_LEVELS:y,SORTING_ORDER:b}=r(90765),{createArgsNormalizer:_,asChindings:v,buildSafeSonicBoom:w,buildFormatters:S,stringify:E,normalizeDestFileDescriptor:k,noop:I}=r(3245),{version:O}=r(26571),{chindingsSym:T,redactFmtSym:j,serializersSym:C,timeSym:R,timeSliceIndexSym:A,streamSym:P,stringifySym:N,stringifySafeSym:q,stringifiersSym:M,setLevelSym:L,endSym:$,formatOptsSym:D,messageKeySym:U,errorKeySym:B,nestedKeySym:F,mixinSym:V,levelCompSym:W,useOnlyCustomLevelsSym:z,formattersSym:Z,hooksSym:J,nestedKeyStrSym:H,mixinMergeStrategySym:G,msgPrefixSym:Y}=c,{epochTime:K,nullTime:Q}=l,{pid:X}=process,ee=s.hostname(),et=o.err,er=_({level:"info",levelComparison:b.ASC,levels:y,messageKey:"msg",errorKey:"err",nestedKey:null,enabled:!0,base:{pid:X,hostname:ee},serializers:Object.assign(Object.create(null),{err:et}),formatters:Object.assign(Object.create(null),{bindings:e=>e,level:(e,t)=>({level:t})}),hooks:{logMethod:void 0,streamWrite:void 0},timestamp:K,name:void 0,redact:null,customLevels:null,useOnlyCustomLevels:!1,depthLimit:5,edgeLimit:100}),es=Object.assign(Object.create(null),o);function en(...e){let t={},{opts:r,stream:s}=er(t,i(),...e);r.level&&"string"==typeof r.level&&void 0!==y[r.level.toLowerCase()]&&(r.level=r.level.toLowerCase());let{redact:o,crlf:l,serializers:c,timestamp:b,messageKey:_,errorKey:w,nestedKey:k,base:O,name:X,level:ee,customLevels:et,levelComparison:es,mixin:eo,mixinMergeStrategy:ei,useOnlyCustomLevels:ea,formatters:el,hooks:eu,depthLimit:ec,edgeLimit:ed,onChild:ep,msgPrefix:eh}=r,ef=d({maximumDepth:ec,maximumBreadth:ed}),em=S(el.level,el.bindings,el.log),eg=E.bind({[q]:ef}),ey=o?a(o,eg):{},eb=o?{stringify:ey[j]}:{stringify:eg},e_=v.bind(null,{[T]:"",[C]:c,[M]:ey,[N]:E,[q]:ef,[Z]:em}),ev="";null!==O&&(ev=e_(void 0===X?O:Object.assign({},O,{name:X})));let ew=b instanceof Function?b:b?K:Q,ex=ew().indexOf(":")+1;if(ea&&!et)throw Error("customLevels is required if useOnlyCustomLevels is set true");if(eo&&"function"!=typeof eo)throw Error(`Unknown mixin type "${typeof eo}" - expected "function"`);if(eh&&"string"!=typeof eh)throw Error(`Unknown msgPrefix type "${typeof eh}" - expected "string"`);p(ee,et,ea);let eS=h(et,ea);return"function"==typeof s.emit&&s.emit("message",{code:"PINO_CONFIG",config:{levels:eS,messageKey:_,errorKey:w}}),g(es),Object.assign(t,{levels:eS,[W]:m(es),[z]:ea,[P]:s,[R]:ew,[A]:ex,[N]:E,[q]:ef,[M]:ey,[$]:"}"+(l?"\r\n":"\n"),[D]:eb,[U]:_,[B]:w,[F]:k,[H]:k?`,${JSON.stringify(k)}:{`:"",[C]:c,[V]:eo,[G]:ei,[T]:ev,[Z]:em,[J]:eu,silent:I,onChild:ep,[Y]:eh}),Object.setPrototypeOf(t,u()),f(t),t[L](ee),t}e.exports=en,e.exports.destination=(e=process.stdout.fd)=>"object"==typeof e?(e.dest=k(e.dest||process.stdout.fd),w(e)):w({dest:k(e),minLength:0}),e.exports.transport=r(70897),e.exports.multistream=r(80004),e.exports.levels=h(),e.exports.stdSerializers=es,e.exports.stdTimeFunctions=Object.assign({},l),e.exports.symbols=c,e.exports.version=O,e.exports.default=en,e.exports.pino=en},59190:(e,t,r)=>{"use strict";let s=r(92048),o=r(17702),i=r(21764).inherits,a=r(55315),l=r(66263),u=r(27790),c=Buffer.allocUnsafe(0),d="buffer",p="utf8",[h,f]=(process.versions.node||"0.0").split(".").map(Number),m=h>=22&&f>=7;function g(e,t){function r(r,s){if(r){t._reopening=!1,t._writing=!1,t._opening=!1,t.sync?process.nextTick(()=>{t.listenerCount("error")>0&&t.emit("error",r)}):t.emit("error",r);return}let o=t._reopening;t.fd=s,t.file=e,t._reopening=!1,t._opening=!1,t._writing=!1,t.sync?process.nextTick(()=>t.emit("ready")):t.emit("ready"),!t.destroyed&&(!t._writing&&t._len>t.minLength||t._flushPending?t._actualWrite():o&&process.nextTick(()=>t.emit("drain")))}t._opening=!0,t._writing=!0,t._asyncDrainScheduled=!1;let o=t.append?"a":"w",i=t.mode;if(t.sync)try{t.mkdir&&s.mkdirSync(a.dirname(e),{recursive:!0});let l=s.openSync(e,o,i);r(null,l)}catch(e){throw r(e),e}else t.mkdir?s.mkdir(a.dirname(e),{recursive:!0},t=>{if(t)return r(t);s.open(e,o,i,r)}):s.open(e,o,i,r)}function y(e){let t,r;if(!(this instanceof y))return new y(e);let{fd:o,dest:i,minLength:a,maxLength:u,maxWrite:h,periodicFlush:f,sync:m,append:v=!0,mkdir:E,retryEAGAIN:A,fsync:P,contentMode:N,mode:q}=e||{};if(o=o||i,this._len=0,this.fd=-1,this._bufs=[],this._lens=[],this._writing=!1,this._ending=!1,this._reopening=!1,this._asyncDrainScheduled=!1,this._flushPending=!1,this._hwm=Math.max(a||0,16387),this.file=null,this.destroyed=!1,this.minLength=a||0,this.maxLength=u||0,this.maxWrite=h||16384,this._periodicFlush=f||0,this._periodicFlushTimer=void 0,this.sync=m||!1,this.writable=!0,this._fsync=P||!1,this.append=v||!1,this.mode=q,this.retryEAGAIN=A||(()=>!0),this.mkdir=E||!1,N===d)this._writingBuf=c,this.write=S,this.flush=I,this.flushSync=T,this._actualWrite=C,t=()=>s.writeSync(this.fd,this._writingBuf),r=()=>s.write(this.fd,this._writingBuf,this.release);else if(void 0===N||N===p)this._writingBuf="",this.write=w,this.flush=k,this.flushSync=O,this._actualWrite=j,t=()=>s.writeSync(this.fd,this._writingBuf,"utf8"),r=()=>s.write(this.fd,this._writingBuf,"utf8",this.release);else throw Error(`SonicBoom supports "${p}" and "${d}", but passed ${N}`);if("number"==typeof o)this.fd=o,process.nextTick(()=>this.emit("ready"));else if("string"==typeof o)g(o,this);else throw Error("SonicBoom supports only file descriptors and files");if(this.minLength>=this.maxWrite)throw Error(`minLength should be smaller than maxWrite (${this.maxWrite})`);this.release=(e,o)=>{if(e){if(("EAGAIN"===e.code||"EBUSY"===e.code)&&this.retryEAGAIN(e,this._writingBuf.length,this._len-this._writingBuf.length)){if(this.sync)try{l(100),this.release(void 0,0)}catch(e){this.release(e)}else setTimeout(r,100)}else this._writing=!1,this.emit("error",e);return}this.emit("write",o);let i=b(this._writingBuf,this._len,o);if(this._len=i.len,this._writingBuf=i.writingBuf,this._writingBuf.length){if(!this.sync){r();return}try{do{let e=t(),r=b(this._writingBuf,this._len,e);this._len=r.len,this._writingBuf=r.writingBuf}while(this._writingBuf.length)}catch(e){this.release(e);return}}this._fsync&&s.fsyncSync(this.fd);let a=this._len;this._reopening?(this._writing=!1,this._reopening=!1,this.reopen()):a>this.minLength?this._actualWrite():this._ending?a>0?this._actualWrite():(this._writing=!1,R(this)):(this._writing=!1,this.sync?this._asyncDrainScheduled||(this._asyncDrainScheduled=!0,process.nextTick(_,this)):this.emit("drain"))},this.on("newListener",function(e){"drain"===e&&(this._asyncDrainScheduled=!1)}),0!==this._periodicFlush&&(this._periodicFlushTimer=setInterval(()=>this.flush(null),this._periodicFlush),this._periodicFlushTimer.unref())}function b(e,t,r){return"string"==typeof e&&Buffer.byteLength(e)!==r&&(r=Buffer.from(e).subarray(0,r).toString().length),t=Math.max(t-r,0),{writingBuf:e=e.slice(r),len:t}}function _(e){e.listenerCount("drain")>0&&(e._asyncDrainScheduled=!1,e.emit("drain"))}function v(e,t){return 0===e.length?c:1===e.length?e[0]:Buffer.concat(e,t)}function w(e){if(this.destroyed)throw Error("SonicBoom destroyed");let t=this._len+e.length,r=this._bufs;return this.maxLength&&t>this.maxLength?this.emit("drop",e):(0===r.length||r[r.length-1].length+e.length>this.maxWrite?r.push(""+e):r[r.length-1]+=e,this._len=t,!this._writing&&this._len>=this.minLength&&this._actualWrite()),this._len<this._hwm}function S(e){if(this.destroyed)throw Error("SonicBoom destroyed");let t=this._len+e.length,r=this._bufs,s=this._lens;return this.maxLength&&t>this.maxLength?this.emit("drop",e):(0===r.length||s[s.length-1]+e.length>this.maxWrite?(r.push([e]),s.push(e.length)):(r[r.length-1].push(e),s[s.length-1]+=e.length),this._len=t,!this._writing&&this._len>=this.minLength&&this._actualWrite()),this._len<this._hwm}function E(e){this._flushPending=!0;let t=()=>{if(this._fsync)this._flushPending=!1,e();else try{s.fsync(this.fd,t=>{this._flushPending=!1,e(t)})}catch(t){e(t)}this.off("error",r)},r=r=>{this._flushPending=!1,e(r),this.off("drain",t)};this.once("drain",t),this.once("error",r)}function k(e){if(null!=e&&"function"!=typeof e)throw Error("flush cb must be a function");if(this.destroyed){let t=Error("SonicBoom destroyed");if(e){e(t);return}throw t}if(this.minLength<=0){e?.();return}e&&E.call(this,e),this._writing||(0===this._bufs.length&&this._bufs.push(""),this._actualWrite())}function I(e){if(null!=e&&"function"!=typeof e)throw Error("flush cb must be a function");if(this.destroyed){let t=Error("SonicBoom destroyed");if(e){e(t);return}throw t}if(this.minLength<=0){e?.();return}e&&E.call(this,e),this._writing||(0===this._bufs.length&&(this._bufs.push([]),this._lens.push(0)),this._actualWrite())}function O(){if(this.destroyed)throw Error("SonicBoom destroyed");if(this.fd<0)throw Error("sonic boom is not ready yet");!this._writing&&this._writingBuf.length>0&&(this._bufs.unshift(this._writingBuf),this._writingBuf="");let e="";for(;this._bufs.length||e;){e.length<=0&&(e=this._bufs[0]);try{let t=s.writeSync(this.fd,e,"utf8"),r=b(e,this._len,t);e=r.writingBuf,this._len=r.len,e.length<=0&&this._bufs.shift()}catch(t){if(("EAGAIN"===t.code||"EBUSY"===t.code)&&!this.retryEAGAIN(t,e.length,this._len-e.length))throw t;l(100)}}try{s.fsyncSync(this.fd)}catch{}}function T(){if(this.destroyed)throw Error("SonicBoom destroyed");if(this.fd<0)throw Error("sonic boom is not ready yet");!this._writing&&this._writingBuf.length>0&&(this._bufs.unshift([this._writingBuf]),this._writingBuf=c);let e=c;for(;this._bufs.length||e.length;){e.length<=0&&(e=v(this._bufs[0],this._lens[0]));try{let t=s.writeSync(this.fd,e);e=e.subarray(t),this._len=Math.max(this._len-t,0),e.length<=0&&(this._bufs.shift(),this._lens.shift())}catch(t){if(("EAGAIN"===t.code||"EBUSY"===t.code)&&!this.retryEAGAIN(t,e.length,this._len-e.length))throw t;l(100)}}}function j(){let e=this.release;if(this._writing=!0,this._writingBuf=this._writingBuf||this._bufs.shift()||"",this.sync)try{let t=s.writeSync(this.fd,this._writingBuf,"utf8");e(null,t)}catch(t){e(t)}else s.write(this.fd,this._writingBuf,"utf8",e)}function C(){let e=this.release;if(this._writing=!0,this._writingBuf=this._writingBuf.length?this._writingBuf:v(this._bufs.shift(),this._lens.shift()),this.sync)try{let t=s.writeSync(this.fd,this._writingBuf);e(null,t)}catch(t){e(t)}else m&&(this._writingBuf=Buffer.from(this._writingBuf)),s.write(this.fd,this._writingBuf,e)}function R(e){if(-1===e.fd){e.once("ready",R.bind(null,e));return}void 0!==e._periodicFlushTimer&&clearInterval(e._periodicFlushTimer),e.destroyed=!0,e._bufs=[],e._lens=[],u("number"==typeof e.fd,`sonic.fd must be a number, got ${typeof e.fd}`);try{s.fsync(e.fd,function(){1!==e.fd&&2!==e.fd?s.close(e.fd,t):t()})}catch{}function t(t){if(t){e.emit("error",t);return}e._ending&&!e._writing&&e.emit("finish"),e.emit("close")}}i(y,o),y.prototype.reopen=function(e){if(this.destroyed)throw Error("SonicBoom destroyed");if(this._opening){this.once("ready",()=>{this.reopen(e)});return}if(this._ending)return;if(!this.file)throw Error("Unable to reopen a file descriptor, you must pass a file to SonicBoom");if(e&&(this.file=e),this._reopening=!0,this._writing)return;let t=this.fd;this.once("ready",()=>{t!==this.fd&&s.close(t,e=>{if(e)return this.emit("error",e)})}),g(this.file,this)},y.prototype.end=function(){if(this.destroyed)throw Error("SonicBoom destroyed");if(this._opening){this.once("ready",()=>{this.end()});return}!this._ending&&(this._ending=!0,this._writing||(this._len>0&&this.fd>=0?this._actualWrite():R(this)))},y.prototype.destroy=function(){this.destroyed||R(this)},y.SonicBoom=y,y.default=y,e.exports=y},37037:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var o=Object.getOwnPropertyDescriptor(t,r);(!o||("get"in o?!t.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,o)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&s(t,e,r);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.mapHranaError=t.resultSetFromHrana=t.stmtToHrana=t.executeHranaBatch=t.HranaTransaction=void 0;let a=i(r(45060)),l=r(42147),u=r(77806);class c{#eS;#eE;#ek;constructor(e,t){this.#eS=e,this.#eE=t,this.#ek=void 0}execute(e){return this.batch([e]).then(e=>e[0])}async batch(e){let t=this._getStream();if(t.closed)throw new l.LibsqlError("Cannot execute statements because the transaction is closed","TRANSACTION_CLOSED");try{let r;let s=e.map(p);if(void 0===this.#ek){this._getSqlCache().apply(s);let e=t.batch(this.#eE>=3),o=e.step(),i=o.run((0,u.transactionModeToBegin)(this.#eS)),l=o;r=s.map(t=>{let r=e.step().condition(a.BatchCond.ok(l));this.#eE>=3&&r.condition(a.BatchCond.not(a.BatchCond.isAutocommit(e)));let s=r.query(t);return s.catch(()=>void 0),l=r,s}),this.#ek=e.execute().then(()=>i).then(()=>void 0);try{await this.#ek}catch(e){throw this.close(),e}}else{let e;this.#eE<3&&await this.#ek,this._getSqlCache().apply(s);let o=t.batch(this.#eE>=3);r=s.map(t=>{let r=o.step();void 0!==e&&r.condition(a.BatchCond.ok(e)),this.#eE>=3&&r.condition(a.BatchCond.not(a.BatchCond.isAutocommit(o)));let s=r.query(t);return s.catch(()=>void 0),e=r,s}),await o.execute()}let o=[];for(let e of r){let t=await e;if(void 0===t)throw new l.LibsqlError("Statement in a transaction was not executed, probably because the transaction has been rolled back","TRANSACTION_CLOSED");o.push(h(t))}return o}catch(e){throw f(e)}}async executeMultiple(e){let t=this._getStream();if(t.closed)throw new l.LibsqlError("Cannot execute statements because the transaction is closed","TRANSACTION_CLOSED");try{if(void 0===this.#ek){this.#ek=t.run((0,u.transactionModeToBegin)(this.#eS)).then(()=>void 0);try{await this.#ek}catch(e){throw this.close(),e}}else await this.#ek;await t.sequence(e)}catch(e){throw f(e)}}async rollback(){try{let e=this._getStream();if(e.closed||void 0===this.#ek)return;let t=e.run("ROLLBACK").catch(e=>{throw f(e)});e.closeGracefully(),await t}catch(e){throw f(e)}finally{this.close()}}async commit(){try{let e=this._getStream();if(e.closed)throw new l.LibsqlError("Cannot commit the transaction because it is already closed","TRANSACTION_CLOSED");if(void 0===this.#ek)return;await this.#ek;let t=e.run("COMMIT").catch(e=>{throw f(e)});e.closeGracefully(),await t}catch(e){throw f(e)}finally{this.close()}}}async function d(e,t,r,s,o=!1){o&&r.step().run("PRAGMA foreign_keys=off");let i=r.step(),c=i.run((0,u.transactionModeToBegin)(e)),d=i,p=s.map(e=>{let s=r.step().condition(a.BatchCond.ok(d));t>=3&&s.condition(a.BatchCond.not(a.BatchCond.isAutocommit(r)));let o=s.query(e);return d=s,o}),f=r.step().condition(a.BatchCond.ok(d));t>=3&&f.condition(a.BatchCond.not(a.BatchCond.isAutocommit(r)));let m=f.run("COMMIT");r.step().condition(a.BatchCond.not(a.BatchCond.ok(f))).run("ROLLBACK").catch(e=>void 0),o&&r.step().run("PRAGMA foreign_keys=on"),await r.execute();let g=[];for(let e of(await c,p)){let t=await e;if(void 0===t)throw new l.LibsqlError("Statement in a batch was not executed, probably because the transaction has been rolled back","TRANSACTION_CLOSED");g.push(h(t))}return await m,g}function p(e){if("string"==typeof e)return new a.Stmt(e);let t=new a.Stmt(e.sql);if(Array.isArray(e.args))t.bindIndexes(e.args);else for(let[r,s]of Object.entries(e.args))t.bindName(r,s);return t}function h(e){let t=e.columnNames.map(e=>e??""),r=e.columnDecltypes.map(e=>e??""),s=e.rows,o=e.affectedRowCount,i=void 0!==e.lastInsertRowid?e.lastInsertRowid:void 0;return new u.ResultSetImpl(t,r,s,o,i)}function f(e){if(e instanceof a.ClientError){let t=function e(t){if(t instanceof a.ResponseError&&void 0!==t.code)return t.code;if(t instanceof a.ProtoError)return"HRANA_PROTO_ERROR";if(t instanceof a.ClosedError)return t.cause instanceof a.ClientError?e(t.cause):"HRANA_CLOSED_ERROR";if(t instanceof a.WebSocketError)return"HRANA_WEBSOCKET_ERROR";if(t instanceof a.HttpServerError)return"SERVER_ERROR";if(t instanceof a.ProtocolVersionError)return"PROTOCOL_VERSION_ERROR";if(t instanceof a.InternalError)return"INTERNAL_ERROR";else return"UNKNOWN"}(e);return new l.LibsqlError(e.message,t,void 0,e)}return e}t.HranaTransaction=c,t.executeHranaBatch=d,t.stmtToHrana=p,t.resultSetFromHrana=h,t.mapHranaError=f},21223:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var o=Object.getOwnPropertyDescriptor(t,r);(!o||("get"in o?!t.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,o)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&s(t,e,r);return o(t,e),t},a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.HttpTransaction=t.HttpClient=t._createClient=t.createClient=void 0;let u=i(r(45060)),c=r(42147),d=r(43682),p=r(37037),h=r(61958),f=r(73746),m=r(77806),g=l(r(61326));function y(e){if("https"!==e.scheme&&"http"!==e.scheme)throw new c.LibsqlError(`The HTTP client supports only "libsql:", "https:" and "http:" URLs, got ${JSON.stringify(e.scheme+":")}. For more information, please read ${m.supportedUrlLink}`,"URL_SCHEME_NOT_SUPPORTED");if(void 0!==e.encryptionKey)throw new c.LibsqlError("Encryption key is not supported by the remote client.","ENCRYPTION_KEY_NOT_SUPPORTED");if("http"===e.scheme&&e.tls)throw new c.LibsqlError('A "http:" URL cannot opt into TLS by using ?tls=1',"URL_INVALID");if("https"===e.scheme&&!e.tls)throw new c.LibsqlError('A "https:" URL cannot opt out of TLS by using ?tls=0',"URL_INVALID");return new b((0,f.encodeBaseUrl)(e.scheme,e.authority,e.path),e.authToken,e.intMode,e.fetch,e.concurrency)}a(r(42147),t),t.createClient=function(e){return y((0,d.expandConfig)(e,!0))},t._createClient=y;class b{#N;protocol;#eI;#eO;constructor(e,t,r,s,o){this.#N=u.openHttp(e,t,s),this.#N.intMode=r,this.protocol="http",this.#eI=t,this.#eO=(0,g.default)(o)}async limit(e){return this.#eO(e)}async execute(e,t){let r;return r="string"==typeof e?{sql:e,args:t||[]}:e,this.limit(async()=>{try{let e;let t=(0,p.stmtToHrana)(r),s=this.#N.openStream();try{e=s.query(t)}finally{s.closeGracefully()}let o=await e;return(0,p.resultSetFromHrana)(o)}catch(e){throw(0,p.mapHranaError)(e)}})}async batch(e,t="deferred"){return this.limit(async()=>{try{let r;let s=e.map(p.stmtToHrana),o=await this.#N.getVersion(),i=this.#N.openStream();try{new h.SqlCache(i,30).apply(s);let e=i.batch(!1);r=(0,p.executeHranaBatch)(t,o,e,s)}finally{i.closeGracefully()}return await r}catch(e){throw(0,p.mapHranaError)(e)}})}async migrate(e){return this.limit(async()=>{try{let t;let r=e.map(p.stmtToHrana),s=await this.#N.getVersion(),o=this.#N.openStream();try{let e=o.batch(!1);t=(0,p.executeHranaBatch)("deferred",s,e,r,!0)}finally{o.closeGracefully()}return await t}catch(e){throw(0,p.mapHranaError)(e)}})}async transaction(e="write"){return this.limit(async()=>{try{let t=await this.#N.getVersion();return new _(this.#N.openStream(),e,t)}catch(e){throw(0,p.mapHranaError)(e)}})}async executeMultiple(e){return this.limit(async()=>{try{let t;let r=this.#N.openStream();try{t=r.sequence(e)}finally{r.closeGracefully()}await t}catch(e){throw(0,p.mapHranaError)(e)}})}sync(){throw new c.LibsqlError("sync not supported in http mode","SYNC_NOT_SUPPORTED")}close(){this.#N.close()}get closed(){return this.#N.closed}}t.HttpClient=b;class _ extends p.HranaTransaction{#O;#eT;constructor(e,t,r){super(t,r),this.#O=e,this.#eT=new h.SqlCache(e,30)}_getStream(){return this.#O}_getSqlCache(){return this.#eT}close(){this.#O.close()}get closed(){return this.#O.closed}}t.HttpTransaction=_},86850:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var o=Object.getOwnPropertyDescriptor(t,r);(!o||("get"in o?!t.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,o)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.createClient=void 0;let i=r(43682),a=r(96290),l=r(74449),u=r(21223);o(r(42147),t),t.createClient=function(e){var t;return"wss"===(t=(0,i.expandConfig)(e,!0)).scheme||"ws"===t.scheme?(0,l._createClient)(t):"https"===t.scheme||"http"===t.scheme?(0,u._createClient)(t):(0,a._createClient)(t)}},61958:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SqlCache=void 0;class r{#et;#ej;capacity;constructor(e,t){this.#et=e,this.#ej=new s,this.capacity=t}apply(e){if(this.capacity<=0)return;let t=new Set;for(let r of e){if("string"!=typeof r.sql)continue;let e=r.sql;if(e.length>=5e3)continue;let s=this.#ej.get(e);if(void 0===s){for(;this.#ej.size+1>this.capacity;){let[e,r]=this.#ej.peekLru();if(t.has(r))break;r.close(),this.#ej.delete(e)}this.#ej.size+1<=this.capacity&&(s=this.#et.storeSql(e),this.#ej.set(e,s))}void 0!==s&&(r.sql=s,t.add(s))}}}t.SqlCache=r;class s{#eC;constructor(){this.#eC=new Map}get(e){let t=this.#eC.get(e);return void 0!==t&&(this.#eC.delete(e),this.#eC.set(e,t)),t}set(e,t){this.#eC.set(e,t)}peekLru(){for(let e of this.#eC.entries())return e}delete(e){this.#eC.delete(e)}get size(){return this.#eC.size}}},96290:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var o=Object.getOwnPropertyDescriptor(t,r);(!o||("get"in o?!t.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,o)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Sqlite3Transaction=t.Sqlite3Client=t._createClient=t.createClient=void 0;let a=i(r(82630)),l=r(72254),u=r(42147),c=r(43682),d=r(77806);function p(e){if("file"!==e.scheme)throw new u.LibsqlError(`URL scheme ${JSON.stringify(e.scheme+":")} is not supported by the local sqlite3 client. For more information, please read ${d.supportedUrlLink}`,"URL_SCHEME_NOT_SUPPORTED");let t=e.authority;if(void 0!==t){let e=t.host.toLowerCase();if(""!==e&&"localhost"!==e)throw new u.LibsqlError(`Invalid host in file URL: ${JSON.stringify(t.host)}. A "file:" URL with an absolute path should start with one slash ("file:/absolute/path.db") or with three slashes ("file:///absolute/path.db"). For more information, please read ${d.supportedUrlLink}`,"URL_INVALID");if(void 0!==t.port)throw new u.LibsqlError("File URL cannot have a port","URL_INVALID");if(void 0!==t.userinfo)throw new u.LibsqlError("File URL cannot have username and password","URL_INVALID")}let r=(0,c.isInMemoryConfig)(e);if(r&&e.syncUrl)throw new u.LibsqlError(`Embedded replica must use file for local db but URI with in-memory mode were provided instead: ${e.path}`,"URL_INVALID");let s=e.path;r&&(s=`${e.scheme}:${e.path}`);let o={authToken:e.authToken,encryptionKey:e.encryptionKey,syncUrl:e.syncUrl,syncPeriod:e.syncInterval},i=new a.default(s,o);return m(i,"SELECT 1 AS checkThatTheDatabaseCanBeOpened",e.intMode),new h(s,o,i,e.intMode)}o(r(42147),t),t.createClient=function(e){return p((0,c.expandConfig)(e,!0))},t._createClient=p;class h{#eR;#eA;#eP;#eN;closed;protocol;constructor(e,t,r,s){this.#eR=e,this.#eA=t,this.#eP=r,this.#eN=s,this.closed=!1,this.protocol="file"}async execute(e,t){let r;return r="string"==typeof e?{sql:e,args:t||[]}:e,this.#eq(),m(this.#eM(),r,this.#eN)}async batch(e,t="deferred"){this.#eq();let r=this.#eM();try{m(r,(0,d.transactionModeToBegin)(t),this.#eN);let s=e.map(e=>{if(!r.inTransaction)throw new u.LibsqlError("The transaction has been rolled back","TRANSACTION_CLOSED");return m(r,e,this.#eN)});return m(r,"COMMIT",this.#eN),s}finally{r.inTransaction&&m(r,"ROLLBACK",this.#eN)}}async migrate(e){this.#eq();let t=this.#eM();try{m(t,"PRAGMA foreign_keys=off",this.#eN),m(t,(0,d.transactionModeToBegin)("deferred"),this.#eN);let r=e.map(e=>{if(!t.inTransaction)throw new u.LibsqlError("The transaction has been rolled back","TRANSACTION_CLOSED");return m(t,e,this.#eN)});return m(t,"COMMIT",this.#eN),r}finally{t.inTransaction&&m(t,"ROLLBACK",this.#eN),m(t,"PRAGMA foreign_keys=on",this.#eN)}}async transaction(e="write"){let t=this.#eM();return m(t,(0,d.transactionModeToBegin)(e),this.#eN),this.#eP=null,new f(t,this.#eN)}async executeMultiple(e){this.#eq();let t=this.#eM();try{return w(t,e)}finally{t.inTransaction&&m(t,"ROLLBACK",this.#eN)}}async sync(){this.#eq();let e=await this.#eM().sync();return{frames_synced:e.frames_synced,frame_no:e.frame_no}}close(){this.closed=!0,null!==this.#eP&&this.#eP.close()}#eq(){if(this.closed)throw new u.LibsqlError("The client is closed","CLIENT_CLOSED")}#eM(){return null===this.#eP&&(this.#eP=new a.default(this.#eR,this.#eA)),this.#eP}}t.Sqlite3Client=h;class f{#eL;#eN;constructor(e,t){this.#eL=e,this.#eN=t}async execute(e,t){let r;return r="string"==typeof e?{sql:e,args:t||[]}:e,this.#eq(),m(this.#eL,r,this.#eN)}async batch(e){return e.map(e=>(this.#eq(),m(this.#eL,e,this.#eN)))}async executeMultiple(e){return this.#eq(),w(this.#eL,e)}async rollback(){this.#eL.open&&(this.#eq(),m(this.#eL,"ROLLBACK",this.#eN))}async commit(){this.#eq(),m(this.#eL,"COMMIT",this.#eN)}close(){this.#eL.inTransaction&&m(this.#eL,"ROLLBACK",this.#eN)}get closed(){return!this.#eL.inTransaction}#eq(){if(this.closed)throw new u.LibsqlError("The transaction is closed","TRANSACTION_CLOSED")}}function m(e,t,r){let s,o;if("string"==typeof t)s=t,o=[];else if(s=t.sql,Array.isArray(t.args))o=t.args.map(e=>b(e,r));else for(let e in o={},t.args)o["@"===e[0]||"$"===e[0]||":"===e[0]?e.substring(1):e]=b(t.args[e],r);try{let t=e.prepare(s);t.safeIntegers(!0);let i=!0;try{t.raw(!0)}catch{i=!1}if(i){let e=Array.from(t.columns().map(e=>e.name)),s=Array.from(t.columns().map(e=>e.type??"")),i=t.all(o).map(t=>(function(e,t,r){let s={};Object.defineProperty(s,"length",{value:e.length});for(let o=0;o<e.length;++o){let i=function(e,t){if("bigint"==typeof e){if("number"===t){if(e<g||e>y)throw RangeError("Received integer which cannot be safely represented as a JavaScript number");return Number(e)}if("bigint"===t);else if("string"===t)return""+e;else throw Error("Invalid value for IntMode")}else if(e instanceof l.Buffer)return e.buffer;return e}(e[o],r);Object.defineProperty(s,o,{value:i});let a=t[o];Object.hasOwn(s,a)||Object.defineProperty(s,a,{value:i,enumerable:!0,configurable:!0,writable:!0})}return s})(t,e,r));return new d.ResultSetImpl(e,s,i,0,void 0)}{let e=t.run(o),r=e.changes,s=BigInt(e.lastInsertRowid);return new d.ResultSetImpl([],[],[],r,s)}}catch(e){throw S(e)}}t.Sqlite3Transaction=f;let g=-9007199254740991n,y=9007199254740991n;function b(e,t){if("number"==typeof e){if(!Number.isFinite(e))throw RangeError("Only finite numbers (not Infinity or NaN) can be passed as arguments");return e}if("bigint"==typeof e){if(e<_||e>v)throw RangeError("bigint is too large to be represented as a 64-bit integer and passed as argument");return e}if("boolean"==typeof e)switch(t){case"bigint":return e?1n:0n;case"string":return e?"1":"0";default:return e?1:0}else if(e instanceof ArrayBuffer)return l.Buffer.from(e);else if(e instanceof Date)return e.valueOf();else if(void 0!==e)return e;else throw TypeError("undefined cannot be passed as argument to the database")}let _=-0x8000000000000000n,v=0x7fffffffffffffffn;function w(e,t){try{e.exec(t)}catch(e){throw S(e)}}function S(e){return e instanceof a.default.SqliteError?new u.LibsqlError(e.message,e.code,e.rawCode,e):e}},8572:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var o=Object.getOwnPropertyDescriptor(t,r);(!o||("get"in o?!t.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,o)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t._createClient=t.createClient=void 0;let i=r(42147),a=r(43682),l=r(77806),u=r(74449),c=r(21223);function d(e){if("ws"===e.scheme||"wss"===e.scheme)return(0,u._createClient)(e);if("http"===e.scheme||"https"===e.scheme)return(0,c._createClient)(e);throw new i.LibsqlError(`The client that uses Web standard APIs supports only "libsql:", "wss:", "ws:", "https:" and "http:" URLs, got ${JSON.stringify(e.scheme+":")}. For more information, please read ${l.supportedUrlLink}`,"URL_SCHEME_NOT_SUPPORTED")}o(r(42147),t),t.createClient=function(e){return d((0,a.expandConfig)(e,!0))},t._createClient=d},74449:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var o=Object.getOwnPropertyDescriptor(t,r);(!o||("get"in o?!t.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,o)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&s(t,e,r);return o(t,e),t},a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WsTransaction=t.WsClient=t._createClient=t.createClient=void 0;let u=i(r(45060)),c=r(42147),d=r(43682),p=r(37037),h=r(61958),f=r(73746),m=r(77806),g=l(r(61326));function y(e){let t;if("wss"!==e.scheme&&"ws"!==e.scheme)throw new c.LibsqlError(`The WebSocket client supports only "libsql:", "wss:" and "ws:" URLs, got ${JSON.stringify(e.scheme+":")}. For more information, please read ${m.supportedUrlLink}`,"URL_SCHEME_NOT_SUPPORTED");if(void 0!==e.encryptionKey)throw new c.LibsqlError("Encryption key is not supported by the remote client.","ENCRYPTION_KEY_NOT_SUPPORTED");if("ws"===e.scheme&&e.tls)throw new c.LibsqlError('A "ws:" URL cannot opt into TLS by using ?tls=1',"URL_INVALID");if("wss"===e.scheme&&!e.tls)throw new c.LibsqlError('A "wss:" URL cannot opt out of TLS by using ?tls=0',"URL_INVALID");let r=(0,f.encodeBaseUrl)(e.scheme,e.authority,e.path);try{t=u.openWs(r,e.authToken)}catch(t){if(t instanceof u.WebSocketUnsupportedError){let t="wss"===e.scheme?"https":"http",r=(0,f.encodeBaseUrl)(t,e.authority,e.path);throw new c.LibsqlError(`This environment does not support WebSockets, please switch to the HTTP client by using a "${t}:" URL (${JSON.stringify(r)}). For more information, please read ${m.supportedUrlLink}`,"WEBSOCKETS_NOT_SUPPORTED")}throw(0,p.mapHranaError)(t)}return new b(t,r,e.authToken,e.intMode,e.concurrency)}a(r(42147),t),t.createClient=function(e){return y((0,d.expandConfig)(e,!1))},t._createClient=y;class b{#w;#eI;#eN;#e$;#eD;closed;protocol;#eU;#eO;constructor(e,t,r,s,o){this.#w=t,this.#eI=r,this.#eN=s,this.#e$=this.#eB(e),this.#eD=void 0,this.closed=!1,this.protocol="ws",this.#eO=(0,g.default)(o)}async limit(e){return this.#eO(e)}async execute(e,t){let r;return r="string"==typeof e?{sql:e,args:t||[]}:e,this.limit(async()=>{let e=await this.#eF();try{let t=(0,p.stmtToHrana)(r);e.conn.sqlCache.apply([t]);let s=e.stream.query(t);e.stream.closeGracefully();let o=await s;return(0,p.resultSetFromHrana)(o)}catch(e){throw(0,p.mapHranaError)(e)}finally{this._closeStream(e)}})}async batch(e,t="deferred"){return this.limit(async()=>{let r=await this.#eF();try{let s=e.map(p.stmtToHrana),o=await r.conn.client.getVersion();r.conn.sqlCache.apply(s);let i=r.stream.batch(o>=3),a=(0,p.executeHranaBatch)(t,o,i,s);return await a}catch(e){throw(0,p.mapHranaError)(e)}finally{this._closeStream(r)}})}async migrate(e){return this.limit(async()=>{let t=await this.#eF();try{let r=e.map(p.stmtToHrana),s=await t.conn.client.getVersion(),o=t.stream.batch(s>=3),i=(0,p.executeHranaBatch)("deferred",s,o,r,!0);return await i}catch(e){throw(0,p.mapHranaError)(e)}finally{this._closeStream(t)}})}async transaction(e="write"){return this.limit(async()=>{let t=await this.#eF();try{let r=await t.conn.client.getVersion();return new _(this,t,e,r)}catch(e){throw this._closeStream(t),(0,p.mapHranaError)(e)}})}async executeMultiple(e){return this.limit(async()=>{let t=await this.#eF();try{let r=t.stream.sequence(e);t.stream.closeGracefully(),await r}catch(e){throw(0,p.mapHranaError)(e)}finally{this._closeStream(t)}})}sync(){throw new c.LibsqlError("sync not supported in ws mode","SYNC_NOT_SUPPORTED")}async #eF(){if(this.closed)throw new c.LibsqlError("The client is closed","CLIENT_CLOSED");if(new Date().valueOf()-this.#e$.openTime.valueOf()>6e4&&void 0===this.#eD){let e=this.#eB();this.#eD=e,e.client.getVersion().then(t=>{this.#e$!==e&&0===this.#e$.streamStates.size&&this.#e$.client.close(),this.#e$=e,this.#eD=void 0},e=>{this.#eD=void 0})}if(this.#e$.client.closed)try{void 0!==this.#eD?this.#e$=this.#eD:this.#e$=this.#eB()}catch(e){throw(0,p.mapHranaError)(e)}let e=this.#e$;try{void 0===e.useSqlCache&&(e.useSqlCache=await e.client.getVersion()>=2,e.useSqlCache&&(e.sqlCache.capacity=100));let t=e.client.openStream();t.intMode=this.#eN;let r={conn:e,stream:t};return e.streamStates.add(r),r}catch(e){throw(0,p.mapHranaError)(e)}}#eB(e){try{return{client:e??=u.openWs(this.#w,this.#eI),useSqlCache:void 0,sqlCache:new h.SqlCache(e,0),openTime:new Date,streamStates:new Set}}catch(e){throw(0,p.mapHranaError)(e)}}_closeStream(e){e.stream.close();let t=e.conn;t.streamStates.delete(e),0===t.streamStates.size&&t!==this.#e$&&t.client.close()}close(){this.#e$.client.close(),this.closed=!0}}t.WsClient=b;class _ extends p.HranaTransaction{#N;#eV;constructor(e,t,r,s){super(r,s),this.#N=e,this.#eV=t}_getStream(){return this.#eV.stream}_getSqlCache(){return this.#eV.conn.sqlCache}close(){this.#N._closeStream(this.#eV)}get closed(){return this.#eV.stream.closed}}t.WsTransaction=_},22969:(e,t,r)=>{"use strict";r.d(t,{NF:()=>h,RV:()=>f,MS:()=>q,k0:()=>M,cP:()=>R,bF:()=>y,Sq:()=>C,tc:()=>A,gw:()=>m,Ox:()=>b,e$:()=>_,D_:()=>v,Gr:()=>I,pd:()=>w,A8:()=>T,NX:()=>k,pW:()=>E,pY:()=>S,QT:()=>L});var s=r(2347);let o=(e,t=21)=>(r=t)=>{let s="",o=0|r;for(;o--;)s+=e[Math.random()*e.length|0];return s};var i=r(49794),a=Object.defineProperty,l=(e,t,r)=>t in e?a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,u=(e,t,r)=>l(e,"symbol"!=typeof t?t+"":t,r);class c extends Error{constructor(e,t){super(e),u(this,"type"),u(this,"field"),u(this,"value"),u(this,"line"),this.name="ParseError",this.type=t.type,this.field=t.field,this.value=t.value,this.line=t.line}}function d(e){}class p extends TransformStream{constructor({onError:e,onRetry:t,onComment:r}={}){let s;super({start(o){s=function(e){let{onEvent:t=d,onError:r=d,onRetry:s=d,onComment:o}=e,i="",a=!0,l,u="",p="";function h(e){if(""===e){u.length>0&&t({id:l,event:p||void 0,data:u.endsWith(`
`)?u.slice(0,-1):u}),l=void 0,u="",p="";return}if(e.startsWith(":")){o&&o(e.slice(e.startsWith(": ")?2:1));return}let r=e.indexOf(":");if(-1!==r){let t=e.slice(0,r),s=" "===e[r+1]?2:1;f(t,e.slice(r+s),e);return}f(e,"",e)}function f(e,t,o){switch(e){case"event":p=t;break;case"data":u=`${u}${t}
`;break;case"id":l=t.includes("\0")?void 0:t;break;case"retry":/^\d+$/.test(t)?s(parseInt(t,10)):r(new c(`Invalid \`retry\` value: "${t}"`,{type:"invalid-retry",value:t,line:o}));break;default:r(new c(`Unknown field "${e.length>20?`${e.slice(0,20)}\u2026`:e}"`,{type:"unknown-field",field:e,value:t,line:o}))}}return{feed:function(e){let t=a?e.replace(/^\xEF\xBB\xBF/,""):e,[r,s]=function(e){let t=[],r="",s=e.length;for(let o=0;o<s;o++){let s=e[o];"\r"===s&&e[o+1]===`
`?(t.push(r),r="",o++):"\r"===s||s===`
`?(t.push(r),r=""):r+=s}return[t,r]}(`${i}${t}`);for(let e of r)h(e);i=s,a=!1},reset:function(e={}){i&&e.consume&&h(i),l=void 0,u="",p="",i=""}}}({onEvent:e=>{o.enqueue(e)},onError(t){"terminate"===e?o.error(t):"function"==typeof e&&e(t)},onRetry:t,onComment:r})},transform(e){s.feed(e)}})}}function h(...e){return e.reduce((e,t)=>({...e,...null!=t?t:{}}),{})}function f(e){return new ReadableStream({async pull(t){try{let{value:r,done:s}=await e.next();s?t.close():t.enqueue(r)}catch(e){t.error(e)}},cancel(){}})}async function m(e){return null==e?Promise.resolve():new Promise(t=>setTimeout(t,e))}function g(e){let t={};return e.headers.forEach((e,r)=>{t[r]=e}),t}var y=({prefix:e,size:t=16,alphabet:r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:i="-"}={})=>{let a=o(r,t);if(null==e)return a;if(r.includes(i))throw new s.RU({argument:"separator",message:`The separator "${i}" must not be part of the alphabet "${r}".`});return t=>`${e}${i}${a(t)}`},b=y();function _(e){return null==e?"unknown error":"string"==typeof e?e:e instanceof Error?e.message:JSON.stringify(e)}function v(e){return e instanceof Error&&("AbortError"===e.name||"TimeoutError"===e.name)}function w({apiKey:e,environmentVariableName:t,apiKeyParameterName:r="apiKey",description:o}){if("string"==typeof e)return e;if(null!=e)throw new s.tZ({message:`${o} API key must be a string.`});if("undefined"==typeof process)throw new s.tZ({message:`${o} API key is missing. Pass it using the '${r}' parameter. Environment variables is not supported in this environment.`});if(null==(e=process.env[t]))throw new s.tZ({message:`${o} API key is missing. Pass it using the '${r}' parameter or the ${t} environment variable.`});if("string"!=typeof e)throw new s.tZ({message:`${o} API key must be a string. The value of the ${t} environment variable is not a string.`});return e}var S=Symbol.for("vercel.ai.validator");function E({value:e,schema:t}){let r="object"==typeof t&&null!==t&&S in t&&!0===t[S]&&"validate"in t?t:{[S]:!0,validate:e=>{let r=t.safeParse(e);return r.success?{success:!0,value:r.data}:{success:!1,error:r.error}}};try{if(null==r.validate)return{success:!0,value:e};let t=r.validate(e);if(t.success)return t;return{success:!1,error:s.Gz.wrap({value:e,cause:t.error})}}catch(t){return{success:!1,error:s.Gz.wrap({value:e,cause:t})}}}function k({text:e,schema:t}){try{let r=i.parse(e);if(null==t)return{success:!0,value:r,rawValue:r};let s=E({value:r,schema:t});return s.success?{...s,rawValue:r}:s}catch(t){return{success:!1,error:s.xU.isInstance(t)?t:new s.xU({text:e,cause:t})}}}function I(e){try{return i.parse(e),!0}catch(e){return!1}}var O=()=>globalThis.fetch,T=async({url:e,headers:t,body:r,failedResponseHandler:s,successfulResponseHandler:o,abortSignal:i,fetch:a})=>j({url:e,headers:{"Content-Type":"application/json",...t},body:{content:JSON.stringify(r),values:r},failedResponseHandler:s,successfulResponseHandler:o,abortSignal:i,fetch:a}),j=async({url:e,headers:t={},body:r,successfulResponseHandler:o,failedResponseHandler:i,abortSignal:a,fetch:l=O()})=>{try{let u=await l(e,{method:"POST",headers:Object.fromEntries(Object.entries(t).filter(([e,t])=>null!=t)),body:r.content,signal:a}),c=g(u);if(!u.ok){let t;try{t=await i({response:u,url:e,requestBodyValues:r.values})}catch(t){if(v(t)||s.w.isInstance(t))throw t;throw new s.w({message:"Failed to process error response",cause:t,statusCode:u.status,url:e,responseHeaders:c,requestBodyValues:r.values})}throw t.value}try{return await o({response:u,url:e,requestBodyValues:r.values})}catch(t){if(t instanceof Error&&(v(t)||s.w.isInstance(t)))throw t;throw new s.w({message:"Failed to process successful response",cause:t,statusCode:u.status,url:e,responseHeaders:c,requestBodyValues:r.values})}}catch(t){if(v(t))throw t;if(t instanceof TypeError&&"fetch failed"===t.message){let o=t.cause;if(null!=o)throw new s.w({message:`Cannot connect to API: ${o.message}`,cause:o,url:e,requestBodyValues:r.values,isRetryable:!0})}throw t}},C=({errorSchema:e,errorToMessage:t,isRetryable:r})=>async({response:o,url:a,requestBodyValues:l})=>{let u=await o.text(),c=g(o);if(""===u.trim())return{responseHeaders:c,value:new s.w({message:o.statusText,url:a,requestBodyValues:l,statusCode:o.status,responseHeaders:c,responseBody:u,isRetryable:null==r?void 0:r(o)})};try{let d=function({text:e,schema:t}){try{let r=i.parse(e);if(null==t)return r;return function({value:e,schema:t}){let r=E({value:e,schema:t});if(!r.success)throw s.Gz.wrap({value:e,cause:r.error});return r.value}({value:r,schema:t})}catch(t){if(s.xU.isInstance(t)||s.Gz.isInstance(t))throw t;throw new s.xU({text:e,cause:t})}}({text:u,schema:e});return{responseHeaders:c,value:new s.w({message:t(d),url:a,requestBodyValues:l,statusCode:o.status,responseHeaders:c,responseBody:u,data:d,isRetryable:null==r?void 0:r(o,d)})}}catch(e){return{responseHeaders:c,value:new s.w({message:o.statusText,url:a,requestBodyValues:l,statusCode:o.status,responseHeaders:c,responseBody:u,isRetryable:null==r?void 0:r(o)})}}},R=e=>async({response:t})=>{let r=g(t);if(null==t.body)throw new s.g8({});return{responseHeaders:r,value:t.body.pipeThrough(new TextDecoderStream).pipeThrough(new p).pipeThrough(new TransformStream({transform({data:t},r){"[DONE]"!==t&&r.enqueue(k({text:t,schema:e}))}}))}},A=e=>async({response:t,url:r,requestBodyValues:o})=>{let i=await t.text(),a=k({text:i,schema:e}),l=g(t);if(!a.success)throw new s.w({message:"Invalid JSON response",cause:a.error,statusCode:t.status,responseHeaders:l,responseBody:i,url:r,requestBodyValues:o});return{responseHeaders:l,value:a.value,rawValue:a.rawValue}},{btoa:P,atob:N}=globalThis;function q(e){let t=N(e.replace(/-/g,"+").replace(/_/g,"/"));return Uint8Array.from(t,e=>e.codePointAt(0))}function M(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCodePoint(e[r]);return P(t)}function L(e){return null==e?void 0:e.replace(/\/$/,"")}},2347:(e,t,r)=>{"use strict";r.d(t,{AX:()=>_,A_:()=>ep,Gz:()=>el,JJ:()=>X,Mt:()=>L,ON:()=>es,RU:()=>P,Rt:()=>B,_d:()=>ef,e$:()=>j,g8:()=>T,tZ:()=>G,w:()=>E,wA:()=>em,xU:()=>z});var s,o,i,a,l,u,c,d,p,h,f,m,g="vercel.ai.error",y=Symbol.for(g),b=class e extends Error{constructor({name:e,message:t,cause:r}){super(t),this[s]=!0,this.name=e,this.cause=r}static isInstance(t){return e.hasMarker(t,g)}static hasMarker(e,t){let r=Symbol.for(t);return null!=e&&"object"==typeof e&&r in e&&"boolean"==typeof e[r]&&!0===e[r]}};s=y;var _=b,v="AI_APICallError",w=`vercel.ai.error.${v}`,S=Symbol.for(w),E=class extends _{constructor({message:e,url:t,requestBodyValues:r,statusCode:s,responseHeaders:i,responseBody:a,cause:l,isRetryable:u=null!=s&&(408===s||409===s||429===s||s>=500),data:c}){super({name:v,message:e,cause:l}),this[o]=!0,this.url=t,this.requestBodyValues=r,this.statusCode=s,this.responseHeaders=i,this.responseBody=a,this.isRetryable=u,this.data=c}static isInstance(e){return _.hasMarker(e,w)}};o=S;var k="AI_EmptyResponseBodyError",I=`vercel.ai.error.${k}`,O=Symbol.for(I),T=class extends _{constructor({message:e="Empty response body"}={}){super({name:k,message:e}),this[i]=!0}static isInstance(e){return _.hasMarker(e,I)}};function j(e){return null==e?"unknown error":"string"==typeof e?e:e instanceof Error?e.message:JSON.stringify(e)}i=O;var C="AI_InvalidArgumentError",R=`vercel.ai.error.${C}`,A=Symbol.for(R),P=class extends _{constructor({message:e,cause:t,argument:r}){super({name:C,message:e,cause:t}),this[a]=!0,this.argument=r}static isInstance(e){return _.hasMarker(e,R)}};a=A;var N="AI_InvalidPromptError",q=`vercel.ai.error.${N}`,M=Symbol.for(q),L=class extends _{constructor({prompt:e,message:t,cause:r}){super({name:N,message:`Invalid prompt: ${t}`,cause:r}),this[l]=!0,this.prompt=e}static isInstance(e){return _.hasMarker(e,q)}};l=M;var $="AI_InvalidResponseDataError",D=`vercel.ai.error.${$}`,U=Symbol.for(D),B=class extends _{constructor({data:e,message:t=`Invalid response data: ${JSON.stringify(e)}.`}){super({name:$,message:t}),this[u]=!0,this.data=e}static isInstance(e){return _.hasMarker(e,D)}};u=U;var F="AI_JSONParseError",V=`vercel.ai.error.${F}`,W=Symbol.for(V),z=class extends _{constructor({text:e,cause:t}){super({name:F,message:`JSON parsing failed: Text: ${e}.
Error message: ${j(t)}`,cause:t}),this[c]=!0,this.text=e}static isInstance(e){return _.hasMarker(e,V)}};c=W;var Z="AI_LoadAPIKeyError",J=`vercel.ai.error.${Z}`,H=Symbol.for(J),G=class extends _{constructor({message:e}){super({name:Z,message:e}),this[d]=!0}static isInstance(e){return _.hasMarker(e,J)}};d=H,Symbol.for("vercel.ai.error.AI_LoadSettingError"),Symbol.for("vercel.ai.error.AI_NoContentGeneratedError");var Y="AI_NoSuchModelError",K=`vercel.ai.error.${Y}`,Q=Symbol.for(K),X=class extends _{constructor({errorName:e=Y,modelId:t,modelType:r,message:s=`No such ${r}: ${t}`}){super({name:e,message:s}),this[p]=!0,this.modelId=t,this.modelType=r}static isInstance(e){return _.hasMarker(e,K)}};p=Q;var ee="AI_TooManyEmbeddingValuesForCallError",et=`vercel.ai.error.${ee}`,er=Symbol.for(et),es=class extends _{constructor(e){super({name:ee,message:`Too many values for a single embedding call. The ${e.provider} model "${e.modelId}" can only embed up to ${e.maxEmbeddingsPerCall} values per call, but ${e.values.length} values were provided.`}),this[h]=!0,this.provider=e.provider,this.modelId=e.modelId,this.maxEmbeddingsPerCall=e.maxEmbeddingsPerCall,this.values=e.values}static isInstance(e){return _.hasMarker(e,et)}};h=er;var en="AI_TypeValidationError",eo=`vercel.ai.error.${en}`,ei=Symbol.for(eo),ea=class e extends _{constructor({value:e,cause:t}){super({name:en,message:`Type validation failed: Value: ${JSON.stringify(e)}.
Error message: ${j(t)}`,cause:t}),this[f]=!0,this.value=e}static isInstance(e){return _.hasMarker(e,eo)}static wrap({value:t,cause:r}){return e.isInstance(r)&&r.value===t?r:new e({value:t,cause:r})}};f=ei;var el=ea,eu="AI_UnsupportedFunctionalityError",ec=`vercel.ai.error.${eu}`,ed=Symbol.for(ec),ep=class extends _{constructor({functionality:e,message:t=`'${e}' functionality not supported.`}){super({name:eu,message:t}),this[m]=!0,this.functionality=e}static isInstance(e){return _.hasMarker(e,ec)}};function eh(e){return null===e||"string"==typeof e||"number"==typeof e||"boolean"==typeof e||(Array.isArray(e)?e.every(eh):"object"==typeof e&&Object.entries(e).every(([e,t])=>"string"==typeof e&&eh(t)))}function ef(e){return Array.isArray(e)&&e.every(eh)}function em(e){return null!=e&&"object"==typeof e&&Object.entries(e).every(([e,t])=>"string"==typeof e&&eh(t))}m=ed},12273:(e,t,r)=>{"use strict";r.r(t),r.d(t,{LibsqlError:()=>s});class s extends Error{code;rawCode;constructor(e,t,r,s){void 0!==t&&(e=`${t}: ${e}`),super(e,{cause:s}),this.code=t,this.rawCode=r,this.name="LibsqlError"}}},82337:(e,t,r)=>{"use strict";r.r(t),r.d(t,{expandConfig:()=>u,isInMemoryConfig:()=>l});var s=r(12273),o=r(43271),i=r(74539);let a=":memory:";function l(e){return"file"===e.scheme&&(":memory:"===e.path||e.path.startsWith(":memory:?"))}function u(e,t){let r,l;if("object"!=typeof e)throw TypeError(`Expected client configuration as object, got ${typeof e}`);let{url:u,authToken:c,tls:d,intMode:p,concurrency:h}=e;h=Math.max(0,h||20),p??="number";let f=[];u===a&&(u="file::memory:");let m=(0,o.parseUri)(u),g=m.scheme.toLowerCase(),y="file"===g&&m.path===a&&void 0===m.authority;for(let{key:e,value:t}of(r=y?{cache:{values:["shared","private"],update:(e,t)=>f.push(`${e}=${t}`)}}:{tls:{values:["0","1"],update:(e,t)=>d="1"===t},authToken:{update:(e,t)=>c=t}},m.query?.pairs??[])){if(!Object.hasOwn(r,e))throw new s.LibsqlError(`Unsupported URL query parameter ${JSON.stringify(e)}`,"URL_PARAM_NOT_SUPPORTED");let o=r[e];if(void 0!==o.values&&!o.values.includes(t))throw new s.LibsqlError(`Unknown value for the "${e}" query argument: ${JSON.stringify(t)}. Supported values are: [${o.values.map(e=>'"'+e+'"').join(", ")}]`,"URL_INVALID");void 0!==o.update&&o?.update(e,t)}let b=0===f.length?"":`?${f.join("&")}`,_=m.path+b;if("libsql"===g){if(!1===d){if(m.authority?.port===void 0)throw new s.LibsqlError('A "libsql:" URL with ?tls=0 must specify an explicit port',"URL_INVALID");l=t?"http":"ws"}else l=t?"https":"wss"}else l=g;if("http"===l||"ws"===l?d??=!1:d??=!0,"http"!==l&&"ws"!==l&&"https"!==l&&"wss"!==l&&"file"!==l)throw new s.LibsqlError(`The client supports only "libsql:", "wss:", "ws:", "https:", "http:" and "file:" URLs, got ${JSON.stringify(m.scheme+":")}. For more information, please read ${i.supportedUrlLink}`,"URL_SCHEME_NOT_SUPPORTED");if("number"!==p&&"bigint"!==p&&"string"!==p)throw TypeError(`Invalid value for intMode, expected "number", "bigint" or "string", got ${JSON.stringify(p)}`);if(void 0!==m.fragment)throw new s.LibsqlError(`URL fragments are not supported: ${JSON.stringify("#"+m.fragment)}`,"URL_INVALID");return y?{scheme:"file",tls:!1,path:_,intMode:p,concurrency:h,syncUrl:e.syncUrl,syncInterval:e.syncInterval,fetch:e.fetch,authToken:void 0,encryptionKey:void 0,authority:void 0}:{scheme:l,tls:d,authority:m.authority,path:_,authToken:c,intMode:p,concurrency:h,encryptionKey:e.encryptionKey,syncUrl:e.syncUrl,syncInterval:e.syncInterval,fetch:e.fetch}}},43271:(e,t,r)=>{"use strict";r.r(t),r.d(t,{encodeBaseUrl:()=>u,parseUri:()=>o});var s=r(12273);function o(e){let t=i.exec(e);if(null===t)throw new s.LibsqlError(`The URL '${e}' is not in a valid format`,"URL_INVALID");let r=t.groups,o=r.scheme,u=void 0!==r.authority?function(e){let t=a.exec(e);if(null===t)throw new s.LibsqlError("The authority part of the URL is not in a valid format","URL_INVALID");let r=t.groups;return{host:l(r.host_br??r.host),port:r.port?parseInt(r.port,10):void 0,userinfo:void 0!==r.username?{username:l(r.username),password:void 0!==r.password?l(r.password):void 0}:void 0}}(r.authority):void 0;return{scheme:o,authority:u,path:l(r.path),query:void 0!==r.query?function(e){let t=e.split("&"),r=[];for(let e of t){let t,s;if(""===e)continue;let o=e.indexOf("=");o<0?(t=e,s=""):(t=e.substring(0,o),s=e.substring(o+1)),r.push({key:l(t.replaceAll("+"," ")),value:l(s.replaceAll("+"," "))})}return{pairs:r}}(r.query):void 0,fragment:void 0!==r.fragment?l(r.fragment):void 0}}let i=RegExp("^(?<scheme>[A-Za-z][A-Za-z.+-]*):(//(?<authority>[^/?#]*))?(?<path>[^?#]*)(\\?(?<query>[^#]*))?(#(?<fragment>.*))?$","su"),a=RegExp("^((?<username>[^:]*)(:(?<password>.*))?@)?((?<host>[^:\\[\\]]*)|(\\[(?<host_br>[^\\[\\]]*)\\]))(:(?<port>[0-9]*))?$","su");function l(e){try{return decodeURIComponent(e)}catch(e){if(e instanceof URIError)throw new s.LibsqlError(`URL component has invalid percent encoding: ${e}`,"URL_INVALID",void 0,e);throw e}}function u(e,t,r){var o,i;if(void 0===t)throw new s.LibsqlError(`URL with scheme ${JSON.stringify(e+":")} requires authority (the "//" part)`,"URL_INVALID");let a=`${e}:`,l=(o=t.host).includes(":")?`[${encodeURI(o)}]`:encodeURI(o),u=void 0!==(i=t.port)?`:${i}`:"",c=function(e){if(void 0===e)return"";let t=encodeURIComponent(e.username),r=void 0!==e.password?`:${encodeURIComponent(e.password)}`:"";return`${t}${r}@`}(t.userinfo),d=`//${c}${l}${u}`,p=r.split("/").map(encodeURIComponent).join("/");return""===p||p.startsWith("/")||(p="/"+p),new URL(`${a}${d}${p}`)}},74539:(e,t,r)=>{"use strict";r.r(t),r.d(t,{ResultSetImpl:()=>a,supportedUrlLink:()=>o,transactionModeToBegin:()=>i});var s=r(13822);let o="https://github.com/libsql/libsql-client-ts#supported-urls";function i(e){if("write"===e)return"BEGIN IMMEDIATE";if("read"===e)return"BEGIN TRANSACTION READONLY";if("deferred"===e)return"BEGIN DEFERRED";throw RangeError('Unknown transaction mode, supported values are "write", "read" and "deferred"')}class a{columns;columnTypes;rows;rowsAffected;lastInsertRowid;constructor(e,t,r,s,o){this.columns=e,this.columnTypes=t,this.rows=r,this.rowsAffected=s,this.lastInsertRowid=o}toJSON(){return{columns:this.columns,columnTypes:this.columnTypes,rows:this.rows.map(l),rowsAffected:this.rowsAffected,lastInsertRowid:void 0!==this.lastInsertRowid?""+this.lastInsertRowid:null}}}function l(e){return Array.prototype.map.call(e,u)}function u(e){return"bigint"==typeof e?""+e:e instanceof ArrayBuffer?s.DS.fromUint8Array(new Uint8Array(e)):e}},93714:(e,t,r)=>{"use strict";r.r(t),r.d(t,{Batch:()=>l,BatchCond:()=>d,BatchStep:()=>c});var s=r(61629),o=r(42945),i=r(32552),a=r(93953);class l{_stream;#e;_steps;#t;constructor(e,t){this._stream=e,this.#e=t,this._steps=[],this.#t=!1}step(){return new c(this)}execute(){var e,t;if(this.#t)throw new s.MisuseError("This batch has already been executed");this.#t=!0;let r={steps:this._steps.map(e=>e.proto)};return this.#e?u(this._stream,this._steps,r):(e=this._stream,t=this._steps,e._batch(r).then(e=>{for(let r=0;r<t.length;++r){let s=e.stepResults.get(r),o=e.stepErrors.get(r);t[r].callback(s,o)}}))}}async function u(e,t,r){let i=await e._openCursor(r);try{let e,r=0,l=[];for(;;){let u=await i.next();if(void 0===u)break;if("step_begin"===u.type){if(u.step<r||u.step>=t.length)throw new s.ProtoError("Server produced StepBeginEntry for unexpected step");if(void 0!==e)throw new s.ProtoError("Server produced StepBeginEntry before terminating previous step");for(let e=r;e<u.step;++e)t[e].callback(void 0,void 0);r=u.step+1,e=u,l=[]}else if("step_end"===u.type){if(void 0===e)throw new s.ProtoError("Server produced StepEndEntry but no step is active");let r={cols:e.cols,rows:l,affectedRowCount:u.affectedRowCount,lastInsertRowid:u.lastInsertRowid};t[e.step].callback(r,void 0),e=void 0,l=[]}else if("step_error"===u.type){if(void 0===e){if(u.step>=t.length)throw new s.ProtoError("Server produced StepErrorEntry for unexpected step");for(let e=r;e<u.step;++e)t[e].callback(void 0,void 0)}else{if(u.step!==e.step)throw new s.ProtoError("Server produced StepErrorEntry for unexpected step");e=void 0,l=[]}t[u.step].callback(void 0,u.error),r=u.step+1}else if("row"===u.type){if(void 0===e)throw new s.ProtoError("Server produced RowEntry but no step is active");l.push(u.row)}else if("error"===u.type)throw(0,o.errorFromProto)(u.error);else if("none"===u.type)throw new s.ProtoError("Server produced unrecognized CursorEntry");else throw(0,a.impossible)(u,"Impossible CursorEntry")}if(void 0!==e)throw new s.ProtoError("Server closed Cursor before terminating active step");for(let e=r;e<t.length;++e)t[e].callback(void 0,void 0)}finally{i.close()}}class c{_batch;#r;_index;constructor(e){this._batch=e,this.#r=[],this._index=void 0}condition(e){return this.#r.push(e._proto),this}query(e){return this.#s(e,!0,o.rowsResultFromProto)}queryRow(e){return this.#s(e,!0,o.rowResultFromProto)}queryValue(e){return this.#s(e,!0,o.valueResultFromProto)}run(e){return this.#s(e,!1,o.stmtResultFromProto)}#s(e,t,r){if(void 0!==this._index)throw new s.MisuseError("This BatchStep has already been added to the batch");let a={stmt:(0,i.stmtToProto)(this._batch._stream._sqlOwner(),e,t),condition:0===this.#r.length?void 0:1===this.#r.length?this.#r[0]:{type:"and",conds:this.#r.slice()}};return new Promise((e,t)=>{this._index=this._batch._steps.length,this._batch._steps.push({proto:a,callback:(i,a)=>{void 0!==i&&void 0!==a?t(new s.ProtoError("Server returned both result and error")):void 0!==a?t((0,o.errorFromProto)(a)):void 0!==i?e(r(i,this._batch._stream.intMode)):e(void 0)}})})}}class d{_batch;_proto;constructor(e,t){this._batch=e,this._proto=t}static ok(e){return new d(e._batch,{type:"ok",step:p(e)})}static error(e){return new d(e._batch,{type:"error",step:p(e)})}static not(e){return new d(e._batch,{type:"not",cond:e._proto})}static and(e,t){for(let r of t)h(e,r);return new d(e,{type:"and",conds:t.map(e=>e._proto)})}static or(e,t){for(let r of t)h(e,r);return new d(e,{type:"or",conds:t.map(e=>e._proto)})}static isAutocommit(e){return e._stream.client()._ensureVersion(3,"BatchCond.isAutocommit()"),new d(e,{type:"is_autocommit"})}}function p(e){if(void 0===e._index)throw new s.MisuseError("Cannot add a condition referencing a step that has not been added to the batch");return e._index}function h(e,t){if(t._batch!==e)throw new s.MisuseError("Cannot mix BatchCond objects for different Batch objects")}},10308:(e,t,r)=>{"use strict";r.r(t),r.d(t,{ByteQueue:()=>s});class s{#n;#o;#i;constructor(e){this.#n=new Uint8Array(new ArrayBuffer(e)),this.#o=0,this.#i=0}get length(){return this.#i-this.#o}data(){return this.#n.slice(this.#o,this.#i)}push(e){this.#a(e.byteLength),this.#n.set(e,this.#i),this.#i+=e.byteLength}#a(e){if(this.#i+e<=this.#n.byteLength)return;let t=this.#i-this.#o;if(t+e<=this.#n.byteLength&&2*this.#i>=this.#n.byteLength)this.#n.copyWithin(0,this.#o,this.#i);else{let r=this.#n.byteLength;do r*=2;while(t+e>r);let s=new Uint8Array(new ArrayBuffer(r));s.set(this.#n.slice(this.#o,this.#i),0),this.#n=s}this.#i=t,this.#o=0}shift(e){this.#o+=e}}},22118:(e,t,r)=>{"use strict";r.r(t),r.d(t,{Client:()=>s});class s{constructor(){this.intMode="number"}intMode}},10100:(e,t,r)=>{"use strict";r.r(t),r.d(t,{Cursor:()=>s});class s{}},81225:(e,t,r)=>{"use strict";function s(e){return{paramNames:e.params.map(e=>e.name),columns:e.cols,isExplain:e.isExplain,isReadonly:e.isReadonly}}r.r(t),r.d(t,{describeResultFromProto:()=>s})},11517:(e,t,r)=>{"use strict";r.r(t),r.d(t,{readJsonObject:()=>s.readJsonObject,readProtobufMessage:()=>i.readProtobufMessage,writeJsonObject:()=>o.writeJsonObject,writeProtobufMessage:()=>a.writeProtobufMessage});var s=r(7966),o=r(77705),i=r(94062),a=r(93874)},7966:(e,t,r)=>{"use strict";r.r(t),r.d(t,{array:()=>u,arrayObjectsMap:()=>d,boolean:()=>l,number:()=>a,object:()=>c,readJsonObject:()=>h,string:()=>o,stringOpt:()=>i});var s=r(61629);function o(e){if("string"==typeof e)return e;throw p(e,"string")}function i(e){if(null!=e){if("string"==typeof e)return e;throw p(e,"string or null")}}function a(e){if("number"==typeof e)return e;throw p(e,"number")}function l(e){if("boolean"==typeof e)return e;throw p(e,"boolean")}function u(e){if(Array.isArray(e))return e;throw p(e,"array")}function c(e){if(null!==e&&"object"==typeof e&&!Array.isArray(e))return e;throw p(e,"object")}function d(e,t){return u(e).map(e=>t(c(e)))}function p(e,t){if(void 0===e)return new s.ProtoError(`Expected ${t}, but the property was missing`);let r=typeof e;return null===e?r="null":Array.isArray(e)&&(r="array"),new s.ProtoError(`Expected ${t}, received ${r}`)}function h(e,t){return t(c(e))}},77705:(e,t,r)=>{"use strict";r.r(t),r.d(t,{ObjectWriter:()=>s,writeJsonObject:()=>o});class s{#l;#u;constructor(e){this.#l=e,this.#u=!1}begin(){this.#l.push("{"),this.#u=!0}end(){this.#l.push("}"),this.#u=!1}#c(e){this.#u?(this.#l.push('"'),this.#u=!1):this.#l.push(',"'),this.#l.push(e),this.#l.push('":')}string(e,t){this.#c(e),this.#l.push(JSON.stringify(t))}stringRaw(e,t){this.#c(e),this.#l.push('"'),this.#l.push(t),this.#l.push('"')}number(e,t){this.#c(e),this.#l.push(""+t)}boolean(e,t){this.#c(e),this.#l.push(t?"true":"false")}object(e,t,r){this.#c(e),this.begin(),r(this,t),this.end()}arrayObjects(e,t,r){this.#c(e),this.#l.push("[");for(let e=0;e<t.length;++e)0!==e&&this.#l.push(","),this.begin(),r(this,t[e]),this.end();this.#l.push("]")}}function o(e,t){let r=[],o=new s(r);return o.begin(),t(o,e),o.end(),r.join("")}},94062:(e,t,r)=>{"use strict";r.r(t),r.d(t,{FieldReader:()=>a,readProtobufMessage:()=>l});var s=r(61629),o=r(42007);class i{#n;#d;#p;constructor(e){this.#n=e,this.#d=new DataView(e.buffer,e.byteOffset,e.byteLength),this.#p=0}varint(){let e=0;for(let t=0;;t+=7){let r=this.#n[this.#p++];if(e|=(127&r)<<t,!(128&r))break}return e}varintBig(){let e=0n;for(let t=0n;;t+=7n){let r=this.#n[this.#p++];if(e|=BigInt(127&r)<<t,!(128&r))break}return e}bytes(e){let t=new Uint8Array(this.#n.buffer,this.#n.byteOffset+this.#p,e);return this.#p+=e,t}double(){let e=this.#d.getFloat64(this.#p,!0);return this.#p+=8,e}skipVarint(){for(;128&this.#n[this.#p++];);}skip(e){this.#p+=e}eof(){return this.#p>=this.#n.byteLength}}class a{#h;#f;constructor(e){this.#h=e,this.#f=-1}setup(e){this.#f=e}#m(e){if(this.#f!==e)throw new s.ProtoError(`Expected wire type ${e}, got ${this.#f}`);this.#f=-1}bytes(){this.#m(o.LENGTH_DELIMITED);let e=this.#h.varint();return this.#h.bytes(e)}string(){return new TextDecoder().decode(this.bytes())}message(e){return l(this.bytes(),e)}int32(){return this.#m(o.VARINT),this.#h.varint()}uint32(){return this.int32()}bool(){return 0!==this.int32()}uint64(){return this.#m(o.VARINT),this.#h.varintBig()}sint64(){let e=this.uint64();return e>>1n^-(1n&e)}double(){return this.#m(o.FIXED_64),this.#h.double()}maybeSkip(){if(!(this.#f<0)){if(this.#f===o.VARINT)this.#h.skipVarint();else if(this.#f===o.FIXED_64)this.#h.skip(8);else if(this.#f===o.LENGTH_DELIMITED){let e=this.#h.varint();this.#h.skip(e)}else if(this.#f===o.FIXED_32)this.#h.skip(4);else throw new s.ProtoError(`Unexpected wire type ${this.#f}`);this.#f=-1}}}function l(e,t){let r=new i(e),s=new a(r),o=t.default();for(;!r.eof();){let e=r.varint(),i=e>>3,a=7&e;s.setup(a);let l=t[i];if(void 0!==l){let e=l(s,o);void 0!==e&&(o=e)}s.maybeSkip()}return o}},93874:(e,t,r)=>{"use strict";r.r(t),r.d(t,{MessageWriter:()=>o,writeProtobufMessage:()=>i});var s=r(42007);class o{#g;#n;#d;#p;constructor(){this.#g=new ArrayBuffer(256),this.#n=new Uint8Array(this.#g),this.#d=new DataView(this.#g),this.#p=0}#y(e){if(this.#p+e<=this.#g.byteLength)return;let t=this.#g.byteLength;for(;t<this.#p+e;)t*=2;let r=new ArrayBuffer(t),s=new Uint8Array(r),o=new DataView(r);s.set(new Uint8Array(this.#g,0,this.#p)),this.#g=r,this.#n=s,this.#d=o}#b(e){this.#y(5),e|=0;do{let t=127&e;e>>>=7,t|=e?128:0,this.#n[this.#p++]=t}while(e)}#_(e){this.#y(10),e&=0xffffffffffffffffn;do{let t=Number(127n&e);e>>=7n,t|=e?128:0,this.#n[this.#p++]=t}while(e)}#v(e,t){this.#b(e<<3|t)}bytes(e,t){this.#v(e,s.LENGTH_DELIMITED),this.#b(t.byteLength),this.#y(t.byteLength),this.#n.set(t,this.#p),this.#p+=t.byteLength}string(e,t){this.bytes(e,new TextEncoder().encode(t))}message(e,t,r){let s=new o;r(s,t),this.bytes(e,s.data())}int32(e,t){this.#v(e,s.VARINT),this.#b(t)}uint32(e,t){this.int32(e,t)}bool(e,t){this.int32(e,t?1:0)}sint64(e,t){this.#v(e,s.VARINT),this.#_(t<<1n^t>>63n)}double(e,t){this.#v(e,s.FIXED_64),this.#y(8),this.#d.setFloat64(this.#p,t,!0),this.#p+=8}data(){return new Uint8Array(this.#g,0,this.#p)}}function i(e,t){let r=new o;return t(r,e),r.data()}},42007:(e,t,r)=>{"use strict";r.r(t),r.d(t,{FIXED_32:()=>u,FIXED_64:()=>o,GROUP_END:()=>l,GROUP_START:()=>a,LENGTH_DELIMITED:()=>i,VARINT:()=>s});let s=0,o=1,i=2,a=3,l=4,u=5},61629:(e,t,r)=>{"use strict";r.r(t),r.d(t,{ClientError:()=>s,ClosedError:()=>a,HttpServerError:()=>c,InternalError:()=>h,LibsqlUrlParseError:()=>d,MisuseError:()=>f,ProtoError:()=>o,ProtocolVersionError:()=>p,ResponseError:()=>i,WebSocketError:()=>u,WebSocketUnsupportedError:()=>l});class s extends Error{constructor(e){super(e),this.name="ClientError"}}class o extends s{constructor(e){super(e),this.name="ProtoError"}}class i extends s{code;proto;constructor(e,t){super(e),this.name="ResponseError",this.code=t.code,this.proto=t,this.stack=void 0}}class a extends s{constructor(e,t){void 0!==t?(super(`${e}: ${t}`),this.cause=t):super(e),this.name="ClosedError"}}class l extends s{constructor(e){super(e),this.name="WebSocketUnsupportedError"}}class u extends s{constructor(e){super(e),this.name="WebSocketError"}}class c extends s{status;constructor(e,t){super(e),this.status=t,this.name="HttpServerError"}}class d extends s{constructor(e){super(e),this.name="LibsqlUrlParseError"}}class p extends s{constructor(e){super(e),this.name="ProtocolVersionError"}}class h extends s{constructor(e){super(e),this.name="InternalError"}}class f extends s{constructor(e){super(e),this.name="MisuseError"}}},74118:(e,t,r)=>{"use strict";r.r(t),r.d(t,{HttpClient:()=>c,checkEndpoints:()=>l});var s=r(14937),o=r(22118),i=r(61629),a=r(45974);let l=[{versionPath:"v3-protobuf",pipelinePath:"v3-protobuf/pipeline",cursorPath:"v3-protobuf/cursor",version:3,encoding:"protobuf"}],u={versionPath:"v2",pipelinePath:"v2/pipeline",cursorPath:void 0,version:2,encoding:"json"};class c extends o.Client{#w;#x;#S;#E;#k;_endpointPromise;_endpoint;constructor(e,t,r,o=2){super(),this.#w=e,this.#x=t,this.#S=r??s.fetch,this.#E=void 0,this.#k=new Set,3==o?(this._endpointPromise=d(this.#S,this.#w),this._endpointPromise.then(e=>this._endpoint=e,e=>this.#I(e))):(this._endpointPromise=Promise.resolve(u),this._endpointPromise.then(e=>this._endpoint=e,e=>this.#I(e)))}async getVersion(){return void 0!==this._endpoint?this._endpoint.version:(await this._endpointPromise).version}_ensureVersion(e,t){if(!(e<=u.version)){if(void 0===this._endpoint)throw new i.ProtocolVersionError(`${t} is supported only on protocol version ${e} and higher, but the version supported by the HTTP server is not yet known. Use Client.getVersion() to wait until the version is available.`);if(this._endpoint.version<e)throw new i.ProtocolVersionError(`${t} is supported only on protocol version ${e} and higher, but the HTTP server only supports version ${this._endpoint.version}.`)}}openStream(){if(void 0!==this.#E)throw new i.ClosedError("Client is closed",this.#E);let e=new a.HttpStream(this,this.#w,this.#x,this.#S);return this.#k.add(e),e}_streamClosed(e){this.#k.delete(e)}close(){this.#I(new i.ClientError("Client was manually closed"))}get closed(){return void 0!==this.#E}#I(e){if(void 0===this.#E)for(let t of(this.#E=e,Array.from(this.#k)))t._setClosed(new i.ClosedError("Client was closed",e))}}async function d(e,t){for(let r of l){let o=new URL(r.versionPath,t),i=new s.Request(o.toString(),{method:"GET"}),a=await e(i);if(await a.arrayBuffer(),a.ok)return r}return u}},33100:(e,t,r)=>{"use strict";r.r(t),r.d(t,{HttpCursor:()=>f});var s=r(10308),o=r(10100),i=r(7966),a=r(94062),l=r(61629),u=r(93953),c=r(11338),d=r(67043),p=r(79488),h=r(81039);class f extends o.Cursor{#O;#T;#h;#j;#E;#C;constructor(e,t){super(),this.#O=e,this.#T=t,this.#h=void 0,this.#j=new s.ByteQueue(16384),this.#E=void 0,this.#C=!1}async open(e){if(null===e.body)throw new l.ProtoError("No response body for cursor request");this.#h=e.body.getReader();let t=await this.#R(c.CursorRespBody,d.CursorRespBody);if(void 0===t)throw new l.ProtoError("Empty response to cursor request");return t}next(){return this.#R(p.CursorEntry,h.CursorEntry)}close(){this._setClosed(new l.ClientError("Cursor was manually closed"))}_setClosed(e){void 0===this.#E&&(this.#E=e,this.#O._cursorClosed(this),void 0!==this.#h&&this.#h.cancel())}get closed(){return void 0!==this.#E}async #R(e,t){for(;;){if(this.#C)return;if(void 0!==this.#E)throw new l.ClosedError("Cursor is closed",this.#E);if("json"===this.#T){let t=this.#A();if(void 0!==t){let r=JSON.parse(new TextDecoder().decode(t));return i.readJsonObject(r,e)}}else if("protobuf"===this.#T){let e=this.#P();if(void 0!==e)return a.readProtobufMessage(e,t)}else throw(0,u.impossible)(this.#T,"Impossible encoding");if(void 0===this.#h)throw new l.InternalError("Attempted to read from HTTP cursor before it was opened");let{value:r,done:s}=await this.#h.read();if(s&&0===this.#j.length)this.#C=!0;else if(s)throw new l.ProtoError("Unexpected end of cursor stream");else this.#j.push(r)}}#A(){let e=this.#j.data(),t=e.indexOf(10);if(t<0)return;let r=e.slice(0,t);return this.#j.shift(t+1),r}#P(){let e=this.#j.data(),t=0,r=0;for(;;){if(r>=e.byteLength)return;let s=e[r];if(t|=(127&s)<<7*r,r+=1,!(128&s))break}if(e.byteLength<r+t)return;let s=e.slice(r,r+t);return this.#j.shift(r+t),s}}},11338:(e,t,r)=>{"use strict";r.r(t),r.d(t,{CursorRespBody:()=>u,PipelineRespBody:()=>a});var s=r(61629),o=r(7966),i=r(79488);function a(e){return{baton:o.stringOpt(e.baton),baseUrl:o.stringOpt(e.base_url),results:o.arrayObjectsMap(e.results,l)}}function l(e){let t=o.string(e.type);if("ok"===t)return{type:"ok",response:function(e){let t=o.string(e.type);if("close"===t)return{type:"close"};if("execute"===t)return{type:"execute",result:(0,i.StmtResult)(o.object(e.result))};if("batch"===t)return{type:"batch",result:(0,i.BatchResult)(o.object(e.result))};if("sequence"===t)return{type:"sequence"};if("describe"===t)return{type:"describe",result:(0,i.DescribeResult)(o.object(e.result))};if("store_sql"===t)return{type:"store_sql"};if("close_sql"===t)return{type:"close_sql"};else if("get_autocommit"===t)return{type:"get_autocommit",isAutocommit:o.boolean(e.is_autocommit)};else throw new s.ProtoError("Unexpected type of StreamResponse")}(o.object(e.response))};if("error"===t)return{type:"error",error:(0,i.Error)(o.object(e.error))};throw new s.ProtoError("Unexpected type of StreamResult")}function u(e){return{baton:o.stringOpt(e.baton),baseUrl:o.stringOpt(e.base_url)}}},98498:(e,t,r)=>{"use strict";r.r(t),r.d(t,{CursorReqBody:()=>l,PipelineReqBody:()=>i});var s=r(97124),o=r(93953);function i(e,t){void 0!==t.baton&&e.string("baton",t.baton),e.arrayObjects("requests",t.requests,a)}function a(e,t){if(e.stringRaw("type",t.type),"close"===t.type);else if("execute"===t.type)e.object("stmt",t.stmt,s.Stmt);else if("batch"===t.type)e.object("batch",t.batch,s.Batch);else if("sequence"===t.type)void 0!==t.sql&&e.string("sql",t.sql),void 0!==t.sqlId&&e.number("sql_id",t.sqlId);else if("describe"===t.type)void 0!==t.sql&&e.string("sql",t.sql),void 0!==t.sqlId&&e.number("sql_id",t.sqlId);else if("store_sql"===t.type)e.number("sql_id",t.sqlId),e.string("sql",t.sql);else if("close_sql"===t.type)e.number("sql_id",t.sqlId);else if("get_autocommit"===t.type);else throw(0,o.impossible)(t,"Impossible type of StreamRequest")}function l(e,t){void 0!==t.baton&&e.string("baton",t.baton),e.object("batch",t.batch,s.Batch)}},94392:(e,t,r)=>{"use strict";r.r(t)},67043:(e,t,r)=>{"use strict";r.r(t),r.d(t,{CursorRespBody:()=>p,PipelineRespBody:()=>o});var s=r(81039);let o={default:()=>({baton:void 0,baseUrl:void 0,results:[]}),1(e,t){t.baton=e.string()},2(e,t){t.baseUrl=e.string()},3(e,t){t.results.push(e.message(i))}},i={default:()=>({type:"none"}),1:e=>({type:"ok",response:e.message(a)}),2:e=>({type:"error",error:e.message(s.Error)})},a={default:()=>({type:"none"}),1:e=>({type:"close"}),2:e=>e.message(l),3:e=>e.message(u),4:e=>({type:"sequence"}),5:e=>e.message(c),6:e=>({type:"store_sql"}),7:e=>({type:"close_sql"}),8:e=>e.message(d)},l={default:()=>({type:"execute",result:s.StmtResult.default()}),1(e,t){t.result=e.message(s.StmtResult)}},u={default:()=>({type:"batch",result:s.BatchResult.default()}),1(e,t){t.result=e.message(s.BatchResult)}},c={default:()=>({type:"describe",result:s.DescribeResult.default()}),1(e,t){t.result=e.message(s.DescribeResult)}},d={default:()=>({type:"get_autocommit",isAutocommit:!1}),1(e,t){t.isAutocommit=e.bool()}},p={default:()=>({baton:void 0,baseUrl:void 0}),1(e,t){t.baton=e.string()},2(e,t){t.baseUrl=e.string()}}},65554:(e,t,r)=>{"use strict";r.r(t),r.d(t,{CursorReqBody:()=>g,PipelineReqBody:()=>i});var s=r(43153),o=r(93953);function i(e,t){for(let r of(void 0!==t.baton&&e.string(1,t.baton),t.requests))e.message(2,r,a)}function a(e,t){if("close"===t.type)e.message(1,t,l);else if("execute"===t.type)e.message(2,t,u);else if("batch"===t.type)e.message(3,t,c);else if("sequence"===t.type)e.message(4,t,d);else if("describe"===t.type)e.message(5,t,p);else if("store_sql"===t.type)e.message(6,t,h);else if("close_sql"===t.type)e.message(7,t,f);else if("get_autocommit"===t.type)e.message(8,t,m);else throw(0,o.impossible)(t,"Impossible type of StreamRequest")}function l(e,t){}function u(e,t){e.message(1,t.stmt,s.Stmt)}function c(e,t){e.message(1,t.batch,s.Batch)}function d(e,t){void 0!==t.sql&&e.string(1,t.sql),void 0!==t.sqlId&&e.int32(2,t.sqlId)}function p(e,t){void 0!==t.sql&&e.string(1,t.sql),void 0!==t.sqlId&&e.int32(2,t.sqlId)}function h(e,t){e.int32(1,t.sqlId),e.string(2,t.sql)}function f(e,t){e.int32(1,t.sqlId)}function m(e,t){}function g(e,t){void 0!==t.baton&&e.string(1,t.baton),e.message(2,t.batch,s.Batch)}},45974:(e,t,r)=>{"use strict";r.r(t),r.d(t,{HttpStream:()=>_});var s=r(14937),o=r(61629),i=r(11517),a=r(5147),l=r(6813),u=r(68194),c=r(42945),d=r(19530),p=r(9712),h=r(93953),f=r(33100),m=r(98498),g=r(65554),y=r(11338),b=r(67043);class _ extends p.Stream{#N;#q;#x;#S;#M;#j;#L;#$;#D;#U;#E;#B;constructor(e,t,r,s){super(e.intMode),this.#N=e,this.#q=t.toString(),this.#x=r,this.#S=s,this.#M=void 0,this.#j=new l.Queue,this.#L=!1,this.#D=!1,this.#U=!1,this.#E=void 0,this.#B=new a.IdAlloc}client(){return this.#N}_sqlOwner(){return this}storeSql(e){let t=this.#B.alloc();return this.#F({type:"store_sql",sqlId:t,sql:e}).then(()=>void 0,e=>this._setClosed(e)),new d.Sql(this,t)}_closeSql(e){void 0===this.#E&&this.#F({type:"close_sql",sqlId:e}).then(()=>this.#B.free(e),e=>this._setClosed(e))}_execute(e){return this.#F({type:"execute",stmt:e}).then(e=>e.result)}_batch(e){return this.#F({type:"batch",batch:e}).then(e=>e.result)}_describe(e){return this.#F({type:"describe",sql:e.sql,sqlId:e.sqlId}).then(e=>e.result)}_sequence(e){return this.#F({type:"sequence",sql:e.sql,sqlId:e.sqlId}).then(e=>{})}getAutocommit(){return this.#N._ensureVersion(3,"getAutocommit()"),this.#F({type:"get_autocommit"}).then(e=>e.isAutocommit)}#F(e){return new Promise((t,r)=>{this.#V({type:"pipeline",request:e,responseCallback:t,errorCallback:r})})}_openCursor(e){return new Promise((t,r)=>{this.#V({type:"cursor",batch:e,cursorCallback:t,errorCallback:r})})}_cursorClosed(e){if(e!==this.#$)throw new o.InternalError("Cursor was closed, but it was not associated with the stream");this.#$=void 0,(0,u.queueMicrotask)(()=>this.#W())}close(){this._setClosed(new o.ClientError("Stream was manually closed"))}closeGracefully(){this.#D=!0,(0,u.queueMicrotask)(()=>this.#W())}get closed(){return void 0!==this.#E||this.#D}_setClosed(e){if(void 0===this.#E){for(this.#E=e,void 0!==this.#$&&this.#$._setClosed(e),this.#N._streamClosed(this);;){let t=this.#j.shift();if(void 0!==t)t.errorCallback(e);else break}(void 0!==this.#M||this.#L)&&!this.#U&&(this.#j.push({type:"pipeline",request:{type:"close"},responseCallback:()=>void 0,errorCallback:()=>void 0}),this.#U=!0,(0,u.queueMicrotask)(()=>this.#W()))}}#V(e){if(void 0!==this.#E)throw new o.ClosedError("Stream is closed",this.#E);if(this.#D)throw new o.ClosedError("Stream is closing",void 0);this.#j.push(e),(0,u.queueMicrotask)(()=>this.#W())}#W(){if(this.#L||void 0!==this.#$)return;if(this.#D&&0===this.#j.length){this._setClosed(new o.ClientError("Stream was gracefully closed"));return}let e=this.#N._endpoint;if(void 0===e){this.#N._endpointPromise.then(()=>this.#W(),e=>this._setClosed(e));return}let t=this.#j.shift();if(void 0!==t){if("pipeline"===t.type){let r=[t];for(;;){let e=this.#j.first();if(void 0!==e&&"pipeline"===e.type)r.push(e),this.#j.shift();else if(void 0===e&&this.#D&&!this.#U){r.push({type:"pipeline",request:{type:"close"},responseCallback:()=>void 0,errorCallback:()=>void 0}),this.#U=!0;break}else break}this.#z(e,r)}else if("cursor"===t.type)this.#Z(e,t);else throw(0,h.impossible)(t,"Impossible type of QueueEntry")}}#z(e,t){this.#J(()=>this.#H(t,e),t=>v(t,e.encoding),e=>e.baton,e=>e.baseUrl,e=>(function(e,t){if(t.results.length!==e.length)throw new o.ProtoError("Server returned unexpected number of pipeline results");for(let r=0;r<e.length;++r){let s=t.results[r],i=e[r];if("ok"===s.type){if(s.response.type!==i.request.type)throw new o.ProtoError("Received unexpected type of response");i.responseCallback(s.response)}else if("error"===s.type)i.errorCallback((0,c.errorFromProto)(s.error));else if("none"===s.type)throw new o.ProtoError("Received unrecognized type of StreamResult");else throw(0,h.impossible)(s,"Received impossible type of StreamResult")}})(t,e),e=>t.forEach(t=>t.errorCallback(e)))}#Z(e,t){let r=new f.HttpCursor(this,e.encoding);this.#$=r,this.#J(()=>this.#G(t,e),e=>r.open(e),e=>e.baton,e=>e.baseUrl,e=>t.cursorCallback(r),e=>t.errorCallback(e))}#J(e,t,r,s,o,i){let a;try{let t=e();a=(0,this.#S)(t)}catch(e){a=Promise.reject(e)}this.#L=!0,a.then(e=>e.ok?t(e):w(e).then(e=>{throw e})).then(e=>{this.#M=r(e),this.#q=s(e)??this.#q,o(e)}).catch(e=>{this._setClosed(e),i(e)}).finally(()=>{this.#L=!1,this.#W()})}#H(e,t){return this.#Y(new URL(t.pipelinePath,this.#q),{baton:this.#M,requests:e.map(e=>e.request)},t.encoding,m.PipelineReqBody,g.PipelineReqBody)}#G(e,t){if(void 0===t.cursorPath)throw new o.ProtocolVersionError(`Cursors are supported only on protocol version 3 and higher, but the HTTP server only supports version ${t.version}.`);return this.#Y(new URL(t.cursorPath,this.#q),{baton:this.#M,batch:e.batch},t.encoding,m.CursorReqBody,g.CursorReqBody)}#Y(e,t,r,o,a){let l,u;if("json"===r)l=(0,i.writeJsonObject)(t,o),u="application/json";else if("protobuf"===r)l=(0,i.writeProtobufMessage)(t,a),u="application/x-protobuf";else throw(0,h.impossible)(r,"Impossible encoding");let c=new s.Headers;return c.set("content-type",u),void 0!==this.#x&&c.set("authorization",`Bearer ${this.#x}`),new s.Request(e.toString(),{method:"POST",headers:c,body:l})}}async function v(e,t){if("json"===t){let t=await e.json();return(0,i.readJsonObject)(t,y.PipelineRespBody)}if("protobuf"===t){let t=await e.arrayBuffer();return(0,i.readProtobufMessage)(new Uint8Array(t),b.PipelineRespBody)}throw await e.body?.cancel(),(0,h.impossible)(t,"Impossible encoding")}async function w(e){let t=e.headers.get("content-type")??"text/plain",r=`Server returned HTTP status ${e.status}`;if("application/json"===t){let t=await e.json();return"message"in t?(0,c.errorFromProto)(t):new o.HttpServerError(r,e.status)}if("text/plain"===t){let t=(await e.text()).trim();return""!==t&&(r+=`: ${t}`),new o.HttpServerError(r,e.status)}return await e.body?.cancel(),new o.HttpServerError(r,e.status)}},5147:(e,t,r)=>{"use strict";r.r(t),r.d(t,{IdAlloc:()=>o});var s=r(61629);class o{#K;#Q;constructor(){this.#K=new Set,this.#Q=new Set}alloc(){for(let e of this.#Q)return this.#Q.delete(e),this.#K.add(e),this.#K.has(this.#K.size-1)||this.#Q.add(this.#K.size-1),e;let e=this.#K.size;return this.#K.add(e),e}free(e){if(!this.#K.delete(e))throw new s.InternalError("Freeing an id that is not allocated");this.#Q.delete(this.#K.size),e<this.#K.size&&this.#Q.add(e)}}},12551:(e,t,r)=>{"use strict";r.r(t),r.d(t,{Batch:()=>c.Batch,BatchCond:()=>c.BatchCond,BatchStep:()=>c.BatchStep,Client:()=>u.Client,ClientError:()=>i.ClientError,ClosedError:()=>i.ClosedError,Headers:()=>l.Headers,HttpClient:()=>a.HttpClient,HttpServerError:()=>i.HttpServerError,HttpStream:()=>m.HttpStream,InternalError:()=>i.InternalError,LibsqlUrlParseError:()=>i.LibsqlUrlParseError,MisuseError:()=>i.MisuseError,ProtoError:()=>i.ProtoError,ProtocolVersionError:()=>i.ProtocolVersionError,Request:()=>l.Request,ResponseError:()=>i.ResponseError,Sql:()=>p.Sql,Stmt:()=>h.Stmt,Stream:()=>f.Stream,WebSocket:()=>s.WebSocket,WebSocketError:()=>i.WebSocketError,WebSocketUnsupportedError:()=>i.WebSocketUnsupportedError,WsClient:()=>o.WsClient,WsStream:()=>g.WsStream,fetch:()=>l.fetch,openHttp:()=>b,openWs:()=>y,parseLibsqlUrl:()=>d.parseLibsqlUrl});var s=r(3923),o=r(85151),i=r(61629),a=r(74118),l=r(14937),u=r(22118),c=r(93714),d=r(4810),p=r(19530),h=r(32552),f=r(9712),m=r(45974),g=r(43340);function y(e,t,r=2){if(void 0===s.WebSocket)throw new i.WebSocketUnsupportedError("WebSockets are not supported in this environment");var a=void 0;a=3==r?Array.from(o.subprotocolsV3.keys()):Array.from(o.subprotocolsV2.keys());let l=new s.WebSocket(e,a);return new o.WsClient(l,t)}function b(e,t,r,s=2){return new a.HttpClient(e instanceof URL?e:new URL(e),t,r,s)}},4810:(e,t,r)=>{"use strict";r.r(t),r.d(t,{parseLibsqlUrl:()=>o});var s=r(61629);function o(e){let t,r,o,i;let a=new URL(e);for(let[e,t]of a.searchParams.entries())if("authToken"===e)o=t;else if("tls"===e){if("0"===t)i=!1;else if("1"===t)i=!0;else throw new s.LibsqlUrlParseError(`Unknown value for the "tls" query argument: ${JSON.stringify(t)}`)}else throw new s.LibsqlUrlParseError(`Unknown URL query argument ${JSON.stringify(e)}`);if(("http:"===a.protocol||"ws:"===a.protocol)&&!0===i)throw new s.LibsqlUrlParseError(`A ${JSON.stringify(a.protocol)} URL cannot opt into TLS using ?tls=1`);if(("https:"===a.protocol||"wss:"===a.protocol)&&!1===i)throw new s.LibsqlUrlParseError(`A ${JSON.stringify(a.protocol)} URL cannot opt out of TLS using ?tls=0`);if("http:"===a.protocol||"https:"===a.protocol)r=a.protocol;else if("ws:"===a.protocol||"wss:"===a.protocol)t=a.protocol;else if("libsql:"===a.protocol){if(!1===i){if(!a.port)throw new s.LibsqlUrlParseError('A "libsql:" URL with ?tls=0 must specify an explicit port');r="http:",t="ws:"}else r="https:",t="wss:"}else throw new s.LibsqlUrlParseError(`This client does not support ${JSON.stringify(a.protocol)} URLs. Please use a "libsql:", "ws:", "wss:", "http:" or "https:" URL instead.`);if(a.username||a.password)throw new s.LibsqlUrlParseError('This client does not support HTTP Basic authentication with a username and password. You can authenticate using a token passed in the "authToken" URL query parameter.');if(a.hash)throw new s.LibsqlUrlParseError("URL fragments are not supported");let l=a.pathname;return"/"===l&&(l=""),{hranaWsUrl:void 0!==t?`${t}//${a.host}${l}`:void 0,hranaHttpUrl:void 0!==r?`${r}//${a.host}${l}`:void 0,authToken:o}}},6813:(e,t,r)=>{"use strict";r.r(t),r.d(t,{Queue:()=>s});class s{#X;#ee;constructor(){this.#X=[],this.#ee=[]}get length(){return this.#X.length+this.#ee.length}push(e){this.#X.push(e)}shift(){return 0===this.#ee.length&&this.#X.length>0&&(this.#ee=this.#X.reverse(),this.#X=[]),this.#ee.pop()}first(){return 0!==this.#ee.length?this.#ee[this.#ee.length-1]:this.#X[0]}}},68194:(e,t,r)=>{"use strict";let s;if(r.r(t),r.d(t,{queueMicrotask:()=>s}),"undefined"!=typeof queueMicrotask)s=queueMicrotask;else{let e=Promise.resolve();s=t=>{e.then(t)}}},42945:(e,t,r)=>{"use strict";r.r(t),r.d(t,{errorFromProto:()=>d,rowResultFromProto:()=>l,rowsResultFromProto:()=>a,stmtResultFromProto:()=>i,valueResultFromProto:()=>u});var s=r(61629),o=r(57769);function i(e){return{affectedRowCount:e.affectedRowCount,lastInsertRowid:e.lastInsertRowid,columnNames:e.cols.map(e=>e.name),columnDecltypes:e.cols.map(e=>e.decltype)}}function a(e,t){let r=i(e),s=e.rows.map(e=>c(r.columnNames,e,t));return{...r,rows:s}}function l(e,t){let r;let s=i(e);return e.rows.length>0&&(r=c(s.columnNames,e.rows[0],t)),{...s,row:r}}function u(e,t){let r;let s=i(e);return e.rows.length>0&&s.columnNames.length>0&&(r=(0,o.valueFromProto)(e.rows[0][0],t)),{...s,value:r}}function c(e,t,r){let s={};Object.defineProperty(s,"length",{value:t.length});for(let i=0;i<t.length;++i){let a=(0,o.valueFromProto)(t[i],r);Object.defineProperty(s,i,{value:a});let l=e[i];void 0===l||Object.hasOwn(s,l)||Object.defineProperty(s,l,{value:a,enumerable:!0,configurable:!0,writable:!0})}return s}function d(e){return new s.ResponseError(e.message,e)}},79488:(e,t,r)=>{"use strict";r.r(t),r.d(t,{BatchResult:()=>c,CursorEntry:()=>d,DescribeResult:()=>p,Error:()=>a,StmtResult:()=>l,Value:()=>m});var s=r(13822),o=r(61629),i=r(7966);function a(e){return{message:i.string(e.message),code:i.stringOpt(e.code)}}function l(e){let t=i.arrayObjectsMap(e.cols,u),r=i.array(e.rows).map(e=>i.arrayObjectsMap(e,m)),s=i.number(e.affected_row_count),o=i.stringOpt(e.last_insert_rowid);return{cols:t,rows:r,affectedRowCount:s,lastInsertRowid:void 0!==o?BigInt(o):void 0}}function u(e){return{name:i.stringOpt(e.name),decltype:i.stringOpt(e.decltype)}}function c(e){let t=new Map;i.array(e.step_results).forEach((e,r)=>{null!==e&&t.set(r,l(i.object(e)))});let r=new Map;return i.array(e.step_errors).forEach((e,t)=>{null!==e&&r.set(t,a(i.object(e)))}),{stepResults:t,stepErrors:r}}function d(e){let t=i.string(e.type);if("step_begin"===t)return{type:"step_begin",step:i.number(e.step),cols:i.arrayObjectsMap(e.cols,u)};if("step_end"===t){let t=i.number(e.affected_row_count),r=i.stringOpt(e.last_insert_rowid);return{type:"step_end",affectedRowCount:t,lastInsertRowid:void 0!==r?BigInt(r):void 0}}if("step_error"===t)return{type:"step_error",step:i.number(e.step),error:a(i.object(e.error))};if("row"===t)return{type:"row",row:i.arrayObjectsMap(e.row,m)};if("error"===t)return{type:"error",error:a(i.object(e.error))};throw new o.ProtoError("Unexpected type of CursorEntry")}function p(e){let t=i.arrayObjectsMap(e.params,h);return{params:t,cols:i.arrayObjectsMap(e.cols,f),isExplain:i.boolean(e.is_explain),isReadonly:i.boolean(e.is_readonly)}}function h(e){return{name:i.stringOpt(e.name)}}function f(e){return{name:i.string(e.name),decltype:i.stringOpt(e.decltype)}}function m(e){let t=i.string(e.type);if("null"===t)return null;if("integer"===t)return BigInt(i.string(e.value));if("float"===t)return i.number(e.value);if("text"===t)return i.string(e.value);if("blob"===t)return s.DS.toUint8Array(i.string(e.base64));throw new o.ProtoError("Unexpected type of Value")}},97124:(e,t,r)=>{"use strict";r.r(t),r.d(t,{Batch:()=>l,Stmt:()=>i});var s=r(13822),o=r(93953);function i(e,t){void 0!==t.sql&&e.string("sql",t.sql),void 0!==t.sqlId&&e.number("sql_id",t.sqlId),e.arrayObjects("args",t.args,d),e.arrayObjects("named_args",t.namedArgs,a),e.boolean("want_rows",t.wantRows)}function a(e,t){e.string("name",t.name),e.object("value",t.value,d)}function l(e,t){e.arrayObjects("steps",t.steps,u)}function u(e,t){void 0!==t.condition&&e.object("condition",t.condition,c),e.object("stmt",t.stmt,i)}function c(e,t){if(e.stringRaw("type",t.type),"ok"===t.type||"error"===t.type)e.number("step",t.step);else if("not"===t.type)e.object("cond",t.cond,c);else if("and"===t.type||"or"===t.type)e.arrayObjects("conds",t.conds,c);else if("is_autocommit"===t.type);else throw(0,o.impossible)(t,"Impossible type of BatchCond")}function d(e,t){if(null===t)e.stringRaw("type","null");else if("bigint"==typeof t)e.stringRaw("type","integer"),e.stringRaw("value",""+t);else if("number"==typeof t)e.stringRaw("type","float"),e.number("value",t);else if("string"==typeof t)e.stringRaw("type","text"),e.string("value",t);else if(t instanceof Uint8Array)e.stringRaw("type","blob"),e.stringRaw("base64",s.DS.fromUint8Array(t));else if(void 0===t);else throw(0,o.impossible)(t,"Impossible type of Value")}},40186:(e,t,r)=>{"use strict";r.r(t)},81039:(e,t,r)=>{"use strict";r.r(t),r.d(t,{BatchResult:()=>l,CursorEntry:()=>d,DescribeResult:()=>m,Error:()=>s,StmtResult:()=>o});let s={default:()=>({message:"",code:void 0}),1(e,t){t.message=e.string()},2(e,t){t.code=e.string()}},o={default:()=>({cols:[],rows:[],affectedRowCount:0,lastInsertRowid:void 0}),1(e,t){t.cols.push(e.message(i))},2(e,t){t.rows.push(e.message(a))},3(e,t){t.affectedRowCount=Number(e.uint64())},4(e,t){t.lastInsertRowid=e.sint64()}},i={default:()=>({name:void 0,decltype:void 0}),1(e,t){t.name=e.string()},2(e,t){t.decltype=e.string()}},a={default:()=>[],1(e,t){t.push(e.message(b))}},l={default:()=>({stepResults:new Map,stepErrors:new Map}),1(e,t){let[r,s]=e.message(u);t.stepResults.set(r,s)},2(e,t){let[r,s]=e.message(c);t.stepErrors.set(r,s)}},u={default:()=>[0,o.default()],1(e,t){t[0]=e.uint32()},2(e,t){t[1]=e.message(o)}},c={default:()=>[0,s.default()],1(e,t){t[0]=e.uint32()},2(e,t){t[1]=e.message(s)}},d={default:()=>({type:"none"}),1:e=>e.message(p),2:e=>e.message(h),3:e=>e.message(f),4:e=>({type:"row",row:e.message(a)}),5:e=>({type:"error",error:e.message(s)})},p={default:()=>({type:"step_begin",step:0,cols:[]}),1(e,t){t.step=e.uint32()},2(e,t){t.cols.push(e.message(i))}},h={default:()=>({type:"step_end",affectedRowCount:0,lastInsertRowid:void 0}),1(e,t){t.affectedRowCount=e.uint32()},2(e,t){t.lastInsertRowid=e.uint64()}},f={default:()=>({type:"step_error",step:0,error:s.default()}),1(e,t){t.step=e.uint32()},2(e,t){t.error=e.message(s)}},m={default:()=>({params:[],cols:[],isExplain:!1,isReadonly:!1}),1(e,t){t.params.push(e.message(g))},2(e,t){t.cols.push(e.message(y))},3(e,t){t.isExplain=e.bool()},4(e,t){t.isReadonly=e.bool()}},g={default:()=>({name:void 0}),1(e,t){t.name=e.string()}},y={default:()=>({name:"",decltype:void 0}),1(e,t){t.name=e.string()},2(e,t){t.decltype=e.string()}},b={default(){},1:e=>null,2:e=>e.sint64(),3:e=>e.double(),4:e=>e.string(),5:e=>e.bytes()}},43153:(e,t,r)=>{"use strict";r.r(t),r.d(t,{Batch:()=>a,Stmt:()=>o});var s=r(93953);function o(e,t){for(let r of(void 0!==t.sql&&e.string(1,t.sql),void 0!==t.sqlId&&e.int32(2,t.sqlId),t.args))e.message(3,r,d);for(let r of t.namedArgs)e.message(4,r,i);e.bool(5,t.wantRows)}function i(e,t){e.string(1,t.name),e.message(2,t.value,d)}function a(e,t){for(let r of t.steps)e.message(1,r,l)}function l(e,t){void 0!==t.condition&&e.message(1,t.condition,u),e.message(2,t.stmt,o)}function u(e,t){if("ok"===t.type)e.uint32(1,t.step);else if("error"===t.type)e.uint32(2,t.step);else if("not"===t.type)e.message(3,t.cond,u);else if("and"===t.type)e.message(4,t.conds,c);else if("or"===t.type)e.message(5,t.conds,c);else if("is_autocommit"===t.type)e.message(6,void 0,p);else throw(0,s.impossible)(t,"Impossible type of BatchCond")}function c(e,t){for(let r of t)e.message(1,r,u)}function d(e,t){if(null===t)e.message(1,void 0,p);else if("bigint"==typeof t)e.sint64(2,t);else if("number"==typeof t)e.double(3,t);else if("string"==typeof t)e.string(4,t);else if(t instanceof Uint8Array)e.bytes(5,t);else if(void 0===t);else throw(0,s.impossible)(t,"Impossible type of Value")}function p(e,t){}},19530:(e,t,r)=>{"use strict";r.r(t),r.d(t,{Sql:()=>o,sqlToProto:()=>i});var s=r(61629);class o{#et;#er;#E;constructor(e,t){this.#et=e,this.#er=t,this.#E=void 0}_getSqlId(e){if(this.#et!==e)throw new s.MisuseError("Attempted to use SQL text opened with other object");if(void 0!==this.#E)throw new s.ClosedError("SQL text is closed",this.#E);return this.#er}close(){this._setClosed(new s.ClientError("SQL text was manually closed"))}_setClosed(e){void 0===this.#E&&(this.#E=e,this.#et._closeSql(this.#er))}get closed(){return void 0!==this.#E}}function i(e,t){return t instanceof o?{sqlId:t._getSqlId(e)}:{sql:""+t}}},32552:(e,t,r)=>{"use strict";r.r(t),r.d(t,{Stmt:()=>i,stmtToProto:()=>a});var s=r(19530),o=r(57769);class i{sql;_args;_namedArgs;constructor(e){this.sql=e,this._args=[],this._namedArgs=new Map}bindIndexes(e){for(let t of(this._args.length=0,e))this._args.push((0,o.valueToProto)(t));return this}bindIndex(e,t){if(e!==(0|e)||e<=0)throw RangeError("Index of a positional argument must be positive integer");for(;this._args.length<e;)this._args.push(null);return this._args[e-1]=(0,o.valueToProto)(t),this}bindName(e,t){return this._namedArgs.set(e,(0,o.valueToProto)(t)),this}unbindAll(){return this._args.length=0,this._namedArgs.clear(),this}}function a(e,t,r){let a;let l=[],u=[];if(t instanceof i)for(let[e,r]of(a=t.sql,l=t._args,t._namedArgs.entries()))u.push({name:e,value:r});else Array.isArray(t)?(a=t[0],Array.isArray(t[1])?l=t[1].map(e=>(0,o.valueToProto)(e)):u=Object.entries(t[1]).map(([e,t])=>({name:e,value:(0,o.valueToProto)(t)}))):a=t;let{sql:c,sqlId:d}=(0,s.sqlToProto)(e,a);return{sql:c,sqlId:d,args:l,namedArgs:u,wantRows:r}}},9712:(e,t,r)=>{"use strict";r.r(t),r.d(t,{Stream:()=>u});var s=r(93714),o=r(81225),i=r(42945),a=r(19530),l=r(32552);class u{constructor(e){this.intMode=e}query(e){return this.#es(e,!0,i.rowsResultFromProto)}queryRow(e){return this.#es(e,!0,i.rowResultFromProto)}queryValue(e){return this.#es(e,!0,i.valueResultFromProto)}run(e){return this.#es(e,!1,i.stmtResultFromProto)}#es(e,t,r){let s=(0,l.stmtToProto)(this._sqlOwner(),e,t);return this._execute(s).then(e=>r(e,this.intMode))}batch(e=!1){return new s.Batch(this,e)}describe(e){let t=(0,a.sqlToProto)(this._sqlOwner(),e);return this._describe(t).then(o.describeResultFromProto)}sequence(e){let t=(0,a.sqlToProto)(this._sqlOwner(),e);return this._sequence(t)}intMode}},93953:(e,t,r)=>{"use strict";r.r(t),r.d(t,{impossible:()=>o});var s=r(61629);function o(e,t){throw new s.InternalError(t)}},57769:(e,t,r)=>{"use strict";r.r(t),r.d(t,{valueFromProto:()=>u,valueToProto:()=>i});var s=r(61629),o=r(93953);function i(e){if(null===e)return null;if("string"==typeof e)return e;if("number"==typeof e){if(!Number.isFinite(e))throw RangeError("Only finite numbers (not Infinity or NaN) can be passed as arguments");return e}if("bigint"==typeof e){if(e<a||e>l)throw RangeError("This bigint value is too large to be represented as a 64-bit integer and passed as argument");return e}if("boolean"==typeof e)return e?1n:0n;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(e instanceof Uint8Array)return e;else if(e instanceof Date)return+e.valueOf();else if("object"==typeof e)return""+e.toString();else throw TypeError("Unsupported type of value")}let a=-0x8000000000000000n,l=0x7fffffffffffffffn;function u(e,t){if(null===e)return null;if("number"==typeof e||"string"==typeof e)return e;if("bigint"==typeof e){if("number"===t){let t=Number(e);if(!Number.isSafeInteger(t))throw RangeError("Received integer which is too large to be safely represented as a JavaScript number");return t}if("bigint"===t)return e;if("string"===t)return""+e;throw new s.MisuseError("Invalid value for IntMode")}if(e instanceof Uint8Array)return e.slice().buffer;if(void 0===e)throw new s.ProtoError("Received unrecognized type of Value");throw(0,o.impossible)(e,"Impossible type of Value")}},85151:(e,t,r)=>{"use strict";r.r(t),r.d(t,{WsClient:()=>b,subprotocolsV2:()=>g,subprotocolsV3:()=>y});var s=r(22118),o=r(11517),i=r(61629),a=r(5147),l=r(42945),u=r(19530),c=r(93953),d=r(43340),p=r(29649),h=r(52561),f=r(31955),m=r(73853);let g=new Map([["hrana2",{version:2,encoding:"json"}],["hrana1",{version:1,encoding:"json"}]]),y=new Map([["hrana3-protobuf",{version:3,encoding:"protobuf"}],["hrana3",{version:3,encoding:"json"}],["hrana2",{version:2,encoding:"json"}],["hrana1",{version:1,encoding:"json"}]]);class b extends s.Client{#en;#eo;#ei;#E;#ea;#el;#eu;#ec;#ed;_streamIdAlloc;_cursorIdAlloc;#B;constructor(e,t){super(),this.#en=e,this.#eo=[],this.#ei=!1,this.#E=void 0,this.#ea=!1,this.#el=void 0,this.#eu=!1,this.#ec=new Map,this.#ed=new a.IdAlloc,this._streamIdAlloc=new a.IdAlloc,this._cursorIdAlloc=new a.IdAlloc,this.#B=new a.IdAlloc,this.#en.binaryType="arraybuffer",this.#en.addEventListener("open",()=>this.#ep()),this.#en.addEventListener("close",e=>this.#eh(e)),this.#en.addEventListener("error",e=>this.#ef(e)),this.#en.addEventListener("message",e=>this.#em(e)),this.#eg({type:"hello",jwt:t})}#eg(e){if(void 0!==this.#E)throw new i.InternalError("Trying to send a message on a closed client");this.#ei?this.#ey(e):this.#eo.push({openCallback:()=>this.#ey(e),errorCallback:()=>void 0})}#ep(){let e=this.#en.protocol;if(void 0===e){this.#I(new i.ClientError("The `WebSocket.protocol` property is undefined. This most likely means that the WebSocket implementation provided by the environment is broken. If you are using Miniflare 2, please update to Miniflare 3, which fixes this problem."));return}if(""===e)this.#el={version:1,encoding:"json"};else if(this.#el=y.get(e),void 0===this.#el){this.#I(new i.ProtoError(`Unrecognized WebSocket subprotocol: ${JSON.stringify(e)}`));return}for(let e of this.#eo)e.openCallback();this.#eo.length=0,this.#ei=!0}#ey(e){let t=this.#el.encoding;if("json"===t){let t=(0,o.writeJsonObject)(e,p.ClientMsg);this.#en.send(t)}else if("protobuf"===t){let t=(0,o.writeProtobufMessage)(e,h.ClientMsg);this.#en.send(t)}else throw(0,c.impossible)(t,"Impossible encoding")}getVersion(){return new Promise((e,t)=>{this.#eu=!0,void 0!==this.#E?t(this.#E):this.#ei?e(this.#el.version):this.#eo.push({openCallback:()=>e(this.#el.version),errorCallback:t})})}_ensureVersion(e,t){if(void 0!==this.#el&&this.#eu){if(this.#el.version<e)throw new i.ProtocolVersionError(`${t} is supported on protocol version ${e} and higher, but the WebSocket server only supports version ${this.#el.version}`)}else throw new i.ProtocolVersionError(`${t} is supported only on protocol version ${e} and higher, but the version supported by the WebSocket server is not yet known. Use Client.getVersion() to wait until the version is available.`)}_sendRequest(e,t){if(void 0!==this.#E){t.errorCallback(new i.ClosedError("Client is closed",this.#E));return}let r=this.#ed.alloc();this.#ec.set(r,{...t,type:e.type}),this.#eg({type:"request",requestId:r,request:e})}#ef(e){let t=e.message;this.#I(new i.WebSocketError(t??"WebSocket was closed due to an error"))}#eh(e){let t=`WebSocket was closed with code ${e.code}`;e.reason&&(t+=`: ${e.reason}`),this.#I(new i.WebSocketError(t))}#I(e){if(void 0===this.#E){for(let t of(this.#E=e,this.#eo))t.errorCallback(e);for(let[t,r]of(this.#eo.length=0,this.#ec.entries()))r.errorCallback(e),this.#ed.free(t);this.#ec.clear(),this.#en.close()}}#em(e){if(void 0===this.#E)try{let t;let r=this.#el.encoding;if("json"===r){if("string"!=typeof e.data){this.#en.close(3003,"Only text messages are accepted with JSON encoding"),this.#I(new i.ProtoError("Received non-text message from server with JSON encoding"));return}t=(0,o.readJsonObject)(JSON.parse(e.data),f.ServerMsg)}else if("protobuf"===r){if(!(e.data instanceof ArrayBuffer)){this.#en.close(3003,"Only binary messages are accepted with Protobuf encoding"),this.#I(new i.ProtoError("Received non-binary message from server with Protobuf encoding"));return}t=(0,o.readProtobufMessage)(new Uint8Array(e.data),m.ServerMsg)}else throw(0,c.impossible)(r,"Impossible encoding");this.#eb(t)}catch(e){this.#en.close(3007,"Could not handle message"),this.#I(e)}}#eb(e){if("none"===e.type)throw new i.ProtoError("Received an unrecognized ServerMsg");if("hello_ok"===e.type||"hello_error"===e.type){if(this.#ea)throw new i.ProtoError("Received a duplicated hello response");if(this.#ea=!0,"hello_error"===e.type)throw(0,l.errorFromProto)(e.error);return}if(!this.#ea)throw new i.ProtoError("Received a non-hello message before a hello response");if("response_ok"===e.type){let t=e.requestId,r=this.#ec.get(t);if(this.#ec.delete(t),void 0===r)throw new i.ProtoError("Received unexpected OK response");this.#ed.free(t);try{if(r.type!==e.response.type)throw console.dir({responseState:r,msg:e}),new i.ProtoError("Received unexpected type of response");r.responseCallback(e.response)}catch(e){throw r.errorCallback(e),e}}else if("response_error"===e.type){let t=e.requestId,r=this.#ec.get(t);if(this.#ec.delete(t),void 0===r)throw new i.ProtoError("Received unexpected error response");this.#ed.free(t),r.errorCallback((0,l.errorFromProto)(e.error))}else throw(0,c.impossible)(e,"Impossible ServerMsg type")}openStream(){return d.WsStream.open(this)}storeSql(e){this._ensureVersion(2,"storeSql()");let t=this.#B.alloc(),r=new u.Sql(this,t);return this._sendRequest({type:"store_sql",sqlId:t,sql:e},{responseCallback:()=>void 0,errorCallback:e=>r._setClosed(e)}),r}_closeSql(e){void 0===this.#E&&this._sendRequest({type:"close_sql",sqlId:e},{responseCallback:()=>this.#B.free(e),errorCallback:e=>this.#I(e)})}close(){this.#I(new i.ClientError("Client was manually closed"))}get closed(){return void 0!==this.#E}}},39479:(e,t,r)=>{"use strict";r.r(t),r.d(t,{WsCursor:()=>a});var s=r(61629),o=r(10100),i=r(6813);class a extends o.Cursor{#N;#O;#e_;#ev;#ew;#E;#C;constructor(e,t,r){super(),this.#N=e,this.#O=t,this.#e_=r,this.#ev=new i.Queue,this.#ew=new i.Queue,this.#E=void 0,this.#C=!1}async next(){for(;;){if(void 0!==this.#E)throw new s.ClosedError("Cursor is closed",this.#E);for(;!this.#C&&this.#ew.length<10;)this.#ew.push(this.#S());let e=this.#ev.shift();if(this.#C||void 0!==e)return e;await this.#ew.shift().then(e=>{if(void 0!==e){for(let t of e.entries)this.#ev.push(t);this.#C||=e.done}})}}#S(){return this.#O._sendCursorRequest(this,{type:"fetch_cursor",cursorId:this.#e_,maxCount:1e3}).then(e=>e,e=>{this._setClosed(e)})}_setClosed(e){void 0===this.#E&&(this.#E=e,this.#O._sendCursorRequest(this,{type:"close_cursor",cursorId:this.#e_}).catch(()=>void 0),this.#O._cursorClosed(this))}close(){this._setClosed(new s.ClientError("Cursor was manually closed"))}get closed(){return void 0!==this.#E}}},31955:(e,t,r)=>{"use strict";r.r(t),r.d(t,{ServerMsg:()=>a});var s=r(61629),o=r(7966),i=r(79488);function a(e){let t=o.string(e.type);if("hello_ok"===t)return{type:"hello_ok"};if("hello_error"===t)return{type:"hello_error",error:(0,i.Error)(o.object(e.error))};if("response_ok"===t)return{type:"response_ok",requestId:o.number(e.request_id),response:function(e){let t=o.string(e.type);if("open_stream"===t)return{type:"open_stream"};if("close_stream"===t)return{type:"close_stream"};if("execute"===t)return{type:"execute",result:(0,i.StmtResult)(o.object(e.result))};if("batch"===t)return{type:"batch",result:(0,i.BatchResult)(o.object(e.result))};if("open_cursor"===t)return{type:"open_cursor"};if("close_cursor"===t)return{type:"close_cursor"};if("fetch_cursor"===t)return{type:"fetch_cursor",entries:o.arrayObjectsMap(e.entries,i.CursorEntry),done:o.boolean(e.done)};else if("sequence"===t)return{type:"sequence"};else if("describe"===t)return{type:"describe",result:(0,i.DescribeResult)(o.object(e.result))};else if("store_sql"===t)return{type:"store_sql"};else if("close_sql"===t)return{type:"close_sql"};else if("get_autocommit"===t)return{type:"get_autocommit",isAutocommit:o.boolean(e.is_autocommit)};else throw new s.ProtoError("Unexpected type of Response")}(o.object(e.response))};if("response_error"===t)return{type:"response_error",requestId:o.number(e.request_id),error:(0,i.Error)(o.object(e.error))};throw new s.ProtoError("Unexpected type of ServerMsg")}},29649:(e,t,r)=>{"use strict";r.r(t),r.d(t,{ClientMsg:()=>i});var s=r(97124),o=r(93953);function i(e,t){if(e.stringRaw("type",t.type),"hello"===t.type)void 0!==t.jwt&&e.string("jwt",t.jwt);else if("request"===t.type)e.number("request_id",t.requestId),e.object("request",t.request,a);else throw(0,o.impossible)(t,"Impossible type of ClientMsg")}function a(e,t){if(e.stringRaw("type",t.type),"open_stream"===t.type)e.number("stream_id",t.streamId);else if("close_stream"===t.type)e.number("stream_id",t.streamId);else if("execute"===t.type)e.number("stream_id",t.streamId),e.object("stmt",t.stmt,s.Stmt);else if("batch"===t.type)e.number("stream_id",t.streamId),e.object("batch",t.batch,s.Batch);else if("open_cursor"===t.type)e.number("stream_id",t.streamId),e.number("cursor_id",t.cursorId),e.object("batch",t.batch,s.Batch);else if("close_cursor"===t.type)e.number("cursor_id",t.cursorId);else if("fetch_cursor"===t.type)e.number("cursor_id",t.cursorId),e.number("max_count",t.maxCount);else if("sequence"===t.type)e.number("stream_id",t.streamId),void 0!==t.sql&&e.string("sql",t.sql),void 0!==t.sqlId&&e.number("sql_id",t.sqlId);else if("describe"===t.type)e.number("stream_id",t.streamId),void 0!==t.sql&&e.string("sql",t.sql),void 0!==t.sqlId&&e.number("sql_id",t.sqlId);else if("store_sql"===t.type)e.number("sql_id",t.sqlId),e.string("sql",t.sql);else if("close_sql"===t.type)e.number("sql_id",t.sqlId);else if("get_autocommit"===t.type)e.number("stream_id",t.streamId);else throw(0,o.impossible)(t,"Impossible type of Request")}},37137:(e,t,r)=>{"use strict";r.r(t)},73853:(e,t,r)=>{"use strict";r.r(t),r.d(t,{ServerMsg:()=>o});var s=r(81039);let o={default:()=>({type:"none"}),1:e=>({type:"hello_ok"}),2:e=>e.message(i),3:e=>e.message(l),4:e=>e.message(a)},i={default:()=>({type:"hello_error",error:s.Error.default()}),1(e,t){t.error=e.message(s.Error)}},a={default:()=>({type:"response_error",requestId:0,error:s.Error.default()}),1(e,t){t.requestId=e.int32()},2(e,t){t.error=e.message(s.Error)}},l={default:()=>({type:"response_ok",requestId:0,response:{type:"none"}}),1(e,t){t.requestId=e.int32()},2(e,t){t.response={type:"open_stream"}},3(e,t){t.response={type:"close_stream"}},4(e,t){t.response=e.message(u)},5(e,t){t.response=e.message(c)},6(e,t){t.response={type:"open_cursor"}},7(e,t){t.response={type:"close_cursor"}},8(e,t){t.response=e.message(d)},9(e,t){t.response={type:"sequence"}},10(e,t){t.response=e.message(p)},11(e,t){t.response={type:"store_sql"}},12(e,t){t.response={type:"close_sql"}},13(e,t){t.response=e.message(h)}},u={default:()=>({type:"execute",result:s.StmtResult.default()}),1(e,t){t.result=e.message(s.StmtResult)}},c={default:()=>({type:"batch",result:s.BatchResult.default()}),1(e,t){t.result=e.message(s.BatchResult)}},d={default:()=>({type:"fetch_cursor",entries:[],done:!1}),1(e,t){t.entries.push(e.message(s.CursorEntry))},2(e,t){t.done=e.bool()}},p={default:()=>({type:"describe",result:s.DescribeResult.default()}),1(e,t){t.result=e.message(s.DescribeResult)}},h={default:()=>({type:"get_autocommit",isAutocommit:!1}),1(e,t){t.isAutocommit=e.bool()}}},52561:(e,t,r)=>{"use strict";r.r(t),r.d(t,{ClientMsg:()=>i});var s=r(43153),o=r(93953);function i(e,t){if("hello"===t.type)e.message(1,t,a);else if("request"===t.type)e.message(2,t,l);else throw(0,o.impossible)(t,"Impossible type of ClientMsg")}function a(e,t){void 0!==t.jwt&&e.string(1,t.jwt)}function l(e,t){e.int32(1,t.requestId);let r=t.request;if("open_stream"===r.type)e.message(2,r,u);else if("close_stream"===r.type)e.message(3,r,c);else if("execute"===r.type)e.message(4,r,d);else if("batch"===r.type)e.message(5,r,p);else if("open_cursor"===r.type)e.message(6,r,h);else if("close_cursor"===r.type)e.message(7,r,f);else if("fetch_cursor"===r.type)e.message(8,r,m);else if("sequence"===r.type)e.message(9,r,g);else if("describe"===r.type)e.message(10,r,y);else if("store_sql"===r.type)e.message(11,r,b);else if("close_sql"===r.type)e.message(12,r,_);else if("get_autocommit"===r.type)e.message(13,r,v);else throw(0,o.impossible)(r,"Impossible type of Request")}function u(e,t){e.int32(1,t.streamId)}function c(e,t){e.int32(1,t.streamId)}function d(e,t){e.int32(1,t.streamId),e.message(2,t.stmt,s.Stmt)}function p(e,t){e.int32(1,t.streamId),e.message(2,t.batch,s.Batch)}function h(e,t){e.int32(1,t.streamId),e.int32(2,t.cursorId),e.message(3,t.batch,s.Batch)}function f(e,t){e.int32(1,t.cursorId)}function m(e,t){e.int32(1,t.cursorId),e.uint32(2,t.maxCount)}function g(e,t){e.int32(1,t.streamId),void 0!==t.sql&&e.string(2,t.sql),void 0!==t.sqlId&&e.int32(3,t.sqlId)}function y(e,t){e.int32(1,t.streamId),void 0!==t.sql&&e.string(2,t.sql),void 0!==t.sqlId&&e.int32(3,t.sqlId)}function b(e,t){e.int32(1,t.sqlId),e.string(2,t.sql)}function _(e,t){e.int32(1,t.sqlId)}function v(e,t){e.int32(1,t.streamId)}},43340:(e,t,r)=>{"use strict";r.r(t),r.d(t,{WsStream:()=>l});var s=r(61629),o=r(6813),i=r(9712),a=r(39479);class l extends i.Stream{#N;#ex;#j;#$;#D;#E;static open(e){let t=e._streamIdAlloc.alloc(),r=new l(e,t);return e._sendRequest({type:"open_stream",streamId:t},{responseCallback:()=>void 0,errorCallback:e=>r.#I(e)}),r}constructor(e,t){super(e.intMode),this.#N=e,this.#ex=t,this.#j=new o.Queue,this.#$=void 0,this.#D=!1,this.#E=void 0}client(){return this.#N}_sqlOwner(){return this.#N}_execute(e){return this.#F({type:"execute",streamId:this.#ex,stmt:e}).then(e=>e.result)}_batch(e){return this.#F({type:"batch",streamId:this.#ex,batch:e}).then(e=>e.result)}_describe(e){return this.#N._ensureVersion(2,"describe()"),this.#F({type:"describe",streamId:this.#ex,sql:e.sql,sqlId:e.sqlId}).then(e=>e.result)}_sequence(e){return this.#N._ensureVersion(2,"sequence()"),this.#F({type:"sequence",streamId:this.#ex,sql:e.sql,sqlId:e.sqlId}).then(e=>{})}getAutocommit(){return this.#N._ensureVersion(3,"getAutocommit()"),this.#F({type:"get_autocommit",streamId:this.#ex}).then(e=>e.isAutocommit)}#F(e){return new Promise((t,r)=>{this.#V({type:"request",request:e,responseCallback:t,errorCallback:r})})}_openCursor(e){return this.#N._ensureVersion(3,"cursor"),new Promise((t,r)=>{this.#V({type:"cursor",batch:e,cursorCallback:t,errorCallback:r})})}_sendCursorRequest(e,t){if(e!==this.#$)throw new s.InternalError("Cursor not associated with the stream attempted to execute a request");return new Promise((e,r)=>{void 0!==this.#E?r(new s.ClosedError("Stream is closed",this.#E)):this.#N._sendRequest(t,{responseCallback:e,errorCallback:r})})}_cursorClosed(e){if(e!==this.#$)throw new s.InternalError("Cursor was closed, but it was not associated with the stream");this.#$=void 0,this.#W()}#V(e){void 0!==this.#E?e.errorCallback(new s.ClosedError("Stream is closed",this.#E)):this.#D?e.errorCallback(new s.ClosedError("Stream is closing",void 0)):(this.#j.push(e),this.#W())}#W(){for(;;){let e=this.#j.first();if(void 0===e&&void 0===this.#$&&this.#D){this.#I(new s.ClientError("Stream was gracefully closed"));break}if(e?.type==="request"&&void 0===this.#$){let{request:t,responseCallback:r,errorCallback:s}=e;this.#j.shift(),this.#N._sendRequest(t,{responseCallback:r,errorCallback:s})}else if(e?.type==="cursor"&&void 0===this.#$){let{batch:t,cursorCallback:r}=e;this.#j.shift();let s=this.#N._cursorIdAlloc.alloc(),o=new a.WsCursor(this.#N,this,s),i={type:"open_cursor",streamId:this.#ex,cursorId:s,batch:t},l=()=>void 0,u=e=>o._setClosed(e);this.#N._sendRequest(i,{responseCallback:l,errorCallback:u}),this.#$=o,r(o)}else break}}#I(e){if(void 0!==this.#E)return;for(this.#E=e,void 0!==this.#$&&this.#$._setClosed(e);;){let t=this.#j.shift();if(void 0!==t)t.errorCallback(e);else break}let t={type:"close_stream",streamId:this.#ex};this.#N._sendRequest(t,{responseCallback:()=>this.#N._streamIdAlloc.free(this.#ex),errorCallback:()=>void 0})}close(){this.#I(new s.ClientError("Stream was manually closed"))}closeGracefully(){this.#D=!0,this.#W()}get closed(){return void 0!==this.#E||this.#D}}},14937:(e,t,r)=>{"use strict";r.r(t),r.d(t,{Headers:()=>o,Request:()=>s,fetch:()=>i});let s=Request,o=Headers,i=fetch},43254:(e,t,r)=>{"use strict";r.r(t),r.d(t,{Headers:()=>i,Request:()=>o,fetch:()=>s});let s=fetch,o=Request,i=Headers},3923:(e,t,r)=>{"use strict";r.r(t),r.d(t,{WebSocket:()=>s.XY});var s=r(1559)},61632:(e,t,r)=>{"use strict";let s;r.r(t),r.d(t,{WebSocket:()=>s}),"undefined"!=typeof WebSocket?s=WebSocket:"undefined"!=typeof global?s=global.WebSocket:"undefined"!=typeof window?s=window.WebSocket:"undefined"!=typeof self&&(s=self.WebSocket)},25665:(e,t,r)=>{"use strict";r.d(t,{i:()=>i});var s=r(6746),o=r(65987),i=class extends o.o{static TABLE_WORKFLOW_SNAPSHOT=s.vP;static TABLE_EVALS=s.a4;static TABLE_MESSAGES=s.Zb;static TABLE_THREADS=s.i1;static TABLE_TRACES=s.Xd;hasInitialized=null;constructor({name:e}){super({component:"STORAGE",name:e})}async __batchInsert({tableName:e,records:t}){return await this.init(),this.batchInsert({tableName:e,records:t})}async __getThreadById({threadId:e}){return await this.init(),this.getThreadById({threadId:e})}async __getThreadsByResourceId({resourceId:e}){return await this.init(),this.getThreadsByResourceId({resourceId:e})}async __saveThread({thread:e}){return await this.init(),this.saveThread({thread:e})}async __updateThread({id:e,title:t,metadata:r}){return await this.init(),this.updateThread({id:e,title:t,metadata:r})}async __deleteThread({threadId:e}){return await this.init(),this.deleteThread({threadId:e})}async __getMessages({threadId:e,selectBy:t,threadConfig:r}){return await this.init(),this.getMessages({threadId:e,selectBy:t,threadConfig:r})}async __saveMessages({messages:e}){return await this.init(),this.saveMessages({messages:e})}async __getTraces({scope:e,page:t,perPage:r,attributes:s}){return await this.init(),this.getTraces({scope:e,page:t,perPage:r,attributes:s})}async init(){await this.hasInitialized||(this.hasInitialized=Promise.all([this.createTable({tableName:s.vP,schema:{workflow_name:{type:"text"},run_id:{type:"text"},snapshot:{type:"text"},createdAt:{type:"timestamp"},updatedAt:{type:"timestamp"}}}),this.createTable({tableName:s.a4,schema:{input:{type:"text"},output:{type:"text"},result:{type:"jsonb"},agent_name:{type:"text"},metric_name:{type:"text"},instructions:{type:"text"},test_info:{type:"jsonb",nullable:!0},global_run_id:{type:"text"},run_id:{type:"text"},created_at:{type:"timestamp"}}}),this.createTable({tableName:s.i1,schema:{id:{type:"text",nullable:!1,primaryKey:!0},resourceId:{type:"text",nullable:!1},title:{type:"text",nullable:!1},metadata:{type:"text",nullable:!0},createdAt:{type:"timestamp",nullable:!1},updatedAt:{type:"timestamp",nullable:!1}}}),this.createTable({tableName:s.Zb,schema:{id:{type:"text",nullable:!1,primaryKey:!0},thread_id:{type:"text",nullable:!1},content:{type:"text",nullable:!1},role:{type:"text",nullable:!1},type:{type:"text",nullable:!1},createdAt:{type:"timestamp",nullable:!1}}}),this.createTable({tableName:s.Xd,schema:{id:{type:"text",nullable:!1,primaryKey:!0},parentSpanId:{type:"text",nullable:!0},name:{type:"text",nullable:!1},traceId:{type:"text",nullable:!1},scope:{type:"text",nullable:!1},kind:{type:"integer",nullable:!1},attributes:{type:"jsonb",nullable:!0},status:{type:"jsonb",nullable:!0},events:{type:"jsonb",nullable:!0},links:{type:"jsonb",nullable:!0},other:{type:"text",nullable:!0},startTime:{type:"bigint",nullable:!1},endTime:{type:"bigint",nullable:!1},createdAt:{type:"timestamp",nullable:!1}}})]).then(()=>!0),await this.hasInitialized)}async persistWorkflowSnapshot({workflowName:e,runId:t,snapshot:r}){await this.init();let o={workflow_name:e,run_id:t,snapshot:r,createdAt:new Date,updatedAt:new Date};this.logger.debug("Persisting workflow snapshot",{workflowName:e,runId:t,data:o}),await this.insert({tableName:s.vP,record:o})}async loadWorkflowSnapshot({workflowName:e,runId:t}){this.hasInitialized||await this.init(),this.logger.debug("Loading workflow snapshot",{workflowName:e,runId:t});let r=await this.load({tableName:s.vP,keys:{workflow_name:e,run_id:t}});return r?r.snapshot:null}async __getEvalsByAgentName(e,t){return await this.init(),this.getEvalsByAgentName(e,t)}}},69087:(e,t,r)=>{"use strict";r.d(t,{h8:()=>tq,h4:()=>tN});var s,o,i=r(65987),a=r(99397),l=r(25386),u=r(14586),c=r(15673);let d=(e,t,r)=>{let s=t.split(/[\.\[\]]/g),o=e;for(let e of s){if(null==o)return r;let t=e.replace(/['"]/g,"");""!==t.trim()&&(o=o[t])}return void 0===o?r:o};var p=function(e,t){return(p=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)};function h(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}p(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}"function"==typeof SuppressedError&&SuppressedError;var f=function(e){var t="[object "+e+"]";return function(e){return m(e)===t}},m=function(e){return Object.prototype.toString.call(e)},g=function(e){return e instanceof Date?e.getTime():y(e)?e.map(g):e&&"function"==typeof e.toJSON?e.toJSON():e},y=f("Array"),b=f("Object"),_=f("Function"),v=function(e,t){if(null==e&&e==t||e===t)return!0;if(Object.prototype.toString.call(e)!==Object.prototype.toString.call(t))return!1;if(y(e)){if(e.length!==t.length)return!1;for(var r=0,s=e.length;r<s;r++)if(!v(e[r],t[r]))return!1;return!0}if(b(e)){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(var o in e)if(!v(e[o],t[o]))return!1;return!0}return!1},w=function(e,t,r,s,o,i){var a=t[s];if(y(e)&&isNaN(Number(a))&&(!e.hasOwnProperty(a)||_(e[a]))){for(var l=0,u=e.length;l<u;l++)if(!w(e[l],t,r,s,l,e))return!1}return s===t.length||null==e?r(e,o,i,0===s,s===t.length):w(e[a],t,r,s+1,a,e)},S=function(){function e(e,t,r,s){this.params=e,this.owneryQuery=t,this.options=r,this.name=s,this.init()}return e.prototype.init=function(){},e.prototype.reset=function(){this.done=!1,this.keep=!1},e}(),E=function(e){function t(t,r,s,o){var i=e.call(this,t,r,s)||this;return i.children=o,i}return h(t,e),t.prototype.reset=function(){this.keep=!1,this.done=!1;for(var e=0,t=this.children.length;e<t;e++)this.children[e].reset()},t.prototype.childrenNext=function(e,t,r,s,o){for(var i=!0,a=!0,l=0,u=this.children.length;l<u;l++){var c=this.children[l];if(c.done||c.next(e,t,r,s,o),c.keep||(a=!1),c.done){if(!c.keep)break}else i=!1}this.done=i,this.keep=a},t}(S),k=function(e){function t(t,r,s,o,i){var a=e.call(this,t,r,s,o)||this;return a.name=i,a}return h(t,e),t}(E),I=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.propop=!0,t}return h(t,e),t.prototype.next=function(e,t,r,s){this.childrenNext(e,t,r,s)},t}(E),O=function(e){function t(t,r,s,o,i){var a=e.call(this,r,s,o,i)||this;return a.keyPath=t,a.propop=!0,a._nextNestedValue=function(e,t,r,s,o){return a.childrenNext(e,t,r,s,o),!a.done},a}return h(t,e),t.prototype.next=function(e,t,r){w(e,this.keyPath,this._nextNestedValue,0,t,r)},t}(E),T=function(e,t){if(e instanceof Function)return e;if(e instanceof RegExp)return function(t){var r="string"==typeof t&&e.test(t);return e.lastIndex=0,r};var r=g(e);return function(e){return t(r,g(e))}},j=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.propop=!0,t}return h(t,e),t.prototype.init=function(){this._test=T(this.params,this.options.compare)},t.prototype.next=function(e,t,r){(!Array.isArray(r)||r.hasOwnProperty(t))&&this._test(e,t,r)&&(this.done=!0,this.keep=!0)},t}(S),C=function(e){var t;return t=function(t,r,s,o){var i=typeof g(t),a=e(t);return new j(function(e){var t=null==e?null:e;return typeof g(t)===i&&a(t)},r,s,o)},function(e,r,s,o){return t(e,r,s,o)}},R=function(e,t,r,s){var o=s.operations[e];return o||A(e),o(t,r,s,e)},A=function(e){throw Error("Unsupported operation: ".concat(e))},P=function(e,t){for(var r in e)if(t.operations.hasOwnProperty(r)||"$"===r.charAt(0))return!0;return!1},N=function(e,t,r,s,o){if(P(t,o)){var i=M(t,r,o),a=i[0];if(i[1].length)throw Error("Property queries must contain only operations, or exact objects.");return new O(e,t,s,o,a)}return new O(e,t,s,o,[new j(t,s,o)])},q=function(e,t,r){void 0===t&&(t=null);var s=void 0===r?{}:r,o={compare:s.compare||v,operations:Object.assign({},s.operations||{})},i=M(e,null,o),a=i[0],l=i[1],u=[];return(a.length&&u.push(new O([],e,t,o,a)),u.push.apply(u,l),1===u.length)?u[0]:new I(e,t,o,u)},M=function(e,t,r){var s=[],o=[];if(!(e&&(e.constructor===Object||e.constructor===Array||"function Object() { [native code] }"===e.constructor.toString()||"function Array() { [native code] }"===e.constructor.toString())&&!e.toJSON))return s.push(new j(e,e,r)),[s,o];for(var i in e)if(r.operations.hasOwnProperty(i)){var a=R(i,e[i],e,r);if(a&&!a.propop&&t&&!r.operations[t])throw Error("Malformed query. ".concat(i," cannot be matched against property."));null!=a&&s.push(a)}else"$"===i.charAt(0)?A(i):o.push(N(i.split("."),e[i],i,e,r));return[s,o]},L=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.propop=!0,t}return h(t,e),t.prototype.init=function(){this._test=T(this.params,this.options.compare)},t.prototype.reset=function(){e.prototype.reset.call(this),this.keep=!0},t.prototype.next=function(e){this._test(e)&&(this.done=!0,this.keep=!1)},t}(S),$=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.propop=!0,t}return h(t,e),t.prototype.init=function(){if(!this.params||"object"!=typeof this.params)throw Error("Malformed query. $elemMatch must by an object.");this._queryOperation=q(this.params,this.owneryQuery,this.options)},t.prototype.reset=function(){e.prototype.reset.call(this),this._queryOperation.reset()},t.prototype.next=function(e){if(y(e)){for(var t=0,r=e.length;t<r;t++){this._queryOperation.reset();var s=e[t];this._queryOperation.next(s,t,e,!1),this.keep=this.keep||this._queryOperation.keep}this.done=!0}else this.done=!1,this.keep=!1},t}(S),D=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.propop=!0,t}return h(t,e),t.prototype.init=function(){this._queryOperation=q(this.params,this.owneryQuery,this.options)},t.prototype.reset=function(){e.prototype.reset.call(this),this._queryOperation.reset()},t.prototype.next=function(e,t,r,s){this._queryOperation.next(e,t,r,s),this.done=this._queryOperation.done,this.keep=!this._queryOperation.keep},t}(S),U=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.propop=!0,t}return h(t,e),t.prototype.init=function(){},t.prototype.next=function(e){y(e)&&e.length===this.params&&(this.done=!0,this.keep=!0)},t}(S),B=function(e){if(0===e.length)throw Error("$and/$or/$nor must be a nonempty array")},F=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.propop=!1,t}return h(t,e),t.prototype.init=function(){var e=this;B(this.params),this._ops=this.params.map(function(t){return q(t,null,e.options)})},t.prototype.reset=function(){this.done=!1,this.keep=!1;for(var e=0,t=this._ops.length;e<t;e++)this._ops[e].reset()},t.prototype.next=function(e,t,r){for(var s=!1,o=!1,i=0,a=this._ops.length;i<a;i++){var l=this._ops[i];if(l.next(e,t,r),l.keep){s=!0,o=l.keep;break}}this.keep=o,this.done=s},t}(S),V=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.propop=!1,t}return h(t,e),t.prototype.next=function(t,r,s){e.prototype.next.call(this,t,r,s),this.keep=!this.keep},t}(F),W=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.propop=!0,t}return h(t,e),t.prototype.init=function(){var e=this,t=Array.isArray(this.params)?this.params:[this.params];this._testers=t.map(function(t){if(P(t,e.options))throw Error("cannot nest $ under ".concat(e.name.toLowerCase()));return T(t,e.options.compare)})},t.prototype.next=function(e,t,r){for(var s=!1,o=!1,i=0,a=this._testers.length;i<a;i++)if((0,this._testers[i])(e)){s=!0,o=!0;break}this.keep=o,this.done=s},t}(S),z=function(e){function t(t,r,s,o){var i=e.call(this,t,r,s,o)||this;return i.propop=!0,i._in=new W(t,r,s,o),i}return h(t,e),t.prototype.next=function(e,t,r,s){this._in.next(e,t,r),y(r)&&!s?this._in.keep?(this.keep=!1,this.done=!0):t==r.length-1&&(this.keep=!0,this.done=!0):(this.keep=!this._in.keep,this.done=!0)},t.prototype.reset=function(){e.prototype.reset.call(this),this._in.reset()},t}(S),Z=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.propop=!0,t}return h(t,e),t.prototype.next=function(e,t,r,s,o){o?r.hasOwnProperty(t)===this.params&&(this.done=!0,this.keep=!0):(this.done=!0,this.keep=!this.params)},t}(S),J=function(e){function t(t,r,s,o){var i=e.call(this,t,r,s,t.map(function(e){return q(e,r,s)}),o)||this;return i.propop=!1,B(t),i}return h(t,e),t.prototype.next=function(e,t,r,s){this.childrenNext(e,t,r,s)},t}(k),H=function(e){function t(t,r,s,o){var i=e.call(this,t,r,s,t.map(function(e){return q(e,r,s)}),o)||this;return i.propop=!0,i}return h(t,e),t.prototype.next=function(e,t,r,s){this.childrenNext(e,t,r,s)},t}(k),G=C(function(e){return function(t){return null!=t&&t<e}}),Y=C(function(e){return function(t){return t===e||t<=e}}),K=C(function(e){return function(t){return null!=t&&t>e}}),Q=C(function(e){return function(t){return t===e||t>=e}}),X={number:function(e){return"number"==typeof e},string:function(e){return"string"==typeof e},bool:function(e){return"boolean"==typeof e},array:function(e){return Array.isArray(e)},null:function(e){return null===e},timestamp:function(e){return e instanceof Date}},ee=Object.freeze({__proto__:null,$Size:U,$all:function(e,t,r,s){return new H(e,t,r,s)},$and:function(e,t,r,s){return new J(e,t,r,s)},$elemMatch:function(e,t,r,s){return new $(e,t,r,s)},$eq:function(e,t,r){return new j(e,t,r)},$exists:function(e,t,r,s){return new Z(e,t,r,s)},$gt:K,$gte:Q,$in:function(e,t,r,s){return new W(e,t,r,s)},$lt:G,$lte:Y,$mod:function(e,t,r){var s=e[0],o=e[1];return new j(function(e){return g(e)%s===o},t,r)},$ne:function(e,t,r,s){return new L(e,t,r,s)},$nin:function(e,t,r,s){return new z(e,t,r,s)},$nor:function(e,t,r,s){return new V(e,t,r,s)},$not:function(e,t,r,s){return new D(e,t,r,s)},$options:function(){return null},$or:function(e,t,r,s){return new F(e,t,r,s)},$regex:function(e,t,r){return new j(new RegExp(e,t.$options),t,r)},$size:function(e,t,r){return new U(e,t,r,"$size")},$type:function(e,t,r){return new j(function(t){if("string"==typeof e){if(!X[e])throw Error("Type alias does not exist");return X[e](t)}return null!=t&&(t instanceof e||t.constructor===e)},t,r)},$where:function(e,t,r){var s;if(_(e))s=e;else if(process.env.CSP_ENABLED)throw Error('In CSP mode, sift does not support strings in "$where" condition');else s=Function("obj","return "+e);return new j(function(e){return s.bind(e)(e)},t,r)}}),et=function(e,t,r){var s=void 0===r?{}:r;return q(e,t,{compare:s.compare,operations:Object.assign({},ee,s.operations||{})})},er=function(e,t){var r;return void 0===t&&(t={}),r=et(e,null,t),function(e,t,s){return r.reset(),r.next(e,t,s),r.keep}};let es=e=>{if("undefined"==typeof window)return;let t=function(){let e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:void 0;if(e.__xstate__)return e.__xstate__}();t&&t.register(e)};class en{constructor(e){this._process=e,this._active=!1,this._current=null,this._last=null}start(){this._active=!0,this.flush()}clear(){this._current&&(this._current.next=null,this._last=this._current)}enqueue(e){let t={value:e,next:null};if(this._current){this._last.next=t,this._last=t;return}this._current=t,this._last=t,this._active&&this.flush()}flush(){for(;this._current;){let e=this._current;this._process(e.value),this._current=e.next}this._last=null}}let eo="xstate.init",ei="xstate.stop";function ea(e,t){return{type:`xstate.done.state.${e}`,output:t}}function el(e){return{type:eo,input:e}}function eu(e){setTimeout(()=>{throw e})}let ec="function"==typeof Symbol&&Symbol.observable||"@@observable";function ed(e){if(eg(e))return e;let t=[],r="";for(let s=0;s<e.length;s++){switch(e.charCodeAt(s)){case 92:r+=e[s+1],s++;continue;case 46:t.push(r),r="";continue}r+=e[s]}return t.push(r),t}function ep(e){return e&&"object"==typeof e&&"machine"in e&&"value"in e?e.value:"string"!=typeof e?e:function(e){if(1===e.length)return e[0];let t={},r=t;for(let t=0;t<e.length-1;t++)if(t===e.length-2)r[e[t]]=e[t+1];else{let s=r;r={},s[e[t]]=r}return t}(ed(e))}function eh(e,t){let r={},s=Object.keys(e);for(let o=0;o<s.length;o++){let i=s[o];r[i]=t(e[i],i,e,o)}return r}function ef(e){return void 0===e?[]:eg(e)?e:[e]}function em(e,t,r,s){return"function"==typeof e?e({context:t,event:r,self:s}):e}function eg(e){return Array.isArray(e)}function ey(e){return(eg(e)?e:[e]).map(e=>void 0===e||"string"==typeof e?{target:e}:e)}function eb(e){if(void 0!==e&&""!==e)return ef(e)}function e_(e,t,r){let s="object"==typeof e,o=s?e:void 0;return{next:(s?e.next:e)?.bind(o),error:(s?e.error:t)?.bind(o),complete:(s?e.complete:r)?.bind(o)}}function ev(e,t){let r=t.match(/^xstate\.invoke\.(\d+)\.(.*)/);if(!r)return e.implementations.actors[t];let[,s,o]=r,i=e.getStateNodeById(o).config.invoke;return(Array.isArray(i)?i[s]:i).src}function ew(e,t){return`${e.sessionId}.${t}`}let ex=0,eS=!1,eE=function(e){return e[e.NotStarted=0]="NotStarted",e[e.Running=1]="Running",e[e.Stopped=2]="Stopped",e}({}),ek={clock:{setTimeout:(e,t)=>setTimeout(e,t),clearTimeout:e=>clearTimeout(e)},logger:console.log.bind(console),devTools:!1};class eI{constructor(e,t){this.logic=e,this._snapshot=void 0,this.clock=void 0,this.options=void 0,this.id=void 0,this.mailbox=new en(this._process.bind(this)),this.observers=new Set,this.eventListeners=new Map,this.logger=void 0,this._processingStatus=eE.NotStarted,this._parent=void 0,this._syncSnapshot=void 0,this.ref=void 0,this._actorScope=void 0,this._systemId=void 0,this.sessionId=void 0,this.system=void 0,this._doneEvent=void 0,this.src=void 0,this._deferred=[];let r={...ek,...t},{clock:s,logger:o,parent:i,syncSnapshot:a,id:l,systemId:u,inspect:c}=r;this.system=i?i.system:function(e,t){let r=new Map,s=new Map,o=new WeakMap,i=new Set,a={},{clock:l,logger:u}=t,c={schedule:(e,t,r,s,o=Math.random().toString(36).slice(2))=>{let i={source:e,target:t,event:r,delay:s,id:o,startedAt:Date.now()},u=ew(e,o);d._snapshot._scheduledEvents[u]=i;let c=l.setTimeout(()=>{delete a[u],delete d._snapshot._scheduledEvents[u],d._relay(e,t,r)},s);a[u]=c},cancel:(e,t)=>{let r=ew(e,t),s=a[r];delete a[r],delete d._snapshot._scheduledEvents[r],void 0!==s&&l.clearTimeout(s)},cancelAll:e=>{for(let t in d._snapshot._scheduledEvents){let r=d._snapshot._scheduledEvents[t];r.source===e&&c.cancel(e,r.id)}}},d={_snapshot:{_scheduledEvents:(t?.snapshot&&t.snapshot.scheduler)??{}},_bookId:()=>`x:${ex++}`,_register:(e,t)=>(r.set(e,t),e),_unregister:e=>{r.delete(e.sessionId);let t=o.get(e);void 0!==t&&(s.delete(t),o.delete(e))},get:e=>s.get(e),_set:(e,t)=>{let r=s.get(e);if(r&&r!==t)throw Error(`Actor with system ID '${e}' already exists.`);s.set(e,t),o.set(t,e)},inspect:e=>{let t=e_(e);return i.add(t),{unsubscribe(){i.delete(t)}}},_sendInspectionEvent:t=>{if(!i.size)return;let r={...t,rootId:e.sessionId};i.forEach(e=>e.next?.(r))},_relay:(e,t,r)=>{d._sendInspectionEvent({type:"@xstate.event",sourceRef:e,actorRef:t,event:r}),t._send(r)},scheduler:c,getSnapshot:()=>({_scheduledEvents:{...d._snapshot._scheduledEvents}}),start:()=>{let e=d._snapshot._scheduledEvents;for(let t in d._snapshot._scheduledEvents={},e){let{source:r,target:s,event:o,delay:i,id:a}=e[t];c.schedule(r,s,o,i,a)}},_clock:l,_logger:u};return d}(this,{clock:s,logger:o}),c&&!i&&this.system.inspect(e_(c)),this.sessionId=this.system._bookId(),this.id=l??this.sessionId,this.logger=t?.logger??this.system._logger,this.clock=t?.clock??this.system._clock,this._parent=i,this._syncSnapshot=a,this.options=r,this.src=r.src??e,this.ref=this,this._actorScope={self:this,id:this.id,sessionId:this.sessionId,logger:this.logger,defer:e=>{this._deferred.push(e)},system:this.system,stopChild:e=>{if(e._parent!==this)throw Error(`Cannot stop child actor ${e.id} of ${this.id} because it is not a child`);e._stop()},emit:e=>{let t=this.eventListeners.get(e.type),r=this.eventListeners.get("*");if(t||r)for(let s of[...t?t.values():[],...r?r.values():[]])s(e)},actionExecutor:e=>{let t=()=>{if(this._actorScope.system._sendInspectionEvent({type:"@xstate.action",actorRef:this,action:{type:e.type,params:e.params}}),!e.exec)return;let t=eS;try{eS=!0,e.exec(e.info,e.params)}finally{eS=t}};this._processingStatus===eE.Running?t():this._deferred.push(t)}},this.send=this.send.bind(this),this.system._sendInspectionEvent({type:"@xstate.actor",actorRef:this}),u&&(this._systemId=u,this.system._set(u,this)),this._initState(t?.snapshot??t?.state),u&&"active"!==this._snapshot.status&&this.system._unregister(this)}_initState(e){try{this._snapshot=e?this.logic.restoreSnapshot?this.logic.restoreSnapshot(e,this._actorScope):e:this.logic.getInitialSnapshot(this._actorScope,this.options?.input)}catch(e){this._snapshot={status:"error",output:void 0,error:e}}}update(e,t){let r;for(this._snapshot=e;r=this._deferred.shift();)try{r()}catch(t){this._deferred.length=0,this._snapshot={...e,status:"error",error:t}}switch(this._snapshot.status){case"active":for(let t of this.observers)try{t.next?.(e)}catch(e){eu(e)}break;case"done":var s;for(let t of this.observers)try{t.next?.(e)}catch(e){eu(e)}this._stopProcedure(),this._complete(),this._doneEvent=(s=this.id,{type:`xstate.done.actor.${s}`,output:this._snapshot.output,actorId:s}),this._parent&&this.system._relay(this,this._parent,this._doneEvent);break;case"error":this._error(this._snapshot.error)}this.system._sendInspectionEvent({type:"@xstate.snapshot",actorRef:this,event:t,snapshot:e})}subscribe(e,t,r){let s=e_(e,t,r);if(this._processingStatus!==eE.Stopped)this.observers.add(s);else switch(this._snapshot.status){case"done":try{s.complete?.()}catch(e){eu(e)}break;case"error":{let e=this._snapshot.error;if(s.error)try{s.error(e)}catch(e){eu(e)}else eu(e)}}return{unsubscribe:()=>{this.observers.delete(s)}}}on(e,t){let r=this.eventListeners.get(e);r||(r=new Set,this.eventListeners.set(e,r));let s=t.bind(void 0);return r.add(s),{unsubscribe:()=>{r.delete(s)}}}start(){if(this._processingStatus===eE.Running)return this;this._syncSnapshot&&this.subscribe({next:e=>{"active"===e.status&&this.system._relay(this,this._parent,{type:`xstate.snapshot.${this.id}`,snapshot:e})},error:()=>{}}),this.system._register(this.sessionId,this),this._systemId&&this.system._set(this._systemId,this),this._processingStatus=eE.Running;let e=el(this.options.input);switch(this.system._sendInspectionEvent({type:"@xstate.event",sourceRef:this._parent,actorRef:this,event:e}),this._snapshot.status){case"done":return this.update(this._snapshot,e),this;case"error":return this._error(this._snapshot.error),this}if(this._parent||this.system.start(),this.logic.start)try{this.logic.start(this._snapshot,this._actorScope)}catch(e){return this._snapshot={...this._snapshot,status:"error",error:e},this._error(e),this}return this.update(this._snapshot,e),this.options.devTools&&this.attachDevTools(),this.mailbox.start(),this}_process(e){let t,r;try{t=this.logic.transition(this._snapshot,e,this._actorScope)}catch(e){r={err:e}}if(r){let{err:e}=r;this._snapshot={...this._snapshot,status:"error",error:e},this._error(e);return}this.update(t,e),e.type===ei&&(this._stopProcedure(),this._complete())}_stop(){return this._processingStatus===eE.Stopped||((this.mailbox.clear(),this._processingStatus===eE.NotStarted)?this._processingStatus=eE.Stopped:this.mailbox.enqueue({type:ei})),this}stop(){if(this._parent)throw Error("A non-root actor cannot be stopped directly.");return this._stop()}_complete(){for(let e of this.observers)try{e.complete?.()}catch(e){eu(e)}this.observers.clear()}_reportError(e){if(!this.observers.size){this._parent||eu(e);return}let t=!1;for(let r of this.observers){let s=r.error;t||=!s;try{s?.(e)}catch(e){eu(e)}}this.observers.clear(),t&&eu(e)}_error(e){if(this._stopProcedure(),this._reportError(e),this._parent){var t;this.system._relay(this,this._parent,(t=this.id,{type:`xstate.error.actor.${t}`,error:e,actorId:t}))}}_stopProcedure(){return this._processingStatus!==eE.Running||(this.system.scheduler.cancelAll(this),this.mailbox.clear(),this.mailbox=new en(this._process.bind(this)),this._processingStatus=eE.Stopped,this.system._unregister(this)),this}_send(e){this._processingStatus!==eE.Stopped&&this.mailbox.enqueue(e)}send(e){this.system._relay(void 0,this,e)}attachDevTools(){let{devTools:e}=this.options;e&&("function"==typeof e?e:es)(this)}toJSON(){return{xstate$$type:1,id:this.id}}getPersistedSnapshot(e){return this.logic.getPersistedSnapshot(this._snapshot,e)}[ec](){return this}getSnapshot(){return this._snapshot}}function eO(e,...[t]){return new eI(e,t)}function eT(e,t,r,s,{sendId:o}){return[t,{sendId:"function"==typeof o?o(r,s):o},void 0]}function ej(e,t){e.defer(()=>{e.system.scheduler.cancel(e.self,t.sendId)})}function eC(e,t,r,s,{id:o,systemId:i,src:a,input:l,syncSnapshot:u}){let c,d;let p="string"==typeof a?ev(t.machine,a):a,h="function"==typeof o?o(r):o;return p&&(d="function"==typeof l?l({context:t.context,event:r.event,self:e.self}):l,c=eO(p,{id:h,src:a,parent:e.self,syncSnapshot:u,systemId:i,input:d})),[ti(t,{children:{...t.children,[h]:c}}),{id:o,systemId:i,actorRef:c,src:a,input:d},void 0]}function eR(e,{actorRef:t}){t&&e.defer(()=>{t._processingStatus!==eE.Stopped&&t.start()})}function eA(e,t,r,s,{actorRef:o}){let i="function"==typeof o?o(r,s):o,a="string"==typeof i?t.children[i]:i,l=t.children;return a&&(l={...l},delete l[a.id]),[ti(t,{children:l}),a,void 0]}function eP(e,t){if(t){if(e.system._unregister(t),t._processingStatus!==eE.Running){e.stopChild(t);return}e.defer(()=>{e.stopChild(t)})}}function eN(e){function t(e,t){}return t.type="xstate.stopChild",t.actorRef=e,t.resolve=eA,t.execute=eP,t}function eq(e,t,r,s){let{machine:o}=s,i="function"==typeof e,a=i?e:o.implementations.guards["string"==typeof e?e:e.type];if(!i&&!a)throw Error(`Guard '${"string"==typeof e?e:e.type}' is not implemented.'.`);if("function"!=typeof a)return eq(a,t,r,s);let l={context:t,event:r},u=i||"string"==typeof e?void 0:"params"in e?"function"==typeof e.params?e.params({context:t,event:r}):e.params:void 0;return"check"in a?a.check(s,l,a):a(l,u)}let eM=e=>"atomic"===e.type||"final"===e.type;function eL(e){return Object.values(e.states).filter(e=>"history"!==e.type)}function e$(e,t){let r=[];if(t===e)return r;let s=e.parent;for(;s&&s!==t;)r.push(s),s=s.parent;return r}function eD(e){let t=new Set(e),r=eU(t);for(let e of t)if("compound"!==e.type||r.get(e)&&r.get(e).length){if("parallel"===e.type){for(let r of eL(e))if("history"!==r.type&&!t.has(r))for(let e of eJ(r))t.add(e)}}else eJ(e).forEach(e=>t.add(e));for(let e of t){let r=e.parent;for(;r;)t.add(r),r=r.parent}return t}function eU(e){let t=new Map;for(let r of e)t.has(r)||t.set(r,[]),r.parent&&(t.has(r.parent)||t.set(r.parent,[]),t.get(r.parent).push(r));return t}function eB(e,t){return function e(t,r){let s=r.get(t);if(!s)return{};if("compound"===t.type){let e=s[0];if(!e)return{};if(eM(e))return e.key}let o={};for(let t of s)o[t.key]=e(t,r);return o}(e,eU(eD(t)))}function eF(e,t){return"compound"===t.type?eL(t).some(t=>"final"===t.type&&e.has(t)):"parallel"===t.type?eL(t).every(t=>eF(e,t)):"final"===t.type}let eV=e=>"#"===e[0];function eW(e,t,r){let s=eb(r.target),o=r.reenter??!1,i=function(e,t){if(void 0!==t)return t.map(t=>{if("string"!=typeof t)return t;if(eV(t))return e.machine.getStateNodeById(t);let r="."===t[0];if(r&&!e.parent)return eY(e,t.slice(1));let s=r?e.key+t:t;if(e.parent)try{return eY(e.parent,s)}catch(t){throw Error(`Invalid transition definition for state node '${e.id}':
${t.message}`)}else throw Error(`Invalid target: "${t}" is not a valid target from the root node. Did you mean ".${t}"?`)})}(e,s),a={...r,actions:ef(r.actions),guard:r.guard,target:i,source:e,reenter:o,eventType:t,toJSON:()=>({...a,source:`#${e.id}`,target:i?i.map(e=>`#${e.id}`):void 0})};return a}function ez(e){let t=eb(e.config.target);return t?{target:t.map(t=>"string"==typeof t?eY(e.parent,t):t)}:e.parent.initial}function eZ(e){return"history"===e.type}function eJ(e){let t=eH(e);for(let r of t)for(let s of e$(r,e))t.add(s);return t}function eH(e){let t=new Set;return function e(r){if(!t.has(r)){if(t.add(r),"compound"===r.type)e(r.initial.target[0]);else if("parallel"===r.type)for(let t of eL(r))e(t)}}(e),t}function eG(e,t){if(eV(t))return e.machine.getStateNodeById(t);if(!e.states)throw Error(`Unable to retrieve child state '${t}' from '${e.id}'; no child states exist.`);let r=e.states[t];if(!r)throw Error(`Child state '${t}' does not exist on '${e.id}'`);return r}function eY(e,t){if("string"==typeof t&&eV(t))try{return e.machine.getStateNodeById(t)}catch{}let r=ed(t).slice(),s=e;for(;r.length;){let e=r.shift();if(!e.length)break;s=eG(s,e)}return s}function eK(e,t){if("string"==typeof t){let r=e.states[t];if(!r)throw Error(`State '${t}' does not exist on '${e.id}'`);return[e,r]}let r=Object.keys(t),s=r.map(t=>eG(e,t)).filter(Boolean);return[e.machine.root,e].concat(s,r.reduce((r,s)=>{let o=eG(e,s);if(!o)return r;let i=eK(o,t[s]);return r.concat(i)},[]))}function eQ(e,t){let r=e;for(;r.parent&&r.parent!==t;)r=r.parent;return r.parent===t}function eX(e,t,r){let s=new Set;for(let o of e){let e=!1,i=new Set;for(let a of s)if(function(e,t){let r=new Set(e),s=new Set(t);for(let e of r)if(s.has(e))return!0;for(let e of s)if(r.has(e))return!0;return!1}(e2([o],t,r),e2([a],t,r))){if(eQ(o.source,a.source))i.add(a);else{e=!0;break}}if(!e){for(let e of i)s.delete(e);s.add(o)}}return Array.from(s)}function e0(e,t){if(!e.target)return[];let r=new Set;for(let s of e.target)if(eZ(s)){if(t[s.id])for(let e of t[s.id])r.add(e);else for(let e of e0(ez(s),t))r.add(e)}else r.add(s);return[...r]}function e1(e,t){let r=e0(e,t);if(!r)return;if(!e.reenter&&r.every(t=>t===e.source||eQ(t,e.source)))return e.source;let s=function(e){let[t,...r]=e;for(let e of e$(t,void 0))if(r.every(t=>eQ(t,e)))return e}(r.concat(e.source));return s||(e.reenter?void 0:e.source.machine.root)}function e2(e,t,r){let s=new Set;for(let o of e)if(o.target?.length){let e=e1(o,r);for(let r of(o.reenter&&o.source===e&&s.add(e),t))eQ(r,e)&&s.add(r)}return[...s]}function e3(e,t,r,s,o,i){if(!e.length)return t;let a=new Set(t._nodes),l=t.historyValue,u=eX(e,a,l),c=t;o||([c,l]=function(e,t,r,s,o,i,a,l){let u,c=e,d=e2(s,o,i);for(let e of(d.sort((e,t)=>t.order-e.order),d))for(let t of function(e){return Object.keys(e.states).map(t=>e.states[t]).filter(e=>"history"===e.type)}(e)){let r;r="deep"===t.history?t=>eM(t)&&eQ(t,e):t=>t.parent===e,(u??={...i})[t.id]=Array.from(o).filter(r)}for(let e of d)c=e6(c,t,r,[...e.exit,...e.invoke.map(e=>eN(e.id))],a,void 0),o.delete(e);return[c,u||i]}(c,s,r,u,a,l,i,r.actionExecutor)),c=function(e,t,r,s,o,i,a,l){let u=e,c=new Set,d=new Set;(function(e,t,r,s){for(let o of e){let e=e1(o,t);for(let i of o.target||[])!eZ(i)&&(o.source!==i||o.source!==e||o.reenter)&&(s.add(i),r.add(i)),e4(i,t,r,s);for(let i of e0(o,t)){let a=e$(i,e);e?.type==="parallel"&&a.push(e),e8(s,t,r,a,!o.source.parent&&o.reenter?void 0:e)}}})(s,a,d,c),l&&d.add(e.machine.root);let p=new Set;for(let e of[...c].sort((e,t)=>e.order-t.order)){o.add(e);let s=[];for(let t of(s.push(...e.entry),e.invoke))s.push(function(...[e,{id:t,systemId:r,input:s,syncSnapshot:o=!1}={}]){function i(e,t){}return i.type="xstate.spawnChild",i.id=t,i.systemId=r,i.src=e,i.input=s,i.syncSnapshot=o,i.resolve=eC,i.execute=eR,i}(t.src,{...t,syncSnapshot:!!t.onSnapshot}));if(d.has(e)){let t=e.initial.actions;s.push(...t)}if(u=e6(u,t,r,s,i,e.invoke.map(e=>e.id)),"final"===e.type){let s=e.parent,a=s?.type==="parallel"?s:s?.parent,l=a||e;for(s?.type==="compound"&&i.push(ea(s.id,void 0!==e.output?em(e.output,u.context,t,r.self):void 0));a?.type==="parallel"&&!p.has(a)&&eF(o,a);)p.add(a),i.push(ea(a.id)),l=a,a=a.parent;if(a)continue;u=ti(u,{status:"done",output:function(e,t,r,s,o){if(void 0===s.output)return;let i=ea(o.id,void 0!==o.output&&o.parent?em(o.output,e.context,t,r.self):void 0);return em(s.output,e.context,i,r.self)}(u,t,r,u.machine.root,l)})}}return u}(c=e6(c,s,r,u.flatMap(e=>e.actions),i,void 0),s,r,u,a,i,l,o);let d=[...a];"done"===c.status&&(c=e6(c,s,r,d.sort((e,t)=>t.order-e.order).flatMap(e=>e.exit),i,void 0));try{if(l===t.historyValue&&function(e,t){if(e.length!==t.size)return!1;for(let r of e)if(!t.has(r))return!1;return!0}(t._nodes,a))return c;return ti(c,{_nodes:d,historyValue:l})}catch(e){throw e}}function e4(e,t,r,s){if(eZ(e)){if(t[e.id]){let o=t[e.id];for(let e of o)s.add(e),e4(e,t,r,s);for(let i of o)e8(s,t,r,e$(i,e.parent))}else{let o=ez(e);for(let i of o.target)s.add(i),o===e.parent?.initial&&r.add(e.parent),e4(i,t,r,s);for(let i of o.target)e8(s,t,r,e$(i,e.parent))}}else if("compound"===e.type){let[o]=e.initial.target;eZ(o)||(s.add(o),r.add(o)),e4(o,t,r,s),e8(s,t,r,e$(o,e))}else if("parallel"===e.type)for(let o of eL(e).filter(e=>!eZ(e)))[...s].some(e=>eQ(e,o))||(eZ(o)||(s.add(o),r.add(o)),e4(o,t,r,s))}function e8(e,t,r,s,o){for(let i of s)if((!o||eQ(i,o))&&e.add(i),"parallel"===i.type)for(let s of eL(i).filter(e=>!eZ(e)))[...e].some(e=>eQ(e,s))||(e.add(s),e4(s,t,r,e))}function e6(e,t,r,s,o,i){let a=i?[]:void 0,l=function e(t,r,s,o,i,a){let{machine:l}=t,u=t;for(let t of o){var c;let o="function"==typeof t,d=o?t:(c="string"==typeof t?t:t.type,l.implementations.actions[c]),p={context:u.context,event:r,self:s.self,system:s.system},h=o||"string"==typeof t?void 0:"params"in t?"function"==typeof t.params?t.params({context:u.context,event:r}):t.params:void 0;if(!d||!("resolve"in d)){s.actionExecutor({type:"string"==typeof t?t:"object"==typeof t?t.type:t.name||"(anonymous)",info:p,params:h,exec:d});continue}let[f,m,g]=d.resolve(s,u,p,h,d,i);u=f,"retryResolve"in d&&a?.push([d,m]),"execute"in d&&s.actionExecutor({type:d.type,info:p,params:m,exec:d.execute.bind(null,s,m)}),g&&(u=e(u,r,s,g,i,a))}return u}(e,t,r,s,{internalQueue:o,deferredActorIds:i},a);return a?.forEach(([e,t])=>{e.retryResolve(r,l,t)}),l}function e9(e,t,r,s){let o=e,i=[];function a(e,t,s){r.system._sendInspectionEvent({type:"@xstate.microstep",actorRef:r.self,event:t,snapshot:e,_transitions:s}),i.push(e)}if(t.type===ei)return a(o=ti(e5(o,t,r),{status:"stopped"}),t,[]),{snapshot:o,microstates:i};let l=t;if(l.type!==eo){let t=l,u=t.type.startsWith("xstate.error.actor"),c=e7(t,o);if(u&&!c.length)return a(o=ti(e,{status:"error",error:t.error}),t,[]),{snapshot:o,microstates:i};a(o=e3(c,e,r,l,!1,s),t,c)}let u=!0;for(;"active"===o.status;){let e=u?function(e,t){let r=new Set;for(let s of e._nodes.filter(eM))e:for(let o of[s].concat(e$(s,void 0)))if(o.always){for(let s of o.always)if(void 0===s.guard||eq(s.guard,e.context,t,e)){r.add(s);break e}}return eX(Array.from(r),new Set(e._nodes),e.historyValue)}(o,l):[],t=e.length?o:void 0;if(!e.length){if(!s.length)break;e=e7(l=s.shift(),o)}u=(o=e3(e,o,r,l,!1,s))!==t,a(o,l,e)}return"active"!==o.status&&e5(o,l,r),{snapshot:o,microstates:i}}function e5(e,t,r){return e6(e,t,r,Object.values(e.children).map(e=>eN(e)),[],void 0)}function e7(e,t){return t.machine.getTransitionData(t,e)}let te=function(e){return function e(t,r){let s=ep(t),o=ep(r);return"string"==typeof o?"string"==typeof s&&o===s:"string"==typeof s?s in o:Object.keys(s).every(t=>t in o&&e(s[t],o[t]))}(e,this.value)},tt=function(e){return this.tags.has(e)},tr=function(e){let t=this.machine.getTransitionData(this,e);return!!t?.length&&t.some(e=>void 0!==e.target||e.actions.length)},ts=function(){let{_nodes:e,tags:t,machine:r,getMeta:s,toJSON:o,can:i,hasTag:a,matches:l,...u}=this;return{...u,tags:Array.from(t)}},tn=function(){return this._nodes.reduce((e,t)=>(void 0!==t.meta&&(e[t.id]=t.meta),e),{})};function to(e,t){return{status:e.status,output:e.output,error:e.error,machine:t,context:e.context,_nodes:e._nodes,value:eB(t.root,e._nodes),tags:new Set(e._nodes.flatMap(e=>e.tags)),children:e.children,historyValue:e.historyValue||{},matches:te,hasTag:tt,can:tr,getMeta:tn,toJSON:ts}}function ti(e,t={}){return to({...e,...t},e.machine)}function ta(e,t,r,s,{event:o,id:i,delay:a},{internalQueue:l}){let u;let c=t.machine.implementations.delays;if("string"==typeof o)throw Error(`Only event objects may be used with raise; use raise({ type: "${o}" }) instead`);let d="function"==typeof o?o(r,s):o;if("string"==typeof a){let e=c&&c[a];u="function"==typeof e?e(r,s):e}else u="function"==typeof a?a(r,s):a;return"number"!=typeof u&&l.push(d),[t,{event:d,id:i,delay:u},void 0]}function tl(e,t){let{event:r,delay:s,id:o}=t;if("number"==typeof s){e.defer(()=>{let t=e.self;e.system.scheduler.schedule(t,t,r,s,o)});return}}function tu(e,t,r,s,{assignment:o}){if(!t.context)throw Error("Cannot assign to undefined `context`. Ensure that `context` is defined in the machine config.");let i={},a={context:t.context,event:r.event,spawn:function(e,{machine:t,context:r},s,o){let i=(i,a)=>{if("string"!=typeof i)return eO(i,{id:a?.id,parent:e.self,syncSnapshot:a?.syncSnapshot,input:a?.input,src:i,systemId:a?.systemId});{let l=ev(t,i);if(!l)throw Error(`Actor logic '${i}' not implemented in machine '${t.id}'`);let u=eO(l,{id:a?.id,parent:e.self,syncSnapshot:a?.syncSnapshot,input:"function"==typeof a?.input?a.input({context:r,event:s,self:e.self}):a?.input,src:i,systemId:a?.systemId});return o[u.id]=u,u}};return(t,r)=>{let s=i(t,r);return o[s.id]=s,e.defer(()=>{s._processingStatus!==eE.Stopped&&s.start()}),s}}(e,t,r.event,i),self:e.self,system:e.system},l={};if("function"==typeof o)l=o(a,s);else for(let e of Object.keys(o)){let t=o[e];l[e]="function"==typeof t?t(a,s):t}let u=Object.assign({},t.context,l);return[ti(t,{context:u,children:Object.keys(i).length?{...t.children,...i}:t.children}),void 0,void 0]}function tc(e){function t(e,t){}return t.type="xstate.assign",t.assignment=e,t.resolve=tu,t}let td=function(e){return e.Parent="#_parent",e.Internal="#_internal",e}({});function tp(e,t,r,s,{to:o,event:i,id:a,delay:l},u){let c,d;let p=t.machine.implementations.delays;if("string"==typeof i)throw Error(`Only event objects may be used with sendTo; use sendTo({ type: "${i}" }) instead`);let h="function"==typeof i?i(r,s):i;if("string"==typeof l){let e=p&&p[l];c="function"==typeof e?e(r,s):e}else c="function"==typeof l?l(r,s):l;let f="function"==typeof o?o(r,s):o;if("string"==typeof f){if(!(d=f===td.Parent?e.self._parent:f===td.Internal?e.self:f.startsWith("#_")?t.children[f.slice(2)]:u.deferredActorIds?.includes(f)?f:t.children[f]))throw Error(`Unable to send event to actor '${f}' from machine '${t.machine.id}'.`)}else d=f||e.self;return[t,{to:d,targetId:"string"==typeof f?f:void 0,event:h,id:a,delay:c},void 0]}function th(e,t,r){"string"==typeof r.to&&(r.to=t.children[r.to])}function tf(e,t){e.defer(()=>{let{to:r,event:s,delay:o,id:i}=t;if("number"==typeof o){e.system.scheduler.schedule(e.self,r,s,o,i);return}e.system._relay(e.self,r,s.type===XSTATE_ERROR?createErrorActorEvent(e.self.id,s.data):s)})}let tm="xstate.promise.resolve",tg="xstate.promise.reject",ty=new WeakMap;function tb(e){return{config:e,transition:(e,t,r)=>{if("active"!==e.status)return e;switch(t.type){case tm:{let r=t.data;return{...e,status:"done",output:r,input:void 0}}case tg:return{...e,status:"error",error:t.data,input:void 0};case ei:return ty.get(r.self)?.abort(),{...e,status:"stopped",input:void 0};default:return e}},start:(t,{self:r,system:s,emit:o})=>{if("active"!==t.status)return;let i=new AbortController;ty.set(r,i),Promise.resolve(e({input:t.input,system:s,self:r,signal:i.signal,emit:o})).then(e=>{"active"===r.getSnapshot().status&&(ty.delete(r),s._relay(r,r,{type:tm,data:e}))},e=>{"active"===r.getSnapshot().status&&(ty.delete(r),s._relay(r,r,{type:tg,data:e}))})},getInitialSnapshot:(e,t)=>({status:"active",output:void 0,error:void 0,input:t}),getPersistedSnapshot:e=>e,restoreSnapshot:e=>e}}s=e=>void 0,o=0;let t_=new WeakMap;function tv(e,t,r){let s=t_.get(e);return s?t in s||(s[t]=r()):(s={[t]:r()},t_.set(e,s)),s[t]}let tw={},tx=e=>"string"==typeof e?{type:e}:"function"==typeof e?"resolve"in e?{type:e.type}:{type:e.name}:e;class tS{constructor(e,t){if(this.config=e,this.key=void 0,this.id=void 0,this.type=void 0,this.path=void 0,this.states=void 0,this.history=void 0,this.entry=void 0,this.exit=void 0,this.parent=void 0,this.machine=void 0,this.meta=void 0,this.output=void 0,this.order=-1,this.description=void 0,this.tags=[],this.transitions=void 0,this.always=void 0,this.parent=t._parent,this.key=t._key,this.machine=t._machine,this.path=this.parent?this.parent.path.concat(this.key):[],this.id=this.config.id||[this.machine.id,...this.path].join("."),this.type=this.config.type||(this.config.states&&Object.keys(this.config.states).length?"compound":this.config.history?"history":"atomic"),this.description=this.config.description,this.order=this.machine.idMap.size,this.machine.idMap.set(this.id,this),this.states=this.config.states?eh(this.config.states,(e,t)=>new tS(e,{_parent:this,_key:t,_machine:this.machine})):tw,"compound"===this.type&&!this.config.initial)throw Error(`No initial state specified for compound state node "#${this.id}". Try adding { initial: "${Object.keys(this.states)[0]}" } to the state config.`);this.history=!0===this.config.history?"shallow":this.config.history||!1,this.entry=ef(this.config.entry).slice(),this.exit=ef(this.config.exit).slice(),this.meta=this.config.meta,this.output="final"!==this.type&&this.parent?void 0:this.config.output,this.tags=ef(e.tags).slice()}_initialize(){this.transitions=function(e){let t=new Map;if(e.config.on)for(let r of Object.keys(e.config.on)){if(""===r)throw Error('Null events ("") cannot be specified as a transition key. Use `always: { ... }` instead.');let s=e.config.on[r];t.set(r,ey(s).map(t=>eW(e,r,t)))}if(e.config.onDone){let r=`xstate.done.state.${e.id}`;t.set(r,ey(e.config.onDone).map(t=>eW(e,r,t)))}for(let r of e.invoke){if(r.onDone){let s=`xstate.done.actor.${r.id}`;t.set(s,ey(r.onDone).map(t=>eW(e,s,t)))}if(r.onError){let s=`xstate.error.actor.${r.id}`;t.set(s,ey(r.onError).map(t=>eW(e,s,t)))}if(r.onSnapshot){let s=`xstate.snapshot.${r.id}`;t.set(s,ey(r.onSnapshot).map(t=>eW(e,s,t)))}}for(let r of e.after){let e=t.get(r.eventType);e||(e=[],t.set(r.eventType,e)),e.push(r)}return t}(this),this.config.always&&(this.always=ey(this.config.always).map(e=>eW(this,"",e))),Object.keys(this.states).forEach(e=>{this.states[e]._initialize()})}get definition(){return{id:this.id,key:this.key,version:this.machine.version,type:this.type,initial:this.initial?{target:this.initial.target,source:this,actions:this.initial.actions.map(tx),eventType:null,reenter:!1,toJSON:()=>({target:this.initial.target.map(e=>`#${e.id}`),source:`#${this.id}`,actions:this.initial.actions.map(tx),eventType:null})}:void 0,history:this.history,states:eh(this.states,e=>e.definition),on:this.on,transitions:[...this.transitions.values()].flat().map(e=>({...e,actions:e.actions.map(tx)})),entry:this.entry.map(tx),exit:this.exit.map(tx),meta:this.meta,order:this.order||-1,output:this.output,invoke:this.invoke,description:this.description,tags:this.tags}}toJSON(){return this.definition}get invoke(){return tv(this,"invoke",()=>ef(this.config.invoke).map((e,t)=>{var r,s;let{src:o,systemId:i}=e,a=e.id??(r=this.id,`${t}.${r}`),l="string"==typeof o?o:`xstate.invoke.${s=this.id,`${t}.${s}`}`;return{...e,src:l,id:a,systemId:i,toJSON(){let{onDone:t,onError:r,...s}=e;return{...s,type:"xstate.invoke",src:l,id:a}}}}))}get on(){return tv(this,"on",()=>[...this.transitions].flatMap(([e,t])=>t.map(t=>[e,t])).reduce((e,[t,r])=>(e[t]=e[t]||[],e[t].push(r),e),{}))}get after(){return tv(this,"delayedTransitions",()=>(function(e){let t=e.config.after;if(!t)return[];let r=t=>{var r;let s=(r=e.id,{type:`xstate.after.${t}.${r}`}),o=s.type;return e.entry.push(function(e,t){function r(e,t){}return r.type="xstate.raise",r.event=e,r.id=t?.id,r.delay=t?.delay,r.resolve=ta,r.execute=tl,r}(s,{id:o,delay:t})),e.exit.push(function(e){function t(e,t){}return t.type="xstate.cancel",t.sendId=e,t.resolve=eT,t.execute=ej,t}(o)),o};return Object.keys(t).flatMap(e=>{let s=t[e],o=Number.isNaN(+e)?e:+e,i=r(o);return ef("string"==typeof s?{target:s}:s).map(e=>({...e,event:i,delay:o}))}).map(t=>{let{delay:r}=t;return{...eW(e,t.event,t),delay:r}})})(this))}get initial(){return tv(this,"initial",()=>(function(e,t){let r="string"==typeof t?e.states[t]:t?e.states[t.target]:void 0;if(!r&&t)throw Error(`Initial state node "${t}" not found on parent state node #${e.id}`);let s={source:e,actions:t&&"string"!=typeof t?ef(t.actions):[],eventType:null,reenter:!1,target:r?[r]:[],toJSON:()=>({...s,source:`#${e.id}`,target:r?[`#${r.id}`]:[]})};return s})(this,this.config.initial))}next(e,t){let r;let s=t.type,o=[];for(let i of tv(this,`candidates-${s}`,()=>{var e;return e=this,e.transitions.get(s)||[...e.transitions.keys()].filter(e=>{if("*"===e)return!0;if(!e.endsWith(".*"))return!1;let t=e.split("."),r=s.split(".");for(let e=0;e<t.length;e++){let s=t[e],o=r[e];if("*"===s)return e===t.length-1;if(s!==o)return!1}return!0}).sort((e,t)=>t.length-e.length).flatMap(t=>e.transitions.get(t))})){let{guard:a}=i,l=e.context,u=!1;try{u=!a||eq(a,l,t,e)}catch(t){let e="string"==typeof a?a:"object"==typeof a?a.type:void 0;throw Error(`Unable to evaluate guard ${e?`'${e}' `:""}in transition for event '${s}' in state node '${this.id}':
${t.message}`)}if(u){o.push(...i.actions),r=i;break}}return r?[r]:void 0}get events(){return tv(this,"events",()=>{let{states:e}=this,t=new Set(this.ownEvents);if(e)for(let r of Object.keys(e)){let s=e[r];if(s.states)for(let e of s.events)t.add(`${e}`)}return Array.from(t)})}get ownEvents(){return Array.from(new Set([...this.transitions.keys()].filter(e=>this.transitions.get(e).some(e=>!(!e.target&&!e.actions.length&&!e.reenter)))))}}class tE{constructor(e,t){this.config=e,this.version=void 0,this.schemas=void 0,this.implementations=void 0,this.__xstatenode=!0,this.idMap=new Map,this.root=void 0,this.id=void 0,this.states=void 0,this.events=void 0,this.id=e.id||"(machine)",this.implementations={actors:t?.actors??{},actions:t?.actions??{},delays:t?.delays??{},guards:t?.guards??{}},this.version=this.config.version,this.schemas=this.config.schemas,this.transition=this.transition.bind(this),this.getInitialSnapshot=this.getInitialSnapshot.bind(this),this.getPersistedSnapshot=this.getPersistedSnapshot.bind(this),this.restoreSnapshot=this.restoreSnapshot.bind(this),this.start=this.start.bind(this),this.root=new tS(e,{_key:this.id,_machine:this}),this.root._initialize(),this.states=this.root.states,this.events=this.root.events}provide(e){let{actions:t,guards:r,actors:s,delays:o}=this.implementations;return new tE(this.config,{actions:{...t,...e.actions},guards:{...r,...e.guards},actors:{...s,...e.actors},delays:{...o,...e.delays}})}resolveState(e){let t=function(e,t){let r=eD(eK(e,t));return eB(e,[...r])}(this.root,e.value),r=eD(eK(this.root,t));return to({_nodes:[...r],context:e.context||{},children:{},status:eF(r,this.root)?"done":e.status||"active",output:e.output,error:e.error,historyValue:e.historyValue},this)}transition(e,t,r){return e9(e,t,r,[]).snapshot}microstep(e,t,r){return e9(e,t,r,[]).microstates}getTransitionData(e,t){return function e(t,r,s,o){return"string"==typeof r?function(e,t,r,s){let o=eG(e,t).next(r,s);return o&&o.length?o:e.next(r,s)}(t,r,s,o):1===Object.keys(r).length?function(t,r,s,o){let i=Object.keys(r),a=e(eG(t,i[0]),r[i[0]],s,o);return a&&a.length?a:t.next(s,o)}(t,r,s,o):function(t,r,s,o){let i=[];for(let a of Object.keys(r)){let l=r[a];if(!l)continue;let u=e(eG(t,a),l,s,o);u&&i.push(...u)}return i.length?i:t.next(s,o)}(t,r,s,o)}(this.root,e.value,e,t)||[]}getPreInitialState(e,t,r){let{context:s}=this.config,o=to({context:"function"!=typeof s&&s?s:{},_nodes:[this.root],children:{},status:"active"},this);return"function"==typeof s?e6(o,t,e,[tc(({spawn:e,event:t,self:r})=>s({spawn:e,input:t.input,self:r}))],r,void 0):o}getInitialSnapshot(e,t){let r=el(t),s=[],o=this.getPreInitialState(e,r,s),{snapshot:i}=e9(e3([{target:[...eH(this.root)],source:this.root,reenter:!0,actions:[],eventType:null,toJSON:null}],o,e,r,!0,s),r,e,s);return i}start(e){Object.values(e.children).forEach(e=>{"active"===e.getSnapshot().status&&e.start()})}getStateNodeById(e){let t=ed(e),r=t.slice(1),s=eV(t[0])?t[0].slice(1):t[0],o=this.idMap.get(s);if(!o)throw Error(`Child state node '#${s}' does not exist on machine '${this.id}'`);return eY(o,r)}get definition(){return this.root.definition}toJSON(){return this.definition}getPersistedSnapshot(e,t){return function(e,t){let{_nodes:r,tags:s,machine:o,children:i,context:a,can:l,hasTag:u,matches:c,getMeta:d,toJSON:p,...h}=e,f={};for(let e in i){let r=i[e];f[e]={snapshot:r.getPersistedSnapshot(t),src:r.src,systemId:r._systemId,syncSnapshot:r._syncSnapshot}}return{...h,context:function e(t){let r;for(let s in t){let o=t[s];if(o&&"object"==typeof o){if("sessionId"in o&&"send"in o&&"ref"in o)(r??=Array.isArray(t)?t.slice():{...t})[s]={xstate$$type:1,id:o.id};else{let i=e(o);i!==o&&((r??=Array.isArray(t)?t.slice():{...t})[s]=i)}}}return r??t}(a),children:f}}(e,t)}restoreSnapshot(e,t){let r={},s=e.children;Object.keys(s).forEach(e=>{let o=s[e],i=o.snapshot,a=o.src,l="string"==typeof a?ev(this,a):a;if(!l)return;let u=eO(l,{id:e,parent:t.self,syncSnapshot:o.syncSnapshot,snapshot:i,src:a,systemId:o.systemId});r[e]=u});let o=to({...e,children:r,_nodes:Array.from(eD(eK(this.root,e.value)))},this),i=new Set;return function e(t,r){if(!i.has(t))for(let s in i.add(t),t){let o=t[s];if(o&&"object"==typeof o){if("xstate$$type"in o&&1===o.xstate$$type){t[s]=r[o.id];continue}e(o,r)}}}(o.context,r),o}}function tk(e){return e.type.startsWith("xstate.done.actor.")}function tI(e){return"object"==typeof e&&"step"in e&&"path"in e}function tO(e){if(e?.status==="success")return e.output}function tT(e){let t=[],r=(e,s=[])=>{for(let[o,i]of Object.entries(e)){let e=[...s,o];"string"==typeof i?t.push({stepPath:e,stepId:o,status:i}):"object"==typeof i&&null!==i&&r(i,e)}};return r(e),t}function tj(e,t,r){let s=t=>{let o={};for(let[i,a]of Object.entries(t))i===e?o[i]={...r}:"string"==typeof a?o[i]=a:"object"==typeof a&&null!==a&&(o[i]=s(a));return o};return s(t)}var tC=(e,t)=>{let r={};for(let s of Object.keys(e)){let o=e[s];s===t?r[s]="pending":"object"==typeof o&&null!==o?r[s]=tC(o,t):r[s]=o}return r};function tR(e){return tT(e.value).reduce((t,r)=>{let s={status:r.status};return"suspended"===r.status&&(s.suspendPayload=e.context.steps[r.stepId].suspendPayload),t.set(r.stepId,s),t},new Map)}var tA=class extends c{logger;#eW;#ez;#eZ;#eJ;#eH;#eG;#eY;name;#eK=null;#eQ={};#eX;constructor({logger:e,mastra:t,workflowInstance:r,executionSpan:s,name:o,runId:i,steps:a,stepGraph:l,retryConfig:u,startStepId:c}){super(),this.#eW=t,this.#ez=r,this.#eZ=s,this.logger=e,this.#eG=i,this.#eY=c,this.name=o,this.#eJ=l,this.#eQ=a,this.#eX=u,this.initializeMachine()}get startStepId(){return this.#eY}async execute({stepId:e,input:t,snapshot:r}={}){r&&this.logger.debug("Workflow snapshot received",{runId:this.#eG,snapshot:r}),this.logger.debug("Machine input prepared",{runId:this.#eG,input:t});let s=r?{...r,context:t}:void 0;return this.logger.debug("Creating actor with configuration",{input:t,actorSnapshot:s,runId:this.#eG,machineStates:this.#eH.config.states}),this.#eK=eO(this.#eH,{inspect:e=>{this.logger.debug("XState inspection event",{type:e.type,event:e.event,runId:this.#eG})},input:t,snapshot:s}),this.#eK.start(),e&&this.#eK.send({type:"RESET_TO_PENDING",stepId:e}),this.logger.debug("Actor started",{runId:this.#eG}),new Promise((e,t)=>{if(!this.#eK){let e=Error("Actor not initialized");this.#eZ?.recordException(e),this.#eZ?.end(),t(e);return}let r=new Set;this.#eK.subscribe(async t=>{this.emit("state-update",this.#eY,t.value,t.context),function e({value:t,path:r,suspendedPaths:s}){"string"==typeof t?"suspended"===t&&s.add(r):Object.keys(t).forEach(o=>e({value:t[o],path:r?`${r}.${o}`:o,suspendedPaths:s}))}({value:t.value,path:"",suspendedPaths:r});let s=function e({value:t,suspendedPaths:r,path:s}){return"string"==typeof t?["completed","failed"].includes(t)||r.has(s):Object.keys(t).every(o=>e({value:t[o],suspendedPaths:r,path:s?`${s}.${o}`:o}))}({value:t.value,suspendedPaths:r,path:""});if(this.logger.debug("State completion check",{allStatesComplete:s,suspendedPaths:Array.from(r),runId:this.#eG}),s)try{await this.#ez.persistWorkflowSnapshot(),this.#e0(),this.#eZ?.end(),e({results:t.context.steps,activePaths:tR(t)})}catch(r){this.logger.debug("Failed to persist final snapshot",{error:r}),this.#e0(),this.#eZ?.end(),e({results:t.context.steps,activePaths:tR(t)})}})})}#e0(){this.#eK&&(this.#eK.stop(),this.#eK=null),this.removeAllListeners()}#e1(){let e={};return Object.keys(this.#eQ).forEach(t=>{e[t]=this.#eQ[t]?.retryConfig?.delay||this.#eX?.delay||1e3}),e}#e2(){return{updateStepResult:tc({steps:({context:e,event:t})=>{if(!tk(t))return e.steps;let{stepId:r,result:s}=t.output;return{...e.steps,[r]:{status:"success",output:s}}}}),setStepError:tc({steps:({context:e,event:t},r)=>{if(!t.type.startsWith("xstate.error.actor."))return e.steps;let{stepId:s}=r;return s?{...e.steps,[s]:{status:"failed",error:t.error.message}}:e.steps}}),notifyStepCompletion:async(e,t)=>{let{stepId:r}=t;this.logger.debug(`Step ${r} completed`)},snapshotStep:tc({_snapshot:({},e)=>{let{stepId:t}=e;return{stepId:t}}}),persistSnapshot:async({context:e})=>{e._snapshot&&await this.#ez.persistWorkflowSnapshot()},decrementAttemptCount:tc({attempts:({context:e,event:t},r)=>{if(!tk(t))return e.attempts;let{stepId:s}=r,o=e.attempts[s];return void 0===o?e.attempts:{...e.attempts,[s]:o-1}}})}}#e3(){return{resolverFunction:tb(async({input:e})=>{let{stepNode:t,context:r}=e,s=this.#e4({stepConfig:t.config,context:r,stepId:t.step.id});this.logger.debug(`Resolved variables for ${t.step.id}`,{resolvedData:s,runId:this.#eG});let o=await t.config.handler({context:s,suspend:async e=>{await this.#ez.suspend(t.step.id,this),this.#eK?(r.steps[t.step.id]={status:"suspended",suspendPayload:e},this.logger.debug(`Sending SUSPENDED event for step ${t.step.id}`),this.#eK?.send({type:"SUSPENDED",suspendPayload:e,stepId:t.step.id})):this.logger.debug(`Actor not available for step ${t.step.id}`)},runId:this.#eG,mastra:this.#eW});return this.logger.debug(`Step ${t.step.id} result`,{stepId:t.step.id,result:o,runId:this.#eG}),{stepId:t.step.id,result:o}}),conditionCheck:tb(async({input:e})=>{let{context:t,stepNode:r}=e,s=r.config,o=t.attempts[r.step.id];return(this.logger.debug(`Checking conditions for step ${r.step.id}`,{stepId:r.step.id,runId:this.#eG}),this.logger.debug(`Attempt count for step ${r.step.id}`,{attemptCount:o,attempts:t.attempts,runId:this.#eG,stepId:r.step.id}),!o||o<0)?s?.snapshotOnTimeout?{type:"SUSPENDED",stepId:r.step.id}:{type:"CONDITION_FAILED",error:`Step:${r.step.id} condition check failed`}:s?.when?(this.logger.debug(`Checking conditions for step ${r.step.id}`,{stepId:r.step.id,runId:this.#eG}),"function"==typeof s?.when)?await s.when({context:{...t,getStepResult:e=>{if("trigger"===e)return t.triggerData;let r=t.steps[e];if(r&&"success"===r.status)return r.output}},mastra:this.#eW})?(this.logger.debug(`Condition met for step ${r.step.id}`,{stepId:r.step.id,runId:this.#eG}),{type:"CONDITIONS_MET"}):!o||o<0?{type:"CONDITION_FAILED",error:`Step:${r.step.id} condition check failed`}:{type:"WAITING",stepId:r.step.id}:this.#e8(s.when,t)?{type:"CONDITIONS_MET"}:{type:"CONDITION_FAILED",error:`Step:${r.step.id} condition check failed`}:{type:"CONDITIONS_MET"}}),spawnSubscriberFunction:tb(async({input:e})=>{let{parentStepId:t,context:r}=e,s=await this.#ez.runMachine(t,r);return Promise.resolve({steps:s?.results})})}}#e4({stepConfig:e,context:t,stepId:r}){this.logger.debug(`Resolving variables for step ${r}`,{stepId:r,runId:this.#eG});let s={...t,getStepResult:e=>{if("trigger"===e)return t.triggerData;let r=t.steps[e];if(r&&"success"===r.status)return r.output}};for(let[r,o]of Object.entries(e.data)){let e="trigger"===o.step?t.triggerData:tO(t.steps[o.step.id]);if(this.logger.debug(`Got source data for ${r} variable from ${"trigger"===o.step?"trigger":o.step.id}`,{sourceData:e,path:o.path,runId:this.#eG}),!e&&"trigger"!==o.step){s[r]=void 0;continue}let i=""===o.path||"."===o.path?e:d(e,o.path);this.logger.debug(`Resolved variable ${r}`,{value:i,runId:this.#eG}),s[r]=i}return s}initializeMachine(){let e=(function({schemas:e,actors:t,actions:r,guards:s,delays:o}){return{createMachine:i=>new tE({...i,schemas:e},{actors:t,actions:r,guards:s,delays:o})}})({types:{},delays:this.#e1(),actions:this.#e2(),actors:this.#e3()}).createMachine({id:this.name,type:"parallel",context:({input:e})=>({...e}),states:this.#e6(this.#eJ)});return this.#eH=e,e}#e6(e){let t={};return e.initial.forEach(r=>{let s=[...e[r.step.id]||[]];t[r.step.id]={...this.#e9(r,s)}}),t}#e9(e,t=[]){let r=t.shift();return{initial:"pending",on:{RESET_TO_PENDING:{target:".pending"}},states:{pending:{entry:()=>{this.logger.debug(`Step ${e.step.id} pending`,{stepId:e.step.id,runId:this.#eG})},exit:()=>{this.logger.debug(`Step ${e.step.id} finished pending`,{stepId:e.step.id,runId:this.#eG})},invoke:{src:"conditionCheck",input:({context:t})=>({context:t,stepNode:e}),onDone:[{guard:({event:e})=>"SUSPENDED"===e.output.type,target:"suspended",actions:[tc({steps:({context:t,event:r})=>"SUSPENDED"!==r.output.type?t.steps:{...t.steps,[e.step.id]:{status:"suspended",...t.steps?.[e.step.id]||{}}},attempts:({context:t,event:r})=>"SUSPENDED"!==r.output.type?t.attempts:{...t.attempts,[e.step.id]:e.step.retryConfig?.attempts||3}})]},{guard:({event:e})=>"WAITING"===e.output.type,target:"waiting",actions:[{type:"decrementAttemptCount",params:{stepId:e.step.id}},tc({steps:({context:t,event:r})=>"WAITING"!==r.output.type?t.steps:{...t.steps,[e.step.id]:{status:"waiting"}}})]},{guard:({event:e})=>"CONDITIONS_MET"===e.output.type,target:"executing"},{guard:({event:e})=>"CONDITION_FAILED"===e.output.type,target:"failed",actions:tc({steps:({context:t,event:r})=>"CONDITION_FAILED"!==r.output.type?t.steps:(this.logger.debug("Workflow condition check failed",{error:r.output.error,stepId:e.step.id}),{...t.steps,[e.step.id]:{status:"failed",error:r.output.error}})})}]}},waiting:{entry:()=>{this.logger.debug(`Step ${e.step.id} waiting`,{stepId:e.step.id,timestamp:new Date().toISOString(),runId:this.#eG})},exit:()=>{this.logger.debug(`Step ${e.step.id} finished waiting`,{stepId:e.step.id,timestamp:new Date().toISOString(),runId:this.#eG})},after:{[e.step.id]:{target:"pending"}}},suspended:{type:"final",entry:[()=>{this.logger.debug(`Step ${e.step.id} suspended`,{stepId:e.step.id,runId:this.#eG})},tc({steps:({context:t,event:r})=>({...t.steps,[e.step.id]:{...t?.steps?.[e.step.id]||{},status:"suspended",suspendPayload:"SUSPENDED"===r.type?r.suspendPayload:void 0}})})]},executing:{entry:()=>{this.logger.debug(`Step ${e.step.id} executing`,{stepId:e.step.id,runId:this.#eG})},on:{SUSPENDED:{target:"suspended",actions:[tc({steps:({context:t,event:r})=>({...t.steps,[e.step.id]:{status:"suspended",suspendPayload:"SUSPENDED"===r.type?r.suspendPayload:void 0}})})]}},invoke:{src:"resolverFunction",input:({context:t})=>({context:t,stepNode:e}),onDone:{target:"runningSubscribers",actions:[({event:t})=>this.logger.debug(`Step ${e.step.id} finished executing`,{stepId:e.step.id,output:t.output,runId:this.#eG}),{type:"updateStepResult",params:{stepId:e.step.id}},{type:"spawnSubscribers",params:{stepId:e.step.id}}]},onError:{target:"failed",actions:[{type:"setStepError",params:{stepId:e.step.id}}]}}},runningSubscribers:{entry:()=>{this.logger.debug(`Step ${e.step.id} running subscribers`,{stepId:e.step.id,runId:this.#eG})},exit:()=>{this.logger.debug(`Step ${e.step.id} finished running subscribers`,{stepId:e.step.id,runId:this.#eG})},invoke:{src:"spawnSubscriberFunction",input:({context:t})=>({parentStepId:e.step.id,context:t}),onDone:{target:r?r.step.id:"completed",actions:[tc({steps:({context:e,event:t})=>({...e.steps,...t.output.steps})}),()=>this.logger.debug("Subscriber execution completed",{stepId:e.step.id})]},onError:{target:r?r.step.id:"completed",actions:({event:t})=>{this.logger.debug("Subscriber execution failed",{error:t.error,stepId:e.step.id})}}}},completed:{type:"final",entry:[{type:"notifyStepCompletion",params:{stepId:e.step.id}},{type:"snapshotStep",params:{stepId:e.step.id}},{type:"persistSnapshot"}]},failed:{type:"final",entry:[{type:"notifyStepCompletion",params:{stepId:e.step.id}},{type:"snapshotStep",params:{stepId:e.step.id}},{type:"persistSnapshot"}]},...r?{[r.step.id]:{...this.#e9(r,t)}}:{}}}}#e8(e,t){let r=!0,s=!0,o=!0,i=Object.entries(e).find(([e])=>e.includes("."));if(i){let[e,r]=i,[o,...a]=e.split("."),l=a.join("."),u="trigger"===o?t.triggerData:tO(t.steps[o]);if(this.logger.debug(`Got condition data from step ${o}`,{stepId:o,sourceData:u,runId:this.#eG}),!u)return!1;let c=d(u,l);"trigger"===o||"status"!==l||c||(c="success"),s="object"==typeof r&&null!==r?er(r)(c):c===r}if("ref"in e){let{ref:r,query:o}=e,i="trigger"===r.step?t.triggerData:tO(t.steps[r.step.id]);if(this.logger.debug(`Got condition data from ${"trigger"===r.step?"trigger":r.step.id}`,{sourceData:i,runId:this.#eG}),!i)return!1;let a=d(i,r.path);"trigger"===r.step||"status"!==r.path||a||(a="success"),s=er(o)(a)}"and"in e&&(r=e.and.every(e=>this.#e8(e,t)),this.logger.debug("Evaluated AND condition",{andBranchResult:r,runId:this.#eG})),"or"in e&&(o=e.or.some(e=>this.#e8(e,t)),this.logger.debug("Evaluated OR condition",{orBranchResult:o,runId:this.#eG}));let a=s&&r&&o;return this.logger.debug("Evaluated condition",{finalResult:a,runId:this.#eG}),a}getSnapshot(){return this.#eK?.getSnapshot()}},tP=class{name;#eW;#e5={};logger;#eQ={};#eJ;#e7={};#eX;#eG;#te=null;#eZ;#tt=new Set;#tr;#ts={};constructor({name:e,logger:t,steps:r,runId:s,retryConfig:o,mastra:i,stepGraph:a,stepSubscriberGraph:l,onStepTransition:u,onFinish:c}){this.name=e,this.logger=t,this.#eQ=r,this.#eJ=a,this.#e7=l,this.#eX=o,this.#eW=i,this.#eG=s??crypto.randomUUID(),this.#tt=u,this.#tr=c}setState(e){this.#te=e}get runId(){return this.#eG}get executionSpan(){return this.#eZ}async start({triggerData:e}={}){let t=await this.execute({triggerData:e});return this.#tr&&this.#tr(),{...t,runId:this.runId}}async execute({triggerData:e,snapshot:t,stepId:r}={}){this.#eZ=this.#eW?.telemetry?.tracer.startSpan(`workflow.${this.name}.execute`,{attributes:{componentName:this.name,runId:this.runId}});let s={steps:{},triggerData:e||{},attempts:Object.keys(this.#eQ).reduce((e,t)=>(e[t]=this.#eQ[t]?.retryConfig?.attempts||this.#eX?.attempts||3,e),{})},o=this.#eJ,i="trigger";t&&(s=t.context,r&&t?.suspendedSteps?.[r]&&(i=t.suspendedSteps[r],o=this.#e7[i]??this.#eJ));let a=new tA({logger:this.logger,mastra:this.#eW,workflowInstance:this,name:this.name,runId:this.runId,steps:this.#eQ,stepGraph:o,executionSpan:this.#eZ,startStepId:i});this.#e5[i]=a,a.on("state-update",(e,t,r)=>{"trigger"===e?this.#te=t:this.#te=tj(e,this.#te,t);let s=Date.now();this.#tt&&this.#tt.forEach(e=>{e({runId:this.#eG,value:this.#te,context:r,activePaths:tT(this.#te),timestamp:s})})});let{results:l,activePaths:u}=await a.execute({snapshot:t,stepId:r,input:s});return await this.persistWorkflowSnapshot(),{results:l,activePaths:u}}async runMachine(e,t){if(!this.#e7[e])return;let r=new tA({logger:this.logger,mastra:this.#eW,workflowInstance:this,name:"trigger"===e?this.name:`${this.name}-${e}`,runId:this.runId,steps:this.#eQ,stepGraph:this.#e7[e],executionSpan:this.#eZ,startStepId:e});return r.on("state-update",(e,t,r)=>{"trigger"===e?this.#te=t:this.#te=tj(e,this.#te,t);let s=Date.now();this.#tt&&this.#tt.forEach(e=>{e({runId:this.#eG,value:this.#te,context:r,activePaths:tT(this.#te),timestamp:s})})}),this.#e5[e]=r,await r.execute({input:t})}async suspend(e,t){this.#ts[e]=t}async persistWorkflowSnapshot(){let e=await this.#eW?.storage?.loadWorkflowSnapshot({workflowName:this.name,runId:this.#eG}),t={};for(let[e,r]of Object.entries(this.#e5)){let s=r?.getSnapshot();s&&(t[e]={...s})}let r=t.trigger;delete t.trigger;let s=Object.entries(this.#ts).reduce((e,[t,r])=>(e[t]=r.startStepId,e),{});if(!r&&e){e.childStates={...e.childStates,...t},e.suspendedSteps={...e.suspendedSteps,...s},await this.#eW?.storage?.persistWorkflowSnapshot({workflowName:this.name,runId:this.#eG,snapshot:e});return}if(r&&!e){r.suspendedSteps=s,r.childStates={...t},await this.#eW?.storage?.persistWorkflowSnapshot({workflowName:this.name,runId:this.#eG,snapshot:r});return}if(!r){this.logger.debug("Snapshot cannot be persisted. No snapshot received.",{runId:this.#eG});return}if(r.suspendedSteps={...e.suspendedSteps,...s},!e||r===e){await this.#eW?.storage?.persistWorkflowSnapshot({workflowName:this.name,runId:this.#eG,snapshot:r});return}e?.childStates?r.childStates={...e.childStates,...t}:r.childStates=t,await this.#eW?.storage?.persistWorkflowSnapshot({workflowName:this.name,runId:this.#eG,snapshot:r})}async getState(){let e=await this.#eW?.storage?.loadWorkflowSnapshot({workflowName:this.name,runId:this.runId}),t=e?{trigger:e,...Object.entries(e?.childStates??{}).reduce((e,[t,r])=>({...e,[t]:r}),{})}:{};Object.assign(t,Object.entries(this.#e5).reduce((e,[t,r])=>{let s=r.getSnapshot();return s?{...e,[t]:s}:e},{}));let r=t.trigger;delete t.trigger;let s={...r},o=tT(t.value);return{runId:this.runId,value:s.value,context:s.context,activePaths:o,timestamp:Date.now()}}},tN=class extends i.o{name;triggerSchema;#eX;#eW;#tn=new Map;#to=[];#ti=[];#eJ={initial:[]};#e7={};#eQ={};#tt=new Set;constructor({name:e,triggerSchema:t,retryConfig:r,mastra:s}){super({component:"WORKFLOW",name:e}),this.name=e,this.#eX=r,this.triggerSchema=t,this.#eW=s,s?.logger&&(this.logger=s?.logger)}step(e,t){let{variables:r={}}=t||{},s={};for(let[e,t]of Object.entries(r))t&&tI(t)&&(s[e]=t);let o=this.#ta(e),i={step:e,config:{...this.#tl(o),...t,data:s}};this.#eQ[o]=e;let a=this.#to[this.#to.length-1],l=this.#e7[a||""];return a&&l?(l.initial.some(e=>e.step.id===o)||l.initial.push(i),l[o]=[]):(this.#eJ[o]||(this.#eJ[o]=[]),this.#eJ.initial.push(i)),this.#ti.push(o),this}#ta(e){return`${e.id}`}then(e,t){let{variables:r={}}=t||{},s={};for(let[e,t]of Object.entries(r))t&&tI(t)&&(s[e]=t);let o=this.#ti[this.#ti.length-1],i=this.#ta(e),a={step:e,config:{...this.#tl(i),...t,data:s}};if(this.#eQ[i]=e,!o)return this;let l=this.#to[this.#to.length-1],u=this.#e7[l||""];return l&&u&&u[o]?u[o].push(a):(this.#eJ[o]||(this.#eJ[o]=[]),this.#eJ[o].push(a)),this}after(e){let t=this.#ta(e);return this.#to.push(t),this.#e7[t]||(this.#e7[t]={initial:[]}),this}createRun(){let e=new tP({logger:this.logger,name:this.name,mastra:this.#eW,retryConfig:this.#eX,steps:this.#eQ,stepGraph:this.#eJ,stepSubscriberGraph:this.#e7,onStepTransition:this.#tt,onFinish:()=>{this.#tn.delete(e.runId)}});return this.#tn.set(e.runId,e),{start:e.start.bind(e),runId:e.runId}}commit(){return this}#tu({value:e,path:t,suspendedPaths:r}){"string"==typeof e?"suspended"===e&&r.add(t):Object.keys(e).forEach(s=>this.#tu({value:e[s],path:t?`${t}.${s}`:s,suspendedPaths:r}))}async #tc(e){if(!this.#eW?.storage){this.logger.debug("Snapshot cannot be loaded. Mastra engine is not initialized",{runId:e});return}let t=this.#tn.get(e);return t&&await t.persistWorkflowSnapshot(),this.#eW.storage.loadWorkflowSnapshot({runId:e,workflowName:this.name})}getExecutionSpan(e){return this.#tn.get(e)?.executionSpan}#tl(e){let t=(e,t,r)=>async s=>await l.D.with(u.g.setSpan(l.D.active(),this.getExecutionSpan(r?.runId??s?.runId)),async()=>this.#eW.telemetry.traceMethod(e,{spanName:t,attributes:r})(s)),r=async({context:r,...s})=>{let o=this.#eQ[e];if(!o)throw Error("Step not found");let{payload:i={},execute:a=async()=>{}}=o,l={...i,...r},u=this.#eW?.telemetry?t(a,`workflow.${this.name}.action.${e}`,{componentName:this.name,runId:s.runId}):a;return u?await u({context:l,...s}):{}};return{handler:({context:s,...o})=>this.getExecutionSpan(o?.runId)?t(r,`workflow.${this.name}.step.${e}`,{componentName:this.name,runId:o?.runId})({context:s,...o}):r({context:s,...o}),data:{}}}#td(e){let t=[],r=(e,s=[])=>{for(let[o,i]of Object.entries(e)){let e=[...s,o];"string"==typeof i?t.push({stepPath:e,stepId:o,status:i}):"object"==typeof i&&null!==i&&r(i,e)}};return r(e),t}async getState(e){let t=this.#tn.get(e);if(t)return t.getState();let r=await this.#eW?.storage?.loadWorkflowSnapshot({runId:e,workflowName:this.name});if(r){let t=this.#td(r.value);return{runId:e,value:r.value,context:r.context,activePaths:t,timestamp:Date.now()}}return null}watch(e){return this.#tt.add(e),()=>{this.#tt.delete(e)}}async resume({runId:e,stepId:t,context:r}){return await (0,a.setTimeout)(0),this._resume({runId:e,stepId:t,context:r})}async _resume({runId:e,stepId:t,context:r}){let s;let o=await this.#tc(e);if(!o)throw Error(`No snapshot found for workflow run ${e}`);try{s="string"==typeof o?JSON.parse(o):o}catch(t){throw this.logger.debug("Failed to parse workflow snapshot for resume",{error:t,runId:e}),Error("Failed to parse workflow snapshot")}let i=s,a=s.suspendedSteps?.[t];if(!a)return;if(!(s="trigger"===a?s:{...s?.childStates?.[a],suspendedSteps:s.suspendedSteps}))throw Error(`No snapshot found for step: ${t} starting at ${a}`);r&&(s.context.steps[t]={status:"success",output:{...s?.context?.steps?.[t]?.output||{},...r}}),s.children&&Object.entries(s.children).forEach(([e,t])=>{if(t.snapshot?.input?.stepNode){let e=this.#tl(t.snapshot.input.stepNode.step.id);t.snapshot.input.stepNode.config={...t.snapshot.input.stepNode.config,...e},t.snapshot.input.context=s.context}}),s.value=tC(s.value,t),s.context?.attempts&&(s.context.attempts[t]=this.#eQ[t]?.retryConfig?.attempts||this.#eX?.attempts||3),this.logger.debug("Resuming workflow with updated snapshot",{updatedSnapshot:s,runId:e,stepId:t});let l=this.#tn.get(e)??new tP({logger:this.logger,name:this.name,mastra:this.#eW,retryConfig:this.#eX,steps:this.#eQ,stepGraph:this.#eJ,stepSubscriberGraph:this.#e7,onStepTransition:this.#tt,runId:e,onFinish:()=>{this.#tn.delete(l.runId)}});return l.setState(i?.value),this.#tn.set(l.runId,l),l?.execute({snapshot:s,stepId:t})}__registerPrimitives(e){e.telemetry&&this.__setTelemetry(e.telemetry),e.logger&&this.__setLogger(e.logger),this.#eW=e}get stepGraph(){return this.#eJ}get stepSubscriberGraph(){return this.#e7}get steps(){return this.#eQ}},tq=class{id;description;inputSchema;outputSchema;payload;execute;retryConfig;mastra;constructor({id:e,description:t,execute:r,payload:s,outputSchema:o,inputSchema:i,retryConfig:a}){this.id=e,this.description=t??"",this.inputSchema=i,this.payload=s,this.outputSchema=o,this.execute=r,this.retryConfig=a}}},15412:(e,t,r)=>{"use strict";r.d(t,{Co:()=>g,pL:()=>y,xl:()=>d});var s=Object.create,o=Object.defineProperty,i=Object.getOwnPropertyDescriptor,a=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),l=e=>{throw TypeError(e)},u=(e,t,r)=>t in e?o(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,c=(e,t)=>o(e,"name",{value:t,configurable:!0}),d=e=>[,,,s(e?.[a("metadata")]??null)],p=["class","method","getter","setter","accessor","field","value","get","set"],h=e=>void 0!==e&&"function"!=typeof e?l("Function expected"):e,f=(e,t,r,s,o)=>({kind:p[e],name:t,metadata:s,addInitializer:e=>r._?l("Already initialized"):o.push(h(e||null))}),m=(e,t)=>u(t,a("metadata"),e[3]),g=(e,t,r,s)=>{for(var o=0,i=e[t>>1],a=i&&i.length;o<a;o++)1&t?i[o].call(r):s=i[o].call(r,s);return s},y=(e,t,r,s,a,u)=>{var d,g,y,b,E,k=7&t,I=!!(8&t),O=!!(16&t),T=k>3?e.length+1:k?I?1:2:0,j=p[k+5],C=k>3&&(e[T-1]=[]),R=e[T]||(e[T]=[]),A=k&&(O||I||(a=a.prototype),k<5&&(k>3||!O)&&i(k<4?a:{get[r](){return v(this,u)},set[r](x){return w(this,u,x)}},r));k?O&&k<4&&c(u,(k>2?"set ":k>1?"get ":"")+r):c(a,r);for(var P=s.length-1;P>=0;P--)b=f(k,r,y={},e[3],R),k&&(b.static=I,b.private=O,E=b.access={has:O?e=>_(a,e):e=>r in e},3^k&&(E.get=O?e=>(1^k?v:S)(e,a,4^k?u:A.get):e=>e[r]),k>2&&(E.set=O?(e,t)=>w(e,a,t,4^k?u:A.set):(e,t)=>e[r]=t)),g=(0,s[P])(k?k<4?O?u:A[j]:k>4?void 0:{get:A.get,set:A.set}:a,b),y._=1,4^k||void 0===g?h(g)&&(k>4?C.unshift(g):k?O?u=g:A[j]=g:a=g):"object"!=typeof g||null===g?l("Object expected"):(h(d=g.get)&&(A.get=d),h(d=g.set)&&(A.set=d),h(d=g.init)&&C.unshift(d));return k||m(e,a),A&&o(a,r,A),O?4^k?u:A:a},b=(e,t,r)=>t.has(e)||l("Cannot "+r),_=(e,t)=>Object(t)!==t?l('Cannot use the "in" operator on this value'):e.has(t),v=(e,t,r)=>(b(e,t,"read from private field"),r?r.call(e):t.get(e)),w=(e,t,r,s)=>(b(e,t,"write to private field"),s?s.call(e,r):t.set(e,r),r),S=(e,t,r)=>(b(e,t,"access private method"),r)},14735:(e,t,r)=>{"use strict";r.d(t,{L:()=>u});var s=r(25665),o=r(6746),i=r(49411),a=r(26363);function l(e){try{return JSON.parse(e)}catch{return{}}}var u=class extends s.i{client;constructor({config:e}){super({name:"LibSQLStore"}),this.client=(0,a.e)({url:this.rewriteDbUrl(e.url),authToken:e.authToken})}rewriteDbUrl(e){if(e.startsWith("file:")&&!e.startsWith("file:/")){let t=process.cwd(),r=e.slice(5);if(t.endsWith(".mastra")||t.endsWith(".mastra/")){let s=(0,i.join)(t,".."),o=(0,i.join)(s,r);return this.logger.debug(`Initializing LibSQL db with url ${e} with relative file path from inside .mastra directory. Rewriting relative file url to "file:${o}". This ensures it's outside the .mastra directory. If the db is stored inside .mastra it will be deleted when Mastra re-bundles code.`),`file:${o}`}}return e}getCreateTableSQL(e,t){let r=Object.entries(t).map(([e,t])=>{let r=t.type.toUpperCase();"TEXT"===r&&(r="TEXT"),"TIMESTAMP"===r&&(r="TEXT");let s=t.nullable?"":"NOT NULL",o=t.primaryKey?"PRIMARY KEY":"";return`${e} ${r} ${s} ${o}`.trim()});return e===o.vP?`CREATE TABLE IF NOT EXISTS ${e} (
                ${r.join(",\n")},
                PRIMARY KEY (workflow_name, run_id)
            )`:`CREATE TABLE IF NOT EXISTS ${e} (${r.join(", ")})`}async createTable({tableName:e,schema:t}){try{this.logger.debug("Creating database table",{tableName:e,operation:"schema init"});let r=this.getCreateTableSQL(e,t);await this.client.execute(r)}catch(t){throw this.logger.error(`Error creating table ${e}: ${t}`),t}}async clearTable({tableName:e}){try{await this.client.execute(`DELETE FROM ${e}`)}catch(e){e instanceof Error&&this.logger.error(e.message)}}prepareStatement({tableName:e,record:t}){let r=Object.keys(t),s=Object.values(t).map(e=>void 0===e?null:"object"==typeof e?JSON.stringify(e):e),o=s.map(()=>"?").join(", ");return{sql:`INSERT OR REPLACE INTO ${e} (${r.join(", ")}) VALUES (${o})`,args:s}}async insert({tableName:e,record:t}){try{await this.client.execute(this.prepareStatement({tableName:e,record:t}))}catch(t){throw this.logger.error(`Error upserting into table ${e}: ${t}`),t}}async batchInsert({tableName:e,records:t}){if(0!==t.length)try{let r=t.map(t=>this.prepareStatement({tableName:e,record:t}));await this.client.batch(r,"write")}catch(t){throw this.logger.error(`Error upserting into table ${e}: ${t}`),t}}async load({tableName:e,keys:t}){let r=Object.entries(t).map(([e])=>`${e} = ?`).join(" AND "),s=Object.values(t),o=await this.client.execute({sql:`SELECT * FROM ${e} WHERE ${r} ORDER BY createdAt DESC LIMIT 1`,args:s});return o.rows&&0!==o.rows.length?Object.fromEntries(Object.entries(o.rows[0]||{}).map(([e,t])=>{try{return[e,"string"==typeof t?JSON.parse(t):t]}catch{return[e,t]}})):null}async getThreadById({threadId:e}){let t=await this.load({tableName:o.i1,keys:{id:e}});return t?{...t,metadata:"string"==typeof t.metadata?JSON.parse(t.metadata):t.metadata}:null}async getThreadsByResourceId({resourceId:e}){let t=await this.client.execute({sql:`SELECT * FROM ${o.i1} WHERE resourceId = ?`,args:[e]});return t.rows?t.rows.map(e=>({id:e.id,resourceId:e.resourceId,title:e.title,createdAt:e.createdAt,updatedAt:e.updatedAt,metadata:"string"==typeof e.metadata?JSON.parse(e.metadata):e.metadata})):[]}async saveThread({thread:e}){return await this.insert({tableName:o.i1,record:{...e,metadata:JSON.stringify(e.metadata)}}),e}async updateThread({id:e,title:t,metadata:r}){let s=await this.getThreadById({threadId:e});if(!s)throw Error(`Thread ${e} not found`);let i={...s,title:t,metadata:{...s.metadata,...r}};return await this.client.execute({sql:`UPDATE ${o.i1} SET title = ?, metadata = ? WHERE id = ?`,args:[t,JSON.stringify(i.metadata),e]}),i}async deleteThread({threadId:e}){await this.client.execute({sql:`DELETE FROM ${o.i1} WHERE id = ?`,args:[e]})}parseRow(e){let t=e.content;try{t=JSON.parse(e.content)}catch{}return{id:e.id,content:t,role:e.role,type:e.type,createdAt:new Date(e.createdAt),threadId:e.thread_id}}async getMessages({threadId:e,selectBy:t}){try{let r=[],s="number"==typeof t?.last?t.last:40;if(t?.include?.length){let s=t.include.map(e=>e.id),i=Math.max(...t.include.map(e=>e.withPreviousMessages||0)),a=Math.max(...t.include.map(e=>e.withNextMessages||0)),l=await this.client.execute({sql:`
            WITH numbered_messages AS (
              SELECT 
                id,
                content,
                role,
                type,
                "createdAt",
                thread_id,
                ROW_NUMBER() OVER (ORDER BY "createdAt" ASC) as row_num
              FROM "${o.Zb}"
              WHERE thread_id = ?
            ),
            target_positions AS (
              SELECT row_num as target_pos
              FROM numbered_messages
              WHERE id IN (${s.map(()=>"?").join(", ")})
            )
            SELECT DISTINCT m.*
            FROM numbered_messages m
            CROSS JOIN target_positions t
            WHERE m.row_num BETWEEN (t.target_pos - ?) AND (t.target_pos + ?)
            ORDER BY m."createdAt" ASC
          `,args:[e,...s,i,a]});l.rows&&r.push(...l.rows.map(e=>this.parseRow(e)))}let i=r.map(e=>e.id),a=`
        SELECT 
          id, 
          content, 
          role, 
          type,
          "createdAt", 
          thread_id
        FROM "${o.Zb}"
        WHERE thread_id = ?
        ${i.length?`AND id NOT IN (${i.map(()=>"?").join(", ")})`:""}
        ORDER BY "createdAt" DESC
        LIMIT ?
      `,l=[e,...i.length?i:[],s],u=await this.client.execute({sql:a,args:l});return u.rows&&r.push(...u.rows.map(e=>this.parseRow(e))),r.sort((e,t)=>e.createdAt.getTime()-t.createdAt.getTime()),r}catch(e){throw this.logger.error("Error getting messages:",e),e}}async saveMessages({messages:e}){if(0===e.length)return e;let t=await this.client.transaction("write");try{let r=e[0]?.threadId;if(!r)throw Error("Thread ID is required");for(let s of e){let e=s.createdAt||new Date;await t.execute({sql:`INSERT INTO ${o.Zb} (id, thread_id, content, role, type, createdAt) 
                              VALUES (?, ?, ?, ?, ?, ?)`,args:[s.id,r,"object"==typeof s.content?JSON.stringify(s.content):s.content,s.role,s.type,e instanceof Date?e.toISOString():e]})}return await t.commit(),e}catch(e){throw this.logger.error("Failed to save messages in database: "+e?.message),await t.rollback(),e}}transformEvalRow(e){let t=JSON.parse(e.result),r=e.test_info?JSON.parse(e.test_info):void 0;if(!t||"object"!=typeof t||!("score"in t))throw Error(`Invalid MetricResult format: ${JSON.stringify(t)}`);return{input:e.input,output:e.output,result:t,agentName:e.agent_name,metricName:e.metric_name,instructions:e.instructions,testInfo:r,globalRunId:e.global_run_id,runId:e.run_id,createdAt:e.created_at}}async getEvalsByAgentName(e,t){try{let r=`SELECT * FROM ${o.a4} WHERE agent_name = ?`,s=await this.client.execute({sql:`${r}${"test"===t?" AND test_info IS NOT NULL AND test_info->>'testPath' IS NOT NULL":"live"===t?" AND (test_info IS NULL OR test_info->>'testPath' IS NULL)":""} ORDER BY created_at DESC`,args:[e]});return s.rows?.map(e=>this.transformEvalRow(e))??[]}catch(e){if(e instanceof Error&&e.message.includes("no such table"))return[];throw this.logger.error("Failed to get evals for the specified agent: "+e?.message),e}}async getTraces({name:e,scope:t,page:r,perPage:s,attributes:i}={page:0,perPage:100}){let a=[],u=[];e&&u.push("name LIKE CONCAT(?, '%')"),t&&u.push("scope = ?"),i&&Object.keys(i).forEach(e=>{u.push(`attributes->>'$.${e}' = ?`)});let c=u.length>0?`WHERE ${u.join(" AND ")}`:"";if(e&&a.push(e),t&&a.push(t),i)for(let[e,t]of Object.entries(i))a.push(t);a.push(s,r*s);let d=await this.client.execute({sql:`SELECT * FROM ${o.Xd} ${c} ORDER BY "startTime" DESC LIMIT ? OFFSET ?`,args:a});return d.rows?d.rows.map(e=>({id:e.id,parentSpanId:e.parentSpanId,traceId:e.traceId,name:e.name,scope:e.scope,kind:e.kind,status:l(e.status),events:l(e.events),links:l(e.links),attributes:l(e.attributes),startTime:e.startTime,endTime:e.endTime,other:l(e.other),createdAt:e.createdAt})):[]}}},65987:(e,t,r)=>{"use strict";r.d(t,{o:()=>o});var s=r(81046),o=class{component=s.pU.LLM;logger;name;telemetry;constructor({component:e,name:t}){this.component=e||s.pU.LLM,this.name=t,this.logger=(0,s.hu)({name:`${this.component} - ${this.name}`})}__setLogger(e){this.logger=e,this.logger.debug(`Logger updated [component=${this.component}] [name=${this.name}]`)}__setTelemetry(e){this.telemetry=e,this.logger.debug(`Telemetry updated [component=${this.component}] [tracer=${this.telemetry.tracer}]`)}__getTelemetry(){return this.telemetry}get experimental_telemetry(){return this.telemetry?{tracer:this.telemetry.getBaggageTracer(),isEnabled:!!this.telemetry.tracer}:void 0}}},81046:(e,t,r)=>{"use strict";r.d(t,{AS:()=>d,hu:()=>c,in:()=>l,pU:()=>a});var s=r(76162),o=r(93018),i=r(65289),a={AGENT:"AGENT",WORKFLOW:"WORKFLOW",LLM:"LLM",TTS:"TTS",VOICE:"VOICE",VECTOR:"VECTOR",BUNDLER:"BUNDLER",DEPLOYER:"DEPLOYER",MEMORY:"MEMORY",STORAGE:"STORAGE",EMBEDDINGS:"EMBEDDINGS"},l={DEBUG:"debug",INFO:"info",WARN:"warn",ERROR:"error",NONE:"silent"};s.Transform;var u=class{logger;transports;constructor(e={}){this.transports=e.transports||{};let t=Object.entries(this.transports);this.logger=o({name:e.name||"app",level:e.level||l.INFO},e.overrideDefaultTransports?e?.transports?.default:0===t.length?i({colorize:!0,levelFirst:!0,ignore:"pid,hostname",colorizeObjects:!0,translateTime:"SYS:standard",singleLine:!1}):o.multistream([...t.map(([t,r])=>({stream:r,level:e.level||l.INFO})),{stream:i({colorize:!0,levelFirst:!0,ignore:"pid,hostname",colorizeObjects:!0,translateTime:"SYS:standard",singleLine:!1}),level:e.level||l.INFO}]))}debug(e,t={}){this.logger.debug(t,e)}info(e,t={}){this.logger.info(t,e)}warn(e,t={}){this.logger.warn(t,e)}error(e,t={}){this.logger.error(t,e)}createStream(){return new s.Transform({transform:(e,t,r)=>{let s=e.toString().trim();s&&this.info(s),r(null,e)}})}async getLogs(e){return e&&this.transports[e]?this.transports[e].getLogs():[]}async getLogsByRunId({runId:e,transportId:t}){return this.transports[t]?.getLogsByRunId({runId:e})}};function c(e){return new u(e)}var d={debug:()=>{},info:()=>{},warn:()=>{},error:()=>{},cleanup:async()=>{}}},6746:(e,t,r)=>{"use strict";r.d(t,{Xd:()=>l,Zb:()=>i,a4:()=>o,i1:()=>a,vP:()=>s});var s="mastra_workflow_snapshot",o="mastra_evals",i="mastra_messages",a="mastra_threads",l="mastra_traces"},50134:(e,t,r)=>{"use strict";r.d(t,{B$:()=>I,Mm:()=>O,M0:()=>T});var s,o=r(6746),i=r(14586),a=r(25386),l=r(57159),u=r(90147),c=r(40874);!function(e){e[e.SUCCESS=0]="SUCCESS",e[e.FAILED=1]="FAILED"}(s||(s={}));var d=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var s,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(s=i.next()).done;)a.push(s.value)}catch(e){o={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a};function p(e){return Object.keys(e).map(function(t){return function e(t,r){return{key:t,value:function t(r){var s=typeof r;return"string"===s?{stringValue:r}:"number"===s?Number.isInteger(r)?{intValue:r}:{doubleValue:r}:"boolean"===s?{boolValue:r}:r instanceof Uint8Array?{bytesValue:r}:Array.isArray(r)?{arrayValue:{values:r.map(t)}}:"object"===s&&null!=r?{kvlistValue:{values:Object.entries(r).map(function(t){var r=d(t,2);return e(r[0],r[1])})}}:{}}(r)}}(t,e[t])})}function h(e){return e>=48&&e<=57?e-48:e>=97&&e<=102?e-87:e-55}function f(e){for(var t=new Uint8Array(e.length/2),r=0,s=0;s<e.length;s+=2){var o=h(e.charCodeAt(s)),i=h(e.charCodeAt(s+1));t[r++]=o<<4|i}return t}function m(e){var t=BigInt(1e9);return BigInt(e[0])*t+BigInt(e[1])}function g(e){var t;return{low:Number(BigInt.asUintN(32,t=m(e))),high:Number(BigInt.asUintN(32,t>>BigInt(32)))}}var y="undefined"!=typeof BigInt?function(e){return m(e).toString()}:function(e){return 1e9*e[0]+e[1]};function b(e){return e}function _(e){if(void 0!==e)return f(e)}var v={encodeHrTime:g,encodeSpanContext:f,encodeOptionalSpanContext:_},w=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],s=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&s>=e.length&&(e=void 0),{value:e&&e[s++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},S=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var s,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(s=i.next()).done;)a.push(s.value)}catch(e){o={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},E={serializeRequest:function(e){var t={resourceSpans:function(e,t){for(var r=function(e){var t,r,s=new Map;try{for(var o=w(e),i=o.next();!i.done;i=o.next()){var a=i.value,l=s.get(a.resource);l||(l=new Map,s.set(a.resource,l));var u=a.instrumentationLibrary.name+"@"+(a.instrumentationLibrary.version||"")+":"+(a.instrumentationLibrary.schemaUrl||""),c=l.get(u);c||(c=[],l.set(u,c)),c.push(a)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}return s}(e),s=[],o=r.entries(),i=o.next();!i.done;){for(var a=S(i.value,2),l=a[0],u=a[1],c=[],d=u.values(),h=d.next();!h.done;){var f=h.value;if(f.length>0){var m,g=f.map(function(e){return function(e,t){var r,s=e.spanContext(),o=e.status;return{traceId:t.encodeSpanContext(s.traceId),spanId:t.encodeSpanContext(s.spanId),parentSpanId:t.encodeOptionalSpanContext(e.parentSpanId),traceState:null===(r=s.traceState)||void 0===r?void 0:r.serialize(),name:e.name,kind:null==e.kind?0:e.kind+1,startTimeUnixNano:t.encodeHrTime(e.startTime),endTimeUnixNano:t.encodeHrTime(e.endTime),attributes:p(e.attributes),droppedAttributesCount:e.droppedAttributesCount,events:e.events.map(function(e){return{attributes:e.attributes?p(e.attributes):[],name:e.name,timeUnixNano:t.encodeHrTime(e.time),droppedAttributesCount:e.droppedAttributesCount||0}}),droppedEventsCount:e.droppedEventsCount,status:{code:o.code,message:o.message},links:e.links.map(function(e){return function(e,t){var r;return{attributes:e.attributes?p(e.attributes):[],spanId:t.encodeSpanContext(e.context.spanId),traceId:t.encodeSpanContext(e.context.traceId),traceState:null===(r=e.context.traceState)||void 0===r?void 0:r.serialize(),droppedAttributesCount:e.droppedAttributesCount||0}}(e,t)}),droppedLinksCount:e.droppedLinksCount}}(e,t)});c.push({scope:{name:(m=f[0].instrumentationLibrary).name,version:m.version},spans:g,schemaUrl:f[0].instrumentationLibrary.schemaUrl})}h=d.next()}var y={resource:{attributes:p(l.attributes),droppedAttributesCount:0},scopeSpans:c,schemaUrl:void 0};s.push(y),i=o.next()}return s}(e,function(e){if(void 0===e)return v;var t,r,s=null===(t=e.useLongBits)||void 0===t||t,o=null!==(r=e.useHex)&&void 0!==r&&r;return{encodeHrTime:s?g:y,encodeSpanContext:o?b:f,encodeOptionalSpanContext:o?b:_}}({useHex:!0,useLongBits:!1}))};return new TextEncoder().encode(JSON.stringify(t))},deserializeResponse:function(e){return JSON.parse(new TextDecoder().decode(e))}};function k(e="default-tracer"){try{return!!i.g.getTracer(e)}catch{return!1}}function I(e){return function(t){return Object.getOwnPropertyNames(t.prototype).forEach(r=>{if(e?.excludeMethods?.includes(r)||"constructor"===r||e?.methodFilter&&!e.methodFilter(r))return;let s=Object.getOwnPropertyDescriptor(t.prototype,r);if(s&&"function"==typeof s.value){var o;Object.defineProperty(t.prototype,r,(o={spanName:e?.prefix?`${e.prefix}.${r}`:r,skipIfNoTelemetry:!0,spanKind:e?.spanKind||c.M.INTERNAL,tracerName:e?.tracerName},function(e,t,r){if(!r||"number"==typeof r)return;let s=r.value,c=String(t);return r.value=function(...e){let t,r,d;if(o?.skipIfNoTelemetry&&!k(o?.tracerName))return s.apply(this,e);let p=i.g.getTracer(o?.tracerName??"default-tracer");"string"==typeof o?t=o:o?(t=o.spanName||c,r=o.spanKind):t=c;let h=p.startSpan(t,{kind:r}),f=i.g.setSpan(a.D.active(),h);e.forEach((e,r)=>{try{h.setAttribute(`${t}.argument.${r}`,JSON.stringify(e))}catch{h.setAttribute(`${t}.argument.${r}`,"[Not Serializable]")}});let m=l.u.getBaggage(f);m?.componentName?(h.setAttribute("componentName",m?.componentName),h.setAttribute("runId",m?.runId)):this&&this.name&&(h.setAttribute("componentName",this.name),h.setAttribute("runId",this.runId),f=l.u.setBaggage(f,{componentName:this.name,runId:this.runId}));try{if((d=a.D.with(f,()=>s.apply(this,e)))instanceof Promise)return d.then(e=>{try{h.setAttribute(`${t}.result`,JSON.stringify(e))}catch{h.setAttribute(`${t}.result`,"[Not Serializable]")}return e}).finally(()=>h.end());try{h.setAttribute(`${t}.result`,JSON.stringify(d))}catch{h.setAttribute(`${t}.result`,"[Not Serializable]")}return d}catch(e){throw h.setStatus({code:u.Q.ERROR,message:e instanceof Error?e.message:"Unknown error"}),e instanceof Error&&h.recordException(e),e}finally{d instanceof Promise||h.end()}},r})(t,r,s))}}),t}}var O=class{storage;queue=[];serializer;logger;activeFlush=void 0;constructor({logger:e,storage:t}){this.storage=t,this.serializer=E,this.logger=e}export(e,t){let r=this.serializer.serializeRequest(e),s=JSON.parse(Buffer.from(r.buffer,"utf8")),o=s?.resourceSpans?.[0]?.scopeSpans;this.logger.debug(`Exporting telemetry: ${o.length} scope spans to be processed [trace batch]`),this.queue.push({data:o,resultCallback:t}),this.activeFlush||(this.activeFlush=this.flush())}shutdown(){return this.forceFlush()}flush(){let e=new Date,t=this.queue.shift();if(!t)return Promise.resolve();let r=t.data.reduce((t,r)=>{let{scope:s,spans:o}=r;for(let r of o){let{spanId:o,parentSpanId:i,traceId:a,name:l,kind:u,attributes:c,status:d,events:p,links:h,startTimeUnixNano:f,endTimeUnixNano:m,...g}=r,y=Number(BigInt(f)/1000n),b=Number(BigInt(m)/1000n);t.push({id:o,parentSpanId:i,traceId:a,name:l,scope:s.name,kind:u,status:JSON.stringify(d),events:JSON.stringify(p),links:JSON.stringify(h),attributes:JSON.stringify(c.reduce((e,t)=>{let r=Object.keys(t.value)[0];return r&&(e[t.key]=t.value[r]),e},{})),startTime:y,endTime:b,other:JSON.stringify(g),createdAt:e})}return t},[]);return this.storage.__batchInsert({tableName:o.Xd,records:r}).then(()=>{t.resultCallback({code:s.SUCCESS})}).catch(e=>{this.logger.error("span err:"+e?.message),t.resultCallback({code:s.FAILED,error:e})}).finally(()=>{this.activeFlush=void 0})}async forceFlush(){if(this.queue.length)for(await this.activeFlush;this.queue.length;)await this.flush()}__setLogger(e){this.logger=e}},T=class e{tracer=i.g.getTracer("default");name="default-service";constructor(e){this.name=e.serviceName??"default-service",this.tracer=i.g.getTracer(this.name)}async shutdown(){}static init(t={}){try{return global.__TELEMETRY__||(global.__TELEMETRY__=new e(t)),global.__TELEMETRY__}catch(e){throw console.error("Failed to initialize telemetry:",e),e}}static get(){if(!global.__TELEMETRY__)throw Error("Telemetry not initialized");return global.__TELEMETRY__}traceClass(e,t={}){let{skipIfNoTelemetry:r=!0}=t;if(r&&!k())return e;let{spanNamePrefix:s=e.constructor.name.toLowerCase(),attributes:o={},excludeMethods:i=[]}=t;return new Proxy(e,{get:(e,t)=>{let r=e[t];return"function"!=typeof r||"constructor"===t||t.toString().startsWith("_")||i.includes(t.toString())?r:this.traceMethod(r.bind(e),{spanName:`${s}.${t.toString()}`,attributes:{...o,[`${s}.name`]:e.constructor.name,[`${s}.method.name`]:t.toString()}})}})}traceMethod(e,t){let r=a.D.active(),{skipIfNoTelemetry:s=!0}=t;return s&&!k()?e:(...s)=>{let o=this.tracer.startSpan(t.spanName);function c(e){throw o.recordException(e),o.setStatus({code:u.Q.ERROR,message:e.message}),o.end(),e}try{let u,d=function(e){try{o.setAttribute(`${t.spanName}.result`,JSON.stringify(e))}catch{o.setAttribute(`${t.spanName}.result`,"[Not Serializable]")}return o.end(),e};if(t.attributes&&o.setAttributes(t.attributes),t.attributes?.componentName)r=l.u.setBaggage(r,{componentName:t.attributes.componentName,runId:t.attributes.runId});else{let e=l.u.getBaggage(r);e?.componentName?(o.setAttribute("componentName",e?.componentName),o.setAttribute("runId",e?.runId)):this&&this.name&&(o.setAttribute("componentName",this.name),o.setAttribute("runId",this.runId),r=l.u.setBaggage(r,{componentName:this.name,runId:this.runId}))}if(s.forEach((e,r)=>{try{o.setAttribute(`${t.spanName}.argument.${r}`,JSON.stringify(e))}catch{o.setAttribute(`${t.spanName}.argument.${r}`,"[Not Serializable]")}}),a.D.with(i.g.setSpan(r,o),()=>{u=e(...s)}),u instanceof Promise)return u.then(d).catch(c);return d(u)}catch(e){c(e)}}}getBaggageTracer(){return new j(this.tracer)}},j=class{_tracer;constructor(e){this._tracer=e}startSpan(e,t={},r){r=r??a.D.active();let s=this._tracer.startSpan(e,t,r),o=l.u.getBaggage(r);return s.setAttribute("componentName",o?.componentName),s.setAttribute("runId",o?.runId),s}startActiveSpan(e,t,r,s){return"function"==typeof t?this._tracer.startActiveSpan(e,{},a.D.active(),e=>{let r=l.u.getBaggage(a.D.active());return e.setAttribute("componentName",r?.componentName),t(e)}):"function"==typeof r?this._tracer.startActiveSpan(e,t,a.D.active(),e=>{let t=l.u.getBaggage(a.D.active());return e.setAttribute("componentName",t?.componentName),r(e)}):this._tracer.startActiveSpan(e,t,r,e=>{let t=l.u.getBaggage(r??a.D.active());return e.setAttribute("componentName",t?.componentName),s(e)})}}},17809:(e,t,r)=>{"use strict";r.d(t,{U:()=>s,y:()=>o});var s=class{id;description;inputSchema;outputSchema;execute;mastra;constructor(e){this.id=e.id,this.description=e.description,this.inputSchema=e.inputSchema,this.outputSchema=e.outputSchema,this.execute=e.execute,this.mastra=e.mastra}};function o(e){return new s(e)}},77659:(e,t,r)=>{"use strict";let s,o;r.d(t,{Py:()=>sa,h4:()=>sl});var i,a,l,u,c,d,p,h,f,m,g,y,b,_,v,w,S,E,k,I,O=r(50134),T=r(65987),j=r(15412);i=[(0,O.B$)({prefix:"tts",excludeMethods:["__setTools","__setLogger","__setTelemetry","#log"]})];var C=class extends(l=T.o){model;constructor({model:e}){super({component:"TTS"}),this.model=e}traced(e,t){return this.telemetry?.traceMethod(e,{spanName:`${this.model.name}-tts.${t}`,attributes:{"tts.type":`${this.model.name}`}})??e}};a=(0,j.xl)(l),C=(0,j.pL)(a,0,"MastraTTS",i,C),(0,j.Co)(a,1,C);var R=r(69087),A=r(17809),P=r(7130),N=class extends T.o{constructor(){super({name:"MastraVector",component:"VECTOR"})}baseKeys={query:["queryVector","topK","filter","includeVector"],upsert:["vectors","metadata","ids"],createIndex:["dimension","metric"]};normalizeArgs(e,[t,...r],s=[]){return"object"==typeof t?t:(this.logger.warn(`Deprecation Warning: Passing individual arguments to ${e}() is deprecated. Please use an object parameter instead.`),{indexName:t,...Object.fromEntries([...this.baseKeys[e]||[],...s].slice(0,r.length).map((e,t)=>[e,r[t]]))})}},q=class e{isOperator(e){return e.startsWith("$")}static BASIC_OPERATORS=["$eq","$ne"];static NUMERIC_OPERATORS=["$gt","$gte","$lt","$lte"];static ARRAY_OPERATORS=["$in","$nin","$all","$elemMatch"];static LOGICAL_OPERATORS=["$and","$or","$not","$nor"];static ELEMENT_OPERATORS=["$exists"];static REGEX_OPERATORS=["$regex","$options"];static DEFAULT_OPERATORS={logical:e.LOGICAL_OPERATORS,basic:e.BASIC_OPERATORS,numeric:e.NUMERIC_OPERATORS,array:e.ARRAY_OPERATORS,element:e.ELEMENT_OPERATORS,regex:e.REGEX_OPERATORS};isLogicalOperator(t){return e.DEFAULT_OPERATORS.logical.includes(t)}isBasicOperator(t){return e.DEFAULT_OPERATORS.basic.includes(t)}isNumericOperator(t){return e.DEFAULT_OPERATORS.numeric.includes(t)}isArrayOperator(t){return e.DEFAULT_OPERATORS.array.includes(t)}isElementOperator(t){return e.DEFAULT_OPERATORS.element.includes(t)}isRegexOperator(t){return e.DEFAULT_OPERATORS.regex.includes(t)}isFieldOperator(e){return this.isOperator(e)&&!this.isLogicalOperator(e)}isCustomOperator(e){let t=this.getSupportedOperators();return t.custom?.includes(e)??!1}getSupportedOperators(){return e.DEFAULT_OPERATORS}isValidOperator(e){return Object.values(this.getSupportedOperators()).flat().includes(e)}normalizeComparisonValue(e){return e instanceof Date?e.toISOString():"number"==typeof e&&Object.is(e,-0)?0:e}simulateAllOperator(e,t){return{$and:t.map(t=>({[e]:{$in:[this.normalizeComparisonValue(t)]}}))}}isPrimitive(e){return null==e||"string"==typeof e||"number"==typeof e||"boolean"==typeof e}isRegex(e){return e instanceof RegExp}isEmpty(e){return null==e||"object"==typeof e&&0===Object.keys(e).length}static ErrorMessages={UNSUPPORTED_OPERATOR:e=>`Unsupported operator: ${e}`,INVALID_LOGICAL_OPERATOR_LOCATION:(e,t)=>`Logical operator ${e} cannot be used at field level: ${t}`,NOT_REQUIRES_OBJECT:"$not operator requires an object",NOT_CANNOT_BE_EMPTY:"$not operator cannot be empty",INVALID_LOGICAL_OPERATOR_CONTENT:e=>`Logical operators must contain field conditions, not direct operators: ${e}`,INVALID_TOP_LEVEL_OPERATOR:e=>`Invalid top-level operator: ${e}`,ELEM_MATCH_REQUIRES_OBJECT:"$elemMatch requires an object with conditions"};normalizeArrayValues(e){return e.map(e=>this.normalizeComparisonValue(e))}validateFilter(e){let t=this.validateFilterSupport(e);if(!t.supported)throw Error(t.messages.join(", "))}validateFilterSupport(t,r=""){let s=[];if(this.isPrimitive(t)||this.isEmpty(t))return{supported:!0,messages:[]};if(Array.isArray(t)){let e=t.map(e=>this.validateFilterSupport(e,r)),s=e.flatMap(e=>e.messages);return{supported:e.every(e=>e.supported),messages:s}}let o=!0;for(let[i,a]of Object.entries(t)){let t=r?`${r}.${i}`:i;if(this.isOperator(i)){if(!this.isValidOperator(i)){o=!1,s.push(e.ErrorMessages.UNSUPPORTED_OPERATOR(i));continue}if(!r&&!this.isLogicalOperator(i)){o=!1,s.push(e.ErrorMessages.INVALID_TOP_LEVEL_OPERATOR(i));continue}if("$elemMatch"===i&&("object"!=typeof a||Array.isArray(a))){o=!1,s.push(e.ErrorMessages.ELEM_MATCH_REQUIRES_OBJECT);continue}if(this.isLogicalOperator(i)){if("$not"===i){if(Array.isArray(a)||"object"!=typeof a){o=!1,s.push(e.ErrorMessages.NOT_REQUIRES_OBJECT);continue}this.isEmpty(a)&&(o=!1,s.push(e.ErrorMessages.NOT_CANNOT_BE_EMPTY));continue}if(r&&!this.isLogicalOperator(r.split(".").pop())){o=!1,s.push(e.ErrorMessages.INVALID_LOGICAL_OPERATOR_LOCATION(i,t));continue}if(Array.isArray(a)&&a.some(e=>"object"==typeof e&&1===Object.keys(e).length&&this.isFieldOperator(Object.keys(e)[0]))){o=!1,s.push(e.ErrorMessages.INVALID_LOGICAL_OPERATOR_CONTENT(t));continue}}}let l=this.validateFilterSupport(a,t);l.supported||(o=!1,s.push(...l.messages))}return{supported:o,messages:s}}},M=r(55315),L=r(26363),$=class extends q{getSupportedOperators(){return{...q.DEFAULT_OPERATORS,regex:[],custom:["$contains","$size"]}}translate(e){return this.isEmpty(e)?e:(this.validateFilter(e),this.translateNode(e))}translateNode(e,t=""){if(this.isRegex(e))throw Error("Direct regex pattern format is not supported in LibSQL");let r=e=>t?{[t]:e}:e;if(this.isPrimitive(e))return r({$eq:this.normalizeComparisonValue(e)});if(Array.isArray(e))return r({$in:this.normalizeArrayValues(e)});let s=Object.entries(e),o={};for(let[e,r]of s){let s=t?`${t}.${e}`:e;this.isLogicalOperator(e)?o[e]=Array.isArray(r)?r.map(e=>this.translateNode(e)):this.translateNode(r):this.isOperator(e)?this.isArrayOperator(e)&&!Array.isArray(r)&&"$elemMatch"!==e?o[e]=[r]:this.isBasicOperator(e)&&Array.isArray(r)?o[e]=JSON.stringify(r):o[e]=r:"object"==typeof r&&null!==r?Object.keys(r).some(e=>this.isOperator(e))?o[s]=this.translateNode(r):Object.assign(o,this.translateNode(r,s)):o[s]=this.translateNode(r)}return o}},D=e=>t=>({sql:`CASE 
      WHEN ? IS NULL THEN json_extract(metadata, '$."${V(t)}"') IS ${"="===e?"":"NOT"} NULL
      ELSE json_extract(metadata, '$."${V(t)}"') ${e} ?
    END`,needsValue:!0,transformValue:e=>[e,e]}),U=e=>t=>({sql:`CAST(json_extract(metadata, '$."${V(t)}"') AS NUMERIC) ${e} ?`,needsValue:!0}),B=e=>`json_valid(json_extract(metadata, '$."${V(e)}"'))
   AND json_type(json_extract(metadata, '$."${V(e)}"')) = 'array'`,F={$eq:D("="),$ne:D("!="),$gt:U(">"),$gte:U(">="),$lt:U("<"),$lte:U("<="),$in:(e,t)=>({sql:`json_extract(metadata, '$."${V(e)}"') IN (${t.map(()=>"?").join(",")})`,needsValue:!0}),$nin:(e,t)=>({sql:`json_extract(metadata, '$."${V(e)}"') NOT IN (${t.map(()=>"?").join(",")})`,needsValue:!0}),$all:e=>({sql:`json_extract(metadata, '$."${V(e)}"') = ?`,needsValue:!0,transformValue:t=>{let r=Array.isArray(t)?t:[t];return 0===r.length?{sql:"1 = 0",values:[]}:{sql:`(
          CASE
            WHEN ${B(e)} THEN
                NOT EXISTS (
                    SELECT value 
                    FROM json_each(?) 
                    WHERE value NOT IN (
                    SELECT value 
                    FROM json_each(json_extract(metadata, '$."${V(e)}"'))
                )
            )
            ELSE FALSE
          END
        )`,values:[JSON.stringify(r)]}}}),$elemMatch:e=>({sql:`json_extract(metadata, '$."${V(e)}"') = ?`,needsValue:!0,transformValue:t=>{if("object"!=typeof t||Array.isArray(t))throw Error("$elemMatch requires an object with conditions");let r=Object.entries(t).map(([e,t])=>{if(e.startsWith("$")){let{sql:r,values:s}=W("elem.value",{[e]:t});return{sql:r.replace(/json_extract\(metadata, '\$\."[^"]*"(\."[^"]*")*'\)/g,"elem.value"),values:s}}if("object"!=typeof t||Array.isArray(t))return{sql:`json_extract(elem.value, '$."${e}"') = ?`,values:[t]};{let{sql:r,values:s}=W(e,t);return{sql:r.replace(/json_extract\(metadata, '\$\."[^"]*"(\."[^"]*")*'\)/g,`json_extract(elem.value, '$."${e}"')`),values:s}}});return{sql:`(
          CASE
            WHEN ${B(e)} THEN
              EXISTS (
                SELECT 1 
                FROM json_each(json_extract(metadata, '$."${V(e)}"')) as elem
                WHERE ${r.map(e=>e.sql).join(" AND ")}
              )
            ELSE FALSE
          END
        )`,values:r.flatMap(e=>e.values)}}}),$exists:e=>({sql:`json_extract(metadata, '$."${V(e)}"') IS NOT NULL`,needsValue:!1}),$and:e=>({sql:`(${e})`,needsValue:!1}),$or:e=>({sql:`(${e})`,needsValue:!1}),$not:e=>({sql:`NOT (${e})`,needsValue:!1}),$nor:e=>({sql:`NOT (${e})`,needsValue:!1}),$size:(e,t)=>({sql:`(
    CASE
      WHEN json_type(json_extract(metadata, '$."${V(e)}"')) = 'array' THEN 
        json_array_length(json_extract(metadata, '$."${V(e)}"')) = $${t}
      ELSE FALSE
    END
  )`,needsValue:!0}),$contains:e=>({sql:`json_extract(metadata, '$."${V(e)}"') = ?`,needsValue:!0,transformValue:t=>{if(Array.isArray(t))return{sql:`(
            SELECT ${B(e)}
            AND EXISTS (
              SELECT 1 
              FROM json_each(json_extract(metadata, '$."${V(e)}"')) as m
              WHERE m.value IN (SELECT value FROM json_each(?))
            )
          )`,values:[JSON.stringify(t)]};if(t&&"object"==typeof t){let r=function(e,t=[]){for(let[i,a]of Object.entries(e)){let e=[...t,i];a&&"object"==typeof a&&!Array.isArray(a)?r(a,e):(s.push(e.join(".")),o.push(a))}},s=[],o=[];return r(t),{sql:`(${s.map(t=>`json_extract(metadata, '$."${V(e)}"."${t}"') = ?`).join(" AND ")})`,values:o}}return t}})},V=e=>e.replace(/\./g,'"."');function W(e,t,r){return["$and","$or","$not","$nor"].includes(e)?function(e,t,r){if(!t||0===t.length)switch(e){case"$and":case"$nor":default:return{sql:"true",values:[]};case"$or":return{sql:"false",values:[]};case"$not":throw Error("$not operator cannot be empty")}if("$not"===e){let e=Object.entries(t).map(([e,t])=>W(e,t));return{sql:`NOT (${e.map(e=>e.sql).join(" AND ")})`,values:e.flatMap(e=>e.values)}}let s=[],o="$or"===e||"$nor"===e?"OR":"AND",i=(Array.isArray(t)?t.map(e=>Object.entries(e).map(([e,t])=>W(e,t))):[W(e,t)]).flat().map(e=>(s.push(...e.values),e.sql)).join(` ${o} `);return{sql:"$nor"===e?`NOT (${i})`:`(${i})`,values:s}}(e,t):t&&"object"==typeof t?function(e,t){if("object"==typeof t&&!Array.isArray(t)){let r=Object.entries(t).map(([t,r])=>"$not"===t?{sql:`NOT (${Object.entries(r).map(([t,r])=>z(e,t,r).sql).join(" AND ")})`,values:Object.entries(r).flatMap(([t,r])=>z(e,t,r).values)}:z(e,t,r));return{sql:`(${r.map(e=>e.sql).join(" AND ")})`,values:r.flatMap(e=>e.values)}}let[[r,s]=[]]=Object.entries(t);return z(e,r,s)}(e,t):{sql:`json_extract(metadata, '$."${e.replace(/\./g,'"."')}"') = ?`,values:[t]}}var z=(e,t,r)=>{if(!t.startsWith("$")||!F[t])throw Error(`Invalid operator: ${t}`);let s=(0,F[t])(e,r);if(!s.needsValue)return{sql:s.sql,values:[]};let o=s.transformValue?s.transformValue(r):r;return o&&"object"==typeof o&&"sql"in o?o:{sql:s.sql,values:Array.isArray(o)?o:[o]}},Z=(r(14735),e=>new Promise(t=>setTimeout(t,e))),J=r(2347),H=r(22969),G=r(14586),Y=r(90147);let K=Symbol("Let zodToJsonSchema decide on which parser to use"),Q={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},X=e=>"string"==typeof e?{...Q,name:e}:{...Q,...e},ee=e=>{let t=X(e),r=void 0!==t.name?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,currentPath:r,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([e,r])=>[r._def,{def:r._def,path:[...t.basePath,t.definitionPath,e],jsonSchema:void 0}]))}};function et(e,t,r,s){s?.errorMessages&&r&&(e.errorMessage={...e.errorMessage,[t]:r})}function er(e,t,r,s,o){e[t]=r,et(e,t,s,o)}function es(e,t){return ew(e.type._def,t)}let en=(e,t)=>ew(e.innerType._def,t),eo=(e,t)=>{let r={type:"integer",format:"unix-time"};if("openApi3"===t.target)return r;for(let s of e.checks)switch(s.kind){case"min":er(r,"minimum",s.value,s.message,t);break;case"max":er(r,"maximum",s.value,s.message,t)}return r},ei=e=>(!("type"in e)||"string"!==e.type)&&"allOf"in e,ea={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(void 0===s&&(s=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),s),ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function el(e,t){let r={type:"string"};if(e.checks)for(let s of e.checks)switch(s.kind){case"min":er(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,s.value):s.value,s.message,t);break;case"max":er(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,s.value):s.value,s.message,t);break;case"email":switch(t.emailStrategy){case"format:email":ed(r,"email",s.message,t);break;case"format:idn-email":ed(r,"idn-email",s.message,t);break;case"pattern:zod":ep(r,ea.email,s.message,t)}break;case"url":ed(r,"uri",s.message,t);break;case"uuid":ed(r,"uuid",s.message,t);break;case"regex":ep(r,s.regex,s.message,t);break;case"cuid":ep(r,ea.cuid,s.message,t);break;case"cuid2":ep(r,ea.cuid2,s.message,t);break;case"startsWith":ep(r,RegExp(`^${eu(s.value,t)}`),s.message,t);break;case"endsWith":ep(r,RegExp(`${eu(s.value,t)}$`),s.message,t);break;case"datetime":ed(r,"date-time",s.message,t);break;case"date":ed(r,"date",s.message,t);break;case"time":ed(r,"time",s.message,t);break;case"duration":ed(r,"duration",s.message,t);break;case"length":er(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,s.value):s.value,s.message,t),er(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,s.value):s.value,s.message,t);break;case"includes":ep(r,RegExp(eu(s.value,t)),s.message,t);break;case"ip":"v6"!==s.version&&ed(r,"ipv4",s.message,t),"v4"!==s.version&&ed(r,"ipv6",s.message,t);break;case"base64url":ep(r,ea.base64url,s.message,t);break;case"jwt":ep(r,ea.jwt,s.message,t);break;case"cidr":"v6"!==s.version&&ep(r,ea.ipv4Cidr,s.message,t),"v4"!==s.version&&ep(r,ea.ipv6Cidr,s.message,t);break;case"emoji":ep(r,ea.emoji(),s.message,t);break;case"ulid":ep(r,ea.ulid,s.message,t);break;case"base64":switch(t.base64Strategy){case"format:binary":ed(r,"binary",s.message,t);break;case"contentEncoding:base64":er(r,"contentEncoding","base64",s.message,t);break;case"pattern:zod":ep(r,ea.base64,s.message,t)}break;case"nanoid":ep(r,ea.nanoid,s.message,t)}return r}function eu(e,t){return"escape"===t.patternStrategy?function(e){let t="";for(let r=0;r<e.length;r++)ec.has(e[r])||(t+="\\"),t+=e[r];return t}(e):e}let ec=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function ed(e,t,r,s){e.format||e.anyOf?.some(e=>e.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&s.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.anyOf.push({format:t,...r&&s.errorMessages&&{errorMessage:{format:r}}})):er(e,"format",t,r,s)}function ep(e,t,r,s){e.pattern||e.allOf?.some(e=>e.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&s.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.allOf.push({pattern:eh(t,s),...r&&s.errorMessages&&{errorMessage:{pattern:r}}})):er(e,"pattern",eh(t,s),r,s)}function eh(e,t){if(!t.applyRegexFlags||!e.flags)return e.source;let r={i:e.flags.includes("i"),m:e.flags.includes("m"),s:e.flags.includes("s")},s=r.i?e.source.toLowerCase():e.source,o="",i=!1,a=!1,l=!1;for(let e=0;e<s.length;e++){if(i){o+=s[e],i=!1;continue}if(r.i){if(a){if(s[e].match(/[a-z]/)){l?(o+=s[e]+`${s[e-2]}-${s[e]}`.toUpperCase(),l=!1):"-"===s[e+1]&&s[e+2]?.match(/[a-z]/)?(o+=s[e],l=!0):o+=`${s[e]}${s[e].toUpperCase()}`;continue}}else if(s[e].match(/[a-z]/)){o+=`[${s[e]}${s[e].toUpperCase()}]`;continue}}if(r.m){if("^"===s[e]){o+=`(^|(?<=[\r
]))`;continue}if("$"===s[e]){o+=`($|(?=[\r
]))`;continue}}if(r.s&&"."===s[e]){o+=a?`${s[e]}\r
`:`[${s[e]}\r
]`;continue}o+=s[e],"\\"===s[e]?i=!0:a&&"]"===s[e]?a=!1:a||"["!==s[e]||(a=!0)}try{new RegExp(o)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return o}function ef(e,t){if("openAi"===t.target&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),"openApi3"===t.target&&e.keyType?._def.typeName===P.pA.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((r,s)=>({...r,[s]:ew(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",s]})??{}}),{}),additionalProperties:!1};let r={type:"object",additionalProperties:ew(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??{}};if("openApi3"===t.target)return r;if(e.keyType?._def.typeName===P.pA.ZodString&&e.keyType._def.checks?.length){let{type:s,...o}=el(e.keyType._def,t);return{...r,propertyNames:o}}if(e.keyType?._def.typeName===P.pA.ZodEnum)return{...r,propertyNames:{enum:e.keyType._def.values}};if(e.keyType?._def.typeName===P.pA.ZodBranded&&e.keyType._def.type._def.typeName===P.pA.ZodString&&e.keyType._def.type._def.checks?.length){let{type:s,...o}=es(e.keyType._def,t);return{...r,propertyNames:o}}return r}let em={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"},eg=(e,t)=>{let r=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((e,r)=>ew(e._def,{...t,currentPath:[...t.currentPath,"anyOf",`${r}`]})).filter(e=>!!e&&(!t.strictUnions||"object"==typeof e&&Object.keys(e).length>0));return r.length?{anyOf:r}:void 0},ey=(e,t)=>{if(t.currentPath.toString()===t.propertyPath?.toString())return ew(e.innerType._def,t);let r=ew(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return r?{anyOf:[{not:{}},r]}:{}},eb=(e,t)=>{if("input"===t.pipeStrategy)return ew(e.in._def,t);if("output"===t.pipeStrategy)return ew(e.out._def,t);let r=ew(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),s=ew(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",r?"1":"0"]});return{allOf:[r,s].filter(e=>void 0!==e)}},e_=(e,t)=>ew(e.innerType._def,t),ev=(e,t,r)=>{switch(t){case P.pA.ZodString:return el(e,r);case P.pA.ZodNumber:return function(e,t){let r={type:"number"};if(!e.checks)return r;for(let s of e.checks)switch(s.kind){case"int":r.type="integer",et(r,"type",s.message,t);break;case"min":"jsonSchema7"===t.target?s.inclusive?er(r,"minimum",s.value,s.message,t):er(r,"exclusiveMinimum",s.value,s.message,t):(s.inclusive||(r.exclusiveMinimum=!0),er(r,"minimum",s.value,s.message,t));break;case"max":"jsonSchema7"===t.target?s.inclusive?er(r,"maximum",s.value,s.message,t):er(r,"exclusiveMaximum",s.value,s.message,t):(s.inclusive||(r.exclusiveMaximum=!0),er(r,"maximum",s.value,s.message,t));break;case"multipleOf":er(r,"multipleOf",s.value,s.message,t)}return r}(e,r);case P.pA.ZodObject:return function(e,t){let r="openAi"===t.target,s={type:"object",...Object.entries(e.shape()).reduce((e,[s,o])=>{if(void 0===o||void 0===o._def)return e;let i=o.isOptional();i&&r&&(o instanceof P.ak&&(o=o._def.innerType),o.isNullable()||(o=o.nullable()),i=!1);let a=ew(o._def,{...t,currentPath:[...t.currentPath,"properties",s],propertyPath:[...t.currentPath,"properties",s]});return void 0===a?e:{properties:{...e.properties,[s]:a},required:i?e.required:[...e.required,s]}},{properties:{},required:[]}),additionalProperties:"strict"===t.removeAdditionalStrategy?"ZodNever"===e.catchall._def.typeName?"strict"!==e.unknownKeys:ew(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0:"ZodNever"===e.catchall._def.typeName?"passthrough"===e.unknownKeys:ew(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0};return s.required.length||delete s.required,s}(e,r);case P.pA.ZodBigInt:return function(e,t){let r={type:"integer",format:"int64"};if(!e.checks)return r;for(let s of e.checks)switch(s.kind){case"min":"jsonSchema7"===t.target?s.inclusive?er(r,"minimum",s.value,s.message,t):er(r,"exclusiveMinimum",s.value,s.message,t):(s.inclusive||(r.exclusiveMinimum=!0),er(r,"minimum",s.value,s.message,t));break;case"max":"jsonSchema7"===t.target?s.inclusive?er(r,"maximum",s.value,s.message,t):er(r,"exclusiveMaximum",s.value,s.message,t):(s.inclusive||(r.exclusiveMaximum=!0),er(r,"maximum",s.value,s.message,t));break;case"multipleOf":er(r,"multipleOf",s.value,s.message,t)}return r}(e,r);case P.pA.ZodBoolean:return{type:"boolean"};case P.pA.ZodDate:return function e(t,r,s){let o=s??r.dateStrategy;if(Array.isArray(o))return{anyOf:o.map((s,o)=>e(t,r,s))};switch(o){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return eo(t,r)}}(e,r);case P.pA.ZodUndefined:return{not:{}};case P.pA.ZodNull:return"openApi3"===r.target?{enum:["null"],nullable:!0}:{type:"null"};case P.pA.ZodArray:return function(e,t){let r={type:"array"};return e.type?._def&&e.type?._def?.typeName!==P.pA.ZodAny&&(r.items=ew(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&er(r,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&er(r,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(er(r,"minItems",e.exactLength.value,e.exactLength.message,t),er(r,"maxItems",e.exactLength.value,e.exactLength.message,t)),r}(e,r);case P.pA.ZodUnion:case P.pA.ZodDiscriminatedUnion:return function(e,t){if("openApi3"===t.target)return eg(e,t);let r=e.options instanceof Map?Array.from(e.options.values()):e.options;if(r.every(e=>e._def.typeName in em&&(!e._def.checks||!e._def.checks.length))){let e=r.reduce((e,t)=>{let r=em[t._def.typeName];return r&&!e.includes(r)?[...e,r]:e},[]);return{type:e.length>1?e:e[0]}}if(r.every(e=>"ZodLiteral"===e._def.typeName&&!e.description)){let e=r.reduce((e,t)=>{let r=typeof t._def.value;switch(r){case"string":case"number":case"boolean":return[...e,r];case"bigint":return[...e,"integer"];case"object":if(null===t._def.value)return[...e,"null"];default:return e}},[]);if(e.length===r.length){let t=e.filter((e,t,r)=>r.indexOf(e)===t);return{type:t.length>1?t:t[0],enum:r.reduce((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value],[])}}}else if(r.every(e=>"ZodEnum"===e._def.typeName))return{type:"string",enum:r.reduce((e,t)=>[...e,...t._def.values.filter(t=>!e.includes(t))],[])};return eg(e,t)}(e,r);case P.pA.ZodIntersection:return function(e,t){let r=[ew(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),ew(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(e=>!!e),s="jsonSchema2019-09"===t.target?{unevaluatedProperties:!1}:void 0,o=[];return r.forEach(e=>{if(ei(e))o.push(...e.allOf),void 0===e.unevaluatedProperties&&(s=void 0);else{let t=e;if("additionalProperties"in e&&!1===e.additionalProperties){let{additionalProperties:r,...s}=e;t=s}else s=void 0;o.push(t)}}),o.length?{allOf:o,...s}:void 0}(e,r);case P.pA.ZodTuple:return function(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((e,r)=>ew(e._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[]),additionalItems:ew(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((e,r)=>ew(e._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[])}}(e,r);case P.pA.ZodRecord:return ef(e,r);case P.pA.ZodLiteral:return function(e,t){let r=typeof e.value;return"bigint"!==r&&"number"!==r&&"boolean"!==r&&"string"!==r?{type:Array.isArray(e.value)?"array":"object"}:"openApi3"===t.target?{type:"bigint"===r?"integer":r,enum:[e.value]}:{type:"bigint"===r?"integer":r,const:e.value}}(e,r);case P.pA.ZodEnum:return{type:"string",enum:Array.from(e.values)};case P.pA.ZodNativeEnum:return function(e){let t=e.values,r=Object.keys(e.values).filter(e=>"number"!=typeof t[t[e]]).map(e=>t[e]),s=Array.from(new Set(r.map(e=>typeof e)));return{type:1===s.length?"string"===s[0]?"string":"number":["string","number"],enum:r}}(e);case P.pA.ZodNullable:return function(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return"openApi3"===t.target?{type:em[e.innerType._def.typeName],nullable:!0}:{type:[em[e.innerType._def.typeName],"null"]};if("openApi3"===t.target){let r=ew(e.innerType._def,{...t,currentPath:[...t.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}let r=ew(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return r&&{anyOf:[r,{type:"null"}]}}(e,r);case P.pA.ZodOptional:return ey(e,r);case P.pA.ZodMap:return function(e,t){return"record"===t.mapStrategy?ef(e,t):{type:"array",maxItems:125,items:{type:"array",items:[ew(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||{},ew(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||{}],minItems:2,maxItems:2}}}(e,r);case P.pA.ZodSet:return function(e,t){let r={type:"array",uniqueItems:!0,items:ew(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&er(r,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&er(r,"maxItems",e.maxSize.value,e.maxSize.message,t),r}(e,r);case P.pA.ZodLazy:return()=>e.getter()._def;case P.pA.ZodPromise:return ew(e.type._def,r);case P.pA.ZodNaN:case P.pA.ZodNever:return{not:{}};case P.pA.ZodEffects:return function(e,t){return"input"===t.effectStrategy?ew(e.schema._def,t):{}}(e,r);case P.pA.ZodAny:case P.pA.ZodUnknown:return{};case P.pA.ZodDefault:return function(e,t){return{...ew(e.innerType._def,t),default:e.defaultValue()}}(e,r);case P.pA.ZodBranded:return es(e,r);case P.pA.ZodReadonly:return e_(e,r);case P.pA.ZodCatch:return en(e,r);case P.pA.ZodPipeline:return eb(e,r);case P.pA.ZodFunction:case P.pA.ZodVoid:case P.pA.ZodSymbol:default:return}};function ew(e,t,r=!1){let s=t.seen.get(e);if(t.override){let o=t.override?.(e,t,s,r);if(o!==K)return o}if(s&&!r){let e=ex(s,t);if(void 0!==e)return e}let o={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,o);let i=ev(e,e.typeName,t),a="function"==typeof i?ew(i(),t):i;if(a&&eE(e,t,a),t.postProcess){let r=t.postProcess(a,e,t);return o.jsonSchema=a,r}return o.jsonSchema=a,a}let ex=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:eS(t.currentPath,e.path)};case"none":case"seen":if(e.path.length<t.currentPath.length&&e.path.every((e,r)=>t.currentPath[r]===e))return console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{};return"seen"===t.$refStrategy?{}:void 0}},eS=(e,t)=>{let r=0;for(;r<e.length&&r<t.length&&e[r]===t[r];r++);return[(e.length-r).toString(),...t.slice(r)].join("/")},eE=(e,t,r)=>(e.description&&(r.description=e.description,t.markdownDescription&&(r.markdownDescription=e.description)),r),ek=(e,t)=>{let r=ee(t),s="object"==typeof t&&t.definitions?Object.entries(t.definitions).reduce((e,[t,s])=>({...e,[t]:ew(s._def,{...r,currentPath:[...r.basePath,r.definitionPath,t]},!0)??{}}),{}):void 0,o="string"==typeof t?t:t?.nameStrategy==="title"?void 0:t?.name,i=ew(e._def,void 0===o?r:{...r,currentPath:[...r.basePath,r.definitionPath,o]},!1)??{},a="object"==typeof t&&void 0!==t.name&&"title"===t.nameStrategy?t.name:void 0;void 0!==a&&(i.title=a);let l=void 0===o?s?{...i,[r.definitionPath]:s}:i:{$ref:[..."relative"===r.$refStrategy?[]:r.basePath,r.definitionPath,o].join("/"),[r.definitionPath]:{...s,[o]:i}};return"jsonSchema7"===r.target?l.$schema="http://json-schema.org/draft-07/schema#":("jsonSchema2019-09"===r.target||"openAi"===r.target)&&(l.$schema="https://json-schema.org/draft/2019-09/schema#"),"openAi"===r.target&&("anyOf"in l||"oneOf"in l||"allOf"in l||"type"in l&&Array.isArray(l.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),l};var eI={code:"0",name:"text",parse:e=>{if("string"!=typeof e)throw Error('"text" parts expect a string value.');return{type:"text",value:e}}},eO={code:"3",name:"error",parse:e=>{if("string"!=typeof e)throw Error('"error" parts expect a string value.');return{type:"error",value:e}}},eT={code:"4",name:"assistant_message",parse:e=>{if(null==e||"object"!=typeof e||!("id"in e)||!("role"in e)||!("content"in e)||"string"!=typeof e.id||"string"!=typeof e.role||"assistant"!==e.role||!Array.isArray(e.content)||!e.content.every(e=>null!=e&&"object"==typeof e&&"type"in e&&"text"===e.type&&"text"in e&&null!=e.text&&"object"==typeof e.text&&"value"in e.text&&"string"==typeof e.text.value))throw Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return{type:"assistant_message",value:e}}},ej={code:"5",name:"assistant_control_data",parse:e=>{if(null==e||"object"!=typeof e||!("threadId"in e)||!("messageId"in e)||"string"!=typeof e.threadId||"string"!=typeof e.messageId)throw Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return{type:"assistant_control_data",value:{threadId:e.threadId,messageId:e.messageId}}}},eC={code:"6",name:"data_message",parse:e=>{if(null==e||"object"!=typeof e||!("role"in e)||!("data"in e)||"string"!=typeof e.role||"data"!==e.role)throw Error('"data_message" parts expect an object with a "role" and "data" property.');return{type:"data_message",value:e}}};function eR(e){if(void 0===e)return{value:void 0,state:"undefined-input"};let t=(0,H.NX)({text:e});return t.success?{value:t.value,state:"successful-parse"}:(t=(0,H.NX)({text:function(e){let t=["ROOT"],r=-1,s=null;function o(e,o,i){switch(e){case'"':r=o,t.pop(),t.push(i),t.push("INSIDE_STRING");break;case"f":case"t":case"n":r=o,s=o,t.pop(),t.push(i),t.push("INSIDE_LITERAL");break;case"-":t.pop(),t.push(i),t.push("INSIDE_NUMBER");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":r=o,t.pop(),t.push(i),t.push("INSIDE_NUMBER");break;case"{":r=o,t.pop(),t.push(i),t.push("INSIDE_OBJECT_START");break;case"[":r=o,t.pop(),t.push(i),t.push("INSIDE_ARRAY_START")}}function i(e,s){switch(e){case",":t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break;case"}":r=s,t.pop()}}function a(e,s){switch(e){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":r=s,t.pop()}}for(let l=0;l<e.length;l++){let u=e[l];switch(t[t.length-1]){case"ROOT":o(u,l,"FINISH");break;case"INSIDE_OBJECT_START":switch(u){case'"':t.pop(),t.push("INSIDE_OBJECT_KEY");break;case"}":r=l,t.pop()}break;case"INSIDE_OBJECT_AFTER_COMMA":'"'===u&&(t.pop(),t.push("INSIDE_OBJECT_KEY"));break;case"INSIDE_OBJECT_KEY":'"'===u&&(t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY"));break;case"INSIDE_OBJECT_AFTER_KEY":":"===u&&(t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE"));break;case"INSIDE_OBJECT_BEFORE_VALUE":o(u,l,"INSIDE_OBJECT_AFTER_VALUE");break;case"INSIDE_OBJECT_AFTER_VALUE":i(u,l);break;case"INSIDE_STRING":switch(u){case'"':t.pop(),r=l;break;case"\\":t.push("INSIDE_STRING_ESCAPE");break;default:r=l}break;case"INSIDE_ARRAY_START":"]"===u?(r=l,t.pop()):(r=l,o(u,l,"INSIDE_ARRAY_AFTER_VALUE"));break;case"INSIDE_ARRAY_AFTER_VALUE":switch(u){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":r=l,t.pop();break;default:r=l}break;case"INSIDE_ARRAY_AFTER_COMMA":o(u,l,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_STRING_ESCAPE":t.pop(),r=l;break;case"INSIDE_NUMBER":switch(u){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":r=l;break;case"e":case"E":case"-":case".":break;case",":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&a(u,l),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&i(u,l);break;case"}":t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&i(u,l);break;case"]":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&a(u,l);break;default:t.pop()}break;case"INSIDE_LITERAL":{let o=e.substring(s,l+1);"false".startsWith(o)||"true".startsWith(o)||"null".startsWith(o)?r=l:(t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]?i(u,l):"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&a(u,l))}}}let l=e.slice(0,r+1);for(let r=t.length-1;r>=0;r--)switch(t[r]){case"INSIDE_STRING":l+='"';break;case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":l+="}";break;case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":l+="]";break;case"INSIDE_LITERAL":{let t=e.substring(s,e.length);"true".startsWith(t)?l+="true".slice(t.length):"false".startsWith(t)?l+="false".slice(t.length):"null".startsWith(t)&&(l+="null".slice(t.length))}}return l}(e)})).success?{value:t.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"}}eI.code,eO.code,eT.code,ej.code,eC.code,eI.name,eI.code,eO.name,eO.code,eT.name,eT.code,ej.name,ej.code,eC.name,eC.code,[eI,eO,eT,ej,eC].map(e=>e.code);var eA=[{code:"0",name:"text",parse:e=>{if("string"!=typeof e)throw Error('"text" parts expect a string value.');return{type:"text",value:e}}},{code:"2",name:"data",parse:e=>{if(!Array.isArray(e))throw Error('"data" parts expect an array value.');return{type:"data",value:e}}},{code:"3",name:"error",parse:e=>{if("string"!=typeof e)throw Error('"error" parts expect a string value.');return{type:"error",value:e}}},{code:"8",name:"message_annotations",parse:e=>{if(!Array.isArray(e))throw Error('"message_annotations" parts expect an array value.');return{type:"message_annotations",value:e}}},{code:"9",name:"tool_call",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("toolName"in e)||"string"!=typeof e.toolName||!("args"in e)||"object"!=typeof e.args)throw Error('"tool_call" parts expect an object with a "toolCallId", "toolName", and "args" property.');return{type:"tool_call",value:e}}},{code:"a",name:"tool_result",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("result"in e))throw Error('"tool_result" parts expect an object with a "toolCallId" and a "result" property.');return{type:"tool_result",value:e}}},{code:"b",name:"tool_call_streaming_start",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("toolName"in e)||"string"!=typeof e.toolName)throw Error('"tool_call_streaming_start" parts expect an object with a "toolCallId" and "toolName" property.');return{type:"tool_call_streaming_start",value:e}}},{code:"c",name:"tool_call_delta",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("argsTextDelta"in e)||"string"!=typeof e.argsTextDelta)throw Error('"tool_call_delta" parts expect an object with a "toolCallId" and "argsTextDelta" property.');return{type:"tool_call_delta",value:e}}},{code:"d",name:"finish_message",parse:e=>{if(null==e||"object"!=typeof e||!("finishReason"in e)||"string"!=typeof e.finishReason)throw Error('"finish_message" parts expect an object with a "finishReason" property.');let t={finishReason:e.finishReason};return"usage"in e&&null!=e.usage&&"object"==typeof e.usage&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:"number"==typeof e.usage.promptTokens?e.usage.promptTokens:Number.NaN,completionTokens:"number"==typeof e.usage.completionTokens?e.usage.completionTokens:Number.NaN}),{type:"finish_message",value:t}}},{code:"e",name:"finish_step",parse:e=>{if(null==e||"object"!=typeof e||!("finishReason"in e)||"string"!=typeof e.finishReason)throw Error('"finish_step" parts expect an object with a "finishReason" property.');let t={finishReason:e.finishReason,isContinued:!1};return"usage"in e&&null!=e.usage&&"object"==typeof e.usage&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:"number"==typeof e.usage.promptTokens?e.usage.promptTokens:Number.NaN,completionTokens:"number"==typeof e.usage.completionTokens?e.usage.completionTokens:Number.NaN}),"isContinued"in e&&"boolean"==typeof e.isContinued&&(t.isContinued=e.isContinued),{type:"finish_step",value:t}}},{code:"f",name:"start_step",parse:e=>{if(null==e||"object"!=typeof e||!("messageId"in e)||"string"!=typeof e.messageId)throw Error('"start_step" parts expect an object with an "id" property.');return{type:"start_step",value:{messageId:e.messageId}}}},{code:"g",name:"reasoning",parse:e=>{if("string"!=typeof e)throw Error('"reasoning" parts expect a string value.');return{type:"reasoning",value:e}}},{code:"h",name:"source",parse:e=>{if(null==e||"object"!=typeof e)throw Error('"source" parts expect a Source object.');return{type:"source",value:e}}},{code:"i",name:"redacted_reasoning",parse:e=>{if(null==e||"object"!=typeof e||!("data"in e)||"string"!=typeof e.data)throw Error('"redacted_reasoning" parts expect an object with a "data" property.');return{type:"redacted_reasoning",value:{data:e.data}}}},{code:"j",name:"reasoning_signature",parse:e=>{if(null==e||"object"!=typeof e||!("signature"in e)||"string"!=typeof e.signature)throw Error('"reasoning_signature" parts expect an object with a "signature" property.');return{type:"reasoning_signature",value:{signature:e.signature}}}}],eP=Object.fromEntries(eA.map(e=>[e.code,e]));Object.fromEntries(eA.map(e=>[e.name,e.code]));var eN=eA.map(e=>e.code),eq=e=>{let t=e.indexOf(":");if(-1===t)throw Error("Failed to parse stream string. No separator found.");let r=e.slice(0,t);if(!eN.includes(r))throw Error(`Failed to parse stream string. Invalid code ${r}.`);let s=JSON.parse(e.slice(t+1));return eP[r].parse(s)};function eM(e,t){let r=eA.find(t=>t.name===e);if(!r)throw Error(`Invalid stream part type: ${e}`);return`${r.code}:${JSON.stringify(t)}
`}function eL(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if("object"!=typeof e&&"object"!=typeof t)return e===t;if(e.constructor!==t.constructor)return!1;if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();if(Array.isArray(e)){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!eL(e[r],t[r]))return!1;return!0}let r=Object.keys(e),s=Object.keys(t);if(r.length!==s.length)return!1;for(let o of r)if(!s.includes(o)||!eL(e[o],t[o]))return!1;return!0}var e$=Symbol.for("vercel.ai.schema");function eD(e,{validate:t}={}){return{[e$]:!0,_type:void 0,[H.pY]:!0,jsonSchema:e,validate:t}}function eU(e){return"object"==typeof e&&null!==e&&e$ in e&&!0===e[e$]&&"jsonSchema"in e&&"validate"in e?e:eD(ek(e,{$refStrategy:"none",target:"jsonSchema7"}),{validate:t=>{let r=e.safeParse(t);return r.success?{success:!0,value:r.data}:{success:!1,error:r.error}}})}var eB=Object.defineProperty,eF=(e,t)=>{for(var r in t)eB(e,r,{get:t[r],enumerable:!0})};function eV(e,{contentType:t,dataStreamVersion:r}){let s=new Headers(null!=e?e:{});return s.has("Content-Type")||s.set("Content-Type",t),void 0!==r&&s.set("X-Vercel-AI-Data-Stream",r),s}function eW(e,{contentType:t,dataStreamVersion:r}){let s={};if(null!=e)for(let[t,r]of Object.entries(e))s[t]=r;return null==s["Content-Type"]&&(s["Content-Type"]=t),void 0!==r&&(s["X-Vercel-AI-Data-Stream"]=r),s}function ez({response:e,status:t,statusText:r,headers:s,stream:o}){e.writeHead(null!=t?t:200,r,s);let i=o.getReader();(async()=>{try{for(;;){let{done:t,value:r}=await i.read();if(t)break;e.write(r)}}catch(e){throw e}finally{e.end()}})()}var eZ="AI_InvalidArgumentError",eJ=`vercel.ai.error.${eZ}`,eH=Symbol.for(eJ),eG=class extends J.AX{constructor({parameter:e,value:t,message:r}){super({name:eZ,message:`Invalid argument for parameter ${e}: ${r}`}),this[u]=!0,this.parameter=e,this.value=t}static isInstance(e){return J.AX.hasMarker(e,eJ)}};u=eH;var eY="AI_RetryError",eK=`vercel.ai.error.${eY}`,eQ=Symbol.for(eK),eX=class extends J.AX{constructor({message:e,reason:t,errors:r}){super({name:eY,message:e}),this[c]=!0,this.reason=t,this.errors=r,this.lastError=r[r.length-1]}static isInstance(e){return J.AX.hasMarker(e,eK)}};c=eQ;var e0=({maxRetries:e=2,initialDelayInMs:t=2e3,backoffFactor:r=2}={})=>async s=>e1(s,{maxRetries:e,delayInMs:t,backoffFactor:r});async function e1(e,{maxRetries:t,delayInMs:r,backoffFactor:s},o=[]){try{return await e()}catch(u){if((0,H.D_)(u)||0===t)throw u;let i=(0,H.e$)(u),a=[...o,u],l=a.length;if(l>t)throw new eX({message:`Failed after ${l} attempts. Last error: ${i}`,reason:"maxRetriesExceeded",errors:a});if(u instanceof Error&&J.w.isInstance(u)&&!0===u.isRetryable&&l<=t)return await (0,H.gw)(r),e1(e,{maxRetries:t,delayInMs:s*r,backoffFactor:s},a);if(1===l)throw u;throw new eX({message:`Failed after ${l} attempts with non-retryable error: '${i}'`,reason:"errorNotRetryable",errors:a})}}function e2({maxRetries:e}){if(null!=e){if(!Number.isInteger(e))throw new eG({parameter:"maxRetries",value:e,message:"maxRetries must be an integer"});if(e<0)throw new eG({parameter:"maxRetries",value:e,message:"maxRetries must be >= 0"})}let t=null!=e?e:2;return{maxRetries:t,retry:e0({maxRetries:t})}}function e3({operationId:e,telemetry:t}){return{"operation.name":`${e}${(null==t?void 0:t.functionId)!=null?` ${t.functionId}`:""}`,"resource.name":null==t?void 0:t.functionId,"ai.operationId":e,"ai.telemetry.functionId":null==t?void 0:t.functionId}}function e4({model:e,settings:t,telemetry:r,headers:s}){var o;return{"ai.model.provider":e.provider,"ai.model.id":e.modelId,...Object.entries(t).reduce((e,[t,r])=>(e[`ai.settings.${t}`]=r,e),{}),...Object.entries(null!=(o=null==r?void 0:r.metadata)?o:{}).reduce((e,[t,r])=>(e[`ai.telemetry.metadata.${t}`]=r,e),{}),...Object.entries(null!=s?s:{}).reduce((e,[t,r])=>(void 0!==r&&(e[`ai.request.headers.${t}`]=r),e),{})}}var e8={startSpan:()=>e6,startActiveSpan:(e,t,r,s)=>"function"==typeof t?t(e6):"function"==typeof r?r(e6):"function"==typeof s?s(e6):void 0},e6={spanContext:()=>e9,setAttribute(){return this},setAttributes(){return this},addEvent(){return this},addLink(){return this},addLinks(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording:()=>!1,recordException(){return this}},e9={traceId:"",spanId:"",traceFlags:0};function e5({isEnabled:e=!1,tracer:t}={}){return e?t||G.g.getTracer("ai"):e8}function e7({name:e,tracer:t,attributes:r,fn:s,endWhenDone:o=!0}){return t.startActiveSpan(e,{attributes:r},async e=>{try{let t=await s(e);return o&&e.end(),t}catch(t){try{t instanceof Error?(e.recordException({name:t.name,message:t.message,stack:t.stack}),e.setStatus({code:Y.Q.ERROR,message:t.message})):e.setStatus({code:Y.Q.ERROR})}finally{e.end()}throw t}})}function te({telemetry:e,attributes:t}){return(null==e?void 0:e.isEnabled)!==!0?{}:Object.entries(t).reduce((t,[r,s])=>{if(void 0===s)return t;if("object"==typeof s&&"input"in s&&"function"==typeof s.input){if((null==e?void 0:e.recordInputs)===!1)return t;let o=s.input();return void 0===o?t:{...t,[r]:o}}if("object"==typeof s&&"output"in s&&"function"==typeof s.output){if((null==e?void 0:e.recordOutputs)===!1)return t;let o=s.output();return void 0===o?t:{...t,[r]:o}}return{...t,[r]:s}},{})}var tt=Symbol.for("vercel.ai.error.AI_NoImageGeneratedError");J.AX;var tr="AI_NoObjectGeneratedError",ts=`vercel.ai.error.${tr}`,tn=Symbol.for(ts),to=class extends J.AX{constructor({message:e="No object generated.",cause:t,text:r,response:s,usage:o}){super({name:tr,message:e,cause:t}),this[d]=!0,this.text=r,this.response=s,this.usage=o}static isInstance(e){return J.AX.hasMarker(e,ts)}};d=tn;var ti="AI_DownloadError",ta=`vercel.ai.error.${ti}`,tl=Symbol.for(ta),tu=class extends J.AX{constructor({url:e,statusCode:t,statusText:r,cause:s,message:o=null==s?`Failed to download ${e}: ${t} ${r}`:`Failed to download ${e}: ${s}`}){super({name:ti,message:o,cause:s}),this[p]=!0,this.url=e,this.statusCode=t,this.statusText=r}static isInstance(e){return J.AX.hasMarker(e,ta)}};async function tc({url:e,fetchImplementation:t=fetch}){var r;let s=e.toString();try{let e=await t(s);if(!e.ok)throw new tu({url:s,statusCode:e.status,statusText:e.statusText});return{data:new Uint8Array(await e.arrayBuffer()),mimeType:null!=(r=e.headers.get("content-type"))?r:void 0}}catch(e){if(tu.isInstance(e))throw e;throw new tu({url:s,cause:e})}}p=tl;var td=[{mimeType:"image/gif",bytes:[71,73,70]},{mimeType:"image/png",bytes:[137,80,78,71]},{mimeType:"image/jpeg",bytes:[255,216]},{mimeType:"image/webp",bytes:[82,73,70,70]}],tp="AI_InvalidDataContentError",th=`vercel.ai.error.${tp}`,tf=Symbol.for(th),tm=class extends J.AX{constructor({content:e,cause:t,message:r=`Invalid data content. Expected a base64 string, Uint8Array, ArrayBuffer, or Buffer, but got ${typeof e}.`}){super({name:tp,message:r,cause:t}),this[h]=!0,this.content=e}static isInstance(e){return J.AX.hasMarker(e,th)}};h=tf;var tg=P.z.union([P.z.string(),P.z.instanceof(Uint8Array),P.z.instanceof(ArrayBuffer),P.z.custom(e=>{var t,r;return null!=(r=null==(t=globalThis.Buffer)?void 0:t.isBuffer(e))&&r},{message:"Must be a Buffer"})]);function ty(e){if(e instanceof Uint8Array)return e;if("string"==typeof e)try{return(0,H.MS)(e)}catch(t){throw new tm({message:"Invalid data content. Content string is not a base64-encoded media.",content:e,cause:t})}if(e instanceof ArrayBuffer)return new Uint8Array(e);throw new tm({content:e})}var tb="AI_InvalidMessageRoleError",t_=`vercel.ai.error.${tb}`,tv=Symbol.for(t_),tw=class extends J.AX{constructor({role:e,message:t=`Invalid message role: '${e}'. Must be one of: "system", "user", "assistant", "tool".`}){super({name:tb,message:t}),this[f]=!0,this.role=e}static isInstance(e){return J.AX.hasMarker(e,t_)}};async function tx({prompt:e,modelSupportsImageUrls:t=!0,modelSupportsUrl:r=()=>!1,downloadImplementation:s=tc}){let o=await tS(e.messages,s,t,r);return[...null!=e.system?[{role:"system",content:e.system}]:[],...e.messages.map(e=>(function(e,t){var r,s,o,i,a,l;let u=e.role;switch(u){case"system":return{role:"system",content:e.content,providerMetadata:null!=(r=e.providerOptions)?r:e.experimental_providerMetadata};case"user":if("string"==typeof e.content)return{role:"user",content:[{type:"text",text:e.content}],providerMetadata:null!=(s=e.providerOptions)?s:e.experimental_providerMetadata};return{role:"user",content:e.content.map(e=>(function(e,t){var r,s,o,i,a;let l,u,c;if("text"===e.type)return{type:"text",text:e.text,providerMetadata:null!=(r=e.providerOptions)?r:e.experimental_providerMetadata};let d=e.mimeType,p=e.type;switch(p){case"image":l=e.image;break;case"file":l=e.data;break;default:throw Error(`Unsupported part type: ${p}`)}try{u="string"==typeof l?new URL(l):l}catch(e){u=l}if(u instanceof URL){if("data:"===u.protocol){let{mimeType:e,base64Content:t}=function(e){try{let[t,r]=e.split(",");return{mimeType:t.split(";")[0].split(":")[1],base64Content:r}}catch(e){return{mimeType:void 0,base64Content:void 0}}}(u.toString());if(null==e||null==t)throw Error(`Invalid data URL format in part ${p}`);d=e,c=ty(t)}else{let e=t[u.toString()];e?(c=e.data,null!=d||(d=e.mimeType)):c=u}}else c=ty(u);switch(p){case"image":return c instanceof Uint8Array&&(d=null!=(s=function(e){for(let{bytes:t,mimeType:r}of td)if(e.length>=t.length&&t.every((t,r)=>e[r]===t))return r}(c))?s:d),{type:"image",image:c,mimeType:d,providerMetadata:null!=(o=e.providerOptions)?o:e.experimental_providerMetadata};case"file":if(null==d)throw Error("Mime type is missing for file part");return{type:"file",data:c instanceof Uint8Array?"string"==typeof(a=c)?a:a instanceof ArrayBuffer?(0,H.k0)(new Uint8Array(a)):(0,H.k0)(a):c,mimeType:d,providerMetadata:null!=(i=e.providerOptions)?i:e.experimental_providerMetadata}}})(e,t)).filter(e=>"text"!==e.type||""!==e.text),providerMetadata:null!=(o=e.providerOptions)?o:e.experimental_providerMetadata};case"assistant":if("string"==typeof e.content)return{role:"assistant",content:[{type:"text",text:e.content}],providerMetadata:null!=(i=e.providerOptions)?i:e.experimental_providerMetadata};return{role:"assistant",content:e.content.filter(e=>"text"!==e.type||""!==e.text).map(e=>{let{experimental_providerMetadata:t,providerOptions:r,...s}=e;return{...s,providerMetadata:null!=r?r:t}}),providerMetadata:null!=(a=e.providerOptions)?a:e.experimental_providerMetadata};case"tool":return{role:"tool",content:e.content.map(e=>{var t;return{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,result:e.result,content:e.experimental_content,isError:e.isError,providerMetadata:null!=(t=e.providerOptions)?t:e.experimental_providerMetadata}}),providerMetadata:null!=(l=e.providerOptions)?l:e.experimental_providerMetadata};default:throw new tw({role:u})}})(e,o))]}async function tS(e,t,r,s){let o=e.filter(e=>"user"===e.role).map(e=>e.content).filter(e=>Array.isArray(e)).flat().filter(e=>"image"===e.type||"file"===e.type).filter(e=>!("image"===e.type&&!0===r)).map(e=>"image"===e.type?e.image:e.data).map(e=>"string"==typeof e&&(e.startsWith("http:")||e.startsWith("https:"))?new URL(e):e).filter(e=>e instanceof URL).filter(e=>!s(e));return Object.fromEntries((await Promise.all(o.map(async e=>({url:e,data:await t({url:e})})))).map(({url:e,data:t})=>[e.toString(),t]))}function tE({maxTokens:e,temperature:t,topP:r,topK:s,presencePenalty:o,frequencyPenalty:i,stopSequences:a,seed:l}){if(null!=e){if(!Number.isInteger(e))throw new eG({parameter:"maxTokens",value:e,message:"maxTokens must be an integer"});if(e<1)throw new eG({parameter:"maxTokens",value:e,message:"maxTokens must be >= 1"})}if(null!=t&&"number"!=typeof t)throw new eG({parameter:"temperature",value:t,message:"temperature must be a number"});if(null!=r&&"number"!=typeof r)throw new eG({parameter:"topP",value:r,message:"topP must be a number"});if(null!=s&&"number"!=typeof s)throw new eG({parameter:"topK",value:s,message:"topK must be a number"});if(null!=o&&"number"!=typeof o)throw new eG({parameter:"presencePenalty",value:o,message:"presencePenalty must be a number"});if(null!=i&&"number"!=typeof i)throw new eG({parameter:"frequencyPenalty",value:i,message:"frequencyPenalty must be a number"});if(null!=l&&!Number.isInteger(l))throw new eG({parameter:"seed",value:l,message:"seed must be an integer"});return{maxTokens:e,temperature:null!=t?t:0,topP:r,topK:s,presencePenalty:o,frequencyPenalty:i,stopSequences:null!=a&&a.length>0?a:void 0,seed:l}}f=tv;var tk="AI_MessageConversionError",tI=`vercel.ai.error.${tk}`,tO=Symbol.for(tI),tT=class extends J.AX{constructor({originalMessage:e,message:t}){super({name:tk,message:t}),this[m]=!0,this.originalMessage=e}static isInstance(e){return J.AX.hasMarker(e,tI)}};function tj(e){return"object"==typeof e&&null!==e&&("function"===e.role||"data"===e.role||"toolInvocations"in e||"experimental_attachments"in e)?"has-ui-specific-parts":"object"==typeof e&&null!==e&&"content"in e&&(Array.isArray(e.content)||"experimental_providerMetadata"in e||"providerOptions"in e)?"has-core-specific-parts":"object"==typeof e&&null!==e&&"role"in e&&"content"in e&&"string"==typeof e.content&&["system","user","assistant","tool"].includes(e.role)?"message":"other"}m=tO;var tC=P.z.lazy(()=>P.z.union([P.z.null(),P.z.string(),P.z.number(),P.z.boolean(),P.z.record(P.z.string(),tC),P.z.array(tC)])),tR=P.z.record(P.z.string(),P.z.record(P.z.string(),tC)),tA=P.z.array(P.z.union([P.z.object({type:P.z.literal("text"),text:P.z.string()}),P.z.object({type:P.z.literal("image"),data:P.z.string(),mimeType:P.z.string().optional()})])),tP=P.z.object({type:P.z.literal("text"),text:P.z.string(),providerOptions:tR.optional(),experimental_providerMetadata:tR.optional()}),tN=P.z.object({type:P.z.literal("image"),image:P.z.union([tg,P.z.instanceof(URL)]),mimeType:P.z.string().optional(),providerOptions:tR.optional(),experimental_providerMetadata:tR.optional()}),tq=P.z.object({type:P.z.literal("file"),data:P.z.union([tg,P.z.instanceof(URL)]),mimeType:P.z.string(),providerOptions:tR.optional(),experimental_providerMetadata:tR.optional()}),tM=P.z.object({type:P.z.literal("reasoning"),text:P.z.string(),providerOptions:tR.optional(),experimental_providerMetadata:tR.optional()}),tL=P.z.object({type:P.z.literal("redacted-reasoning"),data:P.z.string(),providerOptions:tR.optional(),experimental_providerMetadata:tR.optional()}),t$=P.z.object({type:P.z.literal("tool-call"),toolCallId:P.z.string(),toolName:P.z.string(),args:P.z.unknown(),providerOptions:tR.optional(),experimental_providerMetadata:tR.optional()}),tD=P.z.object({type:P.z.literal("tool-result"),toolCallId:P.z.string(),toolName:P.z.string(),result:P.z.unknown(),content:tA.optional(),isError:P.z.boolean().optional(),providerOptions:tR.optional(),experimental_providerMetadata:tR.optional()}),tU=P.z.object({role:P.z.literal("system"),content:P.z.string(),providerOptions:tR.optional(),experimental_providerMetadata:tR.optional()}),tB=P.z.object({role:P.z.literal("user"),content:P.z.union([P.z.string(),P.z.array(P.z.union([tP,tN,tq]))]),providerOptions:tR.optional(),experimental_providerMetadata:tR.optional()}),tF=P.z.object({role:P.z.literal("assistant"),content:P.z.union([P.z.string(),P.z.array(P.z.union([tP,tM,tL,t$]))]),providerOptions:tR.optional(),experimental_providerMetadata:tR.optional()}),tV=P.z.object({role:P.z.literal("tool"),content:P.z.array(tD),providerOptions:tR.optional(),experimental_providerMetadata:tR.optional()}),tW=P.z.union([tU,tB,tF,tV]);function tz({prompt:e,tools:t}){if(null==e.prompt&&null==e.messages)throw new J.Mt({prompt:e,message:"prompt or messages must be defined"});if(null!=e.prompt&&null!=e.messages)throw new J.Mt({prompt:e,message:"prompt and messages cannot be defined at the same time"});if(null!=e.system&&"string"!=typeof e.system)throw new J.Mt({prompt:e,message:"system must be a string"});if(null!=e.prompt){if("string"!=typeof e.prompt)throw new J.Mt({prompt:e,message:"prompt must be a string"});return{type:"prompt",system:e.system,messages:[{role:"user",content:e.prompt}]}}if(null!=e.messages){let r=function(e){if(!Array.isArray(e))return"other";if(0===e.length)return"messages";let t=e.map(tj);return t.some(e=>"has-ui-specific-parts"===e)?"ui-messages":t.every(e=>"has-core-specific-parts"===e||"message"===e)?"messages":"other"}(e.messages);if("other"===r)throw new J.Mt({prompt:e,message:"messages must be an array of CoreMessage or UIMessage"});let s="ui-messages"===r?function(e,t){var r,s;let o=null!=(r=null==t?void 0:t.tools)?r:{},i=[];for(let t=0;t<e.length;t++){let r=e[t],a=t===e.length-1,{role:l,content:u,experimental_attachments:c}=r;switch(l){case"system":i.push({role:"system",content:u});break;case"user":i.push({role:"user",content:c?[{type:"text",text:u},...function(e){var t,r,s;let o=[];for(let i of e){let e;try{e=new URL(i.url)}catch(e){throw Error(`Invalid URL: ${i.url}`)}switch(e.protocol){case"http:":case"https:":if(null==(t=i.contentType)?void 0:t.startsWith("image/"))o.push({type:"image",image:e});else{if(!i.contentType)throw Error("If the attachment is not an image, it must specify a content type");o.push({type:"file",data:e,mimeType:i.contentType})}break;case"data:":{let e,t,a;try{[e,t]=i.url.split(","),a=e.split(";")[0].split(":")[1]}catch(e){throw Error(`Error processing data URL: ${i.url}`)}if(null==a||null==t)throw Error(`Invalid data URL format: ${i.url}`);if(null==(r=i.contentType)?void 0:r.startsWith("image/"))o.push({type:"image",image:ty(t)});else if(null==(s=i.contentType)?void 0:s.startsWith("text/"))o.push({type:"text",text:function(e){try{return new TextDecoder().decode(e)}catch(e){throw Error("Error decoding Uint8Array to text")}}(ty(t))});else{if(!i.contentType)throw Error("If the attachment is not an image or text, it must specify a content type");o.push({type:"file",data:t,mimeType:i.contentType})}break}default:throw Error(`Unsupported URL protocol: ${e.protocol}`)}}return o}(c)]:u});break;case"assistant":{if(null!=r.parts){let e=function(){let e=[];for(let t of l)switch(t.type){case"text":e.push({type:"text",text:t.text});break;case"reasoning":for(let r of t.details)switch(r.type){case"text":e.push({type:"reasoning",text:r.text,signature:r.signature});break;case"redacted":e.push({type:"redacted-reasoning",data:r.data})}break;case"tool-invocation":e.push({type:"tool-call",toolCallId:t.toolInvocation.toolCallId,toolName:t.toolInvocation.toolName,args:t.toolInvocation.args});break;default:throw Error(`Unsupported part: ${t}`)}i.push({role:"assistant",content:e});let s=l.filter(e=>"tool-invocation"===e.type).map(e=>e.toolInvocation);s.length>0&&i.push({role:"tool",content:s.map(e=>{if(!("result"in e))throw new tT({originalMessage:r,message:"ToolInvocation must have a result: "+JSON.stringify(e)});let{toolCallId:t,toolName:s,result:i}=e,a=o[s];return(null==a?void 0:a.experimental_toToolResultContent)!=null?{type:"tool-result",toolCallId:t,toolName:s,result:a.experimental_toToolResultContent(i),experimental_content:a.experimental_toToolResultContent(i)}:{type:"tool-result",toolCallId:t,toolName:s,result:i}})}),l=[],a=!1,t++},t=0,a=!1,l=[];for(let o of r.parts)switch(o.type){case"reasoning":l.push(o);break;case"text":a&&e(),l.push(o);break;case"tool-invocation":(null!=(s=o.toolInvocation.step)?s:0)!==t&&e(),l.push(o),a=!0}e();break}let e=r.toolInvocations;if(null==e||0===e.length){i.push({role:"assistant",content:u});break}let t=e.reduce((e,t)=>{var r;return Math.max(e,null!=(r=t.step)?r:0)},0);for(let s=0;s<=t;s++){let t=e.filter(e=>{var t;return(null!=(t=e.step)?t:0)===s});0!==t.length&&(i.push({role:"assistant",content:[...a&&u&&0===s?[{type:"text",text:u}]:[],...t.map(({toolCallId:e,toolName:t,args:r})=>({type:"tool-call",toolCallId:e,toolName:t,args:r}))]}),i.push({role:"tool",content:t.map(e=>{if(!("result"in e))throw new tT({originalMessage:r,message:"ToolInvocation must have a result: "+JSON.stringify(e)});let{toolCallId:t,toolName:s,result:i}=e,a=o[s];return(null==a?void 0:a.experimental_toToolResultContent)!=null?{type:"tool-result",toolCallId:t,toolName:s,result:a.experimental_toToolResultContent(i),experimental_content:a.experimental_toToolResultContent(i)}:{type:"tool-result",toolCallId:t,toolName:s,result:i}})}))}u&&!a&&i.push({role:"assistant",content:u});break}case"data":break;default:throw new tT({originalMessage:r,message:`Unsupported role: ${l}`})}}return i}(e.messages,{tools:t}):e.messages,o=(0,H.pW)({value:s,schema:P.z.array(tW)});if(!o.success)throw new J.Mt({prompt:e,message:"messages must be an array of CoreMessage or UIMessage",cause:o.error});return{type:"messages",messages:s,system:e.system}}throw Error("unreachable")}function tZ({promptTokens:e,completionTokens:t}){return{promptTokens:e,completionTokens:t,totalTokens:e+t}}function tJ(e,t){return{promptTokens:e.promptTokens+t.promptTokens,completionTokens:e.completionTokens+t.completionTokens,totalTokens:e.totalTokens+t.totalTokens}}function tH({prompt:e,schema:t,schemaPrefix:r=null!=t?"JSON schema:":void 0,schemaSuffix:s=null!=t?"You MUST answer with a JSON object that matches the JSON schema above.":"You MUST answer with JSON."}){return[null!=e&&e.length>0?e:void 0,null!=e&&e.length>0?"":void 0,r,null!=t?JSON.stringify(t):void 0,s].filter(e=>null!=e).join("\n")}function tG(e){let t=e.pipeThrough(new TransformStream);return t[Symbol.asyncIterator]=()=>{let e=t.getReader();return{async next(){let{done:t,value:r}=await e.read();return t?{done:!0,value:void 0}:{done:!1,value:r}}}},t}var tY={type:"no-schema",jsonSchema:void 0,validatePartialResult:({value:e,textDelta:t})=>({success:!0,value:{partial:e,textDelta:t}}),validateFinalResult:(e,t)=>void 0===e?{success:!1,error:new to({message:"No object generated: response did not match schema.",text:t.text,response:t.response,usage:t.usage})}:{success:!0,value:e},createElementStream(){throw new J.A_({functionality:"element streams in no-schema mode"})}},tK=e=>({type:"object",jsonSchema:e.jsonSchema,validatePartialResult:({value:e,textDelta:t})=>({success:!0,value:{partial:e,textDelta:t}}),validateFinalResult:t=>(0,H.pW)({value:t,schema:e}),createElementStream(){throw new J.A_({functionality:"element streams in object mode"})}}),tQ=e=>{let{$schema:t,...r}=e.jsonSchema;return{type:"enum",jsonSchema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{elements:{type:"array",items:r}},required:["elements"],additionalProperties:!1},validatePartialResult({value:t,latestObject:r,isFirstDelta:s,isFinalDelta:o}){var i;if(!(0,J.wA)(t)||!(0,J._d)(t.elements))return{success:!1,error:new J.Gz({value:t,cause:"value must be an object that contains an array of elements"})};let a=t.elements,l=[];for(let t=0;t<a.length;t++){let r=a[t],s=(0,H.pW)({value:r,schema:e});if(t!==a.length-1||o){if(!s.success)return s;l.push(s.value)}}let u=null!=(i=null==r?void 0:r.length)?i:0,c="";return s&&(c+="["),u>0&&(c+=","),c+=l.slice(u).map(e=>JSON.stringify(e)).join(","),o&&(c+="]"),{success:!0,value:{partial:l,textDelta:c}}},validateFinalResult(t){if(!(0,J.wA)(t)||!(0,J._d)(t.elements))return{success:!1,error:new J.Gz({value:t,cause:"value must be an object that contains an array of elements"})};let r=t.elements;for(let t of r){let r=(0,H.pW)({value:t,schema:e});if(!r.success)return r}return{success:!0,value:r}},createElementStream(e){let t=0;return tG(e.pipeThrough(new TransformStream({transform(e,r){switch(e.type){case"object":{let s=e.object;for(;t<s.length;t++)r.enqueue(s[t]);break}case"text-delta":case"finish":case"error":break;default:throw Error(`Unsupported chunk type: ${e}`)}}})))}}},tX=e=>({type:"enum",jsonSchema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{result:{type:"string",enum:e}},required:["result"],additionalProperties:!1},validateFinalResult(t){if(!(0,J.wA)(t)||"string"!=typeof t.result)return{success:!1,error:new J.Gz({value:t,cause:'value must be an object that contains a string in the "result" property.'})};let r=t.result;return e.includes(r)?{success:!0,value:r}:{success:!1,error:new J.Gz({value:t,cause:"value must be a string in the enum"})}},validatePartialResult(){throw new J.A_({functionality:"partial results in enum mode"})},createElementStream(){throw new J.A_({functionality:"element streams in enum mode"})}});function t0({output:e,schema:t,enumValues:r}){switch(e){case"object":return tK(eU(t));case"array":return tQ(eU(t));case"enum":return tX(r);case"no-schema":return tY;default:throw Error(`Unsupported output: ${e}`)}}function t1({output:e,mode:t,schema:r,schemaName:s,schemaDescription:o,enumValues:i}){if(null!=e&&"object"!==e&&"array"!==e&&"enum"!==e&&"no-schema"!==e)throw new eG({parameter:"output",value:e,message:"Invalid output type."});if("no-schema"===e){if("auto"===t||"tool"===t)throw new eG({parameter:"mode",value:t,message:'Mode must be "json" for no-schema output.'});if(null!=r)throw new eG({parameter:"schema",value:r,message:"Schema is not supported for no-schema output."});if(null!=o)throw new eG({parameter:"schemaDescription",value:o,message:"Schema description is not supported for no-schema output."});if(null!=s)throw new eG({parameter:"schemaName",value:s,message:"Schema name is not supported for no-schema output."});if(null!=i)throw new eG({parameter:"enumValues",value:i,message:"Enum values are not supported for no-schema output."})}if("object"===e){if(null==r)throw new eG({parameter:"schema",value:r,message:"Schema is required for object output."});if(null!=i)throw new eG({parameter:"enumValues",value:i,message:"Enum values are not supported for object output."})}if("array"===e){if(null==r)throw new eG({parameter:"schema",value:r,message:"Element schema is required for array output."});if(null!=i)throw new eG({parameter:"enumValues",value:i,message:"Enum values are not supported for array output."})}if("enum"===e){if(null!=r)throw new eG({parameter:"schema",value:r,message:"Schema is not supported for enum output."});if(null!=o)throw new eG({parameter:"schemaDescription",value:o,message:"Schema description is not supported for enum output."});if(null!=s)throw new eG({parameter:"schemaName",value:s,message:"Schema name is not supported for enum output."});if(null==i)throw new eG({parameter:"enumValues",value:i,message:"Enum values are required for enum output."});for(let e of i)if("string"!=typeof e)throw new eG({parameter:"enumValues",value:e,message:"Enum values must be strings."})}}var t2=(0,H.bF)({prefix:"aiobj",size:24});async function t3({model:e,enum:t,schema:r,schemaName:s,schemaDescription:o,mode:i,output:a="object",system:l,prompt:u,messages:c,maxRetries:d,abortSignal:p,headers:h,experimental_repairText:f,experimental_telemetry:m,experimental_providerMetadata:g,providerOptions:y=g,_internal:{generateId:b=t2,currentDate:_=()=>new Date}={},...v}){t1({output:a,mode:i,schema:r,schemaName:s,schemaDescription:o,enumValues:t});let{maxRetries:w,retry:S}=e2({maxRetries:d}),E=t0({output:a,schema:r,enumValues:t});"no-schema"===E.type&&void 0===i&&(i="json");let k=e4({model:e,telemetry:m,headers:h,settings:{...v,maxRetries:w}}),I=e5(m);return e7({name:"ai.generateObject",attributes:te({telemetry:m,attributes:{...e3({operationId:"ai.generateObject",telemetry:m}),...k,"ai.prompt":{input:()=>JSON.stringify({system:l,prompt:u,messages:c})},"ai.schema":null!=E.jsonSchema?{input:()=>JSON.stringify(E.jsonSchema)}:void 0,"ai.schema.name":s,"ai.schema.description":o,"ai.settings.output":E.type,"ai.settings.mode":i}}),tracer:I,fn:async t=>{var r,a,d,g;let w,O,T,j,C,R,A,P,N,q;switch(("auto"===i||null==i)&&(i=e.defaultObjectGenerationMode),i){case"json":{let t=tz({prompt:{system:null==E.jsonSchema?tH({prompt:l}):e.supportsStructuredOutputs?l:tH({prompt:l,schema:E.jsonSchema}),prompt:u,messages:c},tools:void 0}),d=await tx({prompt:t,modelSupportsImageUrls:e.supportsImageUrls,modelSupportsUrl:null==(r=e.supportsUrl)?void 0:r.bind(e)}),f=await S(()=>e7({name:"ai.generateObject.doGenerate",attributes:te({telemetry:m,attributes:{...e3({operationId:"ai.generateObject.doGenerate",telemetry:m}),...k,"ai.prompt.format":{input:()=>t.type},"ai.prompt.messages":{input:()=>JSON.stringify(d)},"ai.settings.mode":i,"gen_ai.system":e.provider,"gen_ai.request.model":e.modelId,"gen_ai.request.frequency_penalty":v.frequencyPenalty,"gen_ai.request.max_tokens":v.maxTokens,"gen_ai.request.presence_penalty":v.presencePenalty,"gen_ai.request.temperature":v.temperature,"gen_ai.request.top_k":v.topK,"gen_ai.request.top_p":v.topP}}),tracer:I,fn:async r=>{var i,a,l,u,c,f;let g=await e.doGenerate({mode:{type:"object-json",schema:E.jsonSchema,name:s,description:o},...tE(v),inputFormat:t.type,prompt:d,providerMetadata:y,abortSignal:p,headers:h}),w={id:null!=(a=null==(i=g.response)?void 0:i.id)?a:b(),timestamp:null!=(u=null==(l=g.response)?void 0:l.timestamp)?u:_(),modelId:null!=(f=null==(c=g.response)?void 0:c.modelId)?f:e.modelId};if(void 0===g.text)throw new to({message:"No object generated: the model did not return a response.",response:w,usage:tZ(g.usage)});return r.setAttributes(te({telemetry:m,attributes:{"ai.response.finishReason":g.finishReason,"ai.response.object":{output:()=>g.text},"ai.response.id":w.id,"ai.response.model":w.modelId,"ai.response.timestamp":w.timestamp.toISOString(),"ai.usage.promptTokens":g.usage.promptTokens,"ai.usage.completionTokens":g.usage.completionTokens,"gen_ai.response.finish_reasons":[g.finishReason],"gen_ai.response.id":w.id,"gen_ai.response.model":w.modelId,"gen_ai.usage.prompt_tokens":g.usage.promptTokens,"gen_ai.usage.completion_tokens":g.usage.completionTokens}})),{...g,objectText:g.text,responseData:w}}}));w=f.objectText,O=f.finishReason,T=f.usage,j=f.warnings,C=f.rawResponse,P=f.logprobs,N=f.providerMetadata,A=null!=(a=f.request)?a:{},R=f.responseData;break}case"tool":{let t=tz({prompt:{system:l,prompt:u,messages:c},tools:void 0}),r=await tx({prompt:t,modelSupportsImageUrls:e.supportsImageUrls,modelSupportsUrl:null==(d=e.supportsUrl)?void 0:d.bind(e)}),a=t.type,f=await S(()=>e7({name:"ai.generateObject.doGenerate",attributes:te({telemetry:m,attributes:{...e3({operationId:"ai.generateObject.doGenerate",telemetry:m}),...k,"ai.prompt.format":{input:()=>a},"ai.prompt.messages":{input:()=>JSON.stringify(r)},"ai.settings.mode":i,"gen_ai.system":e.provider,"gen_ai.request.model":e.modelId,"gen_ai.request.frequency_penalty":v.frequencyPenalty,"gen_ai.request.max_tokens":v.maxTokens,"gen_ai.request.presence_penalty":v.presencePenalty,"gen_ai.request.temperature":v.temperature,"gen_ai.request.top_k":v.topK,"gen_ai.request.top_p":v.topP}}),tracer:I,fn:async t=>{var i,l,u,c,d,f,g,w;let S=await e.doGenerate({mode:{type:"object-tool",tool:{type:"function",name:null!=s?s:"json",description:null!=o?o:"Respond with a JSON object.",parameters:E.jsonSchema}},...tE(v),inputFormat:a,prompt:r,providerMetadata:y,abortSignal:p,headers:h}),k=null==(l=null==(i=S.toolCalls)?void 0:i[0])?void 0:l.args,I={id:null!=(c=null==(u=S.response)?void 0:u.id)?c:b(),timestamp:null!=(f=null==(d=S.response)?void 0:d.timestamp)?f:_(),modelId:null!=(w=null==(g=S.response)?void 0:g.modelId)?w:e.modelId};if(void 0===k)throw new to({message:"No object generated: the tool was not called.",response:I,usage:tZ(S.usage)});return t.setAttributes(te({telemetry:m,attributes:{"ai.response.finishReason":S.finishReason,"ai.response.object":{output:()=>k},"ai.response.id":I.id,"ai.response.model":I.modelId,"ai.response.timestamp":I.timestamp.toISOString(),"ai.usage.promptTokens":S.usage.promptTokens,"ai.usage.completionTokens":S.usage.completionTokens,"gen_ai.response.finish_reasons":[S.finishReason],"gen_ai.response.id":I.id,"gen_ai.response.model":I.modelId,"gen_ai.usage.input_tokens":S.usage.promptTokens,"gen_ai.usage.output_tokens":S.usage.completionTokens}})),{...S,objectText:k,responseData:I}}}));w=f.objectText,O=f.finishReason,T=f.usage,j=f.warnings,C=f.rawResponse,P=f.logprobs,N=f.providerMetadata,A=null!=(g=f.request)?g:{},R=f.responseData;break}case void 0:throw Error("Model does not have a default object generation mode.");default:{let e=i;throw Error(`Unsupported mode: ${e}`)}}function M(e){let t=(0,H.NX)({text:e});if(!t.success)throw new to({message:"No object generated: could not parse the response.",cause:t.error,text:e,response:R,usage:tZ(T)});let r=E.validateFinalResult(t.value,{text:e,response:R,usage:tZ(T)});if(!r.success)throw new to({message:"No object generated: response did not match schema.",cause:r.error,text:e,response:R,usage:tZ(T)});return r.value}try{q=M(w)}catch(e){if(null!=f&&to.isInstance(e)&&(J.xU.isInstance(e.cause)||J.Gz.isInstance(e.cause))){let t=await f({text:w,error:e.cause});if(null===t)throw e;q=M(t)}else throw e}return t.setAttributes(te({telemetry:m,attributes:{"ai.response.finishReason":O,"ai.response.object":{output:()=>JSON.stringify(q)},"ai.usage.promptTokens":T.promptTokens,"ai.usage.completionTokens":T.completionTokens}})),new t4({object:q,finishReason:O,usage:tZ(T),warnings:j,request:A,response:{...R,headers:null==C?void 0:C.headers,body:null==C?void 0:C.body},logprobs:P,providerMetadata:N})}})}var t4=class{constructor(e){this.object=e.object,this.finishReason=e.finishReason,this.usage=e.usage,this.warnings=e.warnings,this.providerMetadata=e.providerMetadata,this.experimental_providerMetadata=e.providerMetadata,this.response=e.response,this.request=e.request,this.logprobs=e.logprobs}toJsonResponse(e){var t;return new Response(JSON.stringify(this.object),{status:null!=(t=null==e?void 0:e.status)?t:200,headers:eV(null==e?void 0:e.headers,{contentType:"application/json; charset=utf-8"})})}},t8=class{constructor(){this.status={type:"pending"},this._resolve=void 0,this._reject=void 0}get value(){return this.promise||(this.promise=new Promise((e,t)=>{"resolved"===this.status.type?e(this.status.value):"rejected"===this.status.type&&t(this.status.error),this._resolve=e,this._reject=t})),this.promise}resolve(e){var t;this.status={type:"resolved",value:e},this.promise&&(null==(t=this._resolve)||t.call(this,e))}reject(e){var t;this.status={type:"rejected",error:e},this.promise&&(null==(t=this._reject)||t.call(this,e))}};function t6(){let e,t;return{promise:new Promise((r,s)=>{e=r,t=s}),resolve:e,reject:t}}function t9(){let e=[],t=null,r=!1,s=t6(),o=async()=>{if(r&&0===e.length){null==t||t.close();return}if(0===e.length)return s=t6(),await s.promise,o();try{let{value:s,done:i}=await e[0].read();i?(e.shift(),e.length>0?await o():r&&(null==t||t.close())):null==t||t.enqueue(s)}catch(s){null==t||t.error(s),e.shift(),r&&0===e.length&&(null==t||t.close())}};return{stream:new ReadableStream({start(e){t=e},pull:o,async cancel(){for(let t of e)await t.cancel();e=[],r=!0}}),addStream:t=>{if(r)throw Error("Cannot add inner stream: outer stream is closed");e.push(t.getReader()),s.resolve()},close:()=>{r=!0,s.resolve(),0===e.length&&(null==t||t.close())},terminate:()=>{r=!0,s.resolve(),e.forEach(e=>e.cancel()),e=[],null==t||t.close()}}}function t5(){var e,t;return null!=(t=null==(e=null==globalThis?void 0:globalThis.performance)?void 0:e.now())?t:Date.now()}var t7=(0,H.bF)({prefix:"aiobj",size:24}),re=class{constructor({model:e,headers:t,telemetry:r,settings:s,maxRetries:o,abortSignal:i,outputStrategy:a,system:l,prompt:u,messages:c,schemaName:d,schemaDescription:p,providerOptions:h,mode:f,onError:m,onFinish:g,generateId:y,currentDate:b,now:_}){this.objectPromise=new t8,this.usagePromise=new t8,this.providerMetadataPromise=new t8,this.warningsPromise=new t8,this.requestPromise=new t8,this.responsePromise=new t8;let{maxRetries:v,retry:w}=e2({maxRetries:o}),S=e4({model:e,telemetry:r,headers:t,settings:{...s,maxRetries:v}}),E=e5(r),k=this,I=t9(),O=new TransformStream({transform(e,t){t.enqueue(e),"error"===e.type&&(null==m||m({error:e.error}))}});this.baseStream=I.stream.pipeThrough(O),e7({name:"ai.streamObject",attributes:te({telemetry:r,attributes:{...e3({operationId:"ai.streamObject",telemetry:r}),...S,"ai.prompt":{input:()=>JSON.stringify({system:l,prompt:u,messages:c})},"ai.schema":null!=a.jsonSchema?{input:()=>JSON.stringify(a.jsonSchema)}:void 0,"ai.schema.name":d,"ai.schema.description":p,"ai.settings.output":a.type,"ai.settings.mode":f}}),tracer:E,endWhenDone:!1,fn:async o=>{var m,v;let O,T,j,C,R,A,P,N,q;switch(("auto"===f||null==f)&&(f=e.defaultObjectGenerationMode),f){case"json":{let r=tz({prompt:{system:null==a.jsonSchema?tH({prompt:l}):e.supportsStructuredOutputs?l:tH({prompt:l,schema:a.jsonSchema}),prompt:u,messages:c},tools:void 0});O={mode:{type:"object-json",schema:a.jsonSchema,name:d,description:p},...tE(s),inputFormat:r.type,prompt:await tx({prompt:r,modelSupportsImageUrls:e.supportsImageUrls,modelSupportsUrl:null==(m=e.supportsUrl)?void 0:m.bind(e)}),providerMetadata:h,abortSignal:i,headers:t},T={transform:(e,t)=>{switch(e.type){case"text-delta":t.enqueue(e.textDelta);break;case"response-metadata":case"finish":case"error":t.enqueue(e)}}};break}case"tool":{let r=tz({prompt:{system:l,prompt:u,messages:c},tools:void 0});O={mode:{type:"object-tool",tool:{type:"function",name:null!=d?d:"json",description:null!=p?p:"Respond with a JSON object.",parameters:a.jsonSchema}},...tE(s),inputFormat:r.type,prompt:await tx({prompt:r,modelSupportsImageUrls:e.supportsImageUrls,modelSupportsUrl:null==(v=e.supportsUrl)?void 0:v.bind(e)}),providerMetadata:h,abortSignal:i,headers:t},T={transform(e,t){switch(e.type){case"tool-call-delta":t.enqueue(e.argsTextDelta);break;case"response-metadata":case"finish":case"error":t.enqueue(e)}}};break}case void 0:throw Error("Model does not have a default object generation mode.");default:{let e=f;throw Error(`Unsupported mode: ${e}`)}}let{result:{stream:M,warnings:L,rawResponse:$,request:D},doStreamSpan:U,startTimestampMs:B}=await w(()=>e7({name:"ai.streamObject.doStream",attributes:te({telemetry:r,attributes:{...e3({operationId:"ai.streamObject.doStream",telemetry:r}),...S,"ai.prompt.format":{input:()=>O.inputFormat},"ai.prompt.messages":{input:()=>JSON.stringify(O.prompt)},"ai.settings.mode":f,"gen_ai.system":e.provider,"gen_ai.request.model":e.modelId,"gen_ai.request.frequency_penalty":s.frequencyPenalty,"gen_ai.request.max_tokens":s.maxTokens,"gen_ai.request.presence_penalty":s.presencePenalty,"gen_ai.request.temperature":s.temperature,"gen_ai.request.top_k":s.topK,"gen_ai.request.top_p":s.topP}}),tracer:E,endWhenDone:!1,fn:async t=>({startTimestampMs:_(),doStreamSpan:t,result:await e.doStream(O)})}));k.requestPromise.resolve(null!=D?D:{});let F="",V="",W={id:y(),timestamp:b(),modelId:e.modelId},z=!0,Z=!0,J=M.pipeThrough(new TransformStream(T)).pipeThrough(new TransformStream({async transform(e,t){var r,s,o;if(z){let e=_()-B;z=!1,U.addEvent("ai.stream.firstChunk",{"ai.stream.msToFirstChunk":e}),U.setAttributes({"ai.stream.msToFirstChunk":e})}if("string"==typeof e){F+=e,V+=e;let{value:r,state:s}=eR(F);if(void 0!==r&&!eL(N,r)){let e=a.validatePartialResult({value:r,textDelta:V,latestObject:q,isFirstDelta:Z,isFinalDelta:"successful-parse"===s});e.success&&!eL(q,e.value.partial)&&(N=r,q=e.value.partial,t.enqueue({type:"object",object:q}),t.enqueue({type:"text-delta",textDelta:e.value.textDelta}),V="",Z=!1)}return}switch(e.type){case"response-metadata":W={id:null!=(r=e.id)?r:W.id,timestamp:null!=(s=e.timestamp)?s:W.timestamp,modelId:null!=(o=e.modelId)?o:W.modelId};break;case"finish":{""!==V&&t.enqueue({type:"text-delta",textDelta:V}),C=e.finishReason,j=tZ(e.usage),R=e.providerMetadata,t.enqueue({...e,usage:j,response:W}),k.usagePromise.resolve(j),k.providerMetadataPromise.resolve(R),k.responsePromise.resolve({...W,headers:null==$?void 0:$.headers});let r=a.validateFinalResult(N,{text:F,response:W,usage:j});r.success?(A=r.value,k.objectPromise.resolve(A)):(P=new to({message:"No object generated: response did not match schema.",cause:r.error,text:F,response:W,usage:j}),k.objectPromise.reject(P));break}default:t.enqueue(e)}},async flush(e){try{let e=null!=j?j:{promptTokens:NaN,completionTokens:NaN,totalTokens:NaN};U.setAttributes(te({telemetry:r,attributes:{"ai.response.finishReason":C,"ai.response.object":{output:()=>JSON.stringify(A)},"ai.response.id":W.id,"ai.response.model":W.modelId,"ai.response.timestamp":W.timestamp.toISOString(),"ai.usage.promptTokens":e.promptTokens,"ai.usage.completionTokens":e.completionTokens,"gen_ai.response.finish_reasons":[C],"gen_ai.response.id":W.id,"gen_ai.response.model":W.modelId,"gen_ai.usage.input_tokens":e.promptTokens,"gen_ai.usage.output_tokens":e.completionTokens}})),U.end(),o.setAttributes(te({telemetry:r,attributes:{"ai.usage.promptTokens":e.promptTokens,"ai.usage.completionTokens":e.completionTokens,"ai.response.object":{output:()=>JSON.stringify(A)}}})),await (null==g?void 0:g({usage:e,object:A,error:P,response:{...W,headers:null==$?void 0:$.headers},warnings:L,providerMetadata:R,experimental_providerMetadata:R}))}catch(t){e.enqueue({type:"error",error:t})}finally{o.end()}}}));I.addStream(J)}}).catch(e=>{I.addStream(new ReadableStream({start(t){t.enqueue({type:"error",error:e}),t.close()}}))}).finally(()=>{I.close()}),this.outputStrategy=a}get object(){return this.objectPromise.value}get usage(){return this.usagePromise.value}get experimental_providerMetadata(){return this.providerMetadataPromise.value}get providerMetadata(){return this.providerMetadataPromise.value}get warnings(){return this.warningsPromise.value}get request(){return this.requestPromise.value}get response(){return this.responsePromise.value}get partialObjectStream(){return tG(this.baseStream.pipeThrough(new TransformStream({transform(e,t){switch(e.type){case"object":t.enqueue(e.object);break;case"text-delta":case"finish":case"error":break;default:throw Error(`Unsupported chunk type: ${e}`)}}})))}get elementStream(){return this.outputStrategy.createElementStream(this.baseStream)}get textStream(){return tG(this.baseStream.pipeThrough(new TransformStream({transform(e,t){switch(e.type){case"text-delta":t.enqueue(e.textDelta);break;case"object":case"finish":case"error":break;default:throw Error(`Unsupported chunk type: ${e}`)}}})))}get fullStream(){return tG(this.baseStream)}pipeTextStreamToResponse(e,t){ez({response:e,status:null==t?void 0:t.status,statusText:null==t?void 0:t.statusText,headers:eW(null==t?void 0:t.headers,{contentType:"text/plain; charset=utf-8"}),stream:this.textStream.pipeThrough(new TextEncoderStream)})}toTextStreamResponse(e){var t;return new Response(this.textStream.pipeThrough(new TextEncoderStream),{status:null!=(t=null==e?void 0:e.status)?t:200,headers:eV(null==e?void 0:e.headers,{contentType:"text/plain; charset=utf-8"})})}},rt="AI_NoOutputSpecifiedError",rr=`vercel.ai.error.${rt}`,rs=Symbol.for(rr),rn=class extends J.AX{constructor({message:e="No output specified."}={}){super({name:rt,message:e}),this[g]=!0}static isInstance(e){return J.AX.hasMarker(e,rr)}};g=rs;var ro="AI_ToolExecutionError",ri=`vercel.ai.error.${ro}`,ra=Symbol.for(ri),rl=class extends J.AX{constructor({toolArgs:e,toolName:t,toolCallId:r,cause:s,message:o=`Error executing tool ${t}: ${(0,J.e$)(s)}`}){super({name:ro,message:o,cause:s}),this[y]=!0,this.toolArgs=e,this.toolName=t,this.toolCallId=r}static isInstance(e){return J.AX.hasMarker(e,ri)}};function ru({tools:e,toolChoice:t,activeTools:r}){return null!=e&&Object.keys(e).length>0?{tools:(null!=r?Object.entries(e).filter(([e])=>r.includes(e)):Object.entries(e)).map(([e,t])=>{let r=t.type;switch(r){case void 0:case"function":return{type:"function",name:e,description:t.description,parameters:eU(t.parameters).jsonSchema};case"provider-defined":return{type:"provider-defined",name:e,id:t.id,args:t.args};default:throw Error(`Unsupported tool type: ${r}`)}}),toolChoice:null==t?{type:"auto"}:"string"==typeof t?{type:t}:{type:"tool",toolName:t.toolName}}:{tools:void 0,toolChoice:void 0}}y=ra;var rc=/^([\s\S]*?)(\s+)(\S*)$/;function rd(e){let t=e.match(rc);return t?{prefix:t[1],whitespace:t[2],suffix:t[3]}:void 0}var rp="AI_InvalidToolArgumentsError",rh=`vercel.ai.error.${rp}`,rf=Symbol.for(rh),rm=class extends J.AX{constructor({toolArgs:e,toolName:t,cause:r,message:s=`Invalid arguments for tool ${t}: ${(0,J.e$)(r)}`}){super({name:rp,message:s,cause:r}),this[b]=!0,this.toolArgs=e,this.toolName=t}static isInstance(e){return J.AX.hasMarker(e,rh)}};b=rf;var rg="AI_NoSuchToolError",ry=`vercel.ai.error.${rg}`,rb=Symbol.for(ry),r_=class extends J.AX{constructor({toolName:e,availableTools:t,message:r=`Model tried to call unavailable tool '${e}'. ${void 0===t?"No tools are available.":`Available tools: ${t.join(", ")}.`}`}){super({name:rg,message:r}),this[_]=!0,this.toolName=e,this.availableTools=t}static isInstance(e){return J.AX.hasMarker(e,ry)}};_=rb;var rv="AI_ToolCallRepairError",rw=`vercel.ai.error.${rv}`,rx=Symbol.for(rw),rS=class extends J.AX{constructor({cause:e,originalError:t,message:r=`Error repairing tool call: ${(0,J.e$)(e)}`}){super({name:rv,message:r,cause:e}),this[v]=!0,this.originalError=t}static isInstance(e){return J.AX.hasMarker(e,rw)}};async function rE({toolCall:e,tools:t,repairToolCall:r,system:s,messages:o}){if(null==t)throw new r_({toolName:e.toolName});try{return await rk({toolCall:e,tools:t})}catch(a){if(null==r||!(r_.isInstance(a)||rm.isInstance(a)))throw a;let i=null;try{i=await r({toolCall:e,tools:t,parameterSchema:({toolName:e})=>eU(t[e].parameters).jsonSchema,system:s,messages:o,error:a})}catch(e){throw new rS({cause:e,originalError:a})}if(null==i)throw a;return await rk({toolCall:i,tools:t})}}async function rk({toolCall:e,tools:t}){let r=e.toolName,s=t[r];if(null==s)throw new r_({toolName:e.toolName,availableTools:Object.keys(t)});let o=eU(s.parameters),i=""===e.args.trim()?(0,H.pW)({value:{},schema:o}):(0,H.NX)({text:e.args,schema:o});if(!1===i.success)throw new rm({toolName:r,toolArgs:e.args,cause:i.error});return{type:"tool-call",toolCallId:e.toolCallId,toolName:r,args:i.value}}function rI({text:e="",reasoning:t,tools:r,toolCalls:s,toolResults:o,messageId:i,generateMessageId:a}){let l=[];return l.push({role:"assistant",content:[...t.map(e=>"text"===e.type?{...e,type:"reasoning"}:{...e,type:"redacted-reasoning"}),{type:"text",text:e},...s],id:i}),o.length>0&&l.push({role:"tool",id:a(),content:o.map(e=>{let t=r[e.toolName];return(null==t?void 0:t.experimental_toToolResultContent)!=null?{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,result:t.experimental_toToolResultContent(e.result),experimental_content:t.experimental_toToolResultContent(e.result)}:{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,result:e.result}})}),l}function rO(e){let t=e.filter(e=>"text"===e.type).map(e=>e.text).join("");return t.length>0?t:void 0}v=rx;var rT=(0,H.bF)({prefix:"aitxt",size:24}),rj=(0,H.bF)({prefix:"msg",size:24});async function rC({model:e,tools:t,toolChoice:r,system:s,prompt:o,messages:i,maxRetries:a,abortSignal:l,headers:u,maxSteps:c=1,experimental_generateMessageId:d=rj,experimental_output:p,experimental_continueSteps:h=!1,experimental_telemetry:f,experimental_providerMetadata:m,providerOptions:g=m,experimental_activeTools:y,experimental_repairToolCall:b,_internal:{generateId:_=rT,currentDate:v=()=>new Date}={},onStepFinish:w,...S}){var E;if(c<1)throw new eG({parameter:"maxSteps",value:c,message:"maxSteps must be at least 1"});let{maxRetries:k,retry:I}=e2({maxRetries:a}),O=e4({model:e,telemetry:f,headers:u,settings:{...S,maxRetries:k}}),T=tz({prompt:{system:null!=(E=null==p?void 0:p.injectIntoSystemPrompt({system:s,model:e}))?E:s,prompt:o,messages:i},tools:t}),j=e5(f);return e7({name:"ai.generateText",attributes:te({telemetry:f,attributes:{...e3({operationId:"ai.generateText",telemetry:f}),...O,"ai.prompt":{input:()=>JSON.stringify({system:s,prompt:o,messages:i})},"ai.settings.maxSteps":c}}),tracer:j,fn:async o=>{var i,a,m,E,k,C,R,A,P,N;let q;let M={type:"regular",...ru({tools:t,toolChoice:r,activeTools:y})},L=tE(S),$=[],D=[],U=[],B=0,F=[],V="",W=[],z=[],Z={completionTokens:0,promptTokens:0,totalTokens:0},J="initial";do{let r=0===B?T.type:"messages",o=[...T.messages,...F],y=await tx({prompt:{type:r,system:T.system,messages:o},modelSupportsImageUrls:e.supportsImageUrls,modelSupportsUrl:null==(i=e.supportsUrl)?void 0:i.bind(e)});q=await I(()=>e7({name:"ai.generateText.doGenerate",attributes:te({telemetry:f,attributes:{...e3({operationId:"ai.generateText.doGenerate",telemetry:f}),...O,"ai.prompt.format":{input:()=>r},"ai.prompt.messages":{input:()=>JSON.stringify(y)},"ai.prompt.tools":{input:()=>{var e;return null==(e=M.tools)?void 0:e.map(e=>JSON.stringify(e))}},"ai.prompt.toolChoice":{input:()=>null!=M.toolChoice?JSON.stringify(M.toolChoice):void 0},"gen_ai.system":e.provider,"gen_ai.request.model":e.modelId,"gen_ai.request.frequency_penalty":S.frequencyPenalty,"gen_ai.request.max_tokens":S.maxTokens,"gen_ai.request.presence_penalty":S.presencePenalty,"gen_ai.request.stop_sequences":S.stopSequences,"gen_ai.request.temperature":S.temperature,"gen_ai.request.top_k":S.topK,"gen_ai.request.top_p":S.topP}}),tracer:j,fn:async t=>{var s,o,i,a,c,d;let h=await e.doGenerate({mode:M,...L,inputFormat:r,responseFormat:null==p?void 0:p.responseFormat({model:e}),prompt:y,providerMetadata:g,abortSignal:l,headers:u}),m={id:null!=(o=null==(s=h.response)?void 0:s.id)?o:_(),timestamp:null!=(a=null==(i=h.response)?void 0:i.timestamp)?a:v(),modelId:null!=(d=null==(c=h.response)?void 0:c.modelId)?d:e.modelId};return t.setAttributes(te({telemetry:f,attributes:{"ai.response.finishReason":h.finishReason,"ai.response.text":{output:()=>h.text},"ai.response.toolCalls":{output:()=>JSON.stringify(h.toolCalls)},"ai.response.id":m.id,"ai.response.model":m.modelId,"ai.response.timestamp":m.timestamp.toISOString(),"ai.usage.promptTokens":h.usage.promptTokens,"ai.usage.completionTokens":h.usage.completionTokens,"gen_ai.response.finish_reasons":[h.finishReason],"gen_ai.response.id":m.id,"gen_ai.response.model":m.modelId,"gen_ai.usage.input_tokens":h.usage.promptTokens,"gen_ai.usage.output_tokens":h.usage.completionTokens}})),{...h,response:m}}})),$=await Promise.all((null!=(a=q.toolCalls)?a:[]).map(e=>rE({toolCall:e,tools:t,repairToolCall:b,system:s,messages:o}))),D=null==t?[]:await rR({toolCalls:$,tools:t,tracer:j,telemetry:f,messages:o,abortSignal:l});let A=tZ(q.usage);Z=tJ(Z,A);let P="done";++B<c&&(h&&"length"===q.finishReason&&0===$.length?P="continue":$.length>0&&D.length===$.length&&(P="tool-result"));let N=null!=(m=q.text)?m:"",H="continue"===J&&V.trimEnd()!==V?N.trimStart():N,G="continue"===P?function(e){let t=rd(e);return t?t.prefix+t.whitespace:e}(H):H;if(V="continue"===P||"continue"===J?V+G:G,U=rP(q.reasoning),W.push(...null!=(E=q.sources)?E:[]),"continue"===J){let e=F[F.length-1];"string"==typeof e.content?e.content+=G:e.content.push({text:G,type:"text"})}else F.push(...rI({text:V,reasoning:rP(q.reasoning),tools:null!=t?t:{},toolCalls:$,toolResults:D,messageId:d(),generateMessageId:d}));let Y={stepType:J,text:G,reasoning:rO(U),reasoningDetails:U,sources:null!=(k=q.sources)?k:[],toolCalls:$,toolResults:D,finishReason:q.finishReason,usage:A,warnings:q.warnings,logprobs:q.logprobs,request:null!=(C=q.request)?C:{},response:{...q.response,headers:null==(R=q.rawResponse)?void 0:R.headers,messages:structuredClone(F)},providerMetadata:q.providerMetadata,experimental_providerMetadata:q.providerMetadata,isContinued:"continue"===P};z.push(Y),await (null==w?void 0:w(Y)),J=P}while("done"!==J);return o.setAttributes(te({telemetry:f,attributes:{"ai.response.finishReason":q.finishReason,"ai.response.text":{output:()=>q.text},"ai.response.toolCalls":{output:()=>JSON.stringify(q.toolCalls)},"ai.usage.promptTokens":q.usage.promptTokens,"ai.usage.completionTokens":q.usage.completionTokens}})),new rA({text:V,reasoning:rO(U),reasoningDetails:U,sources:W,outputResolver:()=>{if(null==p)throw new rn;return p.parseOutput({text:V},{response:q.response,usage:Z})},toolCalls:$,toolResults:D,finishReason:q.finishReason,usage:Z,warnings:q.warnings,request:null!=(A=q.request)?A:{},response:{...q.response,headers:null==(P=q.rawResponse)?void 0:P.headers,body:null==(N=q.rawResponse)?void 0:N.body,messages:F},logprobs:q.logprobs,steps:z,providerMetadata:q.providerMetadata})}})}async function rR({toolCalls:e,tools:t,tracer:r,telemetry:s,messages:o,abortSignal:i}){return(await Promise.all(e.map(async({toolCallId:e,toolName:a,args:l})=>{let u=t[a];if((null==u?void 0:u.execute)==null)return;let c=await e7({name:"ai.toolCall",attributes:te({telemetry:s,attributes:{...e3({operationId:"ai.toolCall",telemetry:s}),"ai.toolCall.name":a,"ai.toolCall.id":e,"ai.toolCall.args":{output:()=>JSON.stringify(l)}}}),tracer:r,fn:async t=>{try{let r=await u.execute(l,{toolCallId:e,messages:o,abortSignal:i});try{t.setAttributes(te({telemetry:s,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(r)}}}))}catch(e){}return r}catch(t){throw new rl({toolCallId:e,toolName:a,toolArgs:l,cause:t})}}});return{type:"tool-result",toolCallId:e,toolName:a,args:l,result:c}}))).filter(e=>null!=e)}var rA=class{constructor(e){this.text=e.text,this.reasoning=e.reasoning,this.reasoningDetails=e.reasoningDetails,this.toolCalls=e.toolCalls,this.toolResults=e.toolResults,this.finishReason=e.finishReason,this.usage=e.usage,this.warnings=e.warnings,this.request=e.request,this.response=e.response,this.steps=e.steps,this.experimental_providerMetadata=e.providerMetadata,this.providerMetadata=e.providerMetadata,this.logprobs=e.logprobs,this.outputResolver=e.outputResolver,this.sources=e.sources}get experimental_output(){return this.outputResolver()}};function rP(e){return null==e?[]:"string"==typeof e?[{type:"text",text:e}]:e}var rN={};eF(rN,{object:()=>rU,text:()=>rD});var rq="AI_InvalidStreamPartError",rM=`vercel.ai.error.${rq}`,rL=Symbol.for(rM),r$=class extends J.AX{constructor({chunk:e,message:t}){super({name:rq,message:t}),this[w]=!0,this.chunk=e}static isInstance(e){return J.AX.hasMarker(e,rM)}};w=rL;var rD=()=>({type:"text",responseFormat:()=>({type:"text"}),injectIntoSystemPrompt:({system:e})=>e,parsePartial:({text:e})=>({partial:e}),parseOutput:({text:e})=>e}),rU=({schema:e})=>{let t=eU(e);return{type:"object",responseFormat:({model:e})=>({type:"json",schema:e.supportsStructuredOutputs?t.jsonSchema:void 0}),injectIntoSystemPrompt:({system:e,model:r})=>r.supportsStructuredOutputs?e:tH({prompt:e,schema:t.jsonSchema}),parsePartial({text:e}){let t=eR(e);switch(t.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:t.value};default:{let e=t.state;throw Error(`Unsupported parse state: ${e}`)}}},parseOutput({text:e},r){let s=(0,H.NX)({text:e});if(!s.success)throw new to({message:"No object generated: could not parse the response.",cause:s.error,text:e,response:r.response,usage:r.usage});let o=(0,H.pW)({value:s.value,schema:t});if(!o.success)throw new to({message:"No object generated: response did not match schema.",cause:o.error,text:e,response:r.response,usage:r.usage});return o.value}}};function rB(e,t){let r,s;let o=e.getReader(),i=t.getReader(),a=!1,l=!1;async function u(e){try{null==r&&(r=o.read());let t=await r;r=void 0,t.done?e.close():e.enqueue(t.value)}catch(t){e.error(t)}}async function c(e){try{null==s&&(s=i.read());let t=await s;s=void 0,t.done?e.close():e.enqueue(t.value)}catch(t){e.error(t)}}return new ReadableStream({async pull(e){try{if(a){await c(e);return}if(l){await u(e);return}null==r&&(r=o.read()),null==s&&(s=i.read());let{result:t,reader:d}=await Promise.race([r.then(e=>({result:e,reader:o})),s.then(e=>({result:e,reader:i}))]);t.done||e.enqueue(t.value),d===o?(r=void 0,t.done&&(await c(e),a=!0)):(s=void 0,t.done&&(l=!0,await u(e)))}catch(t){e.error(t)}},cancel(){o.cancel(),i.cancel()}})}var rF=(0,H.bF)({prefix:"aitxt",size:24}),rV=(0,H.bF)({prefix:"msg",size:24}),rW=class{constructor({model:e,telemetry:t,headers:r,settings:s,maxRetries:o,abortSignal:i,system:a,prompt:l,messages:u,tools:c,toolChoice:d,toolCallStreaming:p,transforms:h,activeTools:f,repairToolCall:m,maxSteps:g,output:y,continueSteps:b,providerOptions:_,now:v,currentDate:w,generateId:S,generateMessageId:E,onChunk:k,onError:I,onFinish:O,onStepFinish:T}){var j;let C,R,A,P;if(this.warningsPromise=new t8,this.usagePromise=new t8,this.finishReasonPromise=new t8,this.providerMetadataPromise=new t8,this.textPromise=new t8,this.reasoningPromise=new t8,this.reasoningDetailsPromise=new t8,this.sourcesPromise=new t8,this.toolCallsPromise=new t8,this.toolResultsPromise=new t8,this.requestPromise=new t8,this.responsePromise=new t8,this.stepsPromise=new t8,g<1)throw new eG({parameter:"maxSteps",value:g,message:"maxSteps must be at least 1"});this.output=y;let N="",q="",M="",L=[],$=[],D=[],U={id:S(),timestamp:w(),modelId:e.modelId,messages:[]},B=[],F=[],V="initial",W=[],z=new TransformStream({async transform(e,t){t.enqueue(e);let{part:r}=e;if(("text-delta"===r.type||"reasoning"===r.type||"source"===r.type||"tool-call"===r.type||"tool-result"===r.type||"tool-call-streaming-start"===r.type||"tool-call-delta"===r.type)&&await (null==k?void 0:k({chunk:r})),"error"===r.type&&await (null==I?void 0:I({error:r.error})),"text-delta"===r.type&&(N+=r.textDelta,q+=r.textDelta,M+=r.textDelta),"reasoning"===r.type&&(null==R?(R={type:"text",text:r.textDelta},L.push(R)):R.text+=r.textDelta),"reasoning-signature"===r.type){if(null==R)throw new J.AX({name:"InvalidStreamPart",message:"reasoning-signature without reasoning"});R.signature=r.signature,R=void 0}if("redacted-reasoning"===r.type&&L.push({type:"redacted",data:r.data}),"source"===r.type&&(D.push(r.source),$.push(r.source)),"tool-call"===r.type&&B.push(r),"tool-result"===r.type&&F.push(r),"step-finish"===r.type){let e=rI({text:q,reasoning:L,tools:null!=c?c:{},toolCalls:B,toolResults:F,messageId:r.messageId,generateMessageId:E}),t=W.length,s="done";t+1<g&&(b&&"length"===r.finishReason&&0===B.length?s="continue":B.length>0&&F.length===B.length&&(s="tool-result"));let o={stepType:V,text:N,reasoning:rO(L),reasoningDetails:L,sources:$,toolCalls:B,toolResults:F,finishReason:r.finishReason,usage:r.usage,warnings:r.warnings,logprobs:r.logprobs,request:r.request,response:{...r.response,messages:[...U.messages,...e]},providerMetadata:r.experimental_providerMetadata,experimental_providerMetadata:r.experimental_providerMetadata,isContinued:r.isContinued};await (null==T?void 0:T(o)),W.push(o),B=[],F=[],N="",$=[],L=[],R=void 0,"done"!==s&&(V=s),"continue"!==s&&(U.messages.push(...e),q="")}"finish"===r.type&&(U.id=r.response.id,U.timestamp=r.response.timestamp,U.modelId=r.response.modelId,U.headers=r.response.headers,P=r.usage,A=r.finishReason)},async flush(e){var r;try{if(0===W.length)return;let e=W[W.length-1];et.warningsPromise.resolve(e.warnings),et.requestPromise.resolve(e.request),et.responsePromise.resolve(e.response),et.toolCallsPromise.resolve(e.toolCalls),et.toolResultsPromise.resolve(e.toolResults),et.providerMetadataPromise.resolve(e.experimental_providerMetadata),et.reasoningPromise.resolve(e.reasoning),et.reasoningDetailsPromise.resolve(e.reasoningDetails);let s=null!=A?A:"unknown",o=null!=P?P:{completionTokens:NaN,promptTokens:NaN,totalTokens:NaN};et.finishReasonPromise.resolve(s),et.usagePromise.resolve(o),et.textPromise.resolve(M),et.sourcesPromise.resolve(D),et.stepsPromise.resolve(W),await (null==O?void 0:O({finishReason:s,logprobs:void 0,usage:o,text:M,reasoning:e.reasoning,reasoningDetails:e.reasoningDetails,sources:e.sources,toolCalls:e.toolCalls,toolResults:e.toolResults,request:null!=(r=e.request)?r:{},response:e.response,warnings:e.warnings,providerMetadata:e.providerMetadata,experimental_providerMetadata:e.experimental_providerMetadata,steps:W})),C.setAttributes(te({telemetry:t,attributes:{"ai.response.finishReason":s,"ai.response.text":{output:()=>M},"ai.response.toolCalls":{output:()=>{var t;return(null==(t=e.toolCalls)?void 0:t.length)?JSON.stringify(e.toolCalls):void 0}},"ai.usage.promptTokens":o.promptTokens,"ai.usage.completionTokens":o.completionTokens}}))}catch(t){e.error(t)}finally{C.end()}}}),Z=t9();this.addStream=Z.addStream,this.closeStream=Z.close;let G=Z.stream;for(let e of h)G=G.pipeThrough(e({tools:c,stopStream(){Z.terminate()}}));this.baseStream=G.pipeThrough(function(e){if(!e)return new TransformStream({transform(e,t){t.enqueue({part:e,partialOutput:void 0})}});let t="",r="",s="";function o({controller:e,partialOutput:t}){e.enqueue({part:{type:"text-delta",textDelta:r},partialOutput:t}),r=""}return new TransformStream({transform(i,a){if("step-finish"===i.type&&o({controller:a}),"text-delta"!==i.type){a.enqueue({part:i,partialOutput:void 0});return}t+=i.textDelta,r+=i.textDelta;let l=e.parsePartial({text:t});if(null!=l){let e=JSON.stringify(l.partial);e!==s&&(o({controller:a,partialOutput:l.partial}),s=e)}},flush(e){r.length>0&&o({controller:e})}})}(y)).pipeThrough(z);let{maxRetries:Y,retry:K}=e2({maxRetries:o}),Q=e5(t),X=e4({model:e,telemetry:t,headers:r,settings:{...s,maxRetries:Y}}),ee=tz({prompt:{system:null!=(j=null==y?void 0:y.injectIntoSystemPrompt({system:a,model:e}))?j:a,prompt:l,messages:u},tools:c}),et=this;e7({name:"ai.streamText",attributes:te({telemetry:t,attributes:{...e3({operationId:"ai.streamText",telemetry:t}),...X,"ai.prompt":{input:()=>JSON.stringify({system:a,prompt:l,messages:u})},"ai.settings.maxSteps":g}}),tracer:Q,endWhenDone:!1,fn:async o=>{async function l({currentStep:o,responseMessages:u,usage:h,stepType:k,previousStepText:I,hasLeadingWhitespace:O,messageId:T}){var j;let C,R,A;let P=0===u.length?ee.type:"messages",N=[...ee.messages,...u],q=await tx({prompt:{type:P,system:ee.system,messages:N},modelSupportsImageUrls:e.supportsImageUrls,modelSupportsUrl:null==(j=e.supportsUrl)?void 0:j.bind(e)}),M={type:"regular",...ru({tools:c,toolChoice:d,activeTools:f})},{result:{stream:L,warnings:$,rawResponse:D,request:U},doStreamSpan:B,startTimestampMs:F}=await K(()=>e7({name:"ai.streamText.doStream",attributes:te({telemetry:t,attributes:{...e3({operationId:"ai.streamText.doStream",telemetry:t}),...X,"ai.prompt.format":{input:()=>P},"ai.prompt.messages":{input:()=>JSON.stringify(q)},"ai.prompt.tools":{input:()=>{var e;return null==(e=M.tools)?void 0:e.map(e=>JSON.stringify(e))}},"ai.prompt.toolChoice":{input:()=>null!=M.toolChoice?JSON.stringify(M.toolChoice):void 0},"gen_ai.system":e.provider,"gen_ai.request.model":e.modelId,"gen_ai.request.frequency_penalty":s.frequencyPenalty,"gen_ai.request.max_tokens":s.maxTokens,"gen_ai.request.presence_penalty":s.presencePenalty,"gen_ai.request.stop_sequences":s.stopSequences,"gen_ai.request.temperature":s.temperature,"gen_ai.request.top_k":s.topK,"gen_ai.request.top_p":s.topP}}),tracer:Q,endWhenDone:!1,fn:async t=>({startTimestampMs:v(),doStreamSpan:t,result:await e.doStream({mode:M,...tE(s),inputFormat:P,responseFormat:null==y?void 0:y.responseFormat({model:e}),prompt:q,providerMetadata:_,abortSignal:i,headers:r})})})),V=function({tools:e,generatorStream:t,toolCallStreaming:r,tracer:s,telemetry:o,system:i,messages:a,abortSignal:l,repairToolCall:u}){let c,d=null,p=new ReadableStream({start(e){d=e}}),h={},f=new Set,m=!1;function g(){m&&0===f.size&&(null!=c&&d.enqueue(c),d.close())}let y=new TransformStream({async transform(t,p){let m=t.type;switch(m){case"text-delta":case"reasoning":case"reasoning-signature":case"redacted-reasoning":case"source":case"response-metadata":case"error":p.enqueue(t);break;case"tool-call-delta":r&&(h[t.toolCallId]||(p.enqueue({type:"tool-call-streaming-start",toolCallId:t.toolCallId,toolName:t.toolName}),h[t.toolCallId]=!0),p.enqueue({type:"tool-call-delta",toolCallId:t.toolCallId,toolName:t.toolName,argsTextDelta:t.argsTextDelta}));break;case"tool-call":try{let r=await rE({toolCall:t,tools:e,repairToolCall:u,system:i,messages:a});p.enqueue(r);let c=e[r.toolName];if(null!=c.execute){let e=(0,H.Ox)();f.add(e),e7({name:"ai.toolCall",attributes:te({telemetry:o,attributes:{...e3({operationId:"ai.toolCall",telemetry:o}),"ai.toolCall.name":r.toolName,"ai.toolCall.id":r.toolCallId,"ai.toolCall.args":{output:()=>JSON.stringify(r.args)}}}),tracer:s,fn:async t=>c.execute(r.args,{toolCallId:r.toolCallId,messages:a,abortSignal:l}).then(s=>{d.enqueue({...r,type:"tool-result",result:s}),f.delete(e),g();try{t.setAttributes(te({telemetry:o,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(s)}}}))}catch(e){}},t=>{d.enqueue({type:"error",error:new rl({toolCallId:r.toolCallId,toolName:r.toolName,toolArgs:r.args,cause:t})}),f.delete(e),g()})})}}catch(e){d.enqueue({type:"error",error:e})}break;case"finish":c={type:"finish",finishReason:t.finishReason,logprobs:t.logprobs,usage:tZ(t.usage),experimental_providerMetadata:t.providerMetadata};break;default:throw Error(`Unhandled chunk type: ${m}`)}},flush(){m=!0,g()}});return new ReadableStream({start:async e=>Promise.all([t.pipeThrough(y).pipeTo(new WritableStream({write(t){e.enqueue(t)},close(){}})),p.pipeTo(new WritableStream({write(t){e.enqueue(t)},close(){e.close()}}))])})}({tools:c,generatorStream:L,toolCallStreaming:p,tracer:Q,telemetry:t,system:a,messages:N,repairToolCall:m,abortSignal:i}),W=null!=U?U:{},z=[],Z=[],J=[],G="unknown",Y={promptTokens:0,completionTokens:0,totalTokens:0},er=!0,es="",en="continue"===k?I:"",eo={id:S(),timestamp:w(),modelId:e.modelId},ei="",ea=!1,el=!0,eu=!1;async function ec({controller:e,chunk:t}){e.enqueue(t),es+=t.textDelta,en+=t.textDelta,ea=!0,eu=t.textDelta.trimEnd()!==t.textDelta}et.addStream(V.pipeThrough(new TransformStream({async transform(e,t){var r,s,o;if(er){let e=v()-F;er=!1,B.addEvent("ai.stream.firstChunk",{"ai.response.msToFirstChunk":e}),B.setAttributes({"ai.response.msToFirstChunk":e}),t.enqueue({type:"step-start",messageId:T,request:W,warnings:null!=$?$:[]})}if("text-delta"===e.type&&0===e.textDelta.length)return;let i=e.type;switch(i){case"text-delta":if(b){let r=el&&O?e.textDelta.trimStart():e.textDelta;if(0===r.length)break;el=!1;let s=rd(ei+=r);null!=s&&(ei=s.suffix,await ec({controller:t,chunk:{type:"text-delta",textDelta:s.prefix+s.whitespace}}))}else await ec({controller:t,chunk:e});break;case"reasoning":t.enqueue(e),null==A?(A={type:"text",text:e.textDelta},J.push(A)):A.text+=e.textDelta;break;case"reasoning-signature":if(t.enqueue(e),null==A)throw new r$({chunk:e,message:"reasoning-signature without reasoning"});A.signature=e.signature,A=void 0;break;case"redacted-reasoning":t.enqueue(e),J.push({type:"redacted",data:e.data});break;case"tool-call":t.enqueue(e),z.push(e);break;case"tool-result":t.enqueue(e),Z.push(e);break;case"response-metadata":eo={id:null!=(r=e.id)?r:eo.id,timestamp:null!=(s=e.timestamp)?s:eo.timestamp,modelId:null!=(o=e.modelId)?o:eo.modelId};break;case"finish":{Y=e.usage,G=e.finishReason,C=e.experimental_providerMetadata,R=e.logprobs;let t=v()-F;B.addEvent("ai.stream.finish"),B.setAttributes({"ai.response.msToFinish":t,"ai.response.avgCompletionTokensPerSecond":1e3*Y.completionTokens/t});break}case"source":case"tool-call-streaming-start":case"tool-call-delta":t.enqueue(e);break;case"error":t.enqueue(e),G="error";break;default:throw Error(`Unknown chunk type: ${i}`)}},async flush(e){let r=z.length>0?JSON.stringify(z):void 0,s="done";o+1<g&&(b&&"length"===G&&0===z.length?s="continue":z.length>0&&Z.length===z.length&&(s="tool-result")),b&&ei.length>0&&("continue"!==s||"continue"===k&&!ea)&&(await ec({controller:e,chunk:{type:"text-delta",textDelta:ei}}),ei="");try{B.setAttributes(te({telemetry:t,attributes:{"ai.response.finishReason":G,"ai.response.text":{output:()=>es},"ai.response.toolCalls":{output:()=>r},"ai.response.id":eo.id,"ai.response.model":eo.modelId,"ai.response.timestamp":eo.timestamp.toISOString(),"ai.usage.promptTokens":Y.promptTokens,"ai.usage.completionTokens":Y.completionTokens,"gen_ai.response.finish_reasons":[G],"gen_ai.response.id":eo.id,"gen_ai.response.model":eo.modelId,"gen_ai.usage.input_tokens":Y.promptTokens,"gen_ai.usage.output_tokens":Y.completionTokens}}))}catch(e){}finally{B.end()}e.enqueue({type:"step-finish",finishReason:G,usage:Y,providerMetadata:C,experimental_providerMetadata:C,logprobs:R,request:W,response:{...eo,headers:null==D?void 0:D.headers},warnings:$,isContinued:"continue"===s,messageId:T});let i=tJ(h,Y);if("done"===s)e.enqueue({type:"finish",finishReason:G,usage:i,providerMetadata:C,experimental_providerMetadata:C,logprobs:R,response:{...eo,headers:null==D?void 0:D.headers}}),et.closeStream();else{if("continue"===k){let e=u[u.length-1];"string"==typeof e.content?e.content+=es:e.content.push({text:es,type:"text"})}else u.push(...rI({text:es,reasoning:J,tools:null!=c?c:{},toolCalls:z,toolResults:Z,messageId:T,generateMessageId:E}));await l({currentStep:o+1,responseMessages:u,usage:i,stepType:s,previousStepText:en,hasLeadingWhitespace:eu,messageId:"continue"===s?T:E()})}}})))}C=o,await l({currentStep:0,responseMessages:[],usage:{promptTokens:0,completionTokens:0,totalTokens:0},previousStepText:"",stepType:"initial",hasLeadingWhitespace:!1,messageId:E()})}}).catch(e=>{et.addStream(new ReadableStream({start(t){t.enqueue({type:"error",error:e}),t.close()}})),et.closeStream()})}get warnings(){return this.warningsPromise.value}get usage(){return this.usagePromise.value}get finishReason(){return this.finishReasonPromise.value}get experimental_providerMetadata(){return this.providerMetadataPromise.value}get providerMetadata(){return this.providerMetadataPromise.value}get text(){return this.textPromise.value}get reasoning(){return this.reasoningPromise.value}get reasoningDetails(){return this.reasoningDetailsPromise.value}get sources(){return this.sourcesPromise.value}get toolCalls(){return this.toolCallsPromise.value}get toolResults(){return this.toolResultsPromise.value}get request(){return this.requestPromise.value}get response(){return this.responsePromise.value}get steps(){return this.stepsPromise.value}teeStream(){let[e,t]=this.baseStream.tee();return this.baseStream=t,e}get textStream(){return tG(this.teeStream().pipeThrough(new TransformStream({transform({part:e},t){"text-delta"===e.type&&t.enqueue(e.textDelta)}})))}get fullStream(){return tG(this.teeStream().pipeThrough(new TransformStream({transform({part:e},t){t.enqueue(e)}})))}async consumeStream(){for await(let e of this.fullStream);}get experimental_partialOutputStream(){if(null==this.output)throw new rn;return tG(this.teeStream().pipeThrough(new TransformStream({transform({partialOutput:e},t){null!=e&&t.enqueue(e)}})))}toDataStreamInternal({getErrorMessage:e=()=>"An error occurred.",sendUsage:t=!0,sendReasoning:r=!1,sendSources:s=!1,experimental_sendFinish:o=!0}){return this.fullStream.pipeThrough(new TransformStream({transform:async(i,a)=>{let l=i.type;switch(l){case"text-delta":a.enqueue(eM("text",i.textDelta));break;case"reasoning":r&&a.enqueue(eM("reasoning",i.textDelta));break;case"redacted-reasoning":r&&a.enqueue(eM("redacted_reasoning",{data:i.data}));break;case"reasoning-signature":r&&a.enqueue(eM("reasoning_signature",{signature:i.signature}));break;case"source":s&&a.enqueue(eM("source",i.source));break;case"tool-call-streaming-start":a.enqueue(eM("tool_call_streaming_start",{toolCallId:i.toolCallId,toolName:i.toolName}));break;case"tool-call-delta":a.enqueue(eM("tool_call_delta",{toolCallId:i.toolCallId,argsTextDelta:i.argsTextDelta}));break;case"tool-call":a.enqueue(eM("tool_call",{toolCallId:i.toolCallId,toolName:i.toolName,args:i.args}));break;case"tool-result":a.enqueue(eM("tool_result",{toolCallId:i.toolCallId,result:i.result}));break;case"error":a.enqueue(eM("error",e(i.error)));break;case"step-start":a.enqueue(eM("start_step",{messageId:i.messageId}));break;case"step-finish":a.enqueue(eM("finish_step",{finishReason:i.finishReason,usage:t?{promptTokens:i.usage.promptTokens,completionTokens:i.usage.completionTokens}:void 0,isContinued:i.isContinued}));break;case"finish":o&&a.enqueue(eM("finish_message",{finishReason:i.finishReason,usage:t?{promptTokens:i.usage.promptTokens,completionTokens:i.usage.completionTokens}:void 0}));break;default:throw Error(`Unknown chunk type: ${l}`)}}}))}pipeDataStreamToResponse(e,{status:t,statusText:r,headers:s,data:o,getErrorMessage:i,sendUsage:a,sendReasoning:l,sendSources:u,experimental_sendFinish:c}={}){ez({response:e,status:t,statusText:r,headers:eW(s,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"}),stream:this.toDataStream({data:o,getErrorMessage:i,sendUsage:a,sendReasoning:l,sendSources:u,experimental_sendFinish:c})})}pipeTextStreamToResponse(e,t){ez({response:e,status:null==t?void 0:t.status,statusText:null==t?void 0:t.statusText,headers:eW(null==t?void 0:t.headers,{contentType:"text/plain; charset=utf-8"}),stream:this.textStream.pipeThrough(new TextEncoderStream)})}toDataStream(e){let t=this.toDataStreamInternal({getErrorMessage:null==e?void 0:e.getErrorMessage,sendUsage:null==e?void 0:e.sendUsage,sendReasoning:null==e?void 0:e.sendReasoning,sendSources:null==e?void 0:e.sendSources,experimental_sendFinish:null==e?void 0:e.experimental_sendFinish}).pipeThrough(new TextEncoderStream);return(null==e?void 0:e.data)?rB(null==e?void 0:e.data.stream,t):t}mergeIntoDataStream(e,t){e.merge(this.toDataStreamInternal({getErrorMessage:e.onError,sendUsage:null==t?void 0:t.sendUsage,sendReasoning:null==t?void 0:t.sendReasoning,sendSources:null==t?void 0:t.sendSources,experimental_sendFinish:null==t?void 0:t.experimental_sendFinish}))}toDataStreamResponse({headers:e,status:t,statusText:r,data:s,getErrorMessage:o,sendUsage:i,sendReasoning:a,sendSources:l,experimental_sendFinish:u}={}){return new Response(this.toDataStream({data:s,getErrorMessage:o,sendUsage:i,sendReasoning:a,sendSources:l,experimental_sendFinish:u}),{status:t,statusText:r,headers:eV(e,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}toTextStreamResponse(e){var t;return new Response(this.textStream.pipeThrough(new TextEncoderStream),{status:null!=(t=null==e?void 0:e.status)?t:200,headers:eV(null==e?void 0:e.headers,{contentType:"text/plain; charset=utf-8"})})}},rz="AI_NoSuchProviderError",rZ=`vercel.ai.error.${rz}`,rJ=Symbol.for(rZ);function rH(e={}){let t=new TextEncoder,r="";return new TransformStream({async start(){e.onStart&&await e.onStart()},async transform(s,o){o.enqueue(t.encode(s)),r+=s,e.onToken&&await e.onToken(s),e.onText&&"string"==typeof s&&await e.onText(s)},async flush(){e.onCompletion&&await e.onCompletion(r),e.onFinal&&await e.onFinal(r)}})}function rG(e,t){return e.pipeThrough(new TransformStream({transform:async(e,t)=>{var r;if("string"==typeof e){t.enqueue(e);return}if("event"in e){"on_chat_model_stream"===e.event&&rX(null==(r=e.data)?void 0:r.chunk,t);return}rX(e,t)}})).pipeThrough(rH(t)).pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform:async(e,t)=>{t.enqueue(eM("text",e))}}))}function rY(e,t){return rG(e,t).pipeThrough(new TextEncoderStream)}function rK(e,t){var r;let s=rG(e,null==t?void 0:t.callbacks).pipeThrough(new TextEncoderStream),o=null==t?void 0:t.data,i=null==t?void 0:t.init;return new Response(o?rB(o.stream,s):s,{status:null!=(r=null==i?void 0:i.status)?r:200,statusText:null==i?void 0:i.statusText,headers:eV(null==i?void 0:i.headers,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function rQ(e,t){t.dataStream.merge(rG(e,t.callbacks))}function rX(e,t){if("string"==typeof e.content)t.enqueue(e.content);else for(let r of e.content)"text"===r.type&&t.enqueue(r.text)}function r0(e,t){let r;let s=(r=!0,e=>(r&&(e=e.trimStart())&&(r=!1),e));return(0,H.RV)(e[Symbol.asyncIterator]()).pipeThrough(new TransformStream({async transform(e,t){t.enqueue(s(e.delta))}})).pipeThrough(rH(t)).pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform:async(e,t)=>{t.enqueue(eM("text",e))}}))}function r1(e,t){return r0(e,t).pipeThrough(new TextEncoderStream)}function r2(e,t={}){var r;let{init:s,data:o,callbacks:i}=t,a=r0(e,i).pipeThrough(new TextEncoderStream);return new Response(o?rB(o.stream,a):a,{status:null!=(r=null==s?void 0:s.status)?r:200,statusText:null==s?void 0:s.statusText,headers:eV(null==s?void 0:s.headers,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function r3(e,t){t.dataStream.merge(r0(e,t.callbacks))}J.JJ,S=rJ,eF({},{mergeIntoDataStream:()=>rQ,toDataStream:()=>rY,toDataStreamResponse:()=>rK}),eF({},{mergeIntoDataStream:()=>r3,toDataStream:()=>r1,toDataStreamResponse:()=>r2});var r4=r(99817),r8=!1;async function r6(e,t){try{let s;let o=[];try{s=await function(e){let t=`${e}?d=${Date.now()}`;return r(24449)(t.split("?")[0])}("fastembed")}catch(e){if(e instanceof Error)o.push(e);else throw e}if(!s)throw Error(`${o.map(e=>e.message).join(`
`)}

This runtime does not support fastembed-js, which is the default embedder in Mastra. 
Scroll up to read import errors. These errors mean you can't use the default Mastra embedder on this hosting platform.
You can either use Mastra Cloud which supports the default embedder, or you can configure an alternate provider.

For example if you're using Memory:

import { openai } from "@ai-sdk/openai";

const memory = new Memory({
  embedder: openai.embedding("text-embedding-3-small"), // <- doesn't have to be openai
})

Visit https://sdk.vercel.ai/docs/foundations/overview#embedding-models to find an alternate embedding provider

If you do not want to use the Memory semantic recall feature, you can disable it entirely and this error will go away.

const memory = new Memory({
  options: {
    semanticRecall: false // <- an embedder will not be required with this set to false
  }
})
`);let{FlagEmbedding:i,EmbeddingModel:a}=s,l=await i.init({model:a[t],cacheDir:function(){if(r8)return r8;let e=r4().split("node_modules")[0];return r8=M.join(e,"node_modules",".fastembed-model-cache")}()}),u=await l.embed(e),c=[];for await(let e of u)c.push(...e.map(e=>Array.from(e)));if(0===c.length)throw Error("No embeddings generated");return{embeddings:c}}catch(e){throw console.error("Error generating embeddings:",e),e}}(function({languageModels:e,textEmbeddingModels:t,imageModels:r,fallbackProvider:s}){return{languageModel(t){if(null!=e&&t in e)return e[t];if(s)return s.languageModel(t);throw new J.JJ({modelId:t,modelType:"languageModel"})},textEmbeddingModel(e){if(null!=t&&e in t)return t[e];if(s)return s.textEmbeddingModel(e);throw new J.JJ({modelId:e,modelType:"textEmbeddingModel"})},imageModel(e){if(null!=r&&e in r)return r[e];if(null==s?void 0:s.imageModel)return s.imageModel(e);throw new J.JJ({modelId:e,modelType:"imageModel"})}}})({textEmbeddingModels:{"bge-small-en-v1.5":{specificationVersion:"v1",provider:"fastembed",modelId:"bge-small-en-v1.5",maxEmbeddingsPerCall:256,supportsParallelCalls:!0,doEmbed:async({values:e})=>r6(e,"BGESmallENV15")},"bge-base-en-v1.5":{specificationVersion:"v1",provider:"fastembed",modelId:"bge-base-en-v1.5",maxEmbeddingsPerCall:256,supportsParallelCalls:!0,doEmbed:async({values:e})=>r6(e,"BGEBaseENV15")}}}).textEmbeddingModel;var r9=(T.o,r(25665)),r5=r(81046),r7=((o=r7||{}).ON_EVALUATION="onEvaluation",o.ON_GENERATION="onGeneration",o),se=function(e){return{all:e=e||new Map,on(t,r){let s=e.get(t);s?s.push(r):e.set(t,[r])},off(t,r){let s=e.get(t);s&&(r?s.splice(s.indexOf(r)>>>0,1):e.set(t,[]))},emit(t,r){let s=e.get(t);s&&s.slice().map(e=>{e(r)}),(s=e.get("*"))&&s.slice().map(e=>{e(t,r)})}}}(),st=r(84770),sr=class extends T.o{#eW;#tp;constructor({name:e,model:t}){super({component:r5.pU.LLM,name:e}),this.#tp=t}getProvider(){return this.#tp.provider}getModelId(){return this.#tp.modelId}getModel(){return this.#tp}convertToMessages(e){return Array.isArray(e)?e.map(e=>"string"==typeof e?{role:"user",content:e}:e):[{role:"user",content:e}]}__registerPrimitives(e){e.telemetry&&this.__setTelemetry(e.telemetry),e.logger&&this.__setLogger(e.logger),this.#eW=e}async __text(e){throw this.logger.debug(`[LLMs:${this.name}] Generating text.`,{input:e}),Error("Method not implemented.")}async __textObject(e){throw this.logger.debug(`[LLMs:${this.name}] Generating object.`,{input:e}),Error("Method not implemented.")}async generate(e,t={}){throw this.logger.debug(`[LLMs:${this.name}] Generating text.`,{messages:e,options:t}),Error("Method not implemented.")}async __stream(e){throw this.logger.debug(`[LLMs:${this.name}] Streaming text.`,{input:e}),Error("Method not implemented.")}async __streamObject(e){throw this.logger.debug(`[LLMs:${this.name}] Streaming object.`,{input:e}),Error("Method not implemented.")}async stream(e,t={}){throw this.logger.debug(`[LLMs:${this.name}] Streaming text.`,{messages:e,options:t}),Error("Method not implemented.")}},ss=class extends sr{#tp;#eW;constructor({model:e,mastra:t}){super({name:"aisdk",model:e}),this.#tp=e,t&&(this.#eW=t,t.logger&&this.__setLogger(t.logger))}__registerPrimitives(e){e.telemetry&&this.__setTelemetry(e.telemetry),e.logger&&this.__setLogger(e.logger),this.#eW=e}getProvider(){return this.#tp.provider}getModelId(){return this.#tp.modelId}getModel(){return this.#tp}convertTools({tools:e,runId:t,threadId:r,resourceId:s}={}){this.logger.debug("Starting tool conversion for LLM");let o=Object.entries(e||{}).reduce((e,o)=>{let i=o[0],a=o[1];return a&&(e[i]={description:a.description,parameters:a.inputSchema,execute:"function"==typeof a?.execute?async(e,o)=>{try{return this.logger.debug("Executing tool",{tool:i,props:e}),a?.execute?.({context:e,threadId:r,resourceId:s,mastra:this.#eW,runId:t},o)??void 0}catch(o){throw this.logger.error("Error executing tool",{tool:i,props:e,error:o,runId:t,threadId:r,resourceId:s}),o}}:void 0}),e},{});return this.logger.debug("Converted tools for LLM"),o}async __text({runId:e,messages:t,maxSteps:r,tools:s,convertedTools:o,temperature:i,toolChoice:a="auto",onStepFinish:l,experimental_output:u,telemetry:c,threadId:d,resourceId:p,...h}){let f;let m=this.#tp;this.logger.debug("[LLM] - Generating text",{runId:e,messages:t,maxSteps:r,threadId:d,resourceId:p,tools:Object.keys(s||o||{})});let g={model:m,temperature:i,tools:{...o||this.convertTools({tools:s,runId:e,threadId:d,resourceId:p})},toolChoice:a,maxSteps:r,onStepFinish:async t=>{l?.(JSON.stringify(t,null,2)),this.logger.debug("[LLM] - Step Change:",{text:t?.text,toolCalls:t?.toolCalls,toolResults:t?.toolResults,finishReason:t?.finishReason,usage:t?.usage,runId:e}),t?.response?.headers?.["x-ratelimit-remaining-tokens"]&&2e3>parseInt(t?.response?.headers?.["x-ratelimit-remaining-tokens"],10)&&(this.logger.warn("Rate limit approaching, waiting 10 seconds",{runId:e}),await Z(1e4))},...h};return u&&(this.logger.debug("[LLM] - Using experimental output",{runId:e}),"function"==typeof u.parse?(f=u)instanceof P.z.ZodArray&&(f=f._def.type):f=eD(u)),await rC({messages:t,...g,experimental_telemetry:{...this.experimental_telemetry,...c},experimental_output:f?rN.object({schema:f}):void 0})}async __textObject({messages:e,onStepFinish:t,maxSteps:r=5,tools:s,convertedTools:o,structuredOutput:i,runId:a,temperature:l,toolChoice:u="auto",telemetry:c,threadId:d,resourceId:p,...h}){let f;let m=this.#tp;this.logger.debug("[LLM] - Generating a text object",{runId:a});let g={model:m,temperature:l,tools:{...o||this.convertTools({tools:s,runId:a,threadId:d,resourceId:p})},maxSteps:r,toolChoice:u,onStepFinish:async e=>{t?.(JSON.stringify(e,null,2)),this.logger.debug("[LLM] - Step Change:",{text:e?.text,toolCalls:e?.toolCalls,toolResults:e?.toolResults,finishReason:e?.finishReason,usage:e?.usage,runId:a}),e?.response?.headers?.["x-ratelimit-remaining-tokens"]&&2e3>parseInt(e?.response?.headers?.["x-ratelimit-remaining-tokens"],10)&&(this.logger.warn("Rate limit approaching, waiting 10 seconds",{runId:a}),await Z(1e4))},...h},y="object";return"function"==typeof i.parse?(f=i)instanceof P.z.ZodArray&&(y="array",f=f._def.type):f=eD(i),await t3({messages:e,...g,output:y,schema:f,experimental_telemetry:{...this.experimental_telemetry,...c}})}async __stream({messages:e,onStepFinish:t,onFinish:r,maxSteps:s=5,tools:o,convertedTools:i,runId:a,temperature:l,toolChoice:u="auto",experimental_output:c,telemetry:d,threadId:p,resourceId:h,...f}){let m;let g=this.#tp;this.logger.debug("[LLM] - Streaming text",{runId:a,threadId:p,resourceId:h,messages:e,maxSteps:s,tools:Object.keys(o||i||{})});let y={model:g,temperature:l,tools:{...i||this.convertTools({tools:o,runId:a,threadId:p,resourceId:h})},maxSteps:s,toolChoice:u,onStepFinish:async e=>{t?.(JSON.stringify(e,null,2)),this.logger.debug("[LLM] - Stream Step Change:",{text:e?.text,toolCalls:e?.toolCalls,toolResults:e?.toolResults,finishReason:e?.finishReason,usage:e?.usage,runId:a}),e?.response?.headers?.["x-ratelimit-remaining-tokens"]&&2e3>parseInt(e?.response?.headers?.["x-ratelimit-remaining-tokens"],10)&&(this.logger.warn("Rate limit approaching, waiting 10 seconds",{runId:a}),await Z(1e4))},onFinish:async e=>{r?.(JSON.stringify(e,null,2)),this.logger.debug("[LLM] - Stream Finished:",{text:e?.text,toolCalls:e?.toolCalls,toolResults:e?.toolResults,finishReason:e?.finishReason,usage:e?.usage,runId:a,threadId:p,resourceId:h})},...f};return c&&(this.logger.debug("[LLM] - Using experimental output",{runId:a}),"function"==typeof c.parse?(m=c)instanceof P.z.ZodArray&&(m=m._def.type):m=eD(c)),await function({model:e,tools:t,toolChoice:r,system:s,prompt:o,messages:i,maxRetries:a,abortSignal:l,headers:u,maxSteps:c=1,experimental_generateMessageId:d=rV,experimental_output:p,experimental_continueSteps:h=!1,experimental_telemetry:f,experimental_providerMetadata:m,providerOptions:g=m,experimental_toolCallStreaming:y=!1,toolCallStreaming:b=y,experimental_activeTools:_,experimental_repairToolCall:v,experimental_transform:w,onChunk:S,onError:E,onFinish:k,onStepFinish:I,_internal:{now:O=t5,generateId:T=rF,currentDate:j=()=>new Date}={},...C}){return new rW({model:e,telemetry:f,headers:u,settings:C,maxRetries:a,abortSignal:l,system:s,prompt:o,messages:i,tools:t,toolChoice:r,toolCallStreaming:b,transforms:void 0===w?[]:Array.isArray(w)?w:[w],activeTools:_,repairToolCall:v,maxSteps:c,output:p,continueSteps:h,providerOptions:g,onChunk:S,onError:E,onFinish:k,onStepFinish:I,now:O,currentDate:j,generateId:T,generateMessageId:d})}({messages:e,...y,experimental_telemetry:{...this.experimental_telemetry,...d},experimental_output:m?rN.object({schema:m}):void 0})}async __streamObject({messages:e,onStepFinish:t,onFinish:r,maxSteps:s=5,tools:o,convertedTools:i,structuredOutput:a,runId:l,temperature:u,toolChoice:c="auto",telemetry:d,threadId:p,resourceId:h,...f}){let m;let g=this.#tp;this.logger.debug("[LLM] - Streaming structured output",{runId:l,messages:e,maxSteps:s,tools:Object.keys(o||i||{})});let y={model:g,temperature:u,tools:{...i||this.convertTools({tools:o,runId:l,threadId:p,resourceId:h})},maxSteps:s,toolChoice:c,onStepFinish:async e=>{t?.(JSON.stringify(e,null,2)),this.logger.debug("[LLM] - Stream Step Change:",{text:e?.text,toolCalls:e?.toolCalls,toolResults:e?.toolResults,finishReason:e?.finishReason,usage:e?.usage,runId:l,threadId:p,resourceId:h}),e?.response?.headers?.["x-ratelimit-remaining-tokens"]&&2e3>parseInt(e?.response?.headers?.["x-ratelimit-remaining-tokens"],10)&&(this.logger.warn("Rate limit approaching, waiting 10 seconds",{runId:l}),await Z(1e4))},onFinish:async e=>{r?.(JSON.stringify(e,null,2)),this.logger.debug("[LLM] - Stream Finished:",{text:e?.text,toolCalls:e?.toolCalls,toolResults:e?.toolResults,finishReason:e?.finishReason,usage:e?.usage,runId:l,threadId:p,resourceId:h})},...f},b="object";return"function"==typeof a.parse?(m=a)instanceof P.z.ZodArray&&(b="array",m=m._def.type):m=eD(a),function({model:e,schema:t,schemaName:r,schemaDescription:s,mode:o,output:i="object",system:a,prompt:l,messages:u,maxRetries:c,abortSignal:d,headers:p,experimental_telemetry:h,experimental_providerMetadata:f,providerOptions:m=f,onError:g,onFinish:y,_internal:{generateId:b=t7,currentDate:_=()=>new Date,now:v=t5}={},...w}){t1({output:i,mode:o,schema:t,schemaName:r,schemaDescription:s});let S=t0({output:i,schema:t});return"no-schema"===S.type&&void 0===o&&(o="json"),new re({model:e,telemetry:h,headers:p,settings:w,maxRetries:c,abortSignal:d,outputStrategy:S,system:a,prompt:l,messages:u,schemaName:r,schemaDescription:s,providerOptions:m,mode:o,onError:g,onFinish:y,generateId:b,currentDate:_,now:v})}({messages:e,...y,output:b,schema:m,experimental_telemetry:{...this.experimental_telemetry,...d}})}async generate(e,{maxSteps:t=5,onStepFinish:r,tools:s,convertedTools:o,runId:i,output:a,temperature:l,telemetry:u,...c}={}){let d=this.convertToMessages(e);return a?await this.__textObject({messages:d,structuredOutput:a,onStepFinish:r,maxSteps:t,tools:s,convertedTools:o,runId:i,telemetry:u,...c}):await this.__text({messages:d,onStepFinish:r,maxSteps:t,tools:s,convertedTools:o,runId:i,temperature:l,...c})}async stream(e,{maxSteps:t=5,onFinish:r,onStepFinish:s,tools:o,convertedTools:i,runId:a,output:l,temperature:u,telemetry:c,...d}={}){let p=this.convertToMessages(e);return l?await this.__streamObject({messages:p,structuredOutput:l,onStepFinish:s,onFinish:r,maxSteps:t,tools:o,convertedTools:i,runId:a,temperature:u,telemetry:c,...d}):await this.__stream({messages:p,onStepFinish:s,onFinish:r,maxSteps:t,tools:o,convertedTools:i,runId:a,temperature:u,telemetry:c,...d})}};E=[(0,O.B$)({prefix:"agent",excludeMethods:["__setTools","__setLogger","__setTelemetry","log"]})];var sn=class extends(I=T.o){name;llm;instructions;model;#eW;#th;tools;metrics;evals;voice;constructor(e){if(super({component:r5.pU.AGENT}),this.name=e.name,this.instructions=e.instructions,!e.model)throw Error("LanguageModel is required to create an Agent. Please provide the 'model'.");this.llm=new ss({model:e.model}),this.tools={},this.metrics={},this.evals={},e.tools&&(this.tools=e.tools),e.mastra&&(this.#eW=e.mastra),e.metrics&&(this.logger.warn("The metrics property is deprecated. Please use evals instead to add evaluation metrics."),this.metrics=e.metrics,this.evals=e.metrics),e.evals&&(this.evals=e.evals),e.memory&&(this.#th=e.memory),e.voice&&(this.voice=e.voice)}hasOwnMemory(){return!!this.#th}getMemory(){return this.#th??this.#eW?.memory}__updateInstructions(e){this.instructions=e,this.logger.debug(`[Agents:${this.name}] Instructions updated.`,{model:this.model,name:this.name})}__registerPrimitives(e){e.telemetry&&this.__setTelemetry(e.telemetry),e.logger&&this.__setLogger(e.logger),this.llm.__registerPrimitives(e),this.#eW=e,this.logger.debug(`[Agents:${this.name}] initialized.`,{model:this.model,name:this.name})}__setTools(e){this.tools=e,this.logger.debug(`[Agents:${this.name}] Tools set for agent ${this.name}`,{model:this.model,name:this.name})}async generateTitleFromUserMessage({message:e}){let{object:t}=await this.llm.__textObject({messages:[{role:"system",content:`

      - you will generate a short title based on the first message a user begins a conversation with
      - ensure it is not more than 80 characters long
      - the title should be a summary of the user's message
      - do not use quotes or colons`},{role:"user",content:JSON.stringify(e)}],structuredOutput:P.z.object({title:P.z.string()})});return t.title}getMostRecentUserMessage(e){return e.filter(e=>"user"===e.role).at(-1)}async genTitle(e){let t="New Thread";try{e&&(t=await this.generateTitleFromUserMessage({message:e}))}catch(e){console.error("Error generating title:",e)}return t}async saveMemory({threadId:e,memoryConfig:t,resourceId:r,userMessages:s,runId:o}){let i=this.getMostRecentUserMessage(s),a=this.getMemory();if(a){let l;if(e){if(!(l=await a.getThreadById({threadId:e}))){this.logger.debug(`Thread with id ${e} not found, creating new thread for agent ${this.name}`,{runId:o||this.name});let s=await this.genTitle(i);l=await a.createThread({threadId:e,resourceId:r,title:s,memoryConfig:t})}}else{this.logger.debug(`No threadId, creating new thread for agent ${this.name}`,{runId:o||this.name});let s=await this.genTitle(i);l=await a.createThread({threadId:e,resourceId:r,title:s,memoryConfig:t})}let u=i?[i]:s;if(l){let r=u.map(e=>({id:this.getMemory()?.generateId(),createdAt:new Date,threadId:l.id,...e,content:e.content,role:e.role,type:"text"})),s=e&&a?(await a.rememberMessages({threadId:e,config:t,vectorMessageSearch:r.slice(-1).map(e=>"string"==typeof e?e:e?.content||"").join(`
`)})).messages:[];a&&await a.saveMessages({messages:r,memoryConfig:t}),this.logger.debug("Saved messages to memory",{threadId:l.id,runId:o});let i=a&&e?await a.getSystemMessage({threadId:e,memoryConfig:t}):null;return{threadId:l.id,messages:[i?{role:"system",content:i}:null,...this.sanitizeResponseMessages(s),...u].filter(e=>!!e)}}return{threadId:l?.id||e||"",messages:s}}return{threadId:e||"",messages:s}}async saveResponse({result:e,threadId:t,resourceId:r,runId:s,memoryConfig:o}){let{response:i}=e;try{if(i.messages){let e=Array.isArray(i.messages)?i.messages:[i.messages],a=this.sanitizeResponseMessages(e),l=this.getMemory();l&&(this.logger.debug(`[Agent:${this.name}] - Memory persistence: store=${this.getMemory()?.constructor.name} threadId=${t}`,{runId:s,resourceId:r,threadId:t,memoryStore:this.getMemory()?.constructor.name}),await l.saveMessages({memoryConfig:o,messages:a.map((e,r)=>{let s,o,i;let a=(0,st.randomUUID)(),l="text";if("tool"===e.role&&(s=e.content.map(e=>e.toolCallId),l="tool-result"),"assistant"===e.role){let t=e.content,r=t.map(e=>{if("tool-call"===e.type)return{toolCallId:e.toolCallId,toolArgs:e.args,toolName:e.toolName}})?.filter(Boolean);s=r?.map(e=>e.toolCallId),o=r?.map(e=>e.toolArgs),i=r?.map(e=>e.toolName),l=t?.[0]?.type}return{id:a,threadId:t,role:e.role,content:e.content,createdAt:new Date(Date.now()+r),toolCallIds:s?.length?s:void 0,toolCallArgs:o?.length?o:void 0,toolNames:i?.length?i:void 0,type:l}})}))}}catch(e){this.logger.error(`[Agent:${this.name}] - Failed to save assistant response`,{error:e,runId:s})}}sanitizeResponseMessages(e){let t=[],r=[];for(let s of e)if("tool"===s.role)for(let e of s.content)"tool-result"===e.type&&t.push(e.toolCallId);else if("assistant"===s.role||"user"===s.role)for(let e of s.content)"string"!=typeof e&&"tool-call"===e.type&&r.push(e.toolCallId);return e.map(e=>{if("assistant"!==e.role&&"tool"!==e.role&&"user"!==e.role||"string"==typeof e.content)return e;let s=e.content.filter(e=>"tool-call"===e.type?t.includes(e.toolCallId):"text"===e.type?""!==e.text.trim():"tool-result"!==e.type||r.includes(e.toolCallId));return{...e,content:s}}).filter(e=>"string"==typeof e.content?""!==e.content:!Array.isArray(e.content)||e.content.length&&e.content.every(e=>"text"!==e.type||e.text&&""!==e.text))}convertTools({toolsets:e,threadId:t,resourceId:r,runId:s}){this.logger.debug(`[Agents:${this.name}] - Assigning tools`,{runId:s,threadId:t,resourceId:r});let o={...Object.entries(this.tools||{}).reduce((e,o)=>{let i=o[0],a=this.tools[i];return a&&(e[i]={description:a.description,parameters:a.inputSchema,execute:"function"==typeof a?.execute?async(e,o)=>{try{return this.logger.debug(`[Agent:${this.name}] - Executing tool ${i}`,{name:i,description:a.description,args:e,runId:s,threadId:t,resourceId:r}),a?.execute?.({context:e,mastra:this.#eW,runId:s,threadId:t,resourceId:r},o)??void 0}catch(e){throw this.logger.error(`[Agent:${this.name}] - Failed execution`,{error:e,runId:s,threadId:t,resourceId:r}),e}}:void 0}),e},{})},i=Object.values(e||{});return i.length>0&&(this.logger.debug(`[Agent:${this.name}] - Adding tools from toolsets ${Object.keys(e||{}).join(", ")}`,{runId:s}),i.forEach(e=>{Object.entries(e).forEach(([e,i])=>{o[e]={description:i.description||"",parameters:i.inputSchema,execute:"function"==typeof i?.execute?async(o,a)=>{try{return this.logger.debug(`[Agent:${this.name}] - Executing tool ${e}`,{name:e,description:i.description,args:o,runId:s,threadId:t,resourceId:r}),i?.execute?.({context:o,runId:s,threadId:t,resourceId:r},a)??void 0}catch(e){throw this.logger.error(`[Agent:${this.name}] - Failed toolset execution`,{error:e,runId:s,threadId:t,resourceId:r}),e}}:void 0}})})),o}async preExecute({resourceId:e,runId:t,threadId:r,memoryConfig:s,messages:o}){let i=[];this.logger.debug(`Saving user messages in memory for agent ${this.name}`,{runId:t});let a=await this.saveMemory({threadId:r,resourceId:e,userMessages:o,memoryConfig:s});return{coreMessages:a.messages,threadIdToUse:a.threadId}}__primitive({messages:e,context:t,threadId:r,memoryConfig:s,resourceId:o,runId:i,toolsets:a}){return{before:async()=>{let l;this.logger.debug(`[Agents:${this.name}] - Starting generation`,{runId:i});let u={role:"system",content:`${this.instructions}.`},c=e,d=r,p=this.getMemory();if(r&&p&&!o)throw Error(`A resourceId must be provided when passing a threadId and using Memory. Saw threadId ${r} but resourceId is ${o}`);if(p&&o){this.logger.debug(`[Agent:${this.name}] - Memory persistence enabled: store=${this.getMemory()?.constructor.name}, resourceId=${o}`,{runId:i,resourceId:o,threadId:d,memoryStore:this.getMemory()?.constructor.name});let t=await this.preExecute({resourceId:o,runId:i,threadId:d,memoryConfig:s,messages:e});c=t.coreMessages,d=t.threadIdToUse}if(a&&Object.keys(a||{}).length>0||this.getMemory()&&o){let e=[];a&&Object.keys(a||{}).length>0&&e.push(`toolsets present (${Object.keys(a||{}).length} tools)`),this.getMemory()&&o&&e.push("memory and resourceId available"),this.logger.debug(`[Agent:${this.name}] - Enhancing tools: ${e.join(", ")}`,{runId:i,toolsets:a?Object.keys(a):void 0,hasMemory:!!this.getMemory(),hasResourceId:!!o}),l=this.convertTools({toolsets:a,threadId:d,resourceId:o,runId:i})}return{messageObjects:[u,...t||[],...c],convertedTools:l,threadId:d}},after:async({result:t,threadId:r,memoryConfig:s,outputText:i,runId:a})=>{let l={text:t?.text,object:t?.object,toolResults:t?.toolResults,toolCalls:t?.toolCalls,usage:t?.usage,steps:t?.steps?.map(e=>({stepType:e?.stepType,text:t?.text,object:t?.object,toolResults:t?.toolResults,toolCalls:t?.toolCalls,usage:t?.usage}))};if(this.logger.debug(`[Agent:${this.name}] - Post processing LLM response`,{runId:a,result:l,threadId:r}),this.getMemory()&&o)try{await this.saveResponse({result:t,threadId:r,resourceId:o,memoryConfig:s,runId:a})}catch(e){this.logger.error("Error saving response",{error:e,runId:a,result:l,threadId:r})}if(Object.keys(this.evals||{}).length>0){let t=e.map(e=>e.content).join("\n"),r=a||crypto.randomUUID();for(let e of Object.values(this.evals||{}))!function(e,t){setImmediate(()=>{se.emit(e,t)})}("onGeneration",{input:t,output:i,runId:r,metric:e,agentName:this.name,instructions:this.instructions})}}}}async generate(e,{context:t,threadId:r,memoryOptions:s,resourceId:o,maxSteps:i=5,onStepFinish:a,runId:l,output:u,toolsets:c,temperature:d,toolChoice:p="auto",experimental_output:h,telemetry:f,...m}={}){let g=[];g="string"==typeof e?[{role:"user",content:e}]:e.map(e=>"string"==typeof e?{role:"user",content:e}:e);let y=l||(0,st.randomUUID)(),{before:b,after:_}=this.__primitive({messages:g,context:t,threadId:r,memoryConfig:s,resourceId:o,runId:y,toolsets:c}),{threadId:v,messageObjects:w,convertedTools:S}=await b();if(!u&&h){let e=await this.llm.__text({messages:w,tools:this.tools,convertedTools:S,onStepFinish:a,maxSteps:i||5,runId:y,temperature:d,toolChoice:p||"auto",experimental_output:h,threadId:v,resourceId:o,...m}),t=e.text;return await _({result:e,threadId:v,memoryConfig:s,outputText:t,runId:y}),e.object=e.experimental_output,e}if(!u){let e=await this.llm.__text({messages:w,tools:this.tools,convertedTools:S,onStepFinish:a,maxSteps:i,runId:y,temperature:d,toolChoice:p,telemetry:f,threadId:v,resourceId:o,...m}),t=e.text;return await _({result:e,threadId:v,memoryConfig:s,outputText:t,runId:y}),e}let E=await this.llm.__textObject({messages:w,tools:this.tools,structuredOutput:u,convertedTools:S,onStepFinish:a,maxSteps:i,runId:y,temperature:d,toolChoice:p,telemetry:f,...m}),k=JSON.stringify(E.object);return await _({result:E,threadId:v,memoryConfig:s,outputText:k,runId:y}),E}async stream(e,{context:t,threadId:r,memoryOptions:s,resourceId:o,maxSteps:i=5,onFinish:a,onStepFinish:l,runId:u,toolsets:c,output:d,temperature:p,toolChoice:h="auto",experimental_output:f,telemetry:m,...g}={}){let y=u||(0,st.randomUUID)(),b=[];b="string"==typeof e?[{role:"user",content:e}]:e.map(e=>"string"==typeof e?{role:"user",content:e}:e);let{before:_,after:v}=this.__primitive({messages:b,context:t,threadId:r,memoryConfig:s,resourceId:o,runId:y,toolsets:c}),{threadId:w,messageObjects:S,convertedTools:E}=await _();if(!d&&f){this.logger.debug(`Starting agent ${this.name} llm stream call`,{runId:u});let e=await this.llm.__stream({messages:S,temperature:p,tools:this.tools,convertedTools:E,onStepFinish:l,onFinish:async e=>{try{let t=JSON.parse(e)||{},r=t.text;await v({result:t,threadId:w,memoryConfig:s,outputText:r,runId:y})}catch(e){this.logger.error("Error saving memory on finish",{error:e,runId:u})}a?.(e)},maxSteps:i,runId:y,toolChoice:h,experimental_output:f,...g});return e.partialObjectStream=e.experimental_partialOutputStream,e}return d?(this.logger.debug(`Starting agent ${this.name} llm streamObject call`,{runId:u}),this.llm.__streamObject({messages:S,tools:this.tools,temperature:p,structuredOutput:d,convertedTools:E,onStepFinish:l,onFinish:async e=>{try{let t=JSON.parse(e)||{},r=JSON.stringify(t.object);await v({result:t,threadId:w,memoryConfig:s,outputText:r,runId:y})}catch(e){this.logger.error("Error saving memory on finish",{error:e,runId:u})}a?.(e)},runId:y,toolChoice:h,telemetry:m,...g})):(this.logger.debug(`Starting agent ${this.name} llm stream call`,{runId:u}),this.llm.__stream({messages:S,temperature:p,tools:this.tools,convertedTools:E,onStepFinish:l,onFinish:async e=>{try{let t=JSON.parse(e)||{},r=t.text;await v({result:t,threadId:w,memoryConfig:s,outputText:r,runId:y})}catch(e){this.logger.error("Error saving memory on finish",{error:e,runId:u})}a?.(e)},maxSteps:i,runId:y,toolChoice:h,telemetry:m,...g}))}async speak(e,t){if(!this.voice)throw Error("No voice provider configured");try{return this.voice.speak(e,t)}catch(e){throw this.logger.error("Error during agent speak",{error:e}),e}}async listen(e,t){if(!this.voice)throw Error("No voice provider configured");try{return this.voice.listen(e,t)}catch(e){throw this.logger.error("Error during agent listen",{error:e}),e}}async getSpeakers(){if(!this.voice)throw Error("No voice provider configured");try{return await this.voice.getSpeakers()}catch(e){throw this.logger.error("Error during agent getSpeakers",{error:e}),e}}};k=(0,j.xl)(I),sn=(0,j.pL)(k,0,"Agent",E,sn),(0,j.Co)(k,1,sn);var so=r(20629),si=r(79500),sa=(T.o,class extends sn{constructor(e){super(e),this.logger.warn('Please import "Agent from "@mastra/core/agent" instead of "@mastra/core"')}});T.o,r9.i,A.U;var sl=class extends R.h4{constructor(e){super(e),this.logger.warn('Please import "Workflow" from "@mastra/core/workflows" instead of "@mastra/core"')}}},13822:(e,t,r)=>{"use strict";r.d(t,{DS:()=>D});let s="3.7.7",o="function"==typeof Buffer,i="function"==typeof TextDecoder?new TextDecoder:void 0,a="function"==typeof TextEncoder?new TextEncoder:void 0,l=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),u=(e=>{let t={};return e.forEach((e,r)=>t[e]=r),t})(l),c=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,d=String.fromCharCode.bind(String),p="function"==typeof Uint8Array.from?Uint8Array.from.bind(Uint8Array):e=>new Uint8Array(Array.prototype.slice.call(e,0)),h=e=>e.replace(/=/g,"").replace(/[+\/]/g,e=>"+"==e?"-":"_"),f=e=>e.replace(/[^A-Za-z0-9\+\/]/g,""),m=e=>{let t,r,s,o,i="",a=e.length%3;for(let a=0;a<e.length;){if((r=e.charCodeAt(a++))>255||(s=e.charCodeAt(a++))>255||(o=e.charCodeAt(a++))>255)throw TypeError("invalid character found");i+=l[(t=r<<16|s<<8|o)>>18&63]+l[t>>12&63]+l[t>>6&63]+l[63&t]}return a?i.slice(0,a-3)+"===".substring(a):i},g="function"==typeof btoa?e=>btoa(e):o?e=>Buffer.from(e,"binary").toString("base64"):m,y=o?e=>Buffer.from(e).toString("base64"):e=>{let t=[];for(let r=0,s=e.length;r<s;r+=4096)t.push(d.apply(null,e.subarray(r,r+4096)));return g(t.join(""))},b=(e,t=!1)=>t?h(y(e)):y(e),_=e=>{if(e.length<2){var t=e.charCodeAt(0);return t<128?e:t<2048?d(192|t>>>6)+d(128|63&t):d(224|t>>>12&15)+d(128|t>>>6&63)+d(128|63&t)}var t=65536+(e.charCodeAt(0)-55296)*1024+(e.charCodeAt(1)-56320);return d(240|t>>>18&7)+d(128|t>>>12&63)+d(128|t>>>6&63)+d(128|63&t)},v=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,w=e=>e.replace(v,_),S=o?e=>Buffer.from(e,"utf8").toString("base64"):a?e=>y(a.encode(e)):e=>g(w(e)),E=(e,t=!1)=>t?h(S(e)):S(e),k=e=>E(e,!0),I=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,O=e=>{switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return d((t>>>10)+55296)+d((1023&t)+56320);case 3:return d((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return d((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},T=e=>e.replace(I,O),j=e=>{if(e=e.replace(/\s+/g,""),!c.test(e))throw TypeError("malformed base64.");e+="==".slice(2-(3&e.length));let t,r="",s,o;for(let i=0;i<e.length;)t=u[e.charAt(i++)]<<18|u[e.charAt(i++)]<<12|(s=u[e.charAt(i++)])<<6|(o=u[e.charAt(i++)]),r+=64===s?d(t>>16&255):64===o?d(t>>16&255,t>>8&255):d(t>>16&255,t>>8&255,255&t);return r},C="function"==typeof atob?e=>atob(f(e)):o?e=>Buffer.from(e,"base64").toString("binary"):j,R=o?e=>p(Buffer.from(e,"base64")):e=>p(C(e).split("").map(e=>e.charCodeAt(0))),A=e=>R(N(e)),P=o?e=>Buffer.from(e,"base64").toString("utf8"):i?e=>i.decode(R(e)):e=>T(C(e)),N=e=>f(e.replace(/[-_]/g,e=>"-"==e?"+":"/")),q=e=>P(N(e)),M=e=>({value:e,enumerable:!1,writable:!0,configurable:!0}),L=function(){let e=(e,t)=>Object.defineProperty(String.prototype,e,M(t));e("fromBase64",function(){return q(this)}),e("toBase64",function(e){return E(this,e)}),e("toBase64URI",function(){return E(this,!0)}),e("toBase64URL",function(){return E(this,!0)}),e("toUint8Array",function(){return A(this)})},$=function(){let e=(e,t)=>Object.defineProperty(Uint8Array.prototype,e,M(t));e("toBase64",function(e){return b(this,e)}),e("toBase64URI",function(){return b(this,!0)}),e("toBase64URL",function(){return b(this,!0)})},D={version:s,VERSION:s,atob:C,atobPolyfill:j,btoa:g,btoaPolyfill:m,fromBase64:q,toBase64:E,encode:E,encodeURI:k,encodeURL:k,utob:w,btou:T,decode:q,isValid:e=>{if("string"!=typeof e)return!1;let t=e.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(t)||!/[^\s0-9a-zA-Z\-_]/.test(t)},fromUint8Array:b,toUint8Array:A,extendString:L,extendUint8Array:$,extendBuiltins:()=>{L(),$()}}},1559:(e,t,r)=>{"use strict";r.d(t,{XY:()=>s,ZP:()=>o}),r(78926),r(32934),r(67285);var s=r(38825);r(6390);let o=s},7130:(e,t,r)=>{"use strict";let s;r.d(t,{ak:()=>eS,pA:()=>tc,z:()=>td}),function(e){e.assertEqual=e=>e,e.assertIs=function(e){},e.assertNever=function(e){throw Error()},e.arrayToEnum=e=>{let t={};for(let r of e)t[r]=r;return t},e.getValidEnumValues=t=>{let r=e.objectKeys(t).filter(e=>"number"!=typeof t[t[e]]),s={};for(let e of r)s[e]=t[e];return e.objectValues(s)},e.objectValues=t=>e.objectKeys(t).map(function(e){return t[e]}),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{let t=[];for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t},e.find=(e,t)=>{for(let r of e)if(t(r))return r},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t}(to||(to={})),(ti||(ti={})).mergeShapes=(e,t)=>({...e,...t});let o=to.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),i=e=>{switch(typeof e){case"undefined":return o.undefined;case"string":return o.string;case"number":return isNaN(e)?o.nan:o.number;case"boolean":return o.boolean;case"function":return o.function;case"bigint":return o.bigint;case"symbol":return o.symbol;case"object":if(Array.isArray(e))return o.array;if(null===e)return o.null;if(e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch)return o.promise;if("undefined"!=typeof Map&&e instanceof Map)return o.map;if("undefined"!=typeof Set&&e instanceof Set)return o.set;if("undefined"!=typeof Date&&e instanceof Date)return o.date;return o.object;default:return o.unknown}},a=to.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class l extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(e){return e.message},r={_errors:[]},s=e=>{for(let o of e.issues)if("invalid_union"===o.code)o.unionErrors.map(s);else if("invalid_return_type"===o.code)s(o.returnTypeError);else if("invalid_arguments"===o.code)s(o.argumentsError);else if(0===o.path.length)r._errors.push(t(o));else{let e=r,s=0;for(;s<o.path.length;){let r=o.path[s];s===o.path.length-1?(e[r]=e[r]||{_errors:[]},e[r]._errors.push(t(o))):e[r]=e[r]||{_errors:[]},e=e[r],s++}}};return s(this),r}static assert(e){if(!(e instanceof l))throw Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,to.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){let t={},r=[];for(let s of this.issues)s.path.length>0?(t[s.path[0]]=t[s.path[0]]||[],t[s.path[0]].push(e(s))):r.push(e(s));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}l.create=e=>new l(e);let u=(e,t)=>{let r;switch(e.code){case a.invalid_type:r=e.received===o.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case a.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,to.jsonStringifyReplacer)}`;break;case a.unrecognized_keys:r=`Unrecognized key(s) in object: ${to.joinValues(e.keys,", ")}`;break;case a.invalid_union:r="Invalid input";break;case a.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${to.joinValues(e.options)}`;break;case a.invalid_enum_value:r=`Invalid enum value. Expected ${to.joinValues(e.options)}, received '${e.received}'`;break;case a.invalid_arguments:r="Invalid function arguments";break;case a.invalid_return_type:r="Invalid function return type";break;case a.invalid_date:r="Invalid date";break;case a.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:to.assertNever(e.validation):r="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case a.too_small:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case a.too_big:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case a.custom:r="Invalid input";break;case a.invalid_intersection_types:r="Intersection results could not be merged";break;case a.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case a.not_finite:r="Number must be finite";break;default:r=t.defaultError,to.assertNever(e)}return{message:r}},c=u;function d(){return c}let p=e=>{let{data:t,path:r,errorMaps:s,issueData:o}=e,i=[...r,...o.path||[]],a={...o,path:i};if(void 0!==o.message)return{...o,path:i,message:o.message};let l="";for(let e of s.filter(e=>!!e).slice().reverse())l=e(a,{data:t,defaultError:l}).message;return{...o,path:i,message:l}};function h(e,t){let r=d(),s=p({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,r,r===u?void 0:u].filter(e=>!!e)});e.common.issues.push(s)}class f{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){let r=[];for(let s of t){if("aborted"===s.status)return m;"dirty"===s.status&&e.dirty(),r.push(s.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){let r=[];for(let e of t){let t=await e.key,s=await e.value;r.push({key:t,value:s})}return f.mergeObjectSync(e,r)}static mergeObjectSync(e,t){let r={};for(let s of t){let{key:t,value:o}=s;if("aborted"===t.status||"aborted"===o.status)return m;"dirty"===t.status&&e.dirty(),"dirty"===o.status&&e.dirty(),"__proto__"!==t.value&&(void 0!==o.value||s.alwaysSet)&&(r[t.value]=o.value)}return{status:e.value,value:r}}}let m=Object.freeze({status:"aborted"}),g=e=>({status:"dirty",value:e}),y=e=>({status:"valid",value:e}),b=e=>"aborted"===e.status,_=e=>"dirty"===e.status,v=e=>"valid"===e.status,w=e=>"undefined"!=typeof Promise&&e instanceof Promise;function S(e,t,r,s){if("a"===r&&!s)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)}function E(e,t,r,s,o){if("m"===s)throw TypeError("Private method is not writable");if("a"===s&&!o)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?o.call(e,r):o?o.value=r:t.set(e,r),r}"function"==typeof SuppressedError&&SuppressedError,function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:null==e?void 0:e.message}(ta||(ta={}));class k{constructor(e,t,r,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=s}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}let I=(e,t)=>{if(v(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new l(e.common.issues);return this._error=t,this._error}}};function O(e){if(!e)return{};let{errorMap:t,invalid_type_error:r,required_error:s,description:o}=e;if(t&&(r||s))throw Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:o}:{errorMap:(t,o)=>{var i,a;let{message:l}=e;return"invalid_enum_value"===t.code?{message:null!=l?l:o.defaultError}:void 0===o.data?{message:null!==(i=null!=l?l:s)&&void 0!==i?i:o.defaultError}:"invalid_type"!==t.code?{message:o.defaultError}:{message:null!==(a=null!=l?l:r)&&void 0!==a?a:o.defaultError}},description:o}}class T{get description(){return this._def.description}_getType(e){return i(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:i(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new f,ctx:{common:e.parent.common,data:e.data,parsedType:i(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(w(t))throw Error("Synchronous parse encountered promise.");return t}_parseAsync(e){return Promise.resolve(this._parse(e))}parse(e,t){let r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;let s={common:{issues:[],async:null!==(r=null==t?void 0:t.async)&&void 0!==r&&r,contextualErrorMap:null==t?void 0:t.errorMap},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:i(e)},o=this._parseSync({data:e,path:s.path,parent:s});return I(s,o)}"~validate"(e){var t,r;let s={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:i(e)};if(!this["~standard"].async)try{let t=this._parseSync({data:e,path:[],parent:s});return v(t)?{value:t.value}:{issues:s.common.issues}}catch(e){(null===(r=null===(t=null==e?void 0:e.message)||void 0===t?void 0:t.toLowerCase())||void 0===r?void 0:r.includes("encountered"))&&(this["~standard"].async=!0),s.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:s}).then(e=>v(e)?{value:e.value}:{issues:s.common.issues})}async parseAsync(e,t){let r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){let r={common:{issues:[],contextualErrorMap:null==t?void 0:t.errorMap,async:!0},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:i(e)},s=this._parse({data:e,path:r.path,parent:r});return I(r,await (w(s)?s:Promise.resolve(s)))}refine(e,t){let r=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement((t,s)=>{let o=e(t),i=()=>s.addIssue({code:a.custom,...r(t)});return"undefined"!=typeof Promise&&o instanceof Promise?o.then(e=>!!e||(i(),!1)):!!o||(i(),!1)})}refinement(e,t){return this._refinement((r,s)=>!!e(r)||(s.addIssue("function"==typeof t?t(r,s):t),!1))}_refinement(e){return new ex({schema:this,typeName:tc.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return eS.create(this,this._def)}nullable(){return eE.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return eo.create(this)}promise(){return ew.create(this,this._def)}or(e){return ea.create([this,e],this._def)}and(e){return ec.create(this,e,this._def)}transform(e){return new ex({...O(this._def),schema:this,typeName:tc.ZodEffects,effect:{type:"transform",transform:e}})}default(e){return new ek({...O(this._def),innerType:this,defaultValue:"function"==typeof e?e:()=>e,typeName:tc.ZodDefault})}brand(){return new ej({typeName:tc.ZodBranded,type:this,...O(this._def)})}catch(e){return new eI({...O(this._def),innerType:this,catchValue:"function"==typeof e?e:()=>e,typeName:tc.ZodCatch})}describe(e){return new this.constructor({...this._def,description:e})}pipe(e){return eC.create(this,e)}readonly(){return eR.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}let j=/^c[^\s-]{8,}$/i,C=/^[0-9a-z]+$/,R=/^[0-9A-HJKMNP-TV-Z]{26}$/i,A=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,P=/^[a-z0-9_-]{21}$/i,N=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,q=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,M=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,L=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,$=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,D=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,U=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,B=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,F=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,V="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",W=RegExp(`^${V}$`);function z(e){let t="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`),t}function Z(e){let t=`${V}T${z(e)}`,r=[];return r.push(e.local?"Z?":"Z"),e.offset&&r.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${r.join("|")})`,RegExp(`^${t}$`)}class J extends T{_parse(e){var t,r,i,l;let u;if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==o.string){let t=this._getOrReturnCtx(e);return h(t,{code:a.invalid_type,expected:o.string,received:t.parsedType}),m}let c=new f;for(let o of this._def.checks)if("min"===o.kind)e.data.length<o.value&&(h(u=this._getOrReturnCtx(e,u),{code:a.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),c.dirty());else if("max"===o.kind)e.data.length>o.value&&(h(u=this._getOrReturnCtx(e,u),{code:a.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),c.dirty());else if("length"===o.kind){let t=e.data.length>o.value,r=e.data.length<o.value;(t||r)&&(u=this._getOrReturnCtx(e,u),t?h(u,{code:a.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}):r&&h(u,{code:a.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}),c.dirty())}else if("email"===o.kind)M.test(e.data)||(h(u=this._getOrReturnCtx(e,u),{validation:"email",code:a.invalid_string,message:o.message}),c.dirty());else if("emoji"===o.kind)s||(s=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),s.test(e.data)||(h(u=this._getOrReturnCtx(e,u),{validation:"emoji",code:a.invalid_string,message:o.message}),c.dirty());else if("uuid"===o.kind)A.test(e.data)||(h(u=this._getOrReturnCtx(e,u),{validation:"uuid",code:a.invalid_string,message:o.message}),c.dirty());else if("nanoid"===o.kind)P.test(e.data)||(h(u=this._getOrReturnCtx(e,u),{validation:"nanoid",code:a.invalid_string,message:o.message}),c.dirty());else if("cuid"===o.kind)j.test(e.data)||(h(u=this._getOrReturnCtx(e,u),{validation:"cuid",code:a.invalid_string,message:o.message}),c.dirty());else if("cuid2"===o.kind)C.test(e.data)||(h(u=this._getOrReturnCtx(e,u),{validation:"cuid2",code:a.invalid_string,message:o.message}),c.dirty());else if("ulid"===o.kind)R.test(e.data)||(h(u=this._getOrReturnCtx(e,u),{validation:"ulid",code:a.invalid_string,message:o.message}),c.dirty());else if("url"===o.kind)try{new URL(e.data)}catch(t){h(u=this._getOrReturnCtx(e,u),{validation:"url",code:a.invalid_string,message:o.message}),c.dirty()}else"regex"===o.kind?(o.regex.lastIndex=0,o.regex.test(e.data)||(h(u=this._getOrReturnCtx(e,u),{validation:"regex",code:a.invalid_string,message:o.message}),c.dirty())):"trim"===o.kind?e.data=e.data.trim():"includes"===o.kind?e.data.includes(o.value,o.position)||(h(u=this._getOrReturnCtx(e,u),{code:a.invalid_string,validation:{includes:o.value,position:o.position},message:o.message}),c.dirty()):"toLowerCase"===o.kind?e.data=e.data.toLowerCase():"toUpperCase"===o.kind?e.data=e.data.toUpperCase():"startsWith"===o.kind?e.data.startsWith(o.value)||(h(u=this._getOrReturnCtx(e,u),{code:a.invalid_string,validation:{startsWith:o.value},message:o.message}),c.dirty()):"endsWith"===o.kind?e.data.endsWith(o.value)||(h(u=this._getOrReturnCtx(e,u),{code:a.invalid_string,validation:{endsWith:o.value},message:o.message}),c.dirty()):"datetime"===o.kind?Z(o).test(e.data)||(h(u=this._getOrReturnCtx(e,u),{code:a.invalid_string,validation:"datetime",message:o.message}),c.dirty()):"date"===o.kind?W.test(e.data)||(h(u=this._getOrReturnCtx(e,u),{code:a.invalid_string,validation:"date",message:o.message}),c.dirty()):"time"===o.kind?RegExp(`^${z(o)}$`).test(e.data)||(h(u=this._getOrReturnCtx(e,u),{code:a.invalid_string,validation:"time",message:o.message}),c.dirty()):"duration"===o.kind?q.test(e.data)||(h(u=this._getOrReturnCtx(e,u),{validation:"duration",code:a.invalid_string,message:o.message}),c.dirty()):"ip"===o.kind?(t=e.data,("v4"===(r=o.version)||!r)&&L.test(t)||("v6"===r||!r)&&D.test(t)||(h(u=this._getOrReturnCtx(e,u),{validation:"ip",code:a.invalid_string,message:o.message}),c.dirty())):"jwt"===o.kind?!function(e,t){if(!N.test(e))return!1;try{let[r]=e.split("."),s=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),o=JSON.parse(atob(s));if("object"!=typeof o||null===o||!o.typ||!o.alg||t&&o.alg!==t)return!1;return!0}catch(e){return!1}}(e.data,o.alg)&&(h(u=this._getOrReturnCtx(e,u),{validation:"jwt",code:a.invalid_string,message:o.message}),c.dirty()):"cidr"===o.kind?(i=e.data,("v4"===(l=o.version)||!l)&&$.test(i)||("v6"===l||!l)&&U.test(i)||(h(u=this._getOrReturnCtx(e,u),{validation:"cidr",code:a.invalid_string,message:o.message}),c.dirty())):"base64"===o.kind?B.test(e.data)||(h(u=this._getOrReturnCtx(e,u),{validation:"base64",code:a.invalid_string,message:o.message}),c.dirty()):"base64url"===o.kind?F.test(e.data)||(h(u=this._getOrReturnCtx(e,u),{validation:"base64url",code:a.invalid_string,message:o.message}),c.dirty()):to.assertNever(o);return{status:c.value,value:e.data}}_regex(e,t,r){return this.refinement(t=>e.test(t),{validation:t,code:a.invalid_string,...ta.errToObj(r)})}_addCheck(e){return new J({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...ta.errToObj(e)})}url(e){return this._addCheck({kind:"url",...ta.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...ta.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...ta.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...ta.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...ta.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...ta.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...ta.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...ta.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...ta.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...ta.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...ta.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...ta.errToObj(e)})}datetime(e){var t,r;return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,offset:null!==(t=null==e?void 0:e.offset)&&void 0!==t&&t,local:null!==(r=null==e?void 0:e.local)&&void 0!==r&&r,...ta.errToObj(null==e?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,...ta.errToObj(null==e?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...ta.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...ta.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:null==t?void 0:t.position,...ta.errToObj(null==t?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...ta.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...ta.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...ta.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...ta.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...ta.errToObj(t)})}nonempty(e){return this.min(1,ta.errToObj(e))}trim(){return new J({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new J({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new J({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isDate(){return!!this._def.checks.find(e=>"date"===e.kind)}get isTime(){return!!this._def.checks.find(e=>"time"===e.kind)}get isDuration(){return!!this._def.checks.find(e=>"duration"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isNANOID(){return!!this._def.checks.find(e=>"nanoid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get isCIDR(){return!!this._def.checks.find(e=>"cidr"===e.kind)}get isBase64(){return!!this._def.checks.find(e=>"base64"===e.kind)}get isBase64url(){return!!this._def.checks.find(e=>"base64url"===e.kind)}get minLength(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}J.create=e=>{var t;return new J({checks:[],typeName:tc.ZodString,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...O(e)})};class H extends T{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){let t;if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==o.number){let t=this._getOrReturnCtx(e);return h(t,{code:a.invalid_type,expected:o.number,received:t.parsedType}),m}let r=new f;for(let s of this._def.checks)"int"===s.kind?to.isInteger(e.data)||(h(t=this._getOrReturnCtx(e,t),{code:a.invalid_type,expected:"integer",received:"float",message:s.message}),r.dirty()):"min"===s.kind?(s.inclusive?e.data<s.value:e.data<=s.value)&&(h(t=this._getOrReturnCtx(e,t),{code:a.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),r.dirty()):"max"===s.kind?(s.inclusive?e.data>s.value:e.data>=s.value)&&(h(t=this._getOrReturnCtx(e,t),{code:a.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),r.dirty()):"multipleOf"===s.kind?0!==function(e,t){let r=(e.toString().split(".")[1]||"").length,s=(t.toString().split(".")[1]||"").length,o=r>s?r:s;return parseInt(e.toFixed(o).replace(".",""))%parseInt(t.toFixed(o).replace(".",""))/Math.pow(10,o)}(e.data,s.value)&&(h(t=this._getOrReturnCtx(e,t),{code:a.not_multiple_of,multipleOf:s.value,message:s.message}),r.dirty()):"finite"===s.kind?Number.isFinite(e.data)||(h(t=this._getOrReturnCtx(e,t),{code:a.not_finite,message:s.message}),r.dirty()):to.assertNever(s);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,ta.toString(t))}gt(e,t){return this.setLimit("min",e,!1,ta.toString(t))}lte(e,t){return this.setLimit("max",e,!0,ta.toString(t))}lt(e,t){return this.setLimit("max",e,!1,ta.toString(t))}setLimit(e,t,r,s){return new H({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:ta.toString(s)}]})}_addCheck(e){return new H({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:ta.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:ta.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:ta.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:ta.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:ta.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:ta.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:ta.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:ta.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:ta.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&to.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let r of this._def.checks){if("finite"===r.kind||"int"===r.kind||"multipleOf"===r.kind)return!0;"min"===r.kind?(null===t||r.value>t)&&(t=r.value):"max"===r.kind&&(null===e||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}H.create=e=>new H({checks:[],typeName:tc.ZodNumber,coerce:(null==e?void 0:e.coerce)||!1,...O(e)});class G extends T{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){let t;if(this._def.coerce)try{e.data=BigInt(e.data)}catch(t){return this._getInvalidInput(e)}if(this._getType(e)!==o.bigint)return this._getInvalidInput(e);let r=new f;for(let s of this._def.checks)"min"===s.kind?(s.inclusive?e.data<s.value:e.data<=s.value)&&(h(t=this._getOrReturnCtx(e,t),{code:a.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),r.dirty()):"max"===s.kind?(s.inclusive?e.data>s.value:e.data>=s.value)&&(h(t=this._getOrReturnCtx(e,t),{code:a.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),r.dirty()):"multipleOf"===s.kind?e.data%s.value!==BigInt(0)&&(h(t=this._getOrReturnCtx(e,t),{code:a.not_multiple_of,multipleOf:s.value,message:s.message}),r.dirty()):to.assertNever(s);return{status:r.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return h(t,{code:a.invalid_type,expected:o.bigint,received:t.parsedType}),m}gte(e,t){return this.setLimit("min",e,!0,ta.toString(t))}gt(e,t){return this.setLimit("min",e,!1,ta.toString(t))}lte(e,t){return this.setLimit("max",e,!0,ta.toString(t))}lt(e,t){return this.setLimit("max",e,!1,ta.toString(t))}setLimit(e,t,r,s){return new G({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:ta.toString(s)}]})}_addCheck(e){return new G({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:ta.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:ta.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:ta.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:ta.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:ta.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}G.create=e=>{var t;return new G({checks:[],typeName:tc.ZodBigInt,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...O(e)})};class Y extends T{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==o.boolean){let t=this._getOrReturnCtx(e);return h(t,{code:a.invalid_type,expected:o.boolean,received:t.parsedType}),m}return y(e.data)}}Y.create=e=>new Y({typeName:tc.ZodBoolean,coerce:(null==e?void 0:e.coerce)||!1,...O(e)});class K extends T{_parse(e){let t;if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==o.date){let t=this._getOrReturnCtx(e);return h(t,{code:a.invalid_type,expected:o.date,received:t.parsedType}),m}if(isNaN(e.data.getTime()))return h(this._getOrReturnCtx(e),{code:a.invalid_date}),m;let r=new f;for(let s of this._def.checks)"min"===s.kind?e.data.getTime()<s.value&&(h(t=this._getOrReturnCtx(e,t),{code:a.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),r.dirty()):"max"===s.kind?e.data.getTime()>s.value&&(h(t=this._getOrReturnCtx(e,t),{code:a.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),r.dirty()):to.assertNever(s);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new K({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:ta.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:ta.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}K.create=e=>new K({checks:[],coerce:(null==e?void 0:e.coerce)||!1,typeName:tc.ZodDate,...O(e)});class Q extends T{_parse(e){if(this._getType(e)!==o.symbol){let t=this._getOrReturnCtx(e);return h(t,{code:a.invalid_type,expected:o.symbol,received:t.parsedType}),m}return y(e.data)}}Q.create=e=>new Q({typeName:tc.ZodSymbol,...O(e)});class X extends T{_parse(e){if(this._getType(e)!==o.undefined){let t=this._getOrReturnCtx(e);return h(t,{code:a.invalid_type,expected:o.undefined,received:t.parsedType}),m}return y(e.data)}}X.create=e=>new X({typeName:tc.ZodUndefined,...O(e)});class ee extends T{_parse(e){if(this._getType(e)!==o.null){let t=this._getOrReturnCtx(e);return h(t,{code:a.invalid_type,expected:o.null,received:t.parsedType}),m}return y(e.data)}}ee.create=e=>new ee({typeName:tc.ZodNull,...O(e)});class et extends T{constructor(){super(...arguments),this._any=!0}_parse(e){return y(e.data)}}et.create=e=>new et({typeName:tc.ZodAny,...O(e)});class er extends T{constructor(){super(...arguments),this._unknown=!0}_parse(e){return y(e.data)}}er.create=e=>new er({typeName:tc.ZodUnknown,...O(e)});class es extends T{_parse(e){let t=this._getOrReturnCtx(e);return h(t,{code:a.invalid_type,expected:o.never,received:t.parsedType}),m}}es.create=e=>new es({typeName:tc.ZodNever,...O(e)});class en extends T{_parse(e){if(this._getType(e)!==o.undefined){let t=this._getOrReturnCtx(e);return h(t,{code:a.invalid_type,expected:o.void,received:t.parsedType}),m}return y(e.data)}}en.create=e=>new en({typeName:tc.ZodVoid,...O(e)});class eo extends T{_parse(e){let{ctx:t,status:r}=this._processInputParams(e),s=this._def;if(t.parsedType!==o.array)return h(t,{code:a.invalid_type,expected:o.array,received:t.parsedType}),m;if(null!==s.exactLength){let e=t.data.length>s.exactLength.value,o=t.data.length<s.exactLength.value;(e||o)&&(h(t,{code:e?a.too_big:a.too_small,minimum:o?s.exactLength.value:void 0,maximum:e?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),r.dirty())}if(null!==s.minLength&&t.data.length<s.minLength.value&&(h(t,{code:a.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),r.dirty()),null!==s.maxLength&&t.data.length>s.maxLength.value&&(h(t,{code:a.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((e,r)=>s.type._parseAsync(new k(t,e,t.path,r)))).then(e=>f.mergeArray(r,e));let i=[...t.data].map((e,r)=>s.type._parseSync(new k(t,e,t.path,r)));return f.mergeArray(r,i)}get element(){return this._def.type}min(e,t){return new eo({...this._def,minLength:{value:e,message:ta.toString(t)}})}max(e,t){return new eo({...this._def,maxLength:{value:e,message:ta.toString(t)}})}length(e,t){return new eo({...this._def,exactLength:{value:e,message:ta.toString(t)}})}nonempty(e){return this.min(1,e)}}eo.create=(e,t)=>new eo({type:e,minLength:null,maxLength:null,exactLength:null,typeName:tc.ZodArray,...O(t)});class ei extends T{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;let e=this._def.shape(),t=to.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==o.object){let t=this._getOrReturnCtx(e);return h(t,{code:a.invalid_type,expected:o.object,received:t.parsedType}),m}let{status:t,ctx:r}=this._processInputParams(e),{shape:s,keys:i}=this._getCached(),l=[];if(!(this._def.catchall instanceof es&&"strip"===this._def.unknownKeys))for(let e in r.data)i.includes(e)||l.push(e);let u=[];for(let e of i){let t=s[e],o=r.data[e];u.push({key:{status:"valid",value:e},value:t._parse(new k(r,o,r.path,e)),alwaysSet:e in r.data})}if(this._def.catchall instanceof es){let e=this._def.unknownKeys;if("passthrough"===e)for(let e of l)u.push({key:{status:"valid",value:e},value:{status:"valid",value:r.data[e]}});else if("strict"===e)l.length>0&&(h(r,{code:a.unrecognized_keys,keys:l}),t.dirty());else if("strip"===e);else throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let e=this._def.catchall;for(let t of l){let s=r.data[t];u.push({key:{status:"valid",value:t},value:e._parse(new k(r,s,r.path,t)),alwaysSet:t in r.data})}}return r.common.async?Promise.resolve().then(async()=>{let e=[];for(let t of u){let r=await t.key,s=await t.value;e.push({key:r,value:s,alwaysSet:t.alwaysSet})}return e}).then(e=>f.mergeObjectSync(t,e)):f.mergeObjectSync(t,u)}get shape(){return this._def.shape()}strict(e){return ta.errToObj,new ei({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,r)=>{var s,o,i,a;let l=null!==(i=null===(o=(s=this._def).errorMap)||void 0===o?void 0:o.call(s,t,r).message)&&void 0!==i?i:r.defaultError;return"unrecognized_keys"===t.code?{message:null!==(a=ta.errToObj(e).message)&&void 0!==a?a:l}:{message:l}}}:{}})}strip(){return new ei({...this._def,unknownKeys:"strip"})}passthrough(){return new ei({...this._def,unknownKeys:"passthrough"})}extend(e){return new ei({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new ei({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:tc.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new ei({...this._def,catchall:e})}pick(e){let t={};return to.objectKeys(e).forEach(r=>{e[r]&&this.shape[r]&&(t[r]=this.shape[r])}),new ei({...this._def,shape:()=>t})}omit(e){let t={};return to.objectKeys(this.shape).forEach(r=>{e[r]||(t[r]=this.shape[r])}),new ei({...this._def,shape:()=>t})}deepPartial(){return function e(t){if(t instanceof ei){let r={};for(let s in t.shape){let o=t.shape[s];r[s]=eS.create(e(o))}return new ei({...t._def,shape:()=>r})}return t instanceof eo?new eo({...t._def,type:e(t.element)}):t instanceof eS?eS.create(e(t.unwrap())):t instanceof eE?eE.create(e(t.unwrap())):t instanceof ed?ed.create(t.items.map(t=>e(t))):t}(this)}partial(e){let t={};return to.objectKeys(this.shape).forEach(r=>{let s=this.shape[r];e&&!e[r]?t[r]=s:t[r]=s.optional()}),new ei({...this._def,shape:()=>t})}required(e){let t={};return to.objectKeys(this.shape).forEach(r=>{if(e&&!e[r])t[r]=this.shape[r];else{let e=this.shape[r];for(;e instanceof eS;)e=e._def.innerType;t[r]=e}}),new ei({...this._def,shape:()=>t})}keyof(){return eb(to.objectKeys(this.shape))}}ei.create=(e,t)=>new ei({shape:()=>e,unknownKeys:"strip",catchall:es.create(),typeName:tc.ZodObject,...O(t)}),ei.strictCreate=(e,t)=>new ei({shape:()=>e,unknownKeys:"strict",catchall:es.create(),typeName:tc.ZodObject,...O(t)}),ei.lazycreate=(e,t)=>new ei({shape:e,unknownKeys:"strip",catchall:es.create(),typeName:tc.ZodObject,...O(t)});class ea extends T{_parse(e){let{ctx:t}=this._processInputParams(e),r=this._def.options;if(t.common.async)return Promise.all(r.map(async e=>{let r={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:r}),ctx:r}})).then(function(e){for(let t of e)if("valid"===t.result.status)return t.result;for(let r of e)if("dirty"===r.result.status)return t.common.issues.push(...r.ctx.common.issues),r.result;let r=e.map(e=>new l(e.ctx.common.issues));return h(t,{code:a.invalid_union,unionErrors:r}),m});{let e;let s=[];for(let o of r){let r={...t,common:{...t.common,issues:[]},parent:null},i=o._parseSync({data:t.data,path:t.path,parent:r});if("valid"===i.status)return i;"dirty"!==i.status||e||(e={result:i,ctx:r}),r.common.issues.length&&s.push(r.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;let o=s.map(e=>new l(e));return h(t,{code:a.invalid_union,unionErrors:o}),m}}get options(){return this._def.options}}ea.create=(e,t)=>new ea({options:e,typeName:tc.ZodUnion,...O(t)});let el=e=>{if(e instanceof eg)return el(e.schema);if(e instanceof ex)return el(e.innerType());if(e instanceof ey)return[e.value];if(e instanceof e_)return e.options;if(e instanceof ev)return to.objectValues(e.enum);if(e instanceof ek)return el(e._def.innerType);if(e instanceof X)return[void 0];else if(e instanceof ee)return[null];else if(e instanceof eS)return[void 0,...el(e.unwrap())];else if(e instanceof eE)return[null,...el(e.unwrap())];else if(e instanceof ej)return el(e.unwrap());else if(e instanceof eR)return el(e.unwrap());else if(e instanceof eI)return el(e._def.innerType);else return[]};class eu extends T{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==o.object)return h(t,{code:a.invalid_type,expected:o.object,received:t.parsedType}),m;let r=this.discriminator,s=t.data[r],i=this.optionsMap.get(s);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(h(t,{code:a.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),m)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){let s=new Map;for(let r of t){let t=el(r.shape[e]);if(!t.length)throw Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let o of t){if(s.has(o))throw Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);s.set(o,r)}}return new eu({typeName:tc.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:s,...O(r)})}}class ec extends T{_parse(e){let{status:t,ctx:r}=this._processInputParams(e),s=(e,s)=>{if(b(e)||b(s))return m;let l=function e(t,r){let s=i(t),a=i(r);if(t===r)return{valid:!0,data:t};if(s===o.object&&a===o.object){let s=to.objectKeys(r),o=to.objectKeys(t).filter(e=>-1!==s.indexOf(e)),i={...t,...r};for(let s of o){let o=e(t[s],r[s]);if(!o.valid)return{valid:!1};i[s]=o.data}return{valid:!0,data:i}}if(s===o.array&&a===o.array){if(t.length!==r.length)return{valid:!1};let s=[];for(let o=0;o<t.length;o++){let i=e(t[o],r[o]);if(!i.valid)return{valid:!1};s.push(i.data)}return{valid:!0,data:s}}return s===o.date&&a===o.date&&+t==+r?{valid:!0,data:t}:{valid:!1}}(e.value,s.value);return l.valid?((_(e)||_(s))&&t.dirty(),{status:t.value,value:l.data}):(h(r,{code:a.invalid_intersection_types}),m)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([e,t])=>s(e,t)):s(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}ec.create=(e,t,r)=>new ec({left:e,right:t,typeName:tc.ZodIntersection,...O(r)});class ed extends T{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==o.array)return h(r,{code:a.invalid_type,expected:o.array,received:r.parsedType}),m;if(r.data.length<this._def.items.length)return h(r,{code:a.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),m;!this._def.rest&&r.data.length>this._def.items.length&&(h(r,{code:a.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let s=[...r.data].map((e,t)=>{let s=this._def.items[t]||this._def.rest;return s?s._parse(new k(r,e,r.path,t)):null}).filter(e=>!!e);return r.common.async?Promise.all(s).then(e=>f.mergeArray(t,e)):f.mergeArray(t,s)}get items(){return this._def.items}rest(e){return new ed({...this._def,rest:e})}}ed.create=(e,t)=>{if(!Array.isArray(e))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new ed({items:e,typeName:tc.ZodTuple,rest:null,...O(t)})};class ep extends T{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==o.object)return h(r,{code:a.invalid_type,expected:o.object,received:r.parsedType}),m;let s=[],i=this._def.keyType,l=this._def.valueType;for(let e in r.data)s.push({key:i._parse(new k(r,e,r.path,e)),value:l._parse(new k(r,r.data[e],r.path,e)),alwaysSet:e in r.data});return r.common.async?f.mergeObjectAsync(t,s):f.mergeObjectSync(t,s)}get element(){return this._def.valueType}static create(e,t,r){return new ep(t instanceof T?{keyType:e,valueType:t,typeName:tc.ZodRecord,...O(r)}:{keyType:J.create(),valueType:e,typeName:tc.ZodRecord,...O(t)})}}class eh extends T{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==o.map)return h(r,{code:a.invalid_type,expected:o.map,received:r.parsedType}),m;let s=this._def.keyType,i=this._def.valueType,l=[...r.data.entries()].map(([e,t],o)=>({key:s._parse(new k(r,e,r.path,[o,"key"])),value:i._parse(new k(r,t,r.path,[o,"value"]))}));if(r.common.async){let e=new Map;return Promise.resolve().then(async()=>{for(let r of l){let s=await r.key,o=await r.value;if("aborted"===s.status||"aborted"===o.status)return m;("dirty"===s.status||"dirty"===o.status)&&t.dirty(),e.set(s.value,o.value)}return{status:t.value,value:e}})}{let e=new Map;for(let r of l){let s=r.key,o=r.value;if("aborted"===s.status||"aborted"===o.status)return m;("dirty"===s.status||"dirty"===o.status)&&t.dirty(),e.set(s.value,o.value)}return{status:t.value,value:e}}}}eh.create=(e,t,r)=>new eh({valueType:t,keyType:e,typeName:tc.ZodMap,...O(r)});class ef extends T{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==o.set)return h(r,{code:a.invalid_type,expected:o.set,received:r.parsedType}),m;let s=this._def;null!==s.minSize&&r.data.size<s.minSize.value&&(h(r,{code:a.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),null!==s.maxSize&&r.data.size>s.maxSize.value&&(h(r,{code:a.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());let i=this._def.valueType;function l(e){let r=new Set;for(let s of e){if("aborted"===s.status)return m;"dirty"===s.status&&t.dirty(),r.add(s.value)}return{status:t.value,value:r}}let u=[...r.data.values()].map((e,t)=>i._parse(new k(r,e,r.path,t)));return r.common.async?Promise.all(u).then(e=>l(e)):l(u)}min(e,t){return new ef({...this._def,minSize:{value:e,message:ta.toString(t)}})}max(e,t){return new ef({...this._def,maxSize:{value:e,message:ta.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}ef.create=(e,t)=>new ef({valueType:e,minSize:null,maxSize:null,typeName:tc.ZodSet,...O(t)});class em extends T{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==o.function)return h(t,{code:a.invalid_type,expected:o.function,received:t.parsedType}),m;function r(e,r){return p({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,d(),u].filter(e=>!!e),issueData:{code:a.invalid_arguments,argumentsError:r}})}function s(e,r){return p({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,d(),u].filter(e=>!!e),issueData:{code:a.invalid_return_type,returnTypeError:r}})}let i={errorMap:t.common.contextualErrorMap},c=t.data;if(this._def.returns instanceof ew){let e=this;return y(async function(...t){let o=new l([]),a=await e._def.args.parseAsync(t,i).catch(e=>{throw o.addIssue(r(t,e)),o}),u=await Reflect.apply(c,this,a);return await e._def.returns._def.type.parseAsync(u,i).catch(e=>{throw o.addIssue(s(u,e)),o})})}{let e=this;return y(function(...t){let o=e._def.args.safeParse(t,i);if(!o.success)throw new l([r(t,o.error)]);let a=Reflect.apply(c,this,o.data),u=e._def.returns.safeParse(a,i);if(!u.success)throw new l([s(a,u.error)]);return u.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new em({...this._def,args:ed.create(e).rest(er.create())})}returns(e){return new em({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new em({args:e||ed.create([]).rest(er.create()),returns:t||er.create(),typeName:tc.ZodFunction,...O(r)})}}class eg extends T{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}eg.create=(e,t)=>new eg({getter:e,typeName:tc.ZodLazy,...O(t)});class ey extends T{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return h(t,{received:t.data,code:a.invalid_literal,expected:this._def.value}),m}return{status:"valid",value:e.data}}get value(){return this._def.value}}function eb(e,t){return new e_({values:e,typeName:tc.ZodEnum,...O(t)})}ey.create=(e,t)=>new ey({value:e,typeName:tc.ZodLiteral,...O(t)});class e_ extends T{constructor(){super(...arguments),tl.set(this,void 0)}_parse(e){if("string"!=typeof e.data){let t=this._getOrReturnCtx(e),r=this._def.values;return h(t,{expected:to.joinValues(r),received:t.parsedType,code:a.invalid_type}),m}if(S(this,tl,"f")||E(this,tl,new Set(this._def.values),"f"),!S(this,tl,"f").has(e.data)){let t=this._getOrReturnCtx(e),r=this._def.values;return h(t,{received:t.data,code:a.invalid_enum_value,options:r}),m}return y(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return e_.create(e,{...this._def,...t})}exclude(e,t=this._def){return e_.create(this.options.filter(t=>!e.includes(t)),{...this._def,...t})}}tl=new WeakMap,e_.create=eb;class ev extends T{constructor(){super(...arguments),tu.set(this,void 0)}_parse(e){let t=to.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==o.string&&r.parsedType!==o.number){let e=to.objectValues(t);return h(r,{expected:to.joinValues(e),received:r.parsedType,code:a.invalid_type}),m}if(S(this,tu,"f")||E(this,tu,new Set(to.getValidEnumValues(this._def.values)),"f"),!S(this,tu,"f").has(e.data)){let e=to.objectValues(t);return h(r,{received:r.data,code:a.invalid_enum_value,options:e}),m}return y(e.data)}get enum(){return this._def.values}}tu=new WeakMap,ev.create=(e,t)=>new ev({values:e,typeName:tc.ZodNativeEnum,...O(t)});class ew extends T{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);return t.parsedType!==o.promise&&!1===t.common.async?(h(t,{code:a.invalid_type,expected:o.promise,received:t.parsedType}),m):y((t.parsedType===o.promise?t.data:Promise.resolve(t.data)).then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}ew.create=(e,t)=>new ew({type:e,typeName:tc.ZodPromise,...O(t)});class ex extends T{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===tc.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:r}=this._processInputParams(e),s=this._def.effect||null,o={addIssue:e=>{h(r,e),e.fatal?t.abort():t.dirty()},get path(){return r.path}};if(o.addIssue=o.addIssue.bind(o),"preprocess"===s.type){let e=s.transform(r.data,o);if(r.common.async)return Promise.resolve(e).then(async e=>{if("aborted"===t.value)return m;let s=await this._def.schema._parseAsync({data:e,path:r.path,parent:r});return"aborted"===s.status?m:"dirty"===s.status||"dirty"===t.value?g(s.value):s});{if("aborted"===t.value)return m;let s=this._def.schema._parseSync({data:e,path:r.path,parent:r});return"aborted"===s.status?m:"dirty"===s.status||"dirty"===t.value?g(s.value):s}}if("refinement"===s.type){let e=e=>{let t=s.refinement(e,o);if(r.common.async)return Promise.resolve(t);if(t instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(r=>"aborted"===r.status?m:("dirty"===r.status&&t.dirty(),e(r.value).then(()=>({status:t.value,value:r.value}))));{let s=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===s.status?m:("dirty"===s.status&&t.dirty(),e(s.value),{status:t.value,value:s.value})}}if("transform"===s.type){if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(e=>v(e)?Promise.resolve(s.transform(e.value,o)).then(e=>({status:t.value,value:e})):e);{let e=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!v(e))return e;let i=s.transform(e.value,o);if(i instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:i}}}to.assertNever(s)}}ex.create=(e,t,r)=>new ex({schema:e,typeName:tc.ZodEffects,effect:t,...O(r)}),ex.createWithPreprocess=(e,t,r)=>new ex({schema:t,effect:{type:"preprocess",transform:e},typeName:tc.ZodEffects,...O(r)});class eS extends T{_parse(e){return this._getType(e)===o.undefined?y(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}eS.create=(e,t)=>new eS({innerType:e,typeName:tc.ZodOptional,...O(t)});class eE extends T{_parse(e){return this._getType(e)===o.null?y(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}eE.create=(e,t)=>new eE({innerType:e,typeName:tc.ZodNullable,...O(t)});class ek extends T{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return t.parsedType===o.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}ek.create=(e,t)=>new ek({innerType:e,typeName:tc.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...O(t)});class eI extends T{_parse(e){let{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return w(s)?s.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new l(r.common.issues)},input:r.data})})):{status:"valid",value:"valid"===s.status?s.value:this._def.catchValue({get error(){return new l(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}eI.create=(e,t)=>new eI({innerType:e,typeName:tc.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...O(t)});class eO extends T{_parse(e){if(this._getType(e)!==o.nan){let t=this._getOrReturnCtx(e);return h(t,{code:a.invalid_type,expected:o.nan,received:t.parsedType}),m}return{status:"valid",value:e.data}}}eO.create=e=>new eO({typeName:tc.ZodNaN,...O(e)});let eT=Symbol("zod_brand");class ej extends T{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class eC extends T{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{let e=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?m:"dirty"===e.status?(t.dirty(),g(e.value)):this._def.out._parseAsync({data:e.value,path:r.path,parent:r})})();{let e=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?m:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:r.path,parent:r})}}static create(e,t){return new eC({in:e,out:t,typeName:tc.ZodPipeline})}}class eR extends T{_parse(e){let t=this._def.innerType._parse(e),r=e=>(v(e)&&(e.value=Object.freeze(e.value)),e);return w(t)?t.then(e=>r(e)):r(t)}unwrap(){return this._def.innerType}}function eA(e,t){let r="function"==typeof e?e(t):"string"==typeof e?{message:e}:e;return"string"==typeof r?{message:r}:r}function eP(e,t={},r){return e?et.create().superRefine((s,o)=>{var i,a;let l=e(s);if(l instanceof Promise)return l.then(e=>{var i,a;if(!e){let e=eA(t,s),l=null===(a=null!==(i=e.fatal)&&void 0!==i?i:r)||void 0===a||a;o.addIssue({code:"custom",...e,fatal:l})}});if(!l){let e=eA(t,s),l=null===(a=null!==(i=e.fatal)&&void 0!==i?i:r)||void 0===a||a;o.addIssue({code:"custom",...e,fatal:l})}}):et.create()}eR.create=(e,t)=>new eR({innerType:e,typeName:tc.ZodReadonly,...O(t)});let eN={object:ei.lazycreate};!function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(tc||(tc={}));let eq=J.create,eM=H.create,eL=eO.create,e$=G.create,eD=Y.create,eU=K.create,eB=Q.create,eF=X.create,eV=ee.create,eW=et.create,ez=er.create,eZ=es.create,eJ=en.create,eH=eo.create,eG=ei.create,eY=ei.strictCreate,eK=ea.create,eQ=eu.create,eX=ec.create,e0=ed.create,e1=ep.create,e2=eh.create,e3=ef.create,e4=em.create,e8=eg.create,e6=ey.create,e9=e_.create,e5=ev.create,e7=ew.create,te=ex.create,tt=eS.create,tr=eE.create,ts=ex.createWithPreprocess,tn=eC.create;var to,ti,ta,tl,tu,tc,td=Object.freeze({__proto__:null,defaultErrorMap:u,setErrorMap:function(e){c=e},getErrorMap:d,makeIssue:p,EMPTY_PATH:[],addIssueToContext:h,ParseStatus:f,INVALID:m,DIRTY:g,OK:y,isAborted:b,isDirty:_,isValid:v,isAsync:w,get util(){return to},get objectUtil(){return ti},ZodParsedType:o,getParsedType:i,ZodType:T,datetimeRegex:Z,ZodString:J,ZodNumber:H,ZodBigInt:G,ZodBoolean:Y,ZodDate:K,ZodSymbol:Q,ZodUndefined:X,ZodNull:ee,ZodAny:et,ZodUnknown:er,ZodNever:es,ZodVoid:en,ZodArray:eo,ZodObject:ei,ZodUnion:ea,ZodDiscriminatedUnion:eu,ZodIntersection:ec,ZodTuple:ed,ZodRecord:ep,ZodMap:eh,ZodSet:ef,ZodFunction:em,ZodLazy:eg,ZodLiteral:ey,ZodEnum:e_,ZodNativeEnum:ev,ZodPromise:ew,ZodEffects:ex,ZodTransformer:ex,ZodOptional:eS,ZodNullable:eE,ZodDefault:ek,ZodCatch:eI,ZodNaN:eO,BRAND:eT,ZodBranded:ej,ZodPipeline:eC,ZodReadonly:eR,custom:eP,Schema:T,ZodSchema:T,late:eN,get ZodFirstPartyTypeKind(){return tc},coerce:{string:e=>J.create({...e,coerce:!0}),number:e=>H.create({...e,coerce:!0}),boolean:e=>Y.create({...e,coerce:!0}),bigint:e=>G.create({...e,coerce:!0}),date:e=>K.create({...e,coerce:!0})},any:eW,array:eH,bigint:e$,boolean:eD,date:eU,discriminatedUnion:eQ,effect:te,enum:e9,function:e4,instanceof:(e,t={message:`Input not instance of ${e.name}`})=>eP(t=>t instanceof e,t),intersection:eX,lazy:e8,literal:e6,map:e2,nan:eL,nativeEnum:e5,never:eZ,null:eV,nullable:tr,number:eM,object:eG,oboolean:()=>eD().optional(),onumber:()=>eM().optional(),optional:tt,ostring:()=>eq().optional(),pipeline:tn,preprocess:ts,promise:e7,record:e1,set:e3,strictObject:eY,string:eq,symbol:eB,transformer:te,tuple:e0,undefined:eF,union:eK,unknown:ez,void:eJ,NEVER:m,ZodIssueCode:a,quotelessJson:e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:"),ZodError:l})},26363:(e,t,r)=>{"use strict";r.d(t,{e:()=>N});var s=r(82337),o=r(82630),i=r(72254),a=r(12273),l=r(74539);class u{#eR;#eA;#eP;#eN;closed;protocol;constructor(e,t,r,s){this.#eR=e,this.#eA=t,this.#eP=r,this.#eN=s,this.closed=!1,this.protocol="file"}async execute(e,t){let r;return r="string"==typeof e?{sql:e,args:t||[]}:e,this.#eq(),d(this.#eM(),r,this.#eN)}async batch(e,t="deferred"){this.#eq();let r=this.#eM();try{d(r,(0,l.transactionModeToBegin)(t),this.#eN);let s=e.map(e=>{if(!r.inTransaction)throw new a.LibsqlError("The transaction has been rolled back","TRANSACTION_CLOSED");return d(r,e,this.#eN)});return d(r,"COMMIT",this.#eN),s}finally{r.inTransaction&&d(r,"ROLLBACK",this.#eN)}}async migrate(e){this.#eq();let t=this.#eM();try{d(t,"PRAGMA foreign_keys=off",this.#eN),d(t,(0,l.transactionModeToBegin)("deferred"),this.#eN);let r=e.map(e=>{if(!t.inTransaction)throw new a.LibsqlError("The transaction has been rolled back","TRANSACTION_CLOSED");return d(t,e,this.#eN)});return d(t,"COMMIT",this.#eN),r}finally{t.inTransaction&&d(t,"ROLLBACK",this.#eN),d(t,"PRAGMA foreign_keys=on",this.#eN)}}async transaction(e="write"){let t=this.#eM();return d(t,(0,l.transactionModeToBegin)(e),this.#eN),this.#eP=null,new c(t,this.#eN)}async executeMultiple(e){this.#eq();let t=this.#eM();try{return y(t,e)}finally{t.inTransaction&&d(t,"ROLLBACK",this.#eN)}}async sync(){this.#eq();let e=await this.#eM().sync();return{frames_synced:e.frames_synced,frame_no:e.frame_no}}close(){this.closed=!0,null!==this.#eP&&this.#eP.close()}#eq(){if(this.closed)throw new a.LibsqlError("The client is closed","CLIENT_CLOSED")}#eM(){return null===this.#eP&&(this.#eP=new o(this.#eR,this.#eA)),this.#eP}}class c{#eL;#eN;constructor(e,t){this.#eL=e,this.#eN=t}async execute(e,t){let r;return r="string"==typeof e?{sql:e,args:t||[]}:e,this.#eq(),d(this.#eL,r,this.#eN)}async batch(e){return e.map(e=>(this.#eq(),d(this.#eL,e,this.#eN)))}async executeMultiple(e){return this.#eq(),y(this.#eL,e)}async rollback(){this.#eL.open&&(this.#eq(),d(this.#eL,"ROLLBACK",this.#eN))}async commit(){this.#eq(),d(this.#eL,"COMMIT",this.#eN)}close(){this.#eL.inTransaction&&d(this.#eL,"ROLLBACK",this.#eN)}get closed(){return!this.#eL.inTransaction}#eq(){if(this.closed)throw new a.LibsqlError("The transaction is closed","TRANSACTION_CLOSED")}}function d(e,t,r){let s,o;if("string"==typeof t)s=t,o=[];else if(s=t.sql,Array.isArray(t.args))o=t.args.map(e=>f(e,r));else for(let e in o={},t.args)o["@"===e[0]||"$"===e[0]||":"===e[0]?e.substring(1):e]=f(t.args[e],r);try{let t=e.prepare(s);t.safeIntegers(!0);let a=!0;try{t.raw(!0)}catch{a=!1}if(a){let e=Array.from(t.columns().map(e=>e.name)),s=Array.from(t.columns().map(e=>e.type??"")),a=t.all(o).map(t=>(function(e,t,r){let s={};Object.defineProperty(s,"length",{value:e.length});for(let o=0;o<e.length;++o){let a=function(e,t){if("bigint"==typeof e){if("number"===t){if(e<p||e>h)throw RangeError("Received integer which cannot be safely represented as a JavaScript number");return Number(e)}if("bigint"===t);else if("string"===t)return""+e;else throw Error("Invalid value for IntMode")}else if(e instanceof i.Buffer)return e.buffer;return e}(e[o],r);Object.defineProperty(s,o,{value:a});let l=t[o];Object.hasOwn(s,l)||Object.defineProperty(s,l,{value:a,enumerable:!0,configurable:!0,writable:!0})}return s})(t,e,r));return new l.ResultSetImpl(e,s,a,0,void 0)}{let e=t.run(o),r=e.changes,s=BigInt(e.lastInsertRowid);return new l.ResultSetImpl([],[],[],r,s)}}catch(e){throw b(e)}}let p=-9007199254740991n,h=9007199254740991n;function f(e,t){if("number"==typeof e){if(!Number.isFinite(e))throw RangeError("Only finite numbers (not Infinity or NaN) can be passed as arguments");return e}if("bigint"==typeof e){if(e<m||e>g)throw RangeError("bigint is too large to be represented as a 64-bit integer and passed as argument");return e}if("boolean"==typeof e)switch(t){case"bigint":return e?1n:0n;case"string":return e?"1":"0";default:return e?1:0}else if(e instanceof ArrayBuffer)return i.Buffer.from(e);else if(e instanceof Date)return e.valueOf();else if(void 0!==e)return e;else throw TypeError("undefined cannot be passed as argument to the database")}let m=-0x8000000000000000n,g=0x7fffffffffffffffn;function y(e,t){try{e.exec(t)}catch(e){throw b(e)}}function b(e){return e instanceof o.SqliteError?new a.LibsqlError(e.message,e.code,e.rawCode,e):e}var _=r(12551);class v{#eS;#eE;#ek;constructor(e,t){this.#eS=e,this.#eE=t,this.#ek=void 0}execute(e){return this.batch([e]).then(e=>e[0])}async batch(e){let t=this._getStream();if(t.closed)throw new a.LibsqlError("Cannot execute statements because the transaction is closed","TRANSACTION_CLOSED");try{let r;let s=e.map(S);if(void 0===this.#ek){this._getSqlCache().apply(s);let e=t.batch(this.#eE>=3),o=e.step(),i=o.run((0,l.transactionModeToBegin)(this.#eS)),a=o;r=s.map(t=>{let r=e.step().condition(_.BatchCond.ok(a));this.#eE>=3&&r.condition(_.BatchCond.not(_.BatchCond.isAutocommit(e)));let s=r.query(t);return s.catch(()=>void 0),a=r,s}),this.#ek=e.execute().then(()=>i).then(()=>void 0);try{await this.#ek}catch(e){throw this.close(),e}}else{let e;this.#eE<3&&await this.#ek,this._getSqlCache().apply(s);let o=t.batch(this.#eE>=3);r=s.map(t=>{let r=o.step();void 0!==e&&r.condition(_.BatchCond.ok(e)),this.#eE>=3&&r.condition(_.BatchCond.not(_.BatchCond.isAutocommit(o)));let s=r.query(t);return s.catch(()=>void 0),e=r,s}),await o.execute()}let o=[];for(let e of r){let t=await e;if(void 0===t)throw new a.LibsqlError("Statement in a transaction was not executed, probably because the transaction has been rolled back","TRANSACTION_CLOSED");o.push(E(t))}return o}catch(e){throw k(e)}}async executeMultiple(e){let t=this._getStream();if(t.closed)throw new a.LibsqlError("Cannot execute statements because the transaction is closed","TRANSACTION_CLOSED");try{if(void 0===this.#ek){this.#ek=t.run((0,l.transactionModeToBegin)(this.#eS)).then(()=>void 0);try{await this.#ek}catch(e){throw this.close(),e}}else await this.#ek;await t.sequence(e)}catch(e){throw k(e)}}async rollback(){try{let e=this._getStream();if(e.closed||void 0===this.#ek)return;let t=e.run("ROLLBACK").catch(e=>{throw k(e)});e.closeGracefully(),await t}catch(e){throw k(e)}finally{this.close()}}async commit(){try{let e=this._getStream();if(e.closed)throw new a.LibsqlError("Cannot commit the transaction because it is already closed","TRANSACTION_CLOSED");if(void 0===this.#ek)return;await this.#ek;let t=e.run("COMMIT").catch(e=>{throw k(e)});e.closeGracefully(),await t}catch(e){throw k(e)}finally{this.close()}}}async function w(e,t,r,s,o=!1){o&&r.step().run("PRAGMA foreign_keys=off");let i=r.step(),u=i.run((0,l.transactionModeToBegin)(e)),c=i,d=s.map(e=>{let s=r.step().condition(_.BatchCond.ok(c));t>=3&&s.condition(_.BatchCond.not(_.BatchCond.isAutocommit(r)));let o=s.query(e);return c=s,o}),p=r.step().condition(_.BatchCond.ok(c));t>=3&&p.condition(_.BatchCond.not(_.BatchCond.isAutocommit(r)));let h=p.run("COMMIT");r.step().condition(_.BatchCond.not(_.BatchCond.ok(p))).run("ROLLBACK").catch(e=>void 0),o&&r.step().run("PRAGMA foreign_keys=on"),await r.execute();let f=[];for(let e of(await u,d)){let t=await e;if(void 0===t)throw new a.LibsqlError("Statement in a batch was not executed, probably because the transaction has been rolled back","TRANSACTION_CLOSED");f.push(E(t))}return await h,f}function S(e){if("string"==typeof e)return new _.Stmt(e);let t=new _.Stmt(e.sql);if(Array.isArray(e.args))t.bindIndexes(e.args);else for(let[r,s]of Object.entries(e.args))t.bindName(r,s);return t}function E(e){let t=e.columnNames.map(e=>e??""),r=e.columnDecltypes.map(e=>e??""),s=e.rows,o=e.affectedRowCount,i=void 0!==e.lastInsertRowid?e.lastInsertRowid:void 0;return new l.ResultSetImpl(t,r,s,o,i)}function k(e){if(e instanceof _.ClientError){let t=function e(t){if(t instanceof _.ResponseError&&void 0!==t.code)return t.code;if(t instanceof _.ProtoError)return"HRANA_PROTO_ERROR";if(t instanceof _.ClosedError)return t.cause instanceof _.ClientError?e(t.cause):"HRANA_CLOSED_ERROR";if(t instanceof _.WebSocketError)return"HRANA_WEBSOCKET_ERROR";if(t instanceof _.HttpServerError)return"SERVER_ERROR";if(t instanceof _.ProtocolVersionError)return"PROTOCOL_VERSION_ERROR";if(t instanceof _.InternalError)return"INTERNAL_ERROR";else return"UNKNOWN"}(e);return new a.LibsqlError(e.message,t,void 0,e)}return e}class I{#et;#ej;capacity;constructor(e,t){this.#et=e,this.#ej=new O,this.capacity=t}apply(e){if(this.capacity<=0)return;let t=new Set;for(let r of e){if("string"!=typeof r.sql)continue;let e=r.sql;if(e.length>=5e3)continue;let s=this.#ej.get(e);if(void 0===s){for(;this.#ej.size+1>this.capacity;){let[e,r]=this.#ej.peekLru();if(t.has(r))break;r.close(),this.#ej.delete(e)}this.#ej.size+1<=this.capacity&&(s=this.#et.storeSql(e),this.#ej.set(e,s))}void 0!==s&&(r.sql=s,t.add(s))}}}class O{#eC;constructor(){this.#eC=new Map}get(e){let t=this.#eC.get(e);return void 0!==t&&(this.#eC.delete(e),this.#eC.set(e,t)),t}set(e,t){this.#eC.set(e,t)}peekLru(){for(let e of this.#eC.entries())return e}delete(e){this.#eC.delete(e)}get size(){return this.#eC.size}}var T=r(43271),j=r(61326);class C{#w;#eI;#eN;#e$;#eD;closed;protocol;#eU;#eO;constructor(e,t,r,s,o){this.#w=t,this.#eI=r,this.#eN=s,this.#e$=this.#eB(e),this.#eD=void 0,this.closed=!1,this.protocol="ws",this.#eO=j(o)}async limit(e){return this.#eO(e)}async execute(e,t){let r;return r="string"==typeof e?{sql:e,args:t||[]}:e,this.limit(async()=>{let e=await this.#eF();try{let t=S(r);e.conn.sqlCache.apply([t]);let s=e.stream.query(t);e.stream.closeGracefully();let o=await s;return E(o)}catch(e){throw k(e)}finally{this._closeStream(e)}})}async batch(e,t="deferred"){return this.limit(async()=>{let r=await this.#eF();try{let s=e.map(S),o=await r.conn.client.getVersion();r.conn.sqlCache.apply(s);let i=r.stream.batch(o>=3),a=w(t,o,i,s);return await a}catch(e){throw k(e)}finally{this._closeStream(r)}})}async migrate(e){return this.limit(async()=>{let t=await this.#eF();try{let r=e.map(S),s=await t.conn.client.getVersion(),o=t.stream.batch(s>=3),i=w("deferred",s,o,r,!0);return await i}catch(e){throw k(e)}finally{this._closeStream(t)}})}async transaction(e="write"){return this.limit(async()=>{let t=await this.#eF();try{let r=await t.conn.client.getVersion();return new R(this,t,e,r)}catch(e){throw this._closeStream(t),k(e)}})}async executeMultiple(e){return this.limit(async()=>{let t=await this.#eF();try{let r=t.stream.sequence(e);t.stream.closeGracefully(),await r}catch(e){throw k(e)}finally{this._closeStream(t)}})}sync(){throw new a.LibsqlError("sync not supported in ws mode","SYNC_NOT_SUPPORTED")}async #eF(){if(this.closed)throw new a.LibsqlError("The client is closed","CLIENT_CLOSED");if(new Date().valueOf()-this.#e$.openTime.valueOf()>6e4&&void 0===this.#eD){let e=this.#eB();this.#eD=e,e.client.getVersion().then(t=>{this.#e$!==e&&0===this.#e$.streamStates.size&&this.#e$.client.close(),this.#e$=e,this.#eD=void 0},e=>{this.#eD=void 0})}if(this.#e$.client.closed)try{void 0!==this.#eD?this.#e$=this.#eD:this.#e$=this.#eB()}catch(e){throw k(e)}let e=this.#e$;try{void 0===e.useSqlCache&&(e.useSqlCache=await e.client.getVersion()>=2,e.useSqlCache&&(e.sqlCache.capacity=100));let t=e.client.openStream();t.intMode=this.#eN;let r={conn:e,stream:t};return e.streamStates.add(r),r}catch(e){throw k(e)}}#eB(e){try{return{client:e??=_.openWs(this.#w,this.#eI),useSqlCache:void 0,sqlCache:new I(e,0),openTime:new Date,streamStates:new Set}}catch(e){throw k(e)}}_closeStream(e){e.stream.close();let t=e.conn;t.streamStates.delete(e),0===t.streamStates.size&&t!==this.#e$&&t.client.close()}close(){this.#e$.client.close(),this.closed=!0}}class R extends v{#N;#eV;constructor(e,t,r,s){super(r,s),this.#N=e,this.#eV=t}_getStream(){return this.#eV.stream}_getSqlCache(){return this.#eV.conn.sqlCache}close(){this.#N._closeStream(this.#eV)}get closed(){return this.#eV.stream.closed}}class A{#N;protocol;#eI;#eO;constructor(e,t,r,s,o){this.#N=_.openHttp(e,t,s),this.#N.intMode=r,this.protocol="http",this.#eI=t,this.#eO=j(o)}async limit(e){return this.#eO(e)}async execute(e,t){let r;return r="string"==typeof e?{sql:e,args:t||[]}:e,this.limit(async()=>{try{let e;let t=S(r),s=this.#N.openStream();try{e=s.query(t)}finally{s.closeGracefully()}let o=await e;return E(o)}catch(e){throw k(e)}})}async batch(e,t="deferred"){return this.limit(async()=>{try{let r;let s=e.map(S),o=await this.#N.getVersion(),i=this.#N.openStream();try{new I(i,30).apply(s);let e=i.batch(!1);r=w(t,o,e,s)}finally{i.closeGracefully()}return await r}catch(e){throw k(e)}})}async migrate(e){return this.limit(async()=>{try{let t;let r=e.map(S),s=await this.#N.getVersion(),o=this.#N.openStream();try{let e=o.batch(!1);t=w("deferred",s,e,r,!0)}finally{o.closeGracefully()}return await t}catch(e){throw k(e)}})}async transaction(e="write"){return this.limit(async()=>{try{let t=await this.#N.getVersion();return new P(this.#N.openStream(),e,t)}catch(e){throw k(e)}})}async executeMultiple(e){return this.limit(async()=>{try{let t;let r=this.#N.openStream();try{t=r.sequence(e)}finally{r.closeGracefully()}await t}catch(e){throw k(e)}})}sync(){throw new a.LibsqlError("sync not supported in http mode","SYNC_NOT_SUPPORTED")}close(){this.#N.close()}get closed(){return this.#N.closed}}class P extends v{#O;#eT;constructor(e,t,r){super(t,r),this.#O=e,this.#eT=new I(e,30)}_getStream(){return this.#O}_getSqlCache(){return this.#eT}close(){this.#O.close()}get closed(){return this.#O.closed}}function N(e){var t;return"wss"===(t=(0,s.expandConfig)(e,!0)).scheme||"ws"===t.scheme?function(e){let t;if("wss"!==e.scheme&&"ws"!==e.scheme)throw new a.LibsqlError(`The WebSocket client supports only "libsql:", "wss:" and "ws:" URLs, got ${JSON.stringify(e.scheme+":")}. For more information, please read ${l.supportedUrlLink}`,"URL_SCHEME_NOT_SUPPORTED");if(void 0!==e.encryptionKey)throw new a.LibsqlError("Encryption key is not supported by the remote client.","ENCRYPTION_KEY_NOT_SUPPORTED");if("ws"===e.scheme&&e.tls)throw new a.LibsqlError('A "ws:" URL cannot opt into TLS by using ?tls=1',"URL_INVALID");if("wss"===e.scheme&&!e.tls)throw new a.LibsqlError('A "wss:" URL cannot opt out of TLS by using ?tls=0',"URL_INVALID");let r=(0,T.encodeBaseUrl)(e.scheme,e.authority,e.path);try{t=_.openWs(r,e.authToken)}catch(t){if(t instanceof _.WebSocketUnsupportedError){let t="wss"===e.scheme?"https":"http",r=(0,T.encodeBaseUrl)(t,e.authority,e.path);throw new a.LibsqlError(`This environment does not support WebSockets, please switch to the HTTP client by using a "${t}:" URL (${JSON.stringify(r)}). For more information, please read ${l.supportedUrlLink}`,"WEBSOCKETS_NOT_SUPPORTED")}throw k(t)}return new C(t,r,e.authToken,e.intMode,e.concurrency)}(t):"https"===t.scheme||"http"===t.scheme?function(e){if("https"!==e.scheme&&"http"!==e.scheme)throw new a.LibsqlError(`The HTTP client supports only "libsql:", "https:" and "http:" URLs, got ${JSON.stringify(e.scheme+":")}. For more information, please read ${l.supportedUrlLink}`,"URL_SCHEME_NOT_SUPPORTED");if(void 0!==e.encryptionKey)throw new a.LibsqlError("Encryption key is not supported by the remote client.","ENCRYPTION_KEY_NOT_SUPPORTED");if("http"===e.scheme&&e.tls)throw new a.LibsqlError('A "http:" URL cannot opt into TLS by using ?tls=1',"URL_INVALID");if("https"===e.scheme&&!e.tls)throw new a.LibsqlError('A "https:" URL cannot opt out of TLS by using ?tls=0',"URL_INVALID");return new A((0,T.encodeBaseUrl)(e.scheme,e.authority,e.path),e.authToken,e.intMode,e.fetch,e.concurrency)}(t):function(e){if("file"!==e.scheme)throw new a.LibsqlError(`URL scheme ${JSON.stringify(e.scheme+":")} is not supported by the local sqlite3 client. For more information, please read ${l.supportedUrlLink}`,"URL_SCHEME_NOT_SUPPORTED");let t=e.authority;if(void 0!==t){let e=t.host.toLowerCase();if(""!==e&&"localhost"!==e)throw new a.LibsqlError(`Invalid host in file URL: ${JSON.stringify(t.host)}. A "file:" URL with an absolute path should start with one slash ("file:/absolute/path.db") or with three slashes ("file:///absolute/path.db"). For more information, please read ${l.supportedUrlLink}`,"URL_INVALID");if(void 0!==t.port)throw new a.LibsqlError("File URL cannot have a port","URL_INVALID");if(void 0!==t.userinfo)throw new a.LibsqlError("File URL cannot have username and password","URL_INVALID")}let r=(0,s.isInMemoryConfig)(e);if(r&&e.syncUrl)throw new a.LibsqlError(`Embedded replica must use file for local db but URI with in-memory mode were provided instead: ${e.path}`,"URL_INVALID");let i=e.path;r&&(i=`${e.scheme}:${e.path}`);let c={authToken:e.authToken,encryptionKey:e.encryptionKey,syncUrl:e.syncUrl,syncPeriod:e.syncInterval},p=new o(i,c);return d(p,"SELECT 1 AS checkThatTheDatabaseCanBeOpened",e.intMode),new u(i,c,p,e.intMode)}(t)}},80043:e=>{"use strict";e.exports={type:"commonjs"}},67149:e=>{"use strict";e.exports=JSON.parse('{"name":"@libsql/client","version":"0.14.0","keywords":["libsql","database","sqlite","serverless","vercel","netlify","lambda"],"description":"libSQL driver for TypeScript and JavaScript","repository":{"type":"git","url":"https://github.com/libsql/libsql-client-ts"},"authors":["Jan paek <honza@chiselstrike.com>","Pekka Enberg <penberg@chiselstrike.com>","Jan Plhak <jp@chiselstrike.com>"],"license":"MIT","type":"module","main":"lib-cjs/node.js","types":"lib-esm/node.d.ts","exports":{".":{"types":"./lib-esm/node.d.ts","import":{"workerd":"./lib-esm/web.js","deno":"./lib-esm/web.js","edge-light":"./lib-esm/web.js","netlify":"./lib-esm/web.js","node":"./lib-esm/node.js","browser":"./lib-esm/web.js","default":"./lib-esm/node.js"},"require":"./lib-cjs/node.js"},"./node":{"types":"./lib-esm/node.d.ts","import":"./lib-esm/node.js","require":"./lib-cjs/node.js"},"./http":{"types":"./lib-esm/http.d.ts","import":"./lib-esm/http.js","require":"./lib-cjs/http.js"},"./ws":{"types":"./lib-esm/ws.d.ts","import":"./lib-esm/ws.js","require":"./lib-cjs/ws.js"},"./sqlite3":{"types":"./lib-esm/sqlite3.d.ts","import":"./lib-esm/sqlite3.js","require":"./lib-cjs/sqlite3.js"},"./web":{"types":"./lib-esm/web.d.ts","import":"./lib-esm/web.js","require":"./lib-cjs/web.js"}},"typesVersions":{"*":{".":["./lib-esm/node.d.ts"],"http":["./lib-esm/http.d.ts"],"hrana":["./lib-esm/hrana.d.ts"],"sqlite3":["./lib-esm/sqlite3.d.ts"],"web":["./lib-esm/web.d.ts"]}},"files":["lib-cjs/**","lib-esm/**","README.md"],"scripts":{"prepublishOnly":"npm run build","prebuild":"rm -rf ./lib-cjs ./lib-esm","build":"npm run build:cjs && npm run build:esm","build:cjs":"tsc -p tsconfig.build-cjs.json","build:esm":"tsc -p tsconfig.build-esm.json","postbuild":"cp package-cjs.json ./lib-cjs/package.json","test":"jest --runInBand","typecheck":"tsc --noEmit","typedoc":"rm -rf ./docs && typedoc","prepare":"husky install","lint-staged":"lint-staged"},"dependencies":{"@libsql/core":"^0.14.0","@libsql/hrana-client":"^0.7.0","js-base64":"^3.7.5","libsql":"^0.4.4","promise-limit":"^2.7.0"},"devDependencies":{"@types/jest":"^29.2.5","@types/node":"^18.15.5","husky":"^9.0.11","jest":"^29.3.1","lint-staged":"^15.2.2","msw":"^2.3.0","prettier":"3.2.5","ts-jest":"^29.0.5","typedoc":"^0.23.28","typescript":"^4.9.4"}}')},79553:e=>{"use strict";e.exports={type:"commonjs"}},42926:e=>{"use strict";e.exports=JSON.parse('{"name":"@libsql/core","version":"0.14.0","keywords":["libsql","database","sqlite","serverless","vercel","netlify","lambda"],"description":"libSQL driver for TypeScript and JavaScript","repository":{"type":"git","url":"https://github.com/libsql/libsql-client-ts"},"authors":["Jan paek <honza@chiselstrike.com>","Pekka Enberg <penberg@chiselstrike.com>","Jan Plhak <jp@chiselstrike.com>"],"license":"MIT","type":"module","exports":{"./api":{"types":"./lib-esm/api.d.ts","import":"./lib-esm/api.js","require":"./lib-cjs/api.js"},"./config":{"types":"./lib-esm/config.d.ts","import":"./lib-esm/config.js","require":"./lib-cjs/config.js"},"./uri":{"types":"./lib-esm/uri.d.ts","import":"./lib-esm/uri.js","require":"./lib-cjs/uri.js"},"./util":{"types":"./lib-esm/util.d.ts","import":"./lib-esm/util.js","require":"./lib-cjs/util.js"}},"typesVersions":{"*":{"api":["./lib-esm/api.d.ts"],"config":["./lib-esm/config.d.ts"],"uri":["./lib-esm/uri.d.ts"],"util":["./lib-esm/util.d.ts"]}},"files":["lib-cjs/**","lib-esm/**"],"scripts":{"prepublishOnly":"npm run build","prebuild":"rm -rf ./lib-cjs ./lib-esm","build":"npm run build:cjs && npm run build:esm","build:cjs":"tsc -p tsconfig.build-cjs.json","build:esm":"tsc -p tsconfig.build-esm.json","postbuild":"cp package-cjs.json ./lib-cjs/package.json","test":"jest --runInBand","typecheck":"tsc --noEmit","typedoc":"rm -rf ./docs && typedoc"},"dependencies":{"js-base64":"^3.7.5"},"devDependencies":{"@types/jest":"^29.2.5","@types/node":"^18.15.5","jest":"^29.3.1","ts-jest":"^29.0.5","typedoc":"^0.23.28","typescript":"^4.9.4"}}')},25357:e=>{"use strict";e.exports={type:"commonjs"}},20069:e=>{"use strict";e.exports=JSON.parse('{"name":"@libsql/hrana-client","version":"0.7.0","keywords":["hrana","libsql","sqld","database"],"description":"Hrana client for connecting to sqld over HTTP or WebSocket","repository":{"type":"git","url":"github:libsql/hrana-client-ts"},"homepage":"https://github.com/libsql/hrana-client-ts","authors":["Jan paek <honza@chiselstrike.com>"],"license":"MIT","type":"module","main":"lib-cjs/index.js","types":"lib-esm/index.d.ts","exports":{".":{"types":"./lib-esm/index.d.ts","import":"./lib-esm/index.js","require":"./lib-cjs/index.js"}},"files":["lib-cjs/**","lib-esm/**"],"scripts":{"clean":"rm -rf ./lib-cjs ./lib-esm ./*.tsbuildinfo","prepublishOnly":"npm run clean-build","prebuild":"rm -rf ./lib-cjs ./lib-esm","build":"npm run build:cjs && npm run build:esm","build:cjs":"tsc -p tsconfig.build-cjs.json","build:esm":"tsc -p tsconfig.build-esm.json","postbuild":"cp package-cjs.json ./lib-cjs/package.json","clean-build":"npm run clean && npm run build","typecheck":"tsc --noEmit","test":"jest --runInBand","typedoc":"rm -rf ./docs && typedoc"},"dependencies":{"@libsql/isomorphic-fetch":"^0.3.1","@libsql/isomorphic-ws":"^0.1.5","js-base64":"^3.7.5","node-fetch":"^3.3.2"},"devDependencies":{"@types/jest":"^29","jest":"^29.6.2","ts-jest":"^29.1.1","typedoc":"^0.24.8","typescript":"^5.1.6"}}')},44265:e=>{"use strict";e.exports=JSON.parse('{"name":"@libsql/isomorphic-fetch","version":"0.3.1","keywords":["fetch","isomorphic","node","deno","workers"],"description":"Isomorphic fetch() in Node, Deno and Cloudflare Workers","repository":{"type":"git","url":"https://github.com/libsql/isomorphic-ts.git","directory":"isomorphic-fetch"},"homepage":"https://github.com/libsql/isomorphic-ts/tree/main/isomorphic-fetch","authors":["Jan paek <honza@chiselstrike.com>"],"license":"MIT","type":"module","main":"node.cjs","types":"index.d.ts","exports":{".":{"import":{"bun":"./web.js","node":"./node.js","deno":"./web.js","workerd":"./web.js","default":"./web.js"},"require":{"bun":"./web.cjs","node":"./node.cjs","workerd":"./web.cjs","default":"./web.cjs"}}},"files":["*.mjs","*.cjs","*.js","*.d.ts"],"engines":{"node":">=18.0.0"}}')},6040:e=>{"use strict";e.exports=JSON.parse('{"name":"@libsql/isomorphic-ws","version":"0.1.5","keywords":["ws","websocket","isomorphic","node","deno","workers"],"description":"Isomorphic WebSockets in Node, Bun, Deno and Cloudflare Workers","repository":{"type":"git","url":"https://github.com/libsql/isomorphic-ts.git","directory":"isomorphic-ws"},"homepage":"https://github.com/libsql/isomorphic-ts/tree/main/isomorphic-ws","authors":["Jan paek <honza@chiselstrike.com>"],"license":"MIT","main":"node.cjs","types":"index.d.ts","exports":{".":{"import":{"bun":"./web.mjs","deno":"./web.mjs","workerd":"./web.mjs","node":"./node.mjs","default":"./web.mjs"},"require":{"bun":"./web.cjs","deno":"./web.cjs","workerd":"./web.cjs","node":"./node.cjs","default":"./web.cjs"}}},"files":["*.mjs","*.cjs","*.js","*.d.ts"],"dependencies":{"ws":"^8.13.0","@types/ws":"^8.5.4"}}')},54387:e=>{"use strict";e.exports=JSON.parse('{"name":"@libsql/linux-x64-gnu","description":"Prebuilt binary package for `libsql` on `linux-x64-gnu`.","version":"0.4.7","os":["linux"],"cpu":["x64"],"main":"index.node","files":["index.node"],"neon":{"type":"binary","rust":"x86_64-unknown-linux-gnu","node":"linux-x64-gnu","platform":"linux","arch":"x64","abi":"gnu"},"author":"Pekka Enberg <penberg@iki.fi>","repository":{"type":"git","url":"git+https://github.com/tursodatabase/libsql-js.git"},"keywords":["libsql"],"bugs":{"url":"https://github.com/tursodatabase/libsql-js/issues"},"homepage":"https://github.com/tursodatabase/libsql-js","license":"MIT"}')},80409:e=>{"use strict";e.exports=JSON.parse('{"name":"@libsql/linux-x64-musl","description":"Prebuilt binary package for `libsql` on `linux-x64-musl`.","version":"0.4.7","os":["linux"],"cpu":["x64"],"main":"index.node","files":["index.node"],"neon":{"type":"binary","rust":"x86_64-unknown-linux-musl","node":"linux-x64-musl","platform":"linux","arch":"x64","abi":"musl"},"author":"Pekka Enberg <penberg@iki.fi>","repository":{"type":"git","url":"git+https://github.com/tursodatabase/libsql-js.git"},"keywords":["libsql"],"bugs":{"url":"https://github.com/tursodatabase/libsql-js/issues"},"homepage":"https://github.com/tursodatabase/libsql-js","license":"MIT"}')},63229:e=>{"use strict";e.exports=JSON.parse('{"name":"dotenv","version":"16.4.7","description":"Loads environment variables from .env file","main":"lib/main.js","types":"lib/main.d.ts","exports":{".":{"types":"./lib/main.d.ts","require":"./lib/main.js","default":"./lib/main.js"},"./config":"./config.js","./config.js":"./config.js","./lib/env-options":"./lib/env-options.js","./lib/env-options.js":"./lib/env-options.js","./lib/cli-options":"./lib/cli-options.js","./lib/cli-options.js":"./lib/cli-options.js","./package.json":"./package.json"},"scripts":{"dts-check":"tsc --project tests/types/tsconfig.json","lint":"standard","pretest":"npm run lint && npm run dts-check","test":"tap run --allow-empty-coverage --disable-coverage --timeout=60000","test:coverage":"tap run --show-full-coverage --timeout=60000 --coverage-report=lcov","prerelease":"npm test","release":"standard-version"},"repository":{"type":"git","url":"git://github.com/motdotla/dotenv.git"},"funding":"https://dotenvx.com","keywords":["dotenv","env",".env","environment","variables","config","settings"],"readmeFilename":"README.md","license":"BSD-2-Clause","devDependencies":{"@types/node":"^18.11.3","decache":"^4.6.2","sinon":"^14.0.1","standard":"^17.0.0","standard-version":"^9.5.0","tap":"^19.2.0","typescript":"^4.8.4"},"engines":{"node":">=12"},"browser":{"fs":false}}')},14604:e=>{"use strict";e.exports=JSON.parse('{"name":"thread-stream","version":"3.1.0","description":"A streaming way to send data to a Node.js Worker Thread","main":"index.js","types":"index.d.ts","dependencies":{"real-require":"^0.2.0"},"devDependencies":{"@types/node":"^20.1.0","@types/tap":"^15.0.0","@yao-pkg/pkg":"^5.11.5","desm":"^1.3.0","fastbench":"^1.0.1","husky":"^9.0.6","pino-elasticsearch":"^8.0.0","sonic-boom":"^4.0.1","standard":"^17.0.0","tap":"^16.2.0","ts-node":"^10.8.0","typescript":"^5.3.2","why-is-node-running":"^2.2.2"},"scripts":{"build":"tsc --noEmit","test":"standard && npm run build && npm run transpile && tap \\"test/**/*.test.*js\\" && tap --ts test/*.test.*ts","test:ci":"standard && npm run transpile && npm run test:ci:js && npm run test:ci:ts","test:ci:js":"tap --no-check-coverage --timeout=120 --coverage-report=lcovonly \\"test/**/*.test.*js\\"","test:ci:ts":"tap --ts --no-check-coverage --coverage-report=lcovonly \\"test/**/*.test.*ts\\"","test:yarn":"npm run transpile && tap \\"test/**/*.test.js\\" --no-check-coverage","transpile":"sh ./test/ts/transpile.sh","prepare":"husky install"},"standard":{"ignore":["test/ts/**/*","test/syntax-error.mjs"]},"repository":{"type":"git","url":"git+https://github.com/mcollina/thread-stream.git"},"keywords":["worker","thread","threads","stream"],"author":"Matteo Collina <hello@matteocollina.com>","license":"MIT","bugs":{"url":"https://github.com/mcollina/thread-stream/issues"},"homepage":"https://github.com/mcollina/thread-stream#readme"}')}};