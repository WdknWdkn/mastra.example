"use strict";exports.id=62,exports.ids=[62],exports.modules={95062:(e,t,o)=>{o.d(t,{f:()=>C});var n=o(22969),s=o(2347),l=o(7130);function i(e){var t,o;return null!=(o=null==(t=null==e?void 0:e.content)?void 0:t.map(({token:e,logprob:t,top_logprobs:o})=>({token:e,logprob:t,topLogprobs:o?o.map(({token:e,logprob:t})=>({token:e,logprob:t})):[]})))?o:void 0}function r(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"unknown"}}var a=l.z.object({error:l.z.object({message:l.z.string(),type:l.z.string().nullish(),param:l.z.any().nullish(),code:l.z.union([l.z.string(),l.z.number()]).nullish()})}),u=(0,n.Sq)({errorSchema:a,errorToMessage:e=>e.error.message});function p({id:e,model:t,created:o}){return{id:null!=e?e:void 0,modelId:null!=t?t:void 0,timestamp:null!=o?new Date(1e3*o):void 0}}var c=class{constructor(e,t,o){this.specificationVersion="v1",this.modelId=e,this.settings=t,this.config=o}get supportsStructuredOutputs(){var e;return null!=(e=this.settings.structuredOutputs)?e:h(this.modelId)}get defaultObjectGenerationMode(){return this.modelId.startsWith("gpt-4o-audio-preview")?"tool":this.supportsStructuredOutputs?"json":"tool"}get provider(){return this.config.provider}get supportsImageUrls(){return!this.settings.downloadImages}getArgs({mode:e,prompt:t,maxTokens:o,temperature:l,topP:i,topK:r,frequencyPenalty:a,presencePenalty:u,stopSequences:p,responseFormat:c,seed:d,providerMetadata:m}){var g,b,y,_,v,z,w,k;let j=e.type,x=[];null!=r&&x.push({type:"unsupported-setting",setting:"topK"}),(null==c?void 0:c.type)!=="json"||null==c.schema||this.supportsStructuredOutputs||x.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format schema is only supported with structuredOutputs"});let I=this.settings.useLegacyFunctionCalling;if(I&&!0===this.settings.parallelToolCalls)throw new s.A_({functionality:"useLegacyFunctionCalling with parallelToolCalls"});if(I&&this.supportsStructuredOutputs)throw new s.A_({functionality:"structuredOutputs with useLegacyFunctionCalling"});"remove"===f(this.modelId)&&t.some(e=>"system"===e.role)&&x.push({type:"other",message:"system messages are removed for this model"});let C={model:this.modelId,logit_bias:this.settings.logitBias,logprobs:!0===this.settings.logprobs||"number"==typeof this.settings.logprobs||void 0,top_logprobs:"number"==typeof this.settings.logprobs?this.settings.logprobs:"boolean"==typeof this.settings.logprobs&&this.settings.logprobs?0:void 0,user:this.settings.user,parallel_tool_calls:this.settings.parallelToolCalls,max_tokens:o,temperature:l,top_p:i,frequency_penalty:a,presence_penalty:u,response_format:(null==c?void 0:c.type)==="json"?this.supportsStructuredOutputs&&null!=c.schema?{type:"json_schema",json_schema:{schema:c.schema,strict:!0,name:null!=(g=c.name)?g:"response",description:c.description}}:{type:"json_object"}:void 0,stop:p,seed:d,max_completion_tokens:null==(b=null==m?void 0:m.openai)?void 0:b.maxCompletionTokens,store:null==(y=null==m?void 0:m.openai)?void 0:y.store,metadata:null==(_=null==m?void 0:m.openai)?void 0:_.metadata,prediction:null==(v=null==m?void 0:m.openai)?void 0:v.prediction,reasoning_effort:null!=(w=null==(z=null==m?void 0:m.openai)?void 0:z.reasoningEffort)?w:this.settings.reasoningEffort,messages:function({prompt:e,useLegacyFunctionCalling:t=!1,systemMessageMode:o="system"}){let l=[];for(let{role:i,content:r}of e)switch(i){case"system":switch(o){case"system":l.push({role:"system",content:r});break;case"developer":l.push({role:"developer",content:r});break;case"remove":break;default:throw Error(`Unsupported system message mode: ${o}`)}break;case"user":if(1===r.length&&"text"===r[0].type){l.push({role:"user",content:r[0].text});break}l.push({role:"user",content:r.map(e=>{var t,o,l;switch(e.type){case"text":return{type:"text",text:e.text};case"image":return{type:"image_url",image_url:{url:e.image instanceof URL?e.image.toString():`data:${null!=(t=e.mimeType)?t:"image/jpeg"};base64,${(0,n.k0)(e.image)}`,detail:null==(l=null==(o=e.providerMetadata)?void 0:o.openai)?void 0:l.imageDetail}};case"file":if(e.data instanceof URL)throw new s.A_({functionality:"'File content parts with URL data' functionality not supported."});switch(e.mimeType){case"audio/wav":return{type:"input_audio",input_audio:{data:e.data,format:"wav"}};case"audio/mp3":case"audio/mpeg":return{type:"input_audio",input_audio:{data:e.data,format:"mp3"}};default:throw new s.A_({functionality:`File content part type ${e.mimeType} in user messages`})}}})});break;case"assistant":{let e="",o=[];for(let t of r)switch(t.type){case"text":e+=t.text;break;case"redacted-reasoning":case"reasoning":break;case"tool-call":o.push({id:t.toolCallId,type:"function",function:{name:t.toolName,arguments:JSON.stringify(t.args)}});break;default:throw Error(`Unsupported part: ${t}`)}if(t){if(o.length>1)throw new s.A_({functionality:"useLegacyFunctionCalling with multiple tool calls in one message"});l.push({role:"assistant",content:e,function_call:o.length>0?o[0].function:void 0})}else l.push({role:"assistant",content:e,tool_calls:o.length>0?o:void 0});break}case"tool":for(let e of r)t?l.push({role:"function",name:e.toolName,content:JSON.stringify(e.result)}):l.push({role:"tool",tool_call_id:e.toolCallId,content:JSON.stringify(e.result)});break;default:throw Error(`Unsupported role: ${i}`)}return l}({prompt:t,useLegacyFunctionCalling:I,systemMessageMode:f(this.modelId)})};switch(h(this.modelId)&&(null!=C.temperature&&(C.temperature=void 0,x.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for reasoning models"})),null!=C.top_p&&(C.top_p=void 0,x.push({type:"unsupported-setting",setting:"topP",details:"topP is not supported for reasoning models"})),null!=C.frequency_penalty&&(C.frequency_penalty=void 0,x.push({type:"unsupported-setting",setting:"frequencyPenalty",details:"frequencyPenalty is not supported for reasoning models"})),null!=C.presence_penalty&&(C.presence_penalty=void 0,x.push({type:"unsupported-setting",setting:"presencePenalty",details:"presencePenalty is not supported for reasoning models"})),null!=C.logit_bias&&(C.logit_bias=void 0,x.push({type:"other",message:"logitBias is not supported for reasoning models"})),null!=C.logprobs&&(C.logprobs=void 0,x.push({type:"other",message:"logprobs is not supported for reasoning models"})),null!=C.top_logprobs&&(C.top_logprobs=void 0,x.push({type:"other",message:"topLogprobs is not supported for reasoning models"})),null!=C.max_tokens&&(null==C.max_completion_tokens&&(C.max_completion_tokens=C.max_tokens),C.max_tokens=void 0)),j){case"regular":{let{tools:t,tool_choice:o,functions:n,function_call:l,toolWarnings:i}=function({mode:e,useLegacyFunctionCalling:t=!1,structuredOutputs:o}){var n;let l=(null==(n=e.tools)?void 0:n.length)?e.tools:void 0,i=[];if(null==l)return{tools:void 0,tool_choice:void 0,toolWarnings:i};let r=e.toolChoice;if(t){let e=[];for(let t of l)"provider-defined"===t.type?i.push({type:"unsupported-tool",tool:t}):e.push({name:t.name,description:t.description,parameters:t.parameters});if(null==r)return{functions:e,function_call:void 0,toolWarnings:i};switch(r.type){case"auto":case"none":case void 0:return{functions:e,function_call:void 0,toolWarnings:i};case"required":throw new s.A_({functionality:"useLegacyFunctionCalling and toolChoice: required"});default:return{functions:e,function_call:{name:r.toolName},toolWarnings:i}}}let a=[];for(let e of l)"provider-defined"===e.type?i.push({type:"unsupported-tool",tool:e}):a.push({type:"function",function:{name:e.name,description:e.description,parameters:e.parameters,strict:!!o||void 0}});if(null==r)return{tools:a,tool_choice:void 0,toolWarnings:i};let u=r.type;switch(u){case"auto":case"none":case"required":return{tools:a,tool_choice:u,toolWarnings:i};case"tool":return{tools:a,tool_choice:{type:"function",function:{name:r.toolName}},toolWarnings:i};default:throw new s.A_({functionality:`Unsupported tool choice type: ${u}`})}}({mode:e,useLegacyFunctionCalling:I,structuredOutputs:this.supportsStructuredOutputs});return{args:{...C,tools:t,tool_choice:o,functions:n,function_call:l},warnings:[...x,...i]}}case"object-json":return{args:{...C,response_format:this.supportsStructuredOutputs&&null!=e.schema?{type:"json_schema",json_schema:{schema:e.schema,strict:!0,name:null!=(k=e.name)?k:"response",description:e.description}}:{type:"json_object"}},warnings:x};case"object-tool":return{args:I?{...C,function_call:{name:e.tool.name},functions:[{name:e.tool.name,description:e.tool.description,parameters:e.tool.parameters}]}:{...C,tool_choice:{type:"function",function:{name:e.tool.name}},tools:[{type:"function",function:{name:e.tool.name,description:e.tool.description,parameters:e.tool.parameters,strict:!!this.supportsStructuredOutputs||void 0}}]},warnings:x};default:throw Error(`Unsupported type: ${j}`)}}async doGenerate(e){var t,o,s,l,a,c,d,g;let{args:h,warnings:f}=this.getArgs(e),{responseHeaders:b,value:y,rawValue:_}=await (0,n.A8)({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:(0,n.NF)(this.config.headers(),e.headers),body:h,failedResponseHandler:u,successfulResponseHandler:(0,n.tc)(m),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:v,...z}=h,w=y.choices[0],k=null==(t=y.usage)?void 0:t.completion_tokens_details,j=null==(o=y.usage)?void 0:o.prompt_tokens_details,x={openai:{}};return(null==k?void 0:k.reasoning_tokens)!=null&&(x.openai.reasoningTokens=null==k?void 0:k.reasoning_tokens),(null==k?void 0:k.accepted_prediction_tokens)!=null&&(x.openai.acceptedPredictionTokens=null==k?void 0:k.accepted_prediction_tokens),(null==k?void 0:k.rejected_prediction_tokens)!=null&&(x.openai.rejectedPredictionTokens=null==k?void 0:k.rejected_prediction_tokens),(null==j?void 0:j.cached_tokens)!=null&&(x.openai.cachedPromptTokens=null==j?void 0:j.cached_tokens),{text:null!=(s=w.message.content)?s:void 0,toolCalls:this.settings.useLegacyFunctionCalling&&w.message.function_call?[{toolCallType:"function",toolCallId:(0,n.Ox)(),toolName:w.message.function_call.name,args:w.message.function_call.arguments}]:null==(l=w.message.tool_calls)?void 0:l.map(e=>{var t;return{toolCallType:"function",toolCallId:null!=(t=e.id)?t:(0,n.Ox)(),toolName:e.function.name,args:e.function.arguments}}),finishReason:r(w.finish_reason),usage:{promptTokens:null!=(c=null==(a=y.usage)?void 0:a.prompt_tokens)?c:NaN,completionTokens:null!=(g=null==(d=y.usage)?void 0:d.completion_tokens)?g:NaN},rawCall:{rawPrompt:v,rawSettings:z},rawResponse:{headers:b,body:_},request:{body:JSON.stringify(h)},response:p(y),warnings:f,logprobs:i(w.logprobs),providerMetadata:x}}async doStream(e){let t;if(this.settings.simulateStreaming){let t=await this.doGenerate(e);return{stream:new ReadableStream({start(e){if(e.enqueue({type:"response-metadata",...t.response}),t.text&&e.enqueue({type:"text-delta",textDelta:t.text}),t.toolCalls)for(let o of t.toolCalls)e.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:o.toolCallId,toolName:o.toolName,argsTextDelta:o.args}),e.enqueue({type:"tool-call",...o});e.enqueue({type:"finish",finishReason:t.finishReason,usage:t.usage,logprobs:t.logprobs,providerMetadata:t.providerMetadata}),e.close()}}),rawCall:t.rawCall,rawResponse:t.rawResponse,warnings:t.warnings}}let{args:o,warnings:l}=this.getArgs(e),a={...o,stream:!0,stream_options:"strict"===this.config.compatibility?{include_usage:!0}:void 0},{responseHeaders:c,value:d}=await (0,n.A8)({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:(0,n.NF)(this.config.headers(),e.headers),body:a,failedResponseHandler:u,successfulResponseHandler:(0,n.cP)(g),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:m,...h}=o,f=[],b="unknown",y={promptTokens:void 0,completionTokens:void 0},_=!0,{useLegacyFunctionCalling:v}=this.settings,z={openai:{}};return{stream:d.pipeThrough(new TransformStream({transform(e,o){var l,a,u,c,d,m,g,h,w,k,j,x;if(!e.success){b="error",o.enqueue({type:"error",error:e.error});return}let I=e.value;if("error"in I){b="error",o.enqueue({type:"error",error:I.error});return}if(_&&(_=!1,o.enqueue({type:"response-metadata",...p(I)})),null!=I.usage){let{prompt_tokens:e,completion_tokens:t,prompt_tokens_details:o,completion_tokens_details:n}=I.usage;y={promptTokens:null!=e?e:void 0,completionTokens:null!=t?t:void 0},(null==n?void 0:n.reasoning_tokens)!=null&&(z.openai.reasoningTokens=null==n?void 0:n.reasoning_tokens),(null==n?void 0:n.accepted_prediction_tokens)!=null&&(z.openai.acceptedPredictionTokens=null==n?void 0:n.accepted_prediction_tokens),(null==n?void 0:n.rejected_prediction_tokens)!=null&&(z.openai.rejectedPredictionTokens=null==n?void 0:n.rejected_prediction_tokens),(null==o?void 0:o.cached_tokens)!=null&&(z.openai.cachedPromptTokens=null==o?void 0:o.cached_tokens)}let C=I.choices[0];if((null==C?void 0:C.finish_reason)!=null&&(b=r(C.finish_reason)),(null==C?void 0:C.delta)==null)return;let T=C.delta;null!=T.content&&o.enqueue({type:"text-delta",textDelta:T.content});let N=i(null==C?void 0:C.logprobs);(null==N?void 0:N.length)&&(void 0===t&&(t=[]),t.push(...N));let O=v&&null!=T.function_call?[{type:"function",id:(0,n.Ox)(),function:T.function_call,index:0}]:T.tool_calls;if(null!=O)for(let e of O){let t=e.index;if(null==f[t]){if("function"!==e.type)throw new s.Rt({data:e,message:"Expected 'function' type."});if(null==e.id)throw new s.Rt({data:e,message:"Expected 'id' to be a string."});if((null==(l=e.function)?void 0:l.name)==null)throw new s.Rt({data:e,message:"Expected 'function.name' to be a string."});f[t]={id:e.id,type:"function",function:{name:e.function.name,arguments:null!=(a=e.function.arguments)?a:""},hasFinished:!1};let i=f[t];(null==(u=i.function)?void 0:u.name)!=null&&(null==(c=i.function)?void 0:c.arguments)!=null&&(i.function.arguments.length>0&&o.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:i.id,toolName:i.function.name,argsTextDelta:i.function.arguments}),(0,n.Gr)(i.function.arguments)&&(o.enqueue({type:"tool-call",toolCallType:"function",toolCallId:null!=(d=i.id)?d:(0,n.Ox)(),toolName:i.function.name,args:i.function.arguments}),i.hasFinished=!0));continue}let i=f[t];!i.hasFinished&&((null==(m=e.function)?void 0:m.arguments)!=null&&(i.function.arguments+=null!=(h=null==(g=e.function)?void 0:g.arguments)?h:""),o.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:i.id,toolName:i.function.name,argsTextDelta:null!=(w=e.function.arguments)?w:""}),(null==(k=i.function)?void 0:k.name)!=null&&(null==(j=i.function)?void 0:j.arguments)!=null&&(0,n.Gr)(i.function.arguments)&&(o.enqueue({type:"tool-call",toolCallType:"function",toolCallId:null!=(x=i.id)?x:(0,n.Ox)(),toolName:i.function.name,args:i.function.arguments}),i.hasFinished=!0))}},flush(e){var o,n;e.enqueue({type:"finish",finishReason:b,logprobs:t,usage:{promptTokens:null!=(o=y.promptTokens)?o:NaN,completionTokens:null!=(n=y.completionTokens)?n:NaN},...null!=z?{providerMetadata:z}:{}})}})),rawCall:{rawPrompt:m,rawSettings:h},rawResponse:{headers:c},request:{body:JSON.stringify(a)},warnings:l}}},d=l.z.object({prompt_tokens:l.z.number().nullish(),completion_tokens:l.z.number().nullish(),prompt_tokens_details:l.z.object({cached_tokens:l.z.number().nullish()}).nullish(),completion_tokens_details:l.z.object({reasoning_tokens:l.z.number().nullish(),accepted_prediction_tokens:l.z.number().nullish(),rejected_prediction_tokens:l.z.number().nullish()}).nullish()}).nullish(),m=l.z.object({id:l.z.string().nullish(),created:l.z.number().nullish(),model:l.z.string().nullish(),choices:l.z.array(l.z.object({message:l.z.object({role:l.z.literal("assistant").nullish(),content:l.z.string().nullish(),function_call:l.z.object({arguments:l.z.string(),name:l.z.string()}).nullish(),tool_calls:l.z.array(l.z.object({id:l.z.string().nullish(),type:l.z.literal("function"),function:l.z.object({name:l.z.string(),arguments:l.z.string()})})).nullish()}),index:l.z.number(),logprobs:l.z.object({content:l.z.array(l.z.object({token:l.z.string(),logprob:l.z.number(),top_logprobs:l.z.array(l.z.object({token:l.z.string(),logprob:l.z.number()}))})).nullable()}).nullish(),finish_reason:l.z.string().nullish()})),usage:d}),g=l.z.union([l.z.object({id:l.z.string().nullish(),created:l.z.number().nullish(),model:l.z.string().nullish(),choices:l.z.array(l.z.object({delta:l.z.object({role:l.z.enum(["assistant"]).nullish(),content:l.z.string().nullish(),function_call:l.z.object({name:l.z.string().optional(),arguments:l.z.string().optional()}).nullish(),tool_calls:l.z.array(l.z.object({index:l.z.number(),id:l.z.string().nullish(),type:l.z.literal("function").optional(),function:l.z.object({name:l.z.string().nullish(),arguments:l.z.string().nullish()})})).nullish()}).nullish(),logprobs:l.z.object({content:l.z.array(l.z.object({token:l.z.string(),logprob:l.z.number(),top_logprobs:l.z.array(l.z.object({token:l.z.string(),logprob:l.z.number()}))})).nullable()}).nullish(),finish_reason:l.z.string().nullable().optional(),index:l.z.number()})),usage:d}),a]);function h(e){return"o1"===e||e.startsWith("o1-")||"o3"===e||e.startsWith("o3-")}function f(e){var t,o;return h(e)?null!=(o=null==(t=b[e])?void 0:t.systemMessageMode)?o:"developer":"system"}var b={"o1-mini":{systemMessageMode:"remove"},"o1-mini-2024-09-12":{systemMessageMode:"remove"},"o1-preview":{systemMessageMode:"remove"},"o1-preview-2024-09-12":{systemMessageMode:"remove"},"o3-mini":{systemMessageMode:"developer"},"o3-mini-2025-01-31":{systemMessageMode:"developer"}};function y(e){return null==e?void 0:e.tokens.map((t,o)=>({token:t,logprob:e.token_logprobs[o],topLogprobs:e.top_logprobs?Object.entries(e.top_logprobs[o]).map(([e,t])=>({token:e,logprob:t})):[]}))}var _=class{constructor(e,t,o){this.specificationVersion="v1",this.defaultObjectGenerationMode=void 0,this.modelId=e,this.settings=t,this.config=o}get provider(){return this.config.provider}getArgs({mode:e,inputFormat:t,prompt:o,maxTokens:n,temperature:l,topP:i,topK:r,frequencyPenalty:a,presencePenalty:u,stopSequences:p,responseFormat:c,seed:d}){var m;let g=e.type,h=[];null!=r&&h.push({type:"unsupported-setting",setting:"topK"}),null!=c&&"text"!==c.type&&h.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format is not supported."});let{prompt:f,stopSequences:b}=function({prompt:e,inputFormat:t,user:o="user",assistant:n="assistant"}){if("prompt"===t&&1===e.length&&"user"===e[0].role&&1===e[0].content.length&&"text"===e[0].content[0].type)return{prompt:e[0].content[0].text};let l="";for(let{role:t,content:i}of("system"===e[0].role&&(l+=`${e[0].content}

`,e=e.slice(1)),e))switch(t){case"system":throw new s.Mt({message:"Unexpected system message in prompt: ${content}",prompt:e});case"user":{let e=i.map(e=>{switch(e.type){case"text":return e.text;case"image":throw new s.A_({functionality:"images"})}}).join("");l+=`${o}:
${e}

`;break}case"assistant":{let e=i.map(e=>{switch(e.type){case"text":return e.text;case"tool-call":throw new s.A_({functionality:"tool-call messages"})}}).join("");l+=`${n}:
${e}

`;break}case"tool":throw new s.A_({functionality:"tool messages"});default:throw Error(`Unsupported role: ${t}`)}return{prompt:l+=`${n}:
`,stopSequences:[`
${o}:`]}}({prompt:o,inputFormat:t}),y=[...null!=b?b:[],...null!=p?p:[]],_={model:this.modelId,echo:this.settings.echo,logit_bias:this.settings.logitBias,logprobs:"number"==typeof this.settings.logprobs?this.settings.logprobs:"boolean"==typeof this.settings.logprobs&&this.settings.logprobs?0:void 0,suffix:this.settings.suffix,user:this.settings.user,max_tokens:n,temperature:l,top_p:i,frequency_penalty:a,presence_penalty:u,seed:d,prompt:f,stop:y.length>0?y:void 0};switch(g){case"regular":if(null==(m=e.tools)?void 0:m.length)throw new s.A_({functionality:"tools"});if(e.toolChoice)throw new s.A_({functionality:"toolChoice"});return{args:_,warnings:h};case"object-json":throw new s.A_({functionality:"object-json mode"});case"object-tool":throw new s.A_({functionality:"object-tool mode"});default:throw Error(`Unsupported type: ${g}`)}}async doGenerate(e){let{args:t,warnings:o}=this.getArgs(e),{responseHeaders:s,value:l,rawValue:i}=await (0,n.A8)({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:(0,n.NF)(this.config.headers(),e.headers),body:t,failedResponseHandler:u,successfulResponseHandler:(0,n.tc)(v),abortSignal:e.abortSignal,fetch:this.config.fetch}),{prompt:a,...c}=t,d=l.choices[0];return{text:d.text,usage:{promptTokens:l.usage.prompt_tokens,completionTokens:l.usage.completion_tokens},finishReason:r(d.finish_reason),logprobs:y(d.logprobs),rawCall:{rawPrompt:a,rawSettings:c},rawResponse:{headers:s,body:i},response:p(l),warnings:o,request:{body:JSON.stringify(t)}}}async doStream(e){let t;let{args:o,warnings:s}=this.getArgs(e),l={...o,stream:!0,stream_options:"strict"===this.config.compatibility?{include_usage:!0}:void 0},{responseHeaders:i,value:a}=await (0,n.A8)({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:(0,n.NF)(this.config.headers(),e.headers),body:l,failedResponseHandler:u,successfulResponseHandler:(0,n.cP)(z),abortSignal:e.abortSignal,fetch:this.config.fetch}),{prompt:c,...d}=o,m="unknown",g={promptTokens:Number.NaN,completionTokens:Number.NaN},h=!0;return{stream:a.pipeThrough(new TransformStream({transform(e,o){if(!e.success){m="error",o.enqueue({type:"error",error:e.error});return}let n=e.value;if("error"in n){m="error",o.enqueue({type:"error",error:n.error});return}h&&(h=!1,o.enqueue({type:"response-metadata",...p(n)})),null!=n.usage&&(g={promptTokens:n.usage.prompt_tokens,completionTokens:n.usage.completion_tokens});let s=n.choices[0];(null==s?void 0:s.finish_reason)!=null&&(m=r(s.finish_reason)),(null==s?void 0:s.text)!=null&&o.enqueue({type:"text-delta",textDelta:s.text});let l=y(null==s?void 0:s.logprobs);(null==l?void 0:l.length)&&(void 0===t&&(t=[]),t.push(...l))},flush(e){e.enqueue({type:"finish",finishReason:m,logprobs:t,usage:g})}})),rawCall:{rawPrompt:c,rawSettings:d},rawResponse:{headers:i},warnings:s,request:{body:JSON.stringify(l)}}}},v=l.z.object({id:l.z.string().nullish(),created:l.z.number().nullish(),model:l.z.string().nullish(),choices:l.z.array(l.z.object({text:l.z.string(),finish_reason:l.z.string(),logprobs:l.z.object({tokens:l.z.array(l.z.string()),token_logprobs:l.z.array(l.z.number()),top_logprobs:l.z.array(l.z.record(l.z.string(),l.z.number())).nullable()}).nullish()})),usage:l.z.object({prompt_tokens:l.z.number(),completion_tokens:l.z.number()})}),z=l.z.union([l.z.object({id:l.z.string().nullish(),created:l.z.number().nullish(),model:l.z.string().nullish(),choices:l.z.array(l.z.object({text:l.z.string(),finish_reason:l.z.string().nullish(),index:l.z.number(),logprobs:l.z.object({tokens:l.z.array(l.z.string()),token_logprobs:l.z.array(l.z.number()),top_logprobs:l.z.array(l.z.record(l.z.string(),l.z.number())).nullable()}).nullish()})),usage:l.z.object({prompt_tokens:l.z.number(),completion_tokens:l.z.number()}).nullish()}),a]),w=class{constructor(e,t,o){this.specificationVersion="v1",this.modelId=e,this.settings=t,this.config=o}get provider(){return this.config.provider}get maxEmbeddingsPerCall(){var e;return null!=(e=this.settings.maxEmbeddingsPerCall)?e:2048}get supportsParallelCalls(){var e;return null==(e=this.settings.supportsParallelCalls)||e}async doEmbed({values:e,headers:t,abortSignal:o}){if(e.length>this.maxEmbeddingsPerCall)throw new s.ON({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});let{responseHeaders:l,value:i}=await (0,n.A8)({url:this.config.url({path:"/embeddings",modelId:this.modelId}),headers:(0,n.NF)(this.config.headers(),t),body:{model:this.modelId,input:e,encoding_format:"float",dimensions:this.settings.dimensions,user:this.settings.user},failedResponseHandler:u,successfulResponseHandler:(0,n.tc)(k),abortSignal:o,fetch:this.config.fetch});return{embeddings:i.data.map(e=>e.embedding),usage:i.usage?{tokens:i.usage.prompt_tokens}:void 0,rawResponse:{headers:l}}}},k=l.z.object({data:l.z.array(l.z.object({embedding:l.z.array(l.z.number())})),usage:l.z.object({prompt_tokens:l.z.number()}).nullish()}),j={"dall-e-3":1,"dall-e-2":10},x=class{constructor(e,t,o){this.modelId=e,this.settings=t,this.config=o,this.specificationVersion="v1"}get maxImagesPerCall(){var e,t;return null!=(t=null!=(e=this.settings.maxImagesPerCall)?e:j[this.modelId])?t:1}get provider(){return this.config.provider}async doGenerate({prompt:e,n:t,size:o,aspectRatio:s,seed:l,providerOptions:i,headers:r,abortSignal:a}){var p,c,d,m;let g=[];null!=s&&g.push({type:"unsupported-setting",setting:"aspectRatio",details:"This model does not support aspect ratio. Use `size` instead."}),null!=l&&g.push({type:"unsupported-setting",setting:"seed"});let h=null!=(d=null==(c=null==(p=this.config._internal)?void 0:p.currentDate)?void 0:c.call(p))?d:new Date,{value:f,responseHeaders:b}=await (0,n.A8)({url:this.config.url({path:"/images/generations",modelId:this.modelId}),headers:(0,n.NF)(this.config.headers(),r),body:{model:this.modelId,prompt:e,n:t,size:o,...null!=(m=i.openai)?m:{},response_format:"b64_json"},failedResponseHandler:u,successfulResponseHandler:(0,n.tc)(I),abortSignal:a,fetch:this.config.fetch});return{images:f.data.map(e=>e.b64_json),warnings:g,response:{timestamp:h,modelId:this.modelId,headers:b}}}},I=l.z.object({data:l.z.array(l.z.object({b64_json:l.z.string()}))}),C=function(e={}){var t,o,s;let l=null!=(t=(0,n.QT)(e.baseURL))?t:"https://api.openai.com/v1",i=null!=(o=e.compatibility)?o:"compatible",r=null!=(s=e.name)?s:"openai",a=()=>({Authorization:`Bearer ${(0,n.pd)({apiKey:e.apiKey,environmentVariableName:"OPENAI_API_KEY",description:"OpenAI"})}`,"OpenAI-Organization":e.organization,"OpenAI-Project":e.project,...e.headers}),u=(t,o={})=>new c(t,o,{provider:`${r}.chat`,url:({path:e})=>`${l}${e}`,headers:a,compatibility:i,fetch:e.fetch}),p=(t,o={})=>new _(t,o,{provider:`${r}.completion`,url:({path:e})=>`${l}${e}`,headers:a,compatibility:i,fetch:e.fetch}),d=(t,o={})=>new w(t,o,{provider:`${r}.embedding`,url:({path:e})=>`${l}${e}`,headers:a,fetch:e.fetch}),m=(t,o={})=>new x(t,o,{provider:`${r}.image`,url:({path:e})=>`${l}${e}`,headers:a,fetch:e.fetch}),g=(e,t)=>{if(new.target)throw Error("The OpenAI model function cannot be called with the new keyword.");return"gpt-3.5-turbo-instruct"===e?p(e,t):u(e,t)},h=function(e,t){return g(e,t)};return h.languageModel=g,h.chat=u,h.completion=p,h.embedding=d,h.textEmbedding=d,h.textEmbeddingModel=d,h.image=m,h.imageModel=m,h}({compatibility:"strict"})}};